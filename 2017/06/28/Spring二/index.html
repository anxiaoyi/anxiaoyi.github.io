<html>
<head>
	
	<title>Spring (二) - 默认标签的解析</title>
	<meta name="keywords" content="代码人生,程序员,赵坤" />

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
    <!--<link rel="stylesheet" href="/css/main.css">-->
	<link href="/css/main.css?v=2" rel="stylesheet" type="text/css" />
    <!--<link rel="stylesheet" href="/css/style.css">-->
    

    <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">

    
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2"/>
    

</head>

<body>

<h2 id="Spring-二-默认标签的解析"><a href="#Spring-二-默认标签的解析" class="headerlink" title="Spring (二) - 默认标签的解析"></a>Spring (二) - 默认标签的解析</h2><h3 id="1-默认标签的解析"><a href="#1-默认标签的解析" class="headerlink" title="1. 默认标签的解析"></a>1. 默认标签的解析</h3><p><code>parseDefaultElement</code> 对 4 种不同的标签 <code>import</code>、<code>alias</code>、<code>bean</code>、<code>beans</code> 做了不同的处理:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// DefaultBeanDefinitionDocumentReader.java</span></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseDefaultElement</span><span class="params">(Element ele, BeanDefinitionParserDelegate delegate)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (delegate.nodeNameEquals(ele, IMPORT_ELEMENT)) &#123;</div><div class="line">        importBeanDefinitionResource(ele);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, ALIAS_ELEMENT)) &#123;</div><div class="line">        processAliasRegistration(ele);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, BEAN_ELEMENT)) &#123;</div><div class="line">        processBeanDefinition(ele, delegate);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, NESTED_BEANS_ELEMENT)) &#123;</div><div class="line">        <span class="comment">// recurse</span></div><div class="line">        doRegisterBeanDefinitions(ele);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="2-解析-bean-标签并注册"><a href="#2-解析-bean-标签并注册" class="headerlink" title="2. 解析 bean 标签并注册"></a>2. 解析 bean 标签并注册</h3><p><code>processBeanDefinition</code> 方法调用的时序图:</p>
<p><img src="processBeanDefinition.svg" alt=""></p>
<h4 id="2-1-解析-bean"><a href="#2-1-解析-bean" class="headerlink" title="2.1 解析 bean:"></a>2.1 解析 <code>bean</code>:</h4><p>解析 <code>id</code> 和 <code>name</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// BeanDefinitionParserDelegate.java</span></div><div class="line"><span class="function"><span class="keyword">public</span> BeanDefinitionHolder <span class="title">parseBeanDefinitionElement</span><span class="params">(Element ele, BeanDefinition containingBean)</span> </span>&#123;</div><div class="line">    String id = ele.getAttribute(ID_ATTRIBUTE);</div><div class="line">    String nameAttr = ele.getAttribute(NAME_ATTRIBUTE);</div><div class="line">    <span class="comment">// ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>进一步解析其他属性并统一封装至 <code>GenericBeanDefinition</code> 中:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// BeanDefinitionParserDelegate.java</span></div><div class="line"><span class="function"><span class="keyword">protected</span> AbstractBeanDefinition <span class="title">createBeanDefinition</span><span class="params">(String className, String parentName)</span></span></div><div class="line"><span class="function">    <span class="keyword">throws</span> ClassNotFoundException </span>&#123;</div><div class="line">    <span class="keyword">return</span> BeanDefinitionReaderUtils</div><div class="line">        .createBeanDefinition(parentName,</div><div class="line">                              className,</div><div class="line">                              <span class="keyword">this</span>.readerContext.getBeanClassLoader());</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// BeanDefinitionReaderUtils.java</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> AbstractBeanDefinition</div><div class="line">    createBeanDefinition(String parentName,</div><div class="line">                         String className,</div><div class="line">                         ClassLoader classLoader)</div><div class="line">    <span class="keyword">throws</span> ClassNotFoundException &#123;</div><div class="line"></div><div class="line">    GenericBeanDefinition bd = <span class="keyword">new</span> GenericBeanDefinition();</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    <span class="keyword">return</span> bd;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>BeanDefinition</code> 是 <code>&lt;bean&gt;</code> 在容器中的内部表示形式，<code>BeanDefinition</code> 和 <code>&lt;bean&gt;</code> 是一一对应的。<code>BeanDefinition</code> 会被注册到 <code>BeanDefinitionRegistry</code> 中，<code>BeanDefinitionRegistry</code> 就像 <code>Spring</code> 配置信息的内存数据库。</p>
<p><img src="AbstractBeanDefinition.svg" alt=""></p>
<p>如果 <code>bean</code> 没有指定名字，那么使用默认规则生成 <code>beanName</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// BeanDefinitionParserDelegate.java</span></div><div class="line">beanName = BeanDefinitionReaderUtils</div><div class="line">    .generateBeanName(beanDefinition, <span class="keyword">this</span>.readerContext.getRegistry(), <span class="keyword">true</span>);</div></pre></td></tr></table></figure>
<p>将获取到的信息封装到 <code>BeanDefinitionHolder</code> 实例中:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// BeanDefinitionParserDelegate.java</span></div><div class="line"><span class="function"><span class="keyword">public</span> BeanDefinitionHolder <span class="title">parseBeanDefinitionElement</span><span class="params">(Element ele, BeanDefinition containingBean)</span> </span>&#123;</div><div class="line">    <span class="comment">// ...</span></div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> BeanDefinitionHolder(beanDefinition, beanName, aliasesArray);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="2-2-注册解析的-BeanDefinition"><a href="#2-2-注册解析的-BeanDefinition" class="headerlink" title="2.2 注册解析的 BeanDefinition:"></a>2.2 注册解析的 <code>BeanDefinition</code>:</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// BeanDefinitionReaderUtils.java</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">registerBeanDefinition</span><span class="params">(BeanDefinitionHolder definitionHolder,</span></span></div><div class="line"><span class="function"><span class="params">                                          BeanDefinitionRegistry registry)</span></span></div><div class="line"><span class="function">    <span class="keyword">throws</span> BeanDefinitionStoreException </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">// Register bean definition under primary name.</span></div><div class="line">    String beanName = definitionHolder.getBeanName();</div><div class="line">    registry.registerBeanDefinition(beanName, definitionHolder.getBeanDefinition());</div><div class="line"></div><div class="line">    <span class="comment">// Register aliases for bean name, if any.</span></div><div class="line">    String[] aliases = definitionHolder.getAliases();</div><div class="line">    <span class="keyword">if</span> (aliases != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">for</span> (String alias : aliases) &#123;</div><div class="line">            registry.registerAlias(beanName, alias);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="BeanDefinitionRegistry.svg" alt=""></p>
<p><code>BeanDefinitionRegistry</code> 是用户代码自己提供的:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">BeanDefinitionRegistry beanFactory = <span class="keyword">new</span> DefaultListableBeanFactory();</div><div class="line">XmlBeanDefinitionReader reader = <span class="keyword">new</span> XmlBeanDefinitionReader(beanFactory);</div></pre></td></tr></table></figure>
<p>因此我们分析 <code>DefaultListableBeanFactory</code> 中的 <code>registerBeanDefinition</code> 方法即可:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// DefaultListableBeanFactory.java</span></div><div class="line"></div><div class="line"><span class="comment">/** Map of bean definition objects, keyed by bean name */</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, BeanDefinition&gt; beanDefinitionMap = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(<span class="number">256</span>);</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBeanDefinition</span><span class="params">(String beanName, BeanDefinition beanDefinition)</span></span></div><div class="line"><span class="function">    <span class="keyword">throws</span> BeanDefinitionStoreException </span>&#123;</div><div class="line">    <span class="keyword">if</span> (beanDefinition <span class="keyword">instanceof</span> AbstractBeanDefinition) &#123;</div><div class="line">        ((AbstractBeanDefinition) beanDefinition).validate();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    oldBeanDefinition = <span class="keyword">this</span>.beanDefinitionMap.get(beanName);</div><div class="line">    <span class="keyword">if</span> (oldBeanDefinition != <span class="keyword">null</span>) &#123;</div><div class="line">        <span class="keyword">this</span>.beanDefinitionMap.put(beanName, beanDefinition);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">if</span> (hasBeanCreationStarted()) &#123;</div><div class="line">            <span class="comment">// Cannot modify startup-time collection elements anymore (for stable iteration)</span></div><div class="line">            <span class="keyword">synchronized</span> (<span class="keyword">this</span>.beanDefinitionMap) &#123;</div><div class="line">                <span class="keyword">this</span>.beanDefinitionMap.put(beanName, beanDefinition);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>而沿着类的继承链会发现 <code>registerAlias</code> 的方法是在 <code>SimpleAliasRegistry</code> 中实现的:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** Map from alias to canonical name */</span></div><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, String&gt; aliasMap = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(<span class="number">16</span>);</div><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerAlias</span><span class="params">(String name, String alias)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (alias.equals(name)) &#123;</div><div class="line">        <span class="keyword">this</span>.aliasMap.remove(alias);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        String registeredName = <span class="keyword">this</span>.aliasMap.get(alias);</div><div class="line">        <span class="keyword">if</span> (registeredName != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (registeredName.equals(name)) &#123;</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        checkForAliasCircle(name, alias);</div><div class="line">        <span class="keyword">this</span>.aliasMap.put(alias, name);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong><code>checkForAliasCircle</code> 用于检查 <code>alias</code> 循环依赖</strong>，当 <code>A -&gt; B</code> 存在时，若再次出现 <code>A -&gt; C -&gt; B</code> 则会抛出异常:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">checkForAliasCircle</span><span class="params">(String name, String alias)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (hasAlias(alias, name)) &#123;</div><div class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasAlias</span><span class="params">(String name, String alias)</span> </span>&#123;</div><div class="line">    <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; entry : <span class="keyword">this</span>.aliasMap.entrySet()) &#123;</div><div class="line">        String registeredName = entry.getValue();</div><div class="line">        <span class="keyword">if</span> (registeredName.equals(name)) &#123;</div><div class="line">            String registeredAlias = entry.getKey();</div><div class="line">            <span class="keyword">return</span> (registeredAlias.equals(alias) || hasAlias(registeredAlias, alias));</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="2-3-通知监听器解析及注册完成"><a href="#2-3-通知监听器解析及注册完成" class="headerlink" title="2.3 通知监听器解析及注册完成"></a>2.3 通知监听器解析及注册完成</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// DefaultBeanDefinitionDocumentReader.java</span></div><div class="line">getReaderContext().fireComponentRegistered(<span class="keyword">new</span> BeanComponentDefinition(bdHolder));</div></pre></td></tr></table></figure>
<p>其中 <code>ReaderContext</code> 是在类 <code>XmlBeanDefinitionReader</code> 中调用 <code>createReaderContext</code> 生成的:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// XmlBeanDefinitionReader.java</span></div><div class="line"><span class="keyword">private</span> ReaderEventListener eventListener = <span class="keyword">new</span> EmptyReaderEventListener();</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> XmlReaderContext <span class="title">createReaderContext</span><span class="params">(Resource resource)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> XmlReaderContext(resource,</div><div class="line">                                <span class="keyword">this</span>.problemReporter,</div><div class="line">                                <span class="keyword">this</span>.eventListener,</div><div class="line">                                <span class="keyword">this</span>.sourceExtractor,</div><div class="line">                                <span class="keyword">this</span>,</div><div class="line">                                getNamespaceHandlerResolver());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>ReaderContext</code> 调用的是 <code>EventListener</code> 的 <code>componentRegistered</code> 方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReaderContext</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ReaderContext</span><span class="params">(Resource resource,</span></span></div><div class="line"><span class="function"><span class="params">                         ProblemReporter problemReporter,</span></span></div><div class="line"><span class="function"><span class="params">                         ReaderEventListener eventListener,</span></span></div><div class="line"><span class="function"><span class="params">                         SourceExtractor sourceExtractor)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.resource = resource;</div><div class="line">		<span class="keyword">this</span>.problemReporter = problemReporter;</div><div class="line">		<span class="keyword">this</span>.eventListener = eventListener;</div><div class="line">		<span class="keyword">this</span>.sourceExtractor = sourceExtractor;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fireComponentRegistered</span><span class="params">(ComponentDefinition componentDefinition)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.eventListener.componentRegistered(componentDefinition);</div><div class="line">	&#125;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><img src="EventListener.svg" alt=""></p>
<p>由此可见，这里的事件通知只为扩展，目前 <code>Spring</code> 没有对此事件做任何逻辑处理。</p>
<h3 id="3-解析-Alias-标签"><a href="#3-解析-Alias-标签" class="headerlink" title="3. 解析 Alias 标签:"></a>3. 解析 Alias 标签:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// DefaultBeanDefinitionDocumentReader.java</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">processAliasRegistration</span><span class="params">(Element ele)</span> </span>&#123;</div><div class="line">    String name = ele.getAttribute(NAME_ATTRIBUTE);</div><div class="line">    String alias = ele.getAttribute(ALIAS_ATTRIBUTE);</div><div class="line">    getReaderContext().getRegistry().registerAlias(name, alias);</div><div class="line">    getReaderContext().fireAliasRegistered(name, alias, extractSource(ele));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="4-解析-import-标签"><a href="#4-解析-import-标签" class="headerlink" title="4. 解析 import 标签:"></a>4. 解析 import 标签:</h3><p>获取位于 <code>&lt;resource&gt;</code> 属性中所表示的路径，然后判断是相对路径还是绝对路径，最后重新进行这个路径上 <code>bean</code> 资源文件的读取与加载:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// DefaultBeanDefinitionDocumentReader.java</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">importBeanDefinitionResource</span><span class="params">(Element ele)</span> </span>&#123;</div><div class="line">    String location = ele.getAttribute(RESOURCE_ATTRIBUTE);</div><div class="line"></div><div class="line">    <span class="comment">// Resolve system properties: e.g. "$&#123;user.dir&#125;"</span></div><div class="line">    location = getReaderContext().getEnvironment().resolveRequiredPlaceholders(location);</div><div class="line"></div><div class="line">    <span class="comment">// Discover whether the location is an absolute or relative URI</span></div><div class="line">    <span class="keyword">boolean</span> absoluteLocation = ResourcePatternUtils.isUrl(location) || ResourceUtils.toURI(location).isAbsolute();</div><div class="line"></div><div class="line">    <span class="comment">// Absolute or relative?</span></div><div class="line">    <span class="keyword">if</span> (absoluteLocation) &#123;</div><div class="line">        <span class="comment">// Another parse</span></div><div class="line">        getReaderContext().getReader().loadBeanDefinitions(location, actualResources);</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// Convert relative to absolute path</span></div><div class="line">        <span class="keyword">int</span> importCount;</div><div class="line">        Resource relativeResource = getReaderContext().getResource().createRelative(location);</div><div class="line">        <span class="keyword">if</span> (relativeResource.exists()) &#123;</div><div class="line">            importCount = getReaderContext().getReader().loadBeanDefinitions(relativeResource);</div><div class="line">         &#125;</div><div class="line">    &#125;</div><div class="line">    getReaderContext().fireImportProcessed(location, actResArray, extractSource(ele));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="5-嵌入式-beans-标签的解析"><a href="#5-嵌入式-beans-标签的解析" class="headerlink" title="5. 嵌入式 beans 标签的解析"></a>5. 嵌入式 beans 标签的解析</h3><p>递归调用 <code>beans</code> 的解析过程</p>






</body>
</html>
