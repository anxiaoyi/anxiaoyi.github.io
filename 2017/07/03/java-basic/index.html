<html>
<head>
	
	<!-- hexo-inject:begin --><!-- hexo-inject:end --><title>Java Basic</title>
	<meta name="keywords" content="代码人生,程序员,赵坤" />

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    
    <!--<link rel="stylesheet" href="/css/main.css">-->
	<link href="/css/main.css?v=2" rel="stylesheet" type="text/css" />
    <!--<link rel="stylesheet" href="/css/style.css">-->
    

    <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">

    
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=2"/><!-- hexo-inject:begin --><!-- hexo-inject:end -->
    

</head>

<body>

<!-- hexo-inject:begin --><!-- hexo-inject:end --><h2 id="Java-Basic"><a href="#Java-Basic" class="headerlink" title="Java Basic"></a>Java Basic</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:webupd8team/java</span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install oracle-java8-set-default</span><br></pre></td></tr></table></figure>
<hr>
<p>手动安装:</p>
<ul>
<li>下载 a <code>.tar.gz</code> from <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">Oracle</a> (here I will be using <code>jdk-8u20-linux-x64.tar.gz</code>);</li>
<li>解压</li>
<li><code>sudo mv /path/to/jdk1.8.0_20 /usr/lib/jvm/oracle_jdk8</code></li>
<li>Before addin this jdk as an alternative, you can see that the new alternative is not listed:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --query java</span><br><span class="line">sudo update-alternatives --query javac</span><br></pre></td></tr></table></figure>
<ul>
<li>Next, add the new jdk alternatives (2000 is the priority and feel free to pick a different number):</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --install /usr/bin/java java /usr/lib/jvm/oracle_jdk8/jre/bin/java 2000</span><br><span class="line">sudo update-alternatives --install /usr/bin/javac javac /usr/lib/jvm/oracle_jdk8/bin/javac 2000</span><br></pre></td></tr></table></figure>
<ul>
<li>Now you should see the new jdk listed and you can switch between the alternatives with this command:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --config java</span><br><span class="line">sudo update-alternatives --config javac</span><br></pre></td></tr></table></figure>
<hr>
<p>安装完成后记得，导出 <code>Java</code> 常用命令的路径到环境变量 <code>PATH</code> 中:</p>
<p><img src="2017_09_01_12_19_07.png" alt=""></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:<span class="string">"/usr/lib/jvm/oracle_jdk8/jdk1.8.0_144/bin"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>参考: <a href="https://askubuntu.com/questions/521145/how-to-install-oracle-java-on-ubuntu-14-04" target="_blank" rel="noopener">How to install Oracle Java on Ubuntu 14.04?</a></li>
</ul>
<h3 id="如何获取源代码"><a href="#如何获取源代码" class="headerlink" title="如何获取源代码"></a>如何获取源代码</h3><p><img src="2017_09_03_20_52_31.png" alt=""></p>
<p>然而这部分代码不包含 <code>rt.jar</code> 的源码</p>
<h3 id="Java-Enum"><a href="#Java-Enum" class="headerlink" title="Java Enum"></a>Java Enum</h3><p>(1) Java 枚举内部可以放置静态方法:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public enum JavaBeanAccessor &#123;</span><br><span class="line"></span><br><span class="line">    /** Field accessor. */</span><br><span class="line">    FIELD,</span><br><span class="line">    /** Method accessor.*/</span><br><span class="line">    METHO,D</span><br><span class="line">    /** Method prefer to field. */</span><br><span class="line">    ALL;</span><br><span class="line"></span><br><span class="line">    public static boolean isAccessByMethod(JavaBeanAccessor accessor) &#123;</span><br><span class="line">        <span class="built_in">return</span> METHOD.equals(accessor) || ALL.equals(accessor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Java-排序"><a href="#Java-排序" class="headerlink" title="Java 排序"></a>Java 排序</h3><p>关于 <code>Comparable&lt;T&gt;</code> 接口: Returns a <strong>负数, 0, 正数</strong> as this object is <strong>小于, 等于, 大于</strong> the specified object. 默认是按照 Sorts the specified list into <strong>升序</strong>排列:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Collections.sort(appSiteList);</span><br><span class="line">Collections.reverse(appSiteList);</span><br></pre></td></tr></table></figure>
<h3 id="Java-Operate-Time"><a href="#Java-Operate-Time" class="headerlink" title="Java Operate Time"></a>Java Operate Time</h3><ul>
<li><a href="https://stackoverflow.com/questions/999172/how-to-parse-a-date" target="_blank" rel="noopener">How to parse date</a></li>
<li>如何加减时间</li>
</ul>
<hr>
<p><strong>字符串转为 <code>java.util.Date</code> 对象</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String input = <span class="string">"Thu Jun 18 20:56:02 EDT 2009"</span>;</span><br><span class="line">SimpleDateFormat parser = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"EEE MMM d HH:mm:ss zzz yyyy"</span>, Locale.ENGLISH);</span><br><span class="line">Date date = parser.parse(input);</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>Java 8 字符串转为 <code>java.util.Date</code> 对象</strong>:</p>
<p>If you happen to be on Java 8 already, then use <a href="https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html" target="_blank" rel="noopener"><code>DateTimeFormatter</code></a> (also here, click the link to see all predefined formatters and available format patterns; <a href="https://docs.oracle.com/javase/tutorial/datetime/iso/format.html" target="_blank" rel="noopener">the tutorial is available here</a>).</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String string = <span class="string">"January 2, 2010"</span>;</span><br><span class="line">DateTimeFormatter formatter = DateTimeFormatter.ofPattern(<span class="string">"MMMM d, yyyy"</span>, Locale.ENGLISH);</span><br><span class="line">LocalDate date = LocalDate.parse(string, formatter);</span><br><span class="line">System.out.println(date); <span class="comment">// 2010-01-02</span></span><br></pre></td></tr></table></figure>
<p>如何将 <code>LocalDate</code> 转为 <code>Date</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.util.Date date = java.sql.Date.valueOf(localDate);</span><br></pre></td></tr></table></figure>
<hr>
<p>如何将 <code>java.sql.Time</code> 转为 <code>millseconds</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time.getTime()</span><br></pre></td></tr></table></figure>
<hr>
<p>如何 <code>millseconds</code> 创建 <code>java.sql.Time</code>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Constructs a &lt;code&gt;Time&lt;/code&gt; object using a milliseconds time value.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> time milliseconds since January 1, 1970, 00:00:00 GMT;</span></span><br><span class="line"><span class="comment"> *             a negative number is milliseconds before</span></span><br><span class="line"><span class="comment"> *               January 1, 1970, 00:00:00 GMT</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Time</span><span class="params">(<span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(time);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong><code>java.util.Date</code> 对象格式化为字符串</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SimpleDateFormat formatter = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd"</span>, Locale.ENGLISH);</span><br><span class="line">String formattedDate = formatter.format(date);</span><br></pre></td></tr></table></figure>
<p>Note the importance of explicit <code>Locale</code> argument. If you omit it, then it will use the <a href="http://docs.oracle.com/javase/8/docs/api/java/util/Locale.html#getDefault--" target="_blank" rel="noopener">default locale</a> which is not necessarily English as used in the month name of the input string. If the locale doesn’t match with the input string, then you would confusingly get a <code>java.text.ParseException</code> even though when the format pattern seems valid.</p>
<hr>
<p><strong>时间戳转为 <code>java.util.Date</code></strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> java.util.Date(System.currentTimeMillis())</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>时间加减</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LocalDateTime currentTime = LocalDateTime.now(ZoneId.of(<span class="string">"UTC"</span>));</span><br><span class="line">LocalDateTime nextTime = currentTime.plusHours(<span class="number">12</span>);</span><br></pre></td></tr></table></figure>
<p>这个构造 <code>LocalDateTime</code> 的时候，必须使用参数 <code>Clock.systemUTC()</code>，否则算出来的时间是错误的:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LocalDateTime currentTime = LocalDateTime.now(Clock.systemUTC());</span><br></pre></td></tr></table></figure>
<p><strong><code>LocalDateTime</code></strong> 转为 <strong><code>java.util.Date</code></strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Instant instant = localDateTime.toInstant(ZoneOffset.UTC);</span><br><span class="line">Date date = Date.from(instant);</span><br></pre></td></tr></table></figure>
<p><strong><code>java.util.Date</code></strong> 转为 <strong><code>LocalDateTime</code></strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Instant instant = Instant.ofEpochMilli(date.getTime());</span><br><span class="line">LocalDateTime ldt = LocalDateTime.ofInstant(instant, ZoneOffset.UTC);</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>格式化模式</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Letter  Date or Time Component  Presentation        Examples</span><br><span class="line">------  ----------------------  ------------------  -------------------------------------</span><br><span class="line">G       Era designator          Text                AD</span><br><span class="line">y       Year                    Year                1996; 96</span><br><span class="line">Y       Week year               Year                2009; 09</span><br><span class="line">M/L     Month in year           Month               July; Jul; 07</span><br><span class="line">w       Week in year            Number              27</span><br><span class="line">W       Week in month           Number              2</span><br><span class="line">D       Day in year             Number              189</span><br><span class="line">d       Day in month            Number              10</span><br><span class="line">F       Day of week in month    Number              2</span><br><span class="line">E       Day in week             Text                Tuesday; Tue</span><br><span class="line">u       Day number of week      Number              1</span><br><span class="line">a       Am/pm marker            Text                PM</span><br><span class="line">H       Hour in day (0-23)      Number              0</span><br><span class="line">k       Hour in day (1-24)      Number              24</span><br><span class="line">K       Hour in am/pm (0-11)    Number              0</span><br><span class="line">h       Hour in am/pm (1-12)    Number              12</span><br><span class="line">m       Minute in hour          Number              30</span><br><span class="line">s       Second in minute        Number              55</span><br><span class="line">S       Millisecond             Number              978</span><br><span class="line">z       Time zone               General time zone   Pacific Standard Time; PST; GMT-08:00</span><br><span class="line">Z       Time zone               RFC 822 time zone   -0800</span><br><span class="line">X       Time zone               ISO 8601 time zone  -08; -0800; -08:00</span><br></pre></td></tr></table></figure>
<hr>
<p><code>SimpleDateFormat</code> 示例:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Input string                            Pattern</span><br><span class="line">------------------------------------    ----------------------------</span><br><span class="line">2001.07.04 AD at 12:08:56 PDT           yyyy.MM.dd G &apos;at&apos; HH:mm:ss z</span><br><span class="line">Wed, Jul 4, &apos;01                         EEE, MMM d, &apos;&apos;yy</span><br><span class="line">12:08 PM                                h:mm a</span><br><span class="line">12 o&apos;clock PM, Pacific Daylight Time    hh &apos;o&apos;&apos;clock&apos; a, zzzz</span><br><span class="line">0:08 PM, PDT                            K:mm a, z</span><br><span class="line">02001.July.04 AD 12:08 PM               yyyyy.MMMM.dd GGG hh:mm aaa</span><br><span class="line">Wed, 4 Jul 2001 12:08:56 -0700          EEE, d MMM yyyy HH:mm:ss Z</span><br><span class="line">010704120856-0700                       yyMMddHHmmssZ</span><br><span class="line">2001-07-04T12:08:56.235-0700            yyyy-MM-dd&apos;T&apos;HH:mm:ss.SSSZ</span><br><span class="line">2001-07-04T12:08:56.235-07:00           yyyy-MM-dd&apos;T&apos;HH:mm:ss.SSSXXX</span><br><span class="line">2001-W27-3                              YYYY-&apos;W&apos;ww-u</span><br></pre></td></tr></table></figure>
<p>Important note is that <code>SimpleDateFormat</code> is <strong>非线程安全</strong>. In other words, you should <strong>永远不要</strong> declare and assign it as a <strong>静态</strong> or <strong>实例变量</strong> and then reuse from different methods/threads. You should always create it brand new within the method local scope.</p>
<hr>
<p>根据 <a href="https://docs.oracle.com/javase/8/docs/api/java/time/package-summary.html" target="_blank" rel="noopener">The main API for dates, times, instants, and durations</a>，定义在 <code>java.time</code> 包下面的所有类都是 <strong>immutable and thread-safe</strong> 的。</p>
<hr>
<ul>
<li><strong>格林威治标准时间 <code>GMT</code></strong></li>
</ul>
<p>十七世纪，格林威治皇家天文台为了<strong>海上霸权的扩张计划</strong>而进行天体观测。1675年旧皇家观测所(Old Royal Observatory) 正式成立，到了1884年<strong>决定以通过格林威治的子午线作为划分地球东西两半球的经度零度</strong>。观测所门口墙上有一个标志24小时的时钟，显示当下的时间，对全球而言，<strong>这里所设定的时间是世界时间参考点</strong>，全球都以格林威治的时间作为标准来设定时间，这就是我们耳熟能详的「格林威治标准时间」(Greenwich Mean Time，简称G.M.T.)的由来，标示在手表上，则代表此表具有两地时间功能，也就是同时可以显示原居地和另一个国度的时间。</p>
<ul>
<li><strong>世界协调时间 <code>UTC</code></strong>:</li>
</ul>
<p>多数的两地时间表都以 <code>GMT</code> 来表示，但也有些两地时间表上看不到 <code>GMT</code> 字样，出现的反而是 <code>UTC</code> 这3个英文字母，究竟何谓 <code>UTC</code>？事实上，UTC指的是Coordinated Universal Time－ 世界协调时间（又称世界标准时间、世界统一时间），是经过平均太阳时(以格林威治时间GMT为准)、地轴运动修正后的新时标以及以「秒」为单位的国际原子时所综合精算而成的时间，计算过程相当严谨精密，因此若以「世界标准时间」的角度来说，<strong>UTC比GMT来得更加精准。其误差值必须保持在0.9秒以内</strong>，若大于0.9秒则由位于巴黎的国际地球自转事务中央局发布闰秒，使UTC与地球自转周期一致。所以基本上UTC的本质强调的是比GMT更为精确的世界时间标准，不过对于现行表款来说，GMT与UTC的功能与精确度是没有差别的。</p>
<p>通过下面这样获取的时间比真实的北京时间<strong>慢 8 个小时</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Date currentTime = <span class="keyword">new</span> Date();</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> SimpleDateFormat sdf =</span><br><span class="line">    <span class="keyword">new</span> SimpleDateFormat(<span class="string">"EEE, MMM d, yyyy hh:mm:ss a z"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Give it to me in GMT time.</span></span><br><span class="line">sdf.setTimeZone(TimeZone.getTimeZone(<span class="string">"GMT"</span>));</span><br><span class="line">System.out.println(<span class="string">"GMT time: "</span> + sdf.format(currentTime));</span><br></pre></td></tr></table></figure>
<p><code>GMT</code> 是中央时区,<strong>北京在东8区,相差8个小时</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sdf.setTimeZone(TimeZone.getTimeZone(<span class="string">"GMT+8"</span>));</span><br></pre></td></tr></table></figure>
<p><code>RocketMQ</code> 的 <code>logback</code> 日志的时间戳配置:</p>
<p><img src="2017_12_18_11_03_58.png" alt=""></p>
<h3 id="Java-正则表达式"><a href="#Java-正则表达式" class="headerlink" title="Java 正则表达式"></a>Java 正则表达式</h3><p><strong>查找并替换</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">String oldSequence = <span class="string">"(?&lt;=[A-Z])(%d)"</span>;</span><br><span class="line">String newSequence = <span class="string">"新的字符串"</span>;</span><br><span class="line"></span><br><span class="line">Pattern pattern = Pattern.compile(oldSequence);</span><br><span class="line">Matcher matcher = pattern.matcher(input);</span><br><span class="line"></span><br><span class="line">StringBuffer sb = <span class="keyword">new</span> StringBuffer(input.length());</span><br><span class="line"><span class="keyword">while</span> (matcher.find()) &#123;</span><br><span class="line">    <span class="comment">// (%d) 部分将会被替换，(%d) 前面的部分并不会被替换</span></span><br><span class="line">    matcher.appendReplacement(sb, Matcher.quoteReplacement(<span class="string">"新的字符串"</span>));</span><br><span class="line">&#125;</span><br><span class="line">matcher.appendTail(sb);</span><br><span class="line"></span><br><span class="line">System.out.println(sb.toString());</span><br></pre></td></tr></table></figure>
<hr>
<p>如何找到匹配的字符串:</p>
<p>假设原来的字符串 (即使没有括号) 为: <code>http://down6.apk8.com:8020/qu/星座运程-求签测字[www.apkxyx.com].apk</code>，那么用如下代码运行后:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Pattern ILLEGAL_URL_CHARACTER =</span><br><span class="line">            Pattern.compile(<span class="string">"[\\u4e00-\\u9fa5|\\[|\\]]+"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (matcher.find()) &#123;</span><br><span class="line">    String matched = originDownloadURL.substring(matcher.start(), matcher.end());</span><br><span class="line">    matcher.appendReplacement(stringBuilder,</span><br><span class="line">                              Matcher.quoteReplacement(URLEncoder.encode(matched, <span class="string">"UTF-8"</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>matched</code> 的值依次是:</p>
<ul>
<li><code>星座运程</code></li>
<li><code>求签测字[</code></li>
<li><code>]</code></li>
</ul>
<hr>
<p><a href="http://www.rexegg.com/regex-lookarounds.html" target="_blank" rel="noopener">Mastering Lookahead and Lookbehind</a></p>
<table>
<thead>
<tr>
<th>Lookaround</th>
<th>Name</th>
<th>What it Does</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>(?=foo)</code></td>
<td>Lookahead</td>
<td>Asserts that <strong>what immediately follows</strong> the current position in the string is foo</td>
</tr>
<tr>
<td><code>(?&lt;=foo)</code></td>
<td>Lookbehind</td>
<td>Asserts that <strong>what immediately precedes</strong> the current position in the string is foo</td>
</tr>
<tr>
<td><code>(?!foo)</code></td>
<td>Negative Lookahead</td>
<td>Asserts that <strong>what immediately follows</strong> the current position in the string <strong>is not</strong> foo</td>
</tr>
<tr>
<td><code>(?&lt;!foo)</code></td>
<td>Negative Lookbehind</td>
<td>Asserts that <strong>what immediately precedes</strong> the current position in the string <strong>is not</strong> foo</td>
</tr>
</tbody>
</table>
<hr>
<p><strong>查找匹配的 Group</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">String line = <span class="string">"This order was placed for QT3000! OK?"</span>;</span><br><span class="line">Pattern pattern = Pattern.compile(<span class="string">"(.*?)(\\d+)(.*)"</span>);</span><br><span class="line">Matcher matcher = pattern.matcher(line);</span><br><span class="line"><span class="keyword">while</span> (matcher.find()) &#123;</span><br><span class="line">    System.out.println(<span class="string">"group 0: "</span> + matcher.group(<span class="number">0</span>));</span><br><span class="line">    System.out.println(<span class="string">"group 1: "</span> + matcher.group(<span class="number">1</span>));</span><br><span class="line">    System.out.println(<span class="string">"group 2: "</span> + matcher.group(<span class="number">2</span>));</span><br><span class="line">    System.out.println(<span class="string">"group 3: "</span> + matcher.group(<span class="number">3</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">group 0: This order was placed for QT3000! OK?</span><br><span class="line">group 1: This order was placed for QT</span><br><span class="line">group 2: 3000</span><br><span class="line">group 3: ! OK?</span><br></pre></td></tr></table></figure>
<ul>
<li><strong><code>group(0)</code></strong>: 总是匹配整个正则表达式能覆盖的所有区域</li>
</ul>
<p>Capturing groups are indexed from left to right, <strong>从 1 开始</strong>.  Group zero denotes the entire pattern, so the expression <strong><code>m.group(0)</code></strong> is equivalent to <strong><code>m.group()</code></strong>.</p>
<p>参考: <a href="https://stackoverflow.com/questions/17969436/java-regex-capturing-groups" target="_blank" rel="noopener">Java Regex Capturing Groups</a></p>
<hr>
<p><strong>Predefined character classes</strong>:</p>
<table>
<thead>
<tr>
<th>正则表达式</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>.</code></td>
<td>Any character (may or may not match line terminators)</td>
</tr>
<tr>
<td><code>\d</code></td>
<td>A digit: <code>[0-9]</code></td>
</tr>
<tr>
<td><code>\D</code></td>
<td>A non-digit: <code>[^0-9]</code></td>
</tr>
<tr>
<td><code>\s</code></td>
<td>A whitespace character: <code>[ \t\n\x0B\f\r]</code></td>
</tr>
<tr>
<td><code>\S</code></td>
<td>A non-whitespace character: <code>[^\s]</code></td>
</tr>
<tr>
<td><code>\w</code></td>
<td>A word character: <code>[a-zA-Z_0-9]</code></td>
</tr>
<tr>
<td><code>\W</code></td>
<td>A non-word character: <code>[^\w]</code></td>
</tr>
</tbody>
</table>
<p><strong>Character classes</strong>:</p>
<table>
<thead>
<tr>
<th>正则表达式</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>[abc]</td>
<td>a, b, or c (simple class)</td>
</tr>
<tr>
<td>[\^abc]</td>
<td>除了 a, b, or c 之外的任何字符 (negation)</td>
</tr>
<tr>
<td>[a-zA-Z]</td>
<td>a through z or A through Z, inclusive (range)</td>
</tr>
</tbody>
</table>
<p><strong>Greedy quantifiers</strong>:</p>
<table>
<thead>
<tr>
<th>正则表达式</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>X{n}</td>
<td>X, exactly n times</td>
</tr>
<tr>
<td>X{n,}</td>
<td>X, at least n times</td>
</tr>
<tr>
<td>X{n,m}</td>
<td>X, at least n but not more than m times</td>
</tr>
</tbody>
</table>
<hr>
<p>正则表达式如下这样写，是可以正确匹配的:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// N: "http://download.pchome.net/ios/list-377-1-1.html"</span></span><br><span class="line"><span class="comment">// Y: "http://download.pchome.net/ios/list-957-1-1.html"</span></span><br><span class="line"><span class="comment">// Y: "http://download.pchome.net/ios/list-956-1-1.html"</span></span><br><span class="line"><span class="keyword">final</span> String PAGINATION_URL_REGEX = <span class="string">"http://download\\.pchome\\.net/ios/list-(955|956|957)-1-\\d+\\.html"</span>;</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>贪婪非贪婪 (直接写 <code>.*</code> 的话，就是贪婪匹配)</strong>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*  - zero or more</span><br><span class="line">*? - zero or more (non-greedy)</span><br><span class="line">+  - one or more</span><br><span class="line">+? - one or more (non-greedy)</span><br><span class="line">?  - zero or one</span><br><span class="line">?? - zero or one (non-greedy)</span><br></pre></td></tr></table></figure>
<hr>
<p><code>\</code> is special character in regex (used for instance to create <code>\d</code> - character class representing digits). To make regex treat <code>\</code> as normal character you need to place <strong>另外一个</strong> <code>\</code> before it to turn off its special meaning (you need to escape it). So regex which we are trying to create is <code>\\</code>.</p>
<p>But to create string representing <code>\\</code> so you could pass it to regex engine you need to write it as <strong>四个 <code>\</code> (“\\“)</strong>, because <code>\</code> is also special character in String (it can be used for instance as <code>\t</code> to represent tabulator) so you also need to escape both <code>\</code> there.</p>
<p>将 <code>http:\/\/chelpus.defcon5.biz\/LuckyPatcher.apk</code> 中的反斜杠替换为空字符串：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url.replaceAll(<span class="string">"\\\\"</span>, <span class="string">""</span>);</span><br></pre></td></tr></table></figure>
<p>最终结果为: <code>http://chelpus.defcon5.biz/LuckyPatcher.apk</code></p>
<p>但是如果你 <strong>不想用正则</strong> 替换的话，那么可以写:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"http:\\/\\/chelpus.defcon5.biz\\/LuckyPatcher.apk"</span>.replace(<span class="string">"\\"</span>, <span class="string">""</span>)</span><br></pre></td></tr></table></figure>
<p>也能达到相同的效果。</p>
<hr>
<p><strong>Java Special MetaCharacters</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;([&#123;\^-=$!|]&#125;)?*+.&gt;</span><br></pre></td></tr></table></figure>
<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"something"</span>.split(<span class="string">"\""</span>);</span><br></pre></td></tr></table></figure>
<h3 id="Java-Properties"><a href="#Java-Properties" class="headerlink" title="Java Properties"></a>Java Properties</h3><p><img src="17-08-08-09_57_08_605_310.png" alt=""></p>
<h3 id="indexOf"><a href="#indexOf" class="headerlink" title="indexOf"></a><code>indexOf</code></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> index = <span class="string">"abcdefghijklmn"</span>.indexOf( <span class="string">"def"</span> );</span><br></pre></td></tr></table></figure>
<p><strong><code>index</code> 的值是指向的 <code>d</code></strong>，而不是 <code>f</code> 的下标:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">   ↓</span><br><span class="line">abcdefghijklmn</span><br></pre></td></tr></table></figure>
<h3 id="Java-异常"><a href="#Java-异常" class="headerlink" title="Java 异常"></a>Java 异常</h3><p><strong>红颜色 are checked exceptions</strong>. Any checked exceptions that may be thrown in a method <strong>must either 被捕获 or declared in the method’s throws clause</strong>. Checked exceptions must be caught <strong>在编译阶段</strong>. Checked exceptions are so called because both the Java compiler and the Java virtual machine check to make sure this rule is obeyed. <strong>绿颜色 are uncheck exceptions</strong>. They are exceptions that are not expected to be recovered, such as null pointer, divide by 0, etc.</p>
<p><img src="Exception-Hierarchy-Diagram.jpeg" alt=""></p>
<p><strong>(1) 空指针异常</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Obj</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> STATUS = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (obj.getStatus() == STATUS) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这句话当 <code>obj.getStatus()</code> 返回 <code>null</code> 的时候，会<strong>直接抛出空指针异常</strong></p>
<p><strong>(2) Java Doc 注释异常</strong>:</p>
<p><img src="17-07-28-17_05_46_661_130.png" alt=""></p>
<p><code>Maven</code> 或者 <code>Gradle</code> 在编译这样的代码的时候，也<strong>有可能报异常</strong>，因此在 <strong>Refactor</strong> 代码的时候，最好采用 <code>Intellij Idea</code> 编译器本身自带的 <code>Refactor</code> 功能来进行代码的重构与优化，避免出现此类错误。</p>
<p><strong>(3) Java Content-Type 判断错误</strong>:</p>
<p>仅在 <code>Ubuntu</code> 系统下用 <code>Chrome</code> 浏览器上传 APK 文件，然后服务器这边获取到了 <code>APK</code> 文件的 <code>Content-Type</code>，就仅通过下面这句代码来判断是否是 <code>APK</code> 文件:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">contentType.equals(<span class="string">"application/vnd.android.package-archive"</span>)</span><br></pre></td></tr></table></figure>
<p>最终出现的状况就是，在 <code>Windows</code> 和在 <code>Mac</code> 操作系统上，<code>APK</code> 文件都被判断为非 <code>APK</code> 文件了:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">isApk = contentType.equals(<span class="string">"application/octet-stream"</span>) ||</span><br><span class="line">        contentType.equals(<span class="string">"application/vnd.android.package-archive"</span>);</span><br></pre></td></tr></table></figure>
<p>同样的问题也出现在，做的单页面网站<strong>在 <code>Windows</code> 操作系统下</strong>，使用 <code>IE</code> 内核出现各种意想不到的错误与问题。</p>
<h3 id="Return-from-Finally"><a href="#Return-from-Finally" class="headerlink" title="Return from Finally"></a>Return from Finally</h3><p>下面代码结构的 <code>finally</code> 依然会执行:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Java-较旧的版本安装的问题"><a href="#Java-较旧的版本安装的问题" class="headerlink" title="Java 较旧的版本安装的问题"></a><code>Java</code> 较旧的版本安装的问题</h3><p>下载 <code>Java</code> 较为旧的版本，<a href="http://www.oracle.com/technetwork/java/javasebusiness/downloads/java-archive-downloads-javase5-419410.html" target="_blank" rel="noopener">官网</a>一般会提供一种叫做 <code>.bin</code> 格式的文件:</p>
<p><img src="2017_08_31_20_46_17.png" alt=""></p>
<p>参考 <a href="http://www.oracle.com/technetwork/java/javase/install-linux-64-self-extracting-142068.html" target="_blank" rel="noopener">JDK Self-Extracting Installation for Linux (64-bit)</a>，其实这种文件的解压很简单，执行下面这些命令就可以进行解压到旁边的文件夹了:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod u+x jdk-1_5_0_22-linux-amd64.bin</span><br><span class="line">./jdk-1_5_0_22-linux-amd64.bin</span><br></pre></td></tr></table></figure>
<h3 id="自定义-Exception-的写法"><a href="#自定义-Exception-的写法" class="headerlink" title="自定义 Exception 的写法"></a>自定义 <code>Exception</code> 的写法</h3><p>一定要记得定义 <strong><code>serialVersionUID</code></strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MQClientException</span> <span class="keyword">extends</span> <span class="title">Exception</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">5758410930844185841L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> responseCode;</span><br><span class="line">    <span class="keyword">private</span> String errorMessage;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MQClientException</span><span class="params">(String errorMessage, Throwable cause)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(FAQUrl.attachDefaultURL(errorMessage), cause);</span><br><span class="line">        <span class="keyword">this</span>.responseCode = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">this</span>.errorMessage = errorMessage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>为什么一定要定义 <code>serialVersionUID</code>，其实就是因为基类实现了这个接口，<strong>语言就是这么设计的</strong>，作者可能想要能够让这些异常信息在网络上传输:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Throwable</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h3><p><a href="https://stackoverflow.com/questions/16966629/what-is-the-difference-between-getfields-and-getdeclaredfields-in-java-reflectio" target="_blank" rel="noopener">https://stackoverflow.com/questions/16966629/what-is-the-difference-between-getfields-and-getdeclaredfields-in-java-reflectio</a></p>
<h3 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h3><p><img src="2017_09_12_09_19_08.png" alt=""></p>
<ul>
<li><code>RetentionPolicy.SOURCE</code>: Discard during the compile. These annotations don’t make any sense after the compile has completed, so they <strong>aren’t written to the bytecode</strong>. Example: <code>@Override</code>, <code>@SuppressWarnings</code></li>
<li><code>RetentionPolicy.CLASS</code>: Discard during class load. Useful when doing bytecode-level post-processing. Somewhat surprisingly, this is the default. Appear in the decompiled class, but can’t be inspected at run-time with reflection with <code>getAnnotations()</code>.</li>
<li><font color="red"><strong><code>RetentionPolicy.RUNTIME</code></strong></font>: Do not discard. The annotation should be available for reflection at runtime. Example: <code>@Deprecated</code>. Appear in the decompiled class, and can be inspected at run-time with reflection with <code>getAnnotations()</code>.</li>
</ul>
<p><strong>Language level</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.SOURCE)</span><br><span class="line"><span class="meta">@interface</span> RetentionSource &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.CLASS)</span><br><span class="line"><span class="meta">@interface</span> RetentionClass &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="meta">@interface</span> RetentionRuntime &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RetentionSource</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;&#125;</span><br><span class="line">    <span class="keyword">assert</span> B.class.getAnnotations().length == <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RetentionClass</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;&#125;</span><br><span class="line">    <span class="keyword">assert</span> C.class.getAnnotations().length == <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RetentionRuntime</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">D</span> </span>&#123;&#125;</span><br><span class="line">    <span class="keyword">assert</span> D.class.getAnnotations().length == <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Bytecode level</strong>: using <code>javap</code> we observe that the <code>Retention.CLASS</code> annotated class gets a <code>RuntimeInvisible</code> class attribute:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#14 = Utf8               LRetentionClass;</span><br><span class="line">[...]</span><br><span class="line">RuntimeInvisibleAnnotations:</span><br><span class="line">  0: #14()</span><br></pre></td></tr></table></figure>
<p>while <code>Retention.RUNTIME</code> annotation gets a <code>RuntimeVisible</code> class attribute:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#14 = Utf8               LRetentionRuntime;</span><br><span class="line">[...]</span><br><span class="line">RuntimeVisibleAnnotations:</span><br><span class="line">  0: #14()</span><br></pre></td></tr></table></figure>
<p>and the <code>Runtime.SOURCE</code> annotated <code>.class</code> does not get any annotation.</p>
<hr>
<p><img src="2017_09_12_09_22_08.png" alt=""></p>
<p>可选 <strong><code>ElementType</code></strong> 类型如下:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ElementType &#123;</span><br><span class="line">    <span class="comment">/** Class, interface (including annotation type), or enum declaration */</span></span><br><span class="line">    TYPE,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Field declaration (includes enum constants) */</span></span><br><span class="line">    FIELD,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Method declaration */</span></span><br><span class="line">    METHOD,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Formal parameter declaration */</span></span><br><span class="line">    PARAMETER,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Constructor declaration */</span></span><br><span class="line">    CONSTRUCTOR,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Local variable declaration */</span></span><br><span class="line">    LOCAL_VARIABLE,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Annotation type declaration */</span></span><br><span class="line">    ANNOTATION_TYPE,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Package declaration */</span></span><br><span class="line">    PACKAGE,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Type parameter declaration</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    TYPE_PARAMETER,</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Use of a type</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.8</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    TYPE_USE</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="避免无限循环阻塞下面代码的执行"><a href="#避免无限循环阻塞下面代码的执行" class="headerlink" title="避免无限循环阻塞下面代码的执行"></a>避免无限循环阻塞下面代码的执行</h3><p><img src="2017_09_15_11_38_00.png" alt=""></p>
<p>如图，如果 <code>while(true)</code> 直接写在外面，那么下面的的代码不在执行，必须放在一个新的线程中才能执行。</p>
<h3 id="定时提交任务"><a href="#定时提交任务" class="headerlink" title="定时提交任务"></a>定时提交任务</h3><p><img src="2017_09_15_22_27_30.png" alt=""></p>
<h3 id="URI-各部分字段的值"><a href="#URI-各部分字段的值" class="headerlink" title="URI 各部分字段的值"></a>URI 各部分字段的值</h3><p><img src="URI-construct.png" alt=""></p>
<p><img src="2017_11_14_17_10_45.png" alt=""></p>
<h3 id="Java-8"><a href="#Java-8" class="headerlink" title="Java 8"></a>Java 8</h3><p><code>List</code> 中的所有字符串调用 <code>trim</code> 方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; appScrenshot = originList.stream().map(String :: trim).collect(Collectors.toList());</span><br></pre></td></tr></table></figure>
<p>什么叫做 <code>Function Interface</code>:</p>
<p><img src="2017_11_03_17_50_43.png" alt=""></p>
<p>原来的<strong>匿名类</strong>怎么写:</p>
<p><img src="2017_11_03_17_53_09.png" alt=""></p>
<p>匿名类转为<strong>lambda</strong>写法:</p>
<p><img src="2017_11_03_17_53_39.png" alt=""></p>
<p><code>java.util.function</code> 下面为你定义好了一些能够直接使用的 <code>Function Interface</code>，比如上面的接口就可以使用 <code>Predicate</code> 来代替:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Predicate</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">test</span><span class="params">(T t)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="2017_11_03_18_02_12.png" alt=""></p>
<hr>
<p>接受一个参数，然后在这个参数上执行某些行为最后返回一个 <code>void</code> ，可以使用 <code>Consumer&lt;T&gt;</code> 接口的 <code>accept(T t)</code> 方法:</p>
<p><img src="2017_11_03_18_06_56.png" alt=""></p>
<p><img src="2017_11_03_18_07_32.png" alt=""></p>
<hr>
<p>返回一个参数，可以使用 <code>Function&lt;T, R&gt;</code> 接口提供的 <code>R apply&lt;T t&gt;</code> 方法:</p>
<p><img src="2017_11_03_18_09_31.png" alt=""></p>
<p><img src="2017_11_03_18_10_06.png" alt=""></p>
<hr>
<p><strong>Aggregate Operations</strong>:</p>
<p><img src="2017_11_03_18_12_26.png" alt=""></p>
<p>函数意义:</p>
<p><img src="2017_11_03_20_14_03.png" alt=""></p>
<ul>
<li><a href="https://docs.oracle.com/javase/tutorial/java/javaOO/lambdaexpressions.html#approach1" target="_blank" rel="noopener">参考</a></li>
</ul>
<hr>
<p><font color="red"><strong>注意:</strong></font> 在 <code>filter</code> 方法中有异常情况的抛出:</p>
<p><img src="2017_11_20_15_07_48.png" alt=""></p>
<p>如果没有 <code>catch</code> 的话，程序会阻塞在这里。</p>
<h3 id="DataOutputStream-vs-ObjectOutputStream"><a href="#DataOutputStream-vs-ObjectOutputStream" class="headerlink" title="DataOutputStream vs ObjectOutputStream"></a><code>DataOutputStream</code> vs <code>ObjectOutputStream</code></h3><p>处理基本类型的时候，这两个没有任何区别。</p>
<p><code>DataOutputStream</code> and <code>ObjectOutputStream</code>: when handling basic types, there is no difference apart from the header that <code>ObjectOutputStream</code> creates.</p>
<p>With the <code>ObjectOutputStream</code> class, instances of a class that implements <code>Serializable</code> can be written to the output stream, and can be read back with <code>ObjectInputStream</code>.</p>
<h3 id="java-sql-Connection"><a href="#java-sql-Connection" class="headerlink" title="java.sql.Connection"></a><code>java.sql.Connection</code></h3><p>在 <code>auto-commit</code> 模式下，执行 <code>rollback()</code> 会抛出 <code>SQLException</code> 异常:</p>
<p><img src="2017_10_12_20_07_40.png" alt=""></p>
<h3 id="读取用户输入"><a href="#读取用户输入" class="headerlink" title="读取用户输入"></a>读取用户输入</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String...args)</span> </span>&#123;</span><br><span class="line">        Scanner scanner = Scanner(System.in);</span><br><span class="line">        <span class="keyword">int</span> n = scanner.nextInt();</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ServiceLoader"><a href="#ServiceLoader" class="headerlink" title="ServiceLoader"></a><code>ServiceLoader</code></h3><p>因为其实现了 <code>Iterable</code> 接口:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceLoader</span>&lt;<span class="title">S</span>&gt;</span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">Iterable</span>&lt;<span class="title">S</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以我们可<strong>遍历</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">_loadedInitializers = ServiceLoader.load(ServletContainerInitializer.class);</span><br><span class="line"><span class="keyword">for</span> (ServletContainerInitializer sci:_loadedInitializers) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="读取配置文件"><a href="#读取配置文件" class="headerlink" title="读取配置文件"></a>读取配置文件</h3><p>从 <code>jar</code> 的<strong>同级目录</strong>读取:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./ - the root of your program</span><br><span class="line"> |__ main.jar</span><br><span class="line"> |__ main.properties</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//the base folder is ./, the root of the main.properties file  </span></span><br><span class="line">String path = <span class="string">"./main.properties"</span>;</span><br><span class="line"><span class="comment">//load the file handle for main.properties</span></span><br><span class="line">file = <span class="keyword">new</span> FileInputStream(path);</span><br></pre></td></tr></table></figure>
<h3 id="Iterable"><a href="#Iterable" class="headerlink" title="Iterable"></a><code>Iterable</code></h3><p><code>ArrayList</code> 实现了 <code>Iterable</code> 接口:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayList</span> <span class="keyword">implements</span> <span class="title">Iterable</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Iterator&lt;E&gt; <span class="title">iterator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Itr();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Itr</span> <span class="keyword">implements</span> <span class="title">Iterator</span>&lt;<span class="title">E</span>&gt; </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Index of element to be returned by subsequent call to next.</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">int</span> cursor = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasNext</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> cursor != size();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> E <span class="title">next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">int</span> i = cursor;</span><br><span class="line">                E next = get(i);</span><br><span class="line">                cursor = i + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">return</span> next;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IndexOutOfBoundsException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> NoSuchElementException();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以可以这样 <code>for-each-loop</code> 遍历:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (E e:list) &#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>A class has to implement the <code>Iterable</code> interface if it wants to have a <code>for-each</code> loop to iterate over its collection. However, the for-each loop can only be used to <strong>cycle through</strong> the collection in the forward direction and <strong>不能修改元素</strong> in this collection. But, if all you want is to <strong>读取</strong> the elements data, then it’s very simple and thanks to Java lambda expression it’s often one liner. For example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iterableElements.forEach (x -&gt; System.out.println(x) );</span><br></pre></td></tr></table></figure>
<hr>
<p><strong><code>Iterator</code></strong>:</p>
<p>This interface enables you to iterate over a collection, <strong>获取和删除</strong> its elements. Each of the collection classes provides a <code>iterator()</code> method that returns an iterator to the start of the collection. The advantage of this interface over iterable is that with this interface you can <strong>add, modify or remove</strong> elements in a collection. But, accessing elements needs a little more code than iterable. For example:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (Iterator i = c.iterator(); i.hasNext(); ) &#123;</span><br><span class="line">    Element e = i.next();    <span class="comment">//Get the element</span></span><br><span class="line">    System.out.println(e);    <span class="comment">//access or modify the element</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="组合和聚合"><a href="#组合和聚合" class="headerlink" title="组合和聚合"></a>组合和聚合</h3><p>Composition:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Engine engine;</span><br><span class="line"></span><br><span class="line">  Car(EngineSpecs specs) &#123;</span><br><span class="line">    engine = <span class="keyword">new</span> Engine(specs);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">move</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    engine.work();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Aggregation:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Engine engine;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">setEngine</span><span class="params">(Engine engine)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.engine = engine;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">move</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (engine != <span class="keyword">null</span>)</span><br><span class="line">      engine.work();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Both <strong>Composition and Aggregation</strong> are Associations. Composition -&gt; <strong>Strong Has-A</strong> relationship Aggregation -&gt; <strong>Weak Has-A</strong> relationship.</p>
<h3 id="Invalid-signature-file”-when-attempting-to-run-a-jar"><a href="#Invalid-signature-file”-when-attempting-to-run-a-jar" class="headerlink" title="Invalid signature file” when attempting to run a .jar"></a>Invalid signature file” when attempting to run a <code>.jar</code></h3><p>从 <code>jar</code> 包里面删除这 3 个文件即可:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zip -d yourjar.jar <span class="string">'META-INF/*.SF'</span> <span class="string">'META-INF/*.RSA'</span> <span class="string">'META-INF/*SF'</span></span><br></pre></td></tr></table></figure>
<ul>
<li><a href="https://stackoverflow.com/questions/999489/invalid-signature-file-when-attempting-to-run-a-jar" target="_blank" rel="noopener">参考</a></li>
</ul>
<h3 id="System-getenv-amp-System-getProperty"><a href="#System-getenv-amp-System-getProperty" class="headerlink" title="System.getenv() &amp; System.getProperty()"></a><code>System.getenv()</code> &amp; <code>System.getProperty()</code></h3><p><code>getenv</code> gets an environment variable. <code>getProperty</code> gets a Java property. Environment variables are specified at the OS level. Java properties are specified by passing the <code>-D</code> option to the JVM (and can be set programmatically).</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 返回的是 /home/zk</span></span><br><span class="line">System.getProperty(<span class="string">"user.home"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="请求网站"><a href="#请求网站" class="headerlink" title="请求网站"></a>请求网站</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getText</span><span class="params">(String url)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    URL website = <span class="keyword">new</span> URL(url);</span><br><span class="line">    URLConnection connection = website.openConnection();</span><br><span class="line">    BufferedReader in = <span class="keyword">new</span> BufferedReader(</span><br><span class="line">                                           <span class="keyword">new</span> InputStreamReader(</span><br><span class="line">                                                                 connection.getInputStream()));</span><br><span class="line"></span><br><span class="line">    StringBuilder response = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    String inputLine;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> ((inputLine = in.readLine()) != <span class="keyword">null</span>)</span><br><span class="line">        response.append(inputLine);</span><br><span class="line"></span><br><span class="line">    in.close();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> response.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<p>An <code>InetAddress</code> corresponds to the <strong>Network Layer (网络层)</strong> (Layer 3) and is basically an <strong>IP address (IP 地址)</strong>.</p>
<p>A <code>InetSocketAddress</code> corresponds to the <strong>Transport Layer (传输层)</strong> (Layer 4) and consists of an <strong>IP address and a port number</strong>.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[] &#123;(<span class="keyword">byte</span>)<span class="number">192</span>,(<span class="keyword">byte</span>)<span class="number">168</span>,(<span class="keyword">byte</span>)<span class="number">1</span>,(<span class="keyword">byte</span>)<span class="number">1</span>&#125;;</span><br><span class="line">InetAddress add = InetAddress.getByAddress(b);</span><br><span class="line">add = InetAddress.getByName(<span class="string">"localhost"</span>);</span><br><span class="line"></span><br><span class="line">InetSocketAddress addsock = InetSocketAddress.createUnresolved(<span class="string">"localhost"</span>, <span class="number">90</span>);</span><br></pre></td></tr></table></figure>
<h3 id="Java-安全模型简介"><a href="#Java-安全模型简介" class="headerlink" title="Java 安全模型简介"></a><a href="https://www.ibm.com/developerworks/cn/java/j-lo-javasecurity/" target="_blank" rel="noopener"><code>Java</code> 安全模型简介</a></h3><p>当前最新的安全机制实现，则引入了<strong>域 (Domain)</strong> 的概念。虚拟机会把所有代码加载到不同的系统域和应用域，系统域部分专门负责与关键资源进行交互，而各个应用域部分则通过系统域的部分代理来对各种需要的资源进行访问。<strong>虚拟机中不同的受保护域 (Protected Domain)，对应不一样的权限 (Permission)</strong>。存在于不同域中的类文件就具有了当前域的全部权限:</p>
<p><img src="image009.gif" alt="最新安全模型"></p>
<p><code>doPrivileged</code> 方法能够<strong>使一段受信任代码获得更大的权限</strong>，甚至比调用它的应用程序还要多，可做到临时访问更多的资源。有时候这是非常必要的，可以应付一些特殊的应用场景。例如，应用程序可能无法直接访问某些系统资源，但这样的应用程序必须得到这些资源才能够完成功能。针对这种情况，<code>Java SDK</code> 给域提供了 <code>doPrivileged</code> 方法，让程序突破当前域权限限制，临时扩大访问权限。</p>
<p>在 <code>Eclipse</code> 开发环境中建立两个不同工程：<code>projectX</code> 和 <code>projectY</code>。我们会给 <code>projectX</code> 工程中的 <code>bin</code> 目录赋予<strong>写文件</strong>的权限，换句话说就是允许所有存在于此目录中的 <code>class</code> 文件可以自由的在 <code>bin</code> 目录中进行<strong>文件写</strong>操作。然后，我们会在 <code>projectY</code> 工程中调用 <code>projectX</code> 工程中的一个文件操作工具类。这个工具类提供两种类型接口，一种是<strong>特权访问方式</strong>，另外一种是普通访问方式。由于在 <code>projectY</code> 工程中的文件是不具备在 <code>projectX</code> 工程中 <code>bin</code> 目录的任何写权限，所以通过三种不同访问方式的调用结果，我们就可以很清楚地了解到 <code>Java</code> 中安全控制该如何使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileUtil</span> </span>&#123; </span><br><span class="line">    <span class="comment">// 工程 A 执行文件的路径 </span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String FOLDER_PATH = <span class="string">"D:\\workspace\\projectX\\bin"</span>; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">makeFile</span><span class="params">(String fileName)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">try</span> &#123; </span><br><span class="line">            <span class="comment">// 尝试在工程 A 执行文件的路径中创建一个新文件</span></span><br><span class="line">            File fs = <span class="keyword">new</span> File(FOLDER_PATH + <span class="string">"\\"</span> + fileName); </span><br><span class="line">            fs.createNewFile(); </span><br><span class="line">        &#125; <span class="keyword">catch</span> (AccessControlException e) &#123; </span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123; </span><br><span class="line">            e.printStackTrace(); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">doPrivilegedAction</span><span class="params">(<span class="keyword">final</span> String fileName)</span> </span>&#123; </span><br><span class="line">        <span class="comment">// 用特权访问方式创建文件</span></span><br><span class="line">        AccessController.doPrivileged(<span class="keyword">new</span> PrivilegedAction&lt;String&gt;() &#123; </span><br><span class="line">                <span class="meta">@Override</span> </span><br><span class="line">                <span class="function"><span class="keyword">public</span> String <span class="title">run</span><span class="params">()</span> </span>&#123; </span><br><span class="line">                    makeFile(fileName); </span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">null</span>; </span><br><span class="line">                &#125; </span><br><span class="line">            &#125;); </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当如果想往 <code>projectX</code> 工程中创建文件的时候，只有调用 <code>doPrivilegedAction</code> 才可以创建成功，其它方法均会报无权限。注意，可能需要提前打开一个开关:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.setSecurityManager(<span class="keyword">new</span> SecurityManager());</span><br></pre></td></tr></table></figure>
<hr>
<p>什么时候应该使用 <code>doPriveleged</code>:</p>
<p>There are lot of operations in Java that require the <strong>caller domain (域)</strong> to have <strong>certain permissions (权限)</strong> for successful execution of those operations. <code>System.getProperty</code> is one of those operations. <strong>All file related operations (所有文件操作)</strong> also need special permissions. When you use <code>AccessController.doPrivileged</code> to invoke those operations, the operation is executed with all the rights(permissions) of your protection domain. Hence if your code has enough rights only then it could execute those operations.</p>
<hr>
<p>Essentially, <code>AccessController.doPriviledged()</code> is the equivalent of a <code>set-user-id</code> file. It is saying “I hereby request that this method be done with <strong>my privileges (我的权限)</strong>, <strong>even if I was invoked by a method that does not have them (即使调用我的那个方法并没有这样的权限)</strong>.”</p>
<h3 id="JVM-的编码问题"><a href="#JVM-的编码问题" class="headerlink" title="JVM 的编码问题"></a>JVM 的编码问题</h3><p>There are three “default” encodings:</p>
<ul>
<li><code>file.encoding</code>:</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">System.getProperty(<span class="string">"file.encoding"</span>)</span><br></pre></td></tr></table></figure>
<p>默认值是 <code>UTF-8</code>，可以在启动 JVM 的时候通过指定参数来改变默认值: <code>java -Dfile.encoding=ASCII com.zk.Main</code></p>
<ul>
<li><code>java.nio.Charset</code>:</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Charset.defaultCharset()</span><br></pre></td></tr></table></figure>
<p>默认实现：</p>
<p><img src="2018_01_02_11_31_13.png" alt="defaultCharset"></p>
<ul>
<li>And the encoding of the <code>InputStreamReader</code>:</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">InputStreamReader.getEncoding()</span><br></pre></td></tr></table></figure>
<p>这个方法的默认编码也是用的 <code>Charset.defaultCharset()</code>:</p>
<p><img src="2018_01_02_11_29_20.png" alt="InputStreamReader.getEncoding"></p>
<hr>
<p>以下是一些实验数据:</p>
<table>
<thead>
<tr>
<th>BASH LANG</th>
<th>Dfile.encoding</th>
<th>file.encoding</th>
<th>defaultCharset()</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td><code>ANSI_X3.4-1968</code></td>
<td><code>US-ASCII</code></td>
</tr>
<tr>
<td><code>C</code></td>
<td></td>
<td><code>ANSI_X3.4-1968</code></td>
<td><code>US-ASCII</code></td>
</tr>
<tr>
<td><code>C.UTF-8</code></td>
<td></td>
<td><code>UTF-8</code></td>
<td><code>UTF-8</code></td>
</tr>
<tr>
<td><code>C</code></td>
<td><code>UTF-8</code></td>
<td><code>UTF-8</code></td>
<td><code>UTF-8</code></td>
</tr>
<tr>
<td><code>en_US.utf8</code></td>
<td><code>UTF-8</code></td>
<td><code>UTF-8</code></td>
<td><code>UTF-8</code></td>
</tr>
</tbody>
</table>
<p>使用命令 <code>locale -a</code> 来查看 <code>BASH LANG</code> 环境变量支持设置的值。</p>
<hr>
<p>综上，在不设置 <code>-Dfile.encoding</code> 的情况下，<code>UNIX</code> 的 <code>LANG</code> 环境变量对于 JVM 的编码有着<strong>直接影响</strong>。</p>
<h3 id="Java-Code-Segments"><a href="#Java-Code-Segments" class="headerlink" title="Java Code Segments"></a>Java Code Segments</h3><ul>
<li><a href="http://git.oschina.net/anxiaoyi/code-segments/blob/master/java/ThreadFactoryImpl.java" target="_blank" rel="noopener"><code>ThreadFactory</code></a></li>
<li><a href="">使用 <code>HttpClient</code> 发起 <code>POST</code> 请求</a></li>
<li><a href="http://git.oschina.net/anxiaoyi/code-segments/blob/master/java/ClassLoaderWrapper.java" target="_blank" rel="noopener"><code>getResourceAsURL</code> 或 <code>getResourceAsStream</code></a></li>
<li><a href="http://git.oschina.net/anxiaoyi/code-segments/blob/master/java/Reflector.java" target="_blank" rel="noopener">反射一个类的所有信息</a></li>
<li><a href="http://git.oschina.net/anxiaoyi/code-segments/blob/master/java/HttpClientExample.java" target="_blank" rel="noopener"><code>HttpClient</code> 构建 <code>URI</code></a></li>
<li><a href="http://git.oschina.net/anxiaoyi/code-segments/blob/master/java/AlibabaJSON.java" target="_blank" rel="noopener">阿里巴巴 <code>JSON</code> 使用</a></li>
<li><a href="http://git.oschina.net/anxiaoyi/code-segments/blob/master/java/ByteBufferInputStream.java" target="_blank" rel="noopener"><code>ByteBufferInputStream</code></a></li>
<li><a href="http://git.oschina.net/anxiaoyi/code-segments/blob/master/java/ByteBufferOutputStream.java" target="_blank" rel="noopener"><code>ByteBufferOutputStream</code></a></li>
</ul>






<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</body>
</html>
