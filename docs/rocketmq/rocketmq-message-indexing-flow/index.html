<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="RocketMQ æ¶ˆæ¯ç´¢å¼•æµç¨‹"><meta property="og:title" content="RocketMQ æ¶ˆæ¯ç´¢å¼•æµç¨‹" />
<meta property="og:description" content="RocketMQ æ¶ˆæ¯ç´¢å¼•æµç¨‹ è®²è¿° RocketMQ æ¶ˆæ¯ç´¢å¼•æœåŠ¡
ä¸€ã€æ¶ˆæ¯æŸ¥è¯¢æ–¹å¼ å¯¹äº Producer å‘é€åˆ° Broker æœåŠ¡å™¨çš„æ¶ˆæ¯ï¼ŒRocketMQ æ”¯æŒå¤šç§æ–¹å¼æ¥æ–¹ä¾¿åœ°æŸ¥è¯¢æ¶ˆæ¯:
(1) æ ¹æ®é”®æŸ¥è¯¢æ¶ˆæ¯ å¦‚ä¸‹æ‰€ç¤ºï¼Œåœ¨æ„å»ºæ¶ˆæ¯çš„æ—¶å€™ï¼ŒæŒ‡å®šäº†è¿™æ¡æ¶ˆæ¯çš„é”®ä¸º â€œOrderID001â€:
Message msg = new Message(&#34;TopicTest&#34;, &#34;TagA&#34;, &#34;OrderID001&#34;, // Keys  &#34;Hello world&#34;.getBytes(RemotingHelper.DEFAULT_CHARSET)); é‚£ä¹ˆï¼Œå½“è¿™æ¡æ¶ˆæ¯å‘é€æˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ queryMsgByKey å‘½ä»¤æŸ¥è¯¢åˆ°è¿™æ¡æ¶ˆæ¯çš„è¯¦ç»†ä¿¡æ¯:
MQAdminStartup.main(new String[] { &#34;queryMsgByKey&#34;, &#34;-n&#34;, &#34;localhost:9876&#34;, &#34;-t&#34;, &#34;TopicTest&#34;, &#34;-k&#34;, &#34;OrderID001&#34; }); (2) æ ¹æ®ID(åç§»é‡)æŸ¥è¯¢æ¶ˆæ¯ æ¶ˆæ¯åœ¨å‘é€æˆåŠŸä¹‹åï¼Œå…¶è¿”å›çš„ SendResult ç±»ä¸­åŒ…å«äº†è¿™æ¡æ¶ˆæ¯çš„å”¯ä¸€åç§»é‡ ID (æ³¨æ„æ­¤å¤„æŒ‡çš„æ˜¯ offsetMsgId):
ç”¨æˆ·å¯ä»¥ä½¿ç”¨ queryMsgById å‘½ä»¤æŸ¥è¯¢è¿™æ¡æ¶ˆæ¯çš„è¯¦ç»†ä¿¡æ¯:
MQAdminStartup.main(new String[] { &#34;queryMsgById&#34;, &#34;-n&#34;, &#34;localhost:9876&#34;, &#34;-i&#34;, &#34;0A6C73D900002A9F0000000000004010&#34; }); (3) æ ¹æ®å”¯ä¸€é”®æŸ¥è¯¢æ¶ˆæ¯ æ¶ˆæ¯åœ¨å‘é€æˆåŠŸä¹‹åï¼Œå…¶è¿”å›çš„ SendResult ç±»ä¸­åŒ…å«äº†è¿™æ¡æ¶ˆæ¯çš„å”¯ä¸€ ID:
ç”¨æˆ·å¯ä»¥ä½¿ç”¨ queryMsgByUniqueKey å‘½ä»¤æŸ¥è¯¢è¿™æ¡æ¶ˆæ¯çš„è¯¦ç»†ä¿¡æ¯:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kunzhao.org/docs/rocketmq/rocketmq-message-indexing-flow/" />

<title>RocketMQ æ¶ˆæ¯ç´¢å¼•æµç¨‹ | èµµå¤çš„ä¸ªäººç½‘ç«™</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/book.min.215f2c356498a041f9de3ebaab0d56c45dd9a6292b641970f0f751a7bcec3c63.css" integrity="sha256-IV8sNWSYoEH53j66qw1WxF3ZpikrZBlw8PdRp7zsPGM=">


<script defer src="/en.search.min.e84d2cc329a438825740ccbd901a78cd73f894033e9964726b1dd4ec6a816209.js" integrity="sha256-6E0swymkOIJXQMy9kBp4zXP4lAM&#43;mWRyax3U7GqBYgk="></script>
<script>
var _hmt = _hmt || [];
(function() {
  if (location.hostname === "localhost" || 
    location.hostname === "127.0.0.1") {
    return;
  }

  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d04ff9e23cec6cb39ebbee1b4883e269";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<script data-ad-client="ca-pub-8950855178079071" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><span>èµµå¤çš„ä¸ªäººç½‘ç«™</span>
  </a>
</h2>








  

  
  





 
  
    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/" >
      ğŸ’¡æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/hire/" >
      ğŸ‘‰æ‹›è˜
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/it-zone/" >
      IT åœˆ
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/rocketmq/" >
      RocketMQ æºç åˆ†æ
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/docs/rocketmq/rocketmq-send-message-flow/" >
      RocketMQ æ¶ˆæ¯å‘é€æµç¨‹
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/rocketmq/rocketmq-message-store-flow/" >
      RocketMQ æ¶ˆæ¯å­˜å‚¨æµç¨‹
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/rocketmq/rocketmq-message-receive-flow/" >
      RocketMQ æ¶ˆæ¯æ¥å—æµç¨‹
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/rocketmq/rocketmq-message-filter-flow/" >
      RocketMQ æ¶ˆæ¯è¿‡æ»¤æµç¨‹
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/rocketmq/rocketmq-message-indexing-flow/"  class="active">
      RocketMQ æ¶ˆæ¯ç´¢å¼•æµç¨‹
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/rocketmq/rocketmq-timing-message-and-retry-message/" >
      RocketMQ å®šæ—¶æ¶ˆæ¯å’Œé‡è¯•æ¶ˆæ¯
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/rocketmq/rocketmq-master-slave-sync/" >
      RocketMQ ä¸»å¤‡åŒæ­¥
  </a>

</li>
      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/javascript/" >
      JavaScript ä¸“æ 
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/books/" >
      ä¹¦ç±
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/programmer-interview/" >
      ğŸ‘ ç¨‹åºå‘˜é¢è¯•é¢˜
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/cloud-plus-bbs/" >
      äº‘&#43;ç¤¾åŒºæŠ€æœ¯æ²™é¾™
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tools/" >
      å®ç”¨å·¥å…·
  </a>


    

    






  </li>


      
    
  </ul>
  



  












<ul>
  
  <li>
    <a href="/posts/" >
        åšå®¢
      </a>
  </li>
  
</ul>



</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>RocketMQ æ¶ˆæ¯ç´¢å¼•æµç¨‹</strong>

  <label for="toc-control">
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#ä¸€æ¶ˆæ¯æŸ¥è¯¢æ–¹å¼">ä¸€ã€æ¶ˆæ¯æŸ¥è¯¢æ–¹å¼</a>
      <ul>
        <li><a href="#1-æ ¹æ®é”®æŸ¥è¯¢æ¶ˆæ¯">(1) æ ¹æ®é”®æŸ¥è¯¢æ¶ˆæ¯</a></li>
        <li><a href="#2-æ ¹æ®idåç§»é‡æŸ¥è¯¢æ¶ˆæ¯">(2) æ ¹æ®ID(åç§»é‡)æŸ¥è¯¢æ¶ˆæ¯</a></li>
        <li><a href="#3-æ ¹æ®å”¯ä¸€é”®æŸ¥è¯¢æ¶ˆæ¯">(3) æ ¹æ®å”¯ä¸€é”®æŸ¥è¯¢æ¶ˆæ¯</a></li>
        <li><a href="#4-æ ¹æ®æ¶ˆæ¯é˜Ÿåˆ—åç§»é‡æŸ¥è¯¢æ¶ˆæ¯">(4) æ ¹æ®æ¶ˆæ¯é˜Ÿåˆ—åç§»é‡æŸ¥è¯¢æ¶ˆæ¯</a></li>
      </ul>
    </li>
    <li><a href="#äºŒid-åç§»é‡-æŸ¥è¯¢">äºŒã€ID (åç§»é‡) æŸ¥è¯¢</a>
      <ul>
        <li><a href="#1-ç”Ÿæˆ-id">(1) ç”Ÿæˆ ID</a></li>
        <li><a href="#2-ä½¿ç”¨-id-æŸ¥è¯¢">(2) ä½¿ç”¨ ID æŸ¥è¯¢</a></li>
      </ul>
    </li>
    <li><a href="#ä¸‰æ¶ˆæ¯é˜Ÿåˆ—åç§»é‡æŸ¥è¯¢">ä¸‰ã€æ¶ˆæ¯é˜Ÿåˆ—åç§»é‡æŸ¥è¯¢</a></li>
    <li><a href="#å››æ¶ˆæ¯ç´¢å¼•æœåŠ¡">å››ã€æ¶ˆæ¯ç´¢å¼•æœåŠ¡</a>
      <ul>
        <li><a href="#1-ç´¢å¼•æ–‡ä»¶ç»“æ„">(1) ç´¢å¼•æ–‡ä»¶ç»“æ„</a></li>
        <li><a href="#2-æ·»åŠ æ¶ˆæ¯">(2) æ·»åŠ æ¶ˆæ¯</a></li>
        <li><a href="#3-æŸ¥è¯¢æ¶ˆæ¯">(3) æŸ¥è¯¢æ¶ˆæ¯</a></li>
      </ul>
    </li>
    <li><a href="#äº”å”¯ä¸€é”®æŸ¥è¯¢æ¶ˆæ¯">äº”ã€å”¯ä¸€é”®æŸ¥è¯¢æ¶ˆæ¯</a>
      <ul>
        <li><a href="#1-æ„å»ºé”®">(1) æ„å»ºé”®</a></li>
        <li><a href="#2-ç´¢å¼•é”®">(2) ç´¢å¼•é”®</a></li>
        <li><a href="#3-ä½¿ç”¨é”®æŸ¥è¯¢">(3) ä½¿ç”¨é”®æŸ¥è¯¢</a></li>
      </ul>
    </li>
    <li><a href="#å…­é”®æŸ¥è¯¢æ¶ˆæ¯">å…­ã€é”®æŸ¥è¯¢æ¶ˆæ¯</a>
      <ul>
        <li><a href="#1-æ„å»ºé”®-1">(1) æ„å»ºé”®</a></li>
        <li><a href="#2-ç´¢å¼•é”®-1">(2) ç´¢å¼•é”®</a></li>
        <li><a href="#3-ä½¿ç”¨é”®æŸ¥è¯¢-1">(3) ä½¿ç”¨é”®æŸ¥è¯¢</a></li>
      </ul>
    </li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
<article class="markdown"><h1 id="rocketmq-æ¶ˆæ¯ç´¢å¼•æµç¨‹">RocketMQ æ¶ˆæ¯ç´¢å¼•æµç¨‹</h1>
<p>è®²è¿° RocketMQ æ¶ˆæ¯ç´¢å¼•æœåŠ¡</p>
<h2 id="ä¸€æ¶ˆæ¯æŸ¥è¯¢æ–¹å¼">ä¸€ã€æ¶ˆæ¯æŸ¥è¯¢æ–¹å¼</h2>
<p>å¯¹äº Producer å‘é€åˆ° Broker æœåŠ¡å™¨çš„æ¶ˆæ¯ï¼ŒRocketMQ æ”¯æŒå¤šç§æ–¹å¼æ¥æ–¹ä¾¿åœ°æŸ¥è¯¢æ¶ˆæ¯:</p>
<h3 id="1-æ ¹æ®é”®æŸ¥è¯¢æ¶ˆæ¯">(1) æ ¹æ®é”®æŸ¥è¯¢æ¶ˆæ¯</h3>
<p>å¦‚ä¸‹æ‰€ç¤ºï¼Œåœ¨æ„å»ºæ¶ˆæ¯çš„æ—¶å€™ï¼ŒæŒ‡å®šäº†è¿™æ¡æ¶ˆæ¯çš„é”®ä¸º â€œOrderID001â€:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Message msg <span style="color:#f92672">=</span>
    <span style="color:#66d9ef">new</span> Message<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;TopicTest&#34;</span><span style="color:#f92672">,</span>
                <span style="color:#e6db74">&#34;TagA&#34;</span><span style="color:#f92672">,</span>
                <span style="color:#e6db74">&#34;OrderID001&#34;</span><span style="color:#f92672">,</span> <span style="color:#75715e">// Keys
</span><span style="color:#75715e"></span>                <span style="color:#e6db74">&#34;Hello world&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">(</span>RemotingHelper<span style="color:#f92672">.</span><span style="color:#a6e22e">DEFAULT_CHARSET</span><span style="color:#f92672">));</span>
</code></pre></div><p>é‚£ä¹ˆï¼Œå½“è¿™æ¡æ¶ˆæ¯å‘é€æˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>queryMsgByKey</code> å‘½ä»¤æŸ¥è¯¢åˆ°è¿™æ¡æ¶ˆæ¯çš„è¯¦ç»†ä¿¡æ¯:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">MQAdminStartup<span style="color:#f92672">.</span><span style="color:#a6e22e">main</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> String<span style="color:#f92672">[]</span> <span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;queryMsgByKey&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;-n&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;localhost:9876&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;-t&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;TopicTest&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;-k&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;OrderID001&#34;</span>
    <span style="color:#f92672">});</span>
</code></pre></div><h3 id="2-æ ¹æ®idåç§»é‡æŸ¥è¯¢æ¶ˆæ¯">(2) æ ¹æ®ID(åç§»é‡)æŸ¥è¯¢æ¶ˆæ¯</h3>
<p>æ¶ˆæ¯åœ¨å‘é€æˆåŠŸä¹‹åï¼Œå…¶è¿”å›çš„ <code>SendResult</code> ç±»ä¸­åŒ…å«äº†è¿™æ¡æ¶ˆæ¯çš„å”¯ä¸€åç§»é‡ ID (æ³¨æ„æ­¤å¤„æŒ‡çš„æ˜¯ <code>offsetMsgId</code>):</p>
<p><img src="/images/docs/rocketmq/rocketmq-message-indexing-flow/2018_04_03_11_19_23.png" alt="æ¶ˆæ¯å‘é€æˆåŠŸè¿”å›åç§»é‡"></p>
<p>ç”¨æˆ·å¯ä»¥ä½¿ç”¨ <code>queryMsgById</code> å‘½ä»¤æŸ¥è¯¢è¿™æ¡æ¶ˆæ¯çš„è¯¦ç»†ä¿¡æ¯:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">MQAdminStartup<span style="color:#f92672">.</span><span style="color:#a6e22e">main</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> String<span style="color:#f92672">[]</span> <span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;queryMsgById&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;-n&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;localhost:9876&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;-i&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;0A6C73D900002A9F0000000000004010&#34;</span>
    <span style="color:#f92672">});</span>
</code></pre></div><h3 id="3-æ ¹æ®å”¯ä¸€é”®æŸ¥è¯¢æ¶ˆæ¯">(3) æ ¹æ®å”¯ä¸€é”®æŸ¥è¯¢æ¶ˆæ¯</h3>
<p>æ¶ˆæ¯åœ¨å‘é€æˆåŠŸä¹‹åï¼Œå…¶è¿”å›çš„ SendResult ç±»ä¸­åŒ…å«äº†è¿™æ¡æ¶ˆæ¯çš„<strong>å”¯ä¸€ ID</strong>:</p>
<p><img src="/images/docs/rocketmq/rocketmq-message-indexing-flow/2018_04_03_11_19_47.png" alt="æ¶ˆæ¯å”¯ä¸€ ID"></p>
<p>ç”¨æˆ·å¯ä»¥ä½¿ç”¨ <code>queryMsgByUniqueKey</code> å‘½ä»¤æŸ¥è¯¢è¿™æ¡æ¶ˆæ¯çš„è¯¦ç»†ä¿¡æ¯:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">MQAdminStartup<span style="color:#f92672">.</span><span style="color:#a6e22e">main</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> String<span style="color:#f92672">[]</span> <span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;queryMsgByUniqueKey&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;-n&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;localhost:9876&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;-i&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;0A6C73D939B318B4AAC20CBA5D920000&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;-t&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;TopicTest&#34;</span>
    <span style="color:#f92672">});</span>
</code></pre></div><h3 id="4-æ ¹æ®æ¶ˆæ¯é˜Ÿåˆ—åç§»é‡æŸ¥è¯¢æ¶ˆæ¯">(4) æ ¹æ®æ¶ˆæ¯é˜Ÿåˆ—åç§»é‡æŸ¥è¯¢æ¶ˆæ¯</h3>
<p>æ¶ˆæ¯å‘é€æˆåŠŸä¹‹åçš„ <code>SendResult</code> ä¸­è¿˜åŒ…å«äº†æ¶ˆæ¯é˜Ÿåˆ—çš„å…¶å®ƒä¿¡æ¯ï¼Œå¦‚æ¶ˆæ¯é˜Ÿåˆ— IDã€æ¶ˆæ¯é˜Ÿåˆ—åç§»é‡ç­‰ä¿¡æ¯:</p>
<pre><code>SendResult [sendStatus=SEND_OK,
            msgId=0A6C73D93EC518B4AAC20CC4ACD90000,
            offsetMsgId=0A6C73D900002A9F000000000000484E,
            messageQueue=MessageQueue [topic=TopicTest,
                                    brokerName=zk-pc,
                                    queueId=3],
            queueOffset=24]
</code></pre><p>æ ¹æ®è¿™äº›ä¿¡æ¯ï¼Œä½¿ç”¨ <code>queryMsgByOffset</code> å‘½ä»¤ä¹Ÿå¯ä»¥æŸ¥è¯¢åˆ°è¿™æ¡æ¶ˆæ¯çš„è¯¦ç»†ä¿¡æ¯:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">MQAdminStartup<span style="color:#f92672">.</span><span style="color:#a6e22e">main</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> String<span style="color:#f92672">[]</span> <span style="color:#f92672">{</span>
        <span style="color:#e6db74">&#34;queryMsgByOffset&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;-n&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;localhost:9876&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;-t&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;TopicTest&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;-b&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;zk-pc&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;-i&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;3&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;-o&#34;</span><span style="color:#f92672">,</span>
        <span style="color:#e6db74">&#34;24&#34;</span>
    <span style="color:#f92672">});</span>
</code></pre></div><h2 id="äºŒid-åç§»é‡-æŸ¥è¯¢">äºŒã€ID (åç§»é‡) æŸ¥è¯¢</h2>
<h3 id="1-ç”Ÿæˆ-id">(1) ç”Ÿæˆ ID</h3>
<p>ID (åç§»é‡) æ˜¯åœ¨æ¶ˆæ¯å‘é€åˆ° Broker æœåŠ¡å™¨å­˜å‚¨çš„æ—¶å€™ç”Ÿæˆçš„ï¼Œå…¶åŒ…å«å¦‚ä¸‹å‡ ä¸ªå­—æ®µï¼š</p>
<ul>
<li>Broker æœåŠ¡å™¨ IP åœ°å€</li>
<li>Broker æœåŠ¡å™¨ç«¯å£å·</li>
<li>æ¶ˆæ¯æ–‡ä»¶ <code>CommitLog</code> å†™åç§»é‡</li>
</ul>
<p><img src="/images/docs/rocketmq/rocketmq-message-indexing-flow/msgid_generated_in_broker.png" alt="ç”Ÿæˆ ID"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CommitLog</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DefaultAppendMessageCallback</span> <span style="color:#66d9ef">implements</span> AppendMessageCallback <span style="color:#f92672">{</span>

        <span style="color:#66d9ef">public</span> AppendMessageResult <span style="color:#a6e22e">doAppend</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">long</span> fileFromOffset<span style="color:#f92672">,</span> <span style="color:#75715e">/** å…¶å®ƒå‚æ•° **/</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            String msgId <span style="color:#f92672">=</span> MessageDecoder
                <span style="color:#f92672">.</span><span style="color:#a6e22e">createMessageId</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">msgIdMemory</span><span style="color:#f92672">,</span>
                                 msgInner<span style="color:#f92672">.</span><span style="color:#a6e22e">getStoreHostBytes</span><span style="color:#f92672">(</span>hostHolder<span style="color:#f92672">),</span>
                                 wroteOffset<span style="color:#f92672">);</span>
            <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>        <span style="color:#f92672">}</span>
        
    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="2-ä½¿ç”¨-id-æŸ¥è¯¢">(2) ä½¿ç”¨ ID æŸ¥è¯¢</h3>
<p>Admin ç«¯æŸ¥è¯¢çš„æ—¶å€™ï¼Œé¦–å…ˆå¯¹ <code>msgId</code> è¿›è¡Œè§£æï¼Œå–å‡º Broker æœåŠ¡å™¨çš„ IP ã€ç«¯å£å·å’Œæ¶ˆæ¯åç§»é‡:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MessageDecoder</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> MessageId <span style="color:#a6e22e">decodeMessageId</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> String msgId<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">throws</span> UnknownHostException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> ip <span style="color:#f92672">=</span> UtilAll<span style="color:#f92672">.</span><span style="color:#a6e22e">string2bytes</span><span style="color:#f92672">(</span>msgId<span style="color:#f92672">.</span><span style="color:#a6e22e">substring</span><span style="color:#f92672">(</span>0<span style="color:#f92672">,</span> 8<span style="color:#f92672">));</span>
        <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> port <span style="color:#f92672">=</span> UtilAll<span style="color:#f92672">.</span><span style="color:#a6e22e">string2bytes</span><span style="color:#f92672">(</span>msgId<span style="color:#f92672">.</span><span style="color:#a6e22e">substring</span><span style="color:#f92672">(</span>8<span style="color:#f92672">,</span> 16<span style="color:#f92672">));</span>
        <span style="color:#75715e">// offset
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> data <span style="color:#f92672">=</span> UtilAll<span style="color:#f92672">.</span><span style="color:#a6e22e">string2bytes</span><span style="color:#f92672">(</span>msgId<span style="color:#f92672">.</span><span style="color:#a6e22e">substring</span><span style="color:#f92672">(</span>16<span style="color:#f92672">,</span> 32<span style="color:#f92672">));</span>
        <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><p>è·å–åˆ°<strong>åç§»é‡</strong>ä¹‹åï¼ŒAdmin ä¼šå¯¹ Broker æœåŠ¡å™¨å‘é€ä¸€ä¸ª <code>VIEW_MESSAGE_BY_ID</code> çš„è¯·æ±‚å‘½ä»¤ï¼ŒBroker æœåŠ¡å™¨åœ¨æ”¶åˆ°è¯·æ±‚åï¼Œä¼šä¾æ®åç§»é‡å®šä½åˆ° <code>CommitLog</code> æ–‡ä»¶ä¸­çš„ç›¸åº”ä½ç½®,ç„¶åå–å‡ºæ¶ˆæ¯ï¼Œè¿”å›ç»™ Admin ç«¯:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DefaultMessageStore</span> <span style="color:#66d9ef">implements</span> MessageStore <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> SelectMappedBufferResult <span style="color:#a6e22e">selectOneMessageByOffset</span><span style="color:#f92672">(</span><span style="color:#66d9ef">long</span> commitLogOffset<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        SelectMappedBufferResult sbr <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">commitLog</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">(</span>commitLogOffset<span style="color:#f92672">,</span> 4<span style="color:#f92672">);</span>
        <span style="color:#75715e">// 1 TOTALSIZE
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">int</span> size <span style="color:#f92672">=</span> sbr<span style="color:#f92672">.</span><span style="color:#a6e22e">getByteBuffer</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getInt</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">commitLog</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">(</span>commitLogOffset<span style="color:#f92672">,</span> size<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><p><img src="/images/docs/rocketmq/rocketmq-message-indexing-flow/query_message_by_msg_offset_id.png" alt="æ ¹æ®åç§»é‡å®šä¸ºæ¶ˆæ¯"></p>
<h2 id="ä¸‰æ¶ˆæ¯é˜Ÿåˆ—åç§»é‡æŸ¥è¯¢">ä¸‰ã€æ¶ˆæ¯é˜Ÿåˆ—åç§»é‡æŸ¥è¯¢</h2>
<p>æ ¹æ®é˜Ÿåˆ—åç§»é‡æŸ¥è¯¢æ˜¯æœ€ç®€å•çš„ä¸€ç§æŸ¥è¯¢æ–¹å¼ï¼ŒAdmin ä¼šå¯åŠ¨ä¸€ä¸ª <code>PullConsumer</code> ï¼Œç„¶ååˆ©ç”¨ç”¨æˆ·ä¼ é€’ç»™ Admin çš„é˜Ÿåˆ— IDã€é˜Ÿåˆ—åç§»é‡ç­‰ä¿¡æ¯ï¼Œä»æœåŠ¡å™¨æ‹‰å–ä¸€æ¡æ¶ˆæ¯è¿‡æ¥:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">QueryMsgByOffsetSubCommand</span> <span style="color:#66d9ef">implements</span> SubCommand <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">execute</span><span style="color:#f92672">(</span>CommandLine commandLine<span style="color:#f92672">,</span> Options options<span style="color:#f92672">,</span> RPCHook rpcHook<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> SubCommandException <span style="color:#f92672">{</span>
        <span style="color:#75715e">// æ ¹æ®å‚æ•°æ„å»º MessageQueue
</span><span style="color:#75715e"></span>        MessageQueue mq <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MessageQueue<span style="color:#f92672">();</span>
        mq<span style="color:#f92672">.</span><span style="color:#a6e22e">setTopic</span><span style="color:#f92672">(</span>topic<span style="color:#f92672">);</span>
        mq<span style="color:#f92672">.</span><span style="color:#a6e22e">setBrokerName</span><span style="color:#f92672">(</span>brokerName<span style="color:#f92672">);</span>
        mq<span style="color:#f92672">.</span><span style="color:#a6e22e">setQueueId</span><span style="color:#f92672">(</span>Integer<span style="color:#f92672">.</span><span style="color:#a6e22e">parseInt</span><span style="color:#f92672">(</span>queueId<span style="color:#f92672">));</span>

        <span style="color:#75715e">// ä» Broker æœåŠ¡å™¨æ‹‰å–æ¶ˆæ¯
</span><span style="color:#75715e"></span>        PullResult pullResult <span style="color:#f92672">=</span> defaultMQPullConsumer<span style="color:#f92672">.</span><span style="color:#a6e22e">pull</span><span style="color:#f92672">(</span>mq<span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;*&#34;</span><span style="color:#f92672">,</span> Long<span style="color:#f92672">.</span><span style="color:#a6e22e">parseLong</span><span style="color:#f92672">(</span>offset<span style="color:#f92672">),</span> 1<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><p><img src="/images/docs/rocketmq/rocketmq-message-indexing-flow/query_msg_by_message_queue_offset.png" alt="ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—åç§»é‡æŸ¥è¯¢"></p>
<h2 id="å››æ¶ˆæ¯ç´¢å¼•æœåŠ¡">å››ã€æ¶ˆæ¯ç´¢å¼•æœåŠ¡</h2>
<p>åœ¨ç»§ç»­è®²è§£å‰©ä¸‹ä¸¤ç§æŸ¥è¯¢æ–¹å¼ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆä»‹ç»ä»¥ä¸‹ Broker ç«¯çš„æ¶ˆæ¯ç´¢å¼•æœåŠ¡ã€‚</p>
<p>åœ¨ä¹‹å‰æåˆ°è¿‡ï¼Œæ¯å½“ä¸€æ¡æ¶ˆæ¯å‘é€è¿‡æ¥ä¹‹åï¼Œå…¶ä¼šå°è£…ä¸ºä¸€ä¸ª <code>DispatchRequest</code> æ¥ä¸‹å‘ç»™å„ä¸ªè½¬å‘æœåŠ¡ï¼Œè€Œ <code>CommitLogDispatcherBuildIndex</code> æ„å»ºç´¢å¼•æœåŠ¡ä¾¿æ˜¯å…¶ä¸­ä¹‹ä¸€:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CommitLogDispatcherBuildIndex</span> <span style="color:#66d9ef">implements</span> CommitLogDispatcher <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">dispatch</span><span style="color:#f92672">(</span>DispatchRequest request<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>DefaultMessageStore<span style="color:#f92672">.</span><span style="color:#a6e22e">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">messageStoreConfig</span><span style="color:#f92672">.</span><span style="color:#a6e22e">isMessageIndexEnable</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            DefaultMessageStore<span style="color:#f92672">.</span><span style="color:#a6e22e">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">indexService</span><span style="color:#f92672">.</span><span style="color:#a6e22e">buildIndex</span><span style="color:#f92672">(</span>request<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="1-ç´¢å¼•æ–‡ä»¶ç»“æ„">(1) ç´¢å¼•æ–‡ä»¶ç»“æ„</h3>
<p>æ¶ˆæ¯çš„ç´¢å¼•ä¿¡æ¯æ˜¯å­˜æ”¾åœ¨ç£ç›˜ä¸Šçš„ï¼Œæ–‡ä»¶ä»¥æ—¶é—´æˆ³å‘½åçš„ï¼Œé»˜è®¤å­˜æ”¾åœ¨ <code>$HOME/store/index</code> ç›®å½•ä¸‹ã€‚ç”±ä¸‹å›¾æ¥çœ‹ï¼Œä¸€ä¸ªç´¢å¼•æ–‡ä»¶çš„ç»“æ„è¢«åˆ†æˆäº†ä¸‰éƒ¨åˆ†:</p>
<ul>
<li>å‰ 40 ä¸ªå­—èŠ‚å­˜æ”¾å›ºå®šçš„ç´¢å¼•å¤´ä¿¡æ¯ï¼ŒåŒ…å«äº†å­˜æ”¾åœ¨è¿™ä¸ªç´¢å¼•æ–‡ä»¶ä¸­çš„æ¶ˆæ¯çš„<strong>æœ€å°/å¤§å­˜å‚¨æ—¶é—´</strong>ã€<strong>æœ€å°/å¤§åç§»é‡</strong>ç­‰çŠ¶å†µ</li>
<li>ä¸­é—´ä¸€æ®µå­˜å‚¨äº† 500 ä¸‡ä¸ªå“ˆå¸Œæ§½ä½ï¼Œæ¯ä¸ªæ§½å†…éƒ¨å­˜å‚¨çš„æ˜¯ç´¢å¼•æ–‡ä»¶çš„åœ°å€ (ç´¢å¼•æ§½)</li>
<li>æœ€åä¸€æ®µå­˜å‚¨äº† 2000 ä¸‡ä¸ªç´¢å¼•å†…å®¹ä¿¡æ¯ï¼Œæ˜¯å®é™…çš„ç´¢å¼•ä¿¡æ¯å­˜å‚¨çš„åœ°æ–¹ã€‚æ¯ä¸€ä¸ªæ§½ä½å­˜å‚¨äº†è¿™æ¡æ¶ˆæ¯çš„é”®å“ˆå¸Œå€¼ã€å­˜å‚¨åç§»é‡ã€å­˜å‚¨æ—¶é—´æˆ³ä¸ä¸‹ä¸€ä¸ªç´¢å¼•æ§½åœ°å€</li>
</ul>
<p><img src="/images/docs/rocketmq/rocketmq-message-indexing-flow/indexfile_structure.png" alt="ç´¢å¼•æ–‡ä»¶æ•°æ®ç»“æ„"></p>
<p>RocketMQ åœ¨å†…å­˜ä¸­è¿˜ç»´æŠ¤äº†ä¸€ä¸ª<strong>ç´¢å¼•æ–‡ä»¶åˆ—è¡¨</strong>ï¼Œå¯¹äºæ¯ä¸€ä¸ªç´¢å¼•æ–‡ä»¶ï¼Œå‰ä¸€ä¸ªæ–‡ä»¶çš„æœ€å¤§å­˜å‚¨æ—¶é—´æ˜¯ä¸‹ä¸€ä¸ªæ–‡ä»¶çš„æœ€å°å­˜å‚¨æ—¶é—´ï¼Œå‰ä¸€ä¸ªæ–‡ä»¶çš„æœ€å¤§åç§»é‡æ˜¯ä¸‹ä¸€ä¸ªæ–‡ä»¶çš„æœ€å¤§åç§»é‡ã€‚æ¯ä¸€ä¸ªç´¢å¼•æ–‡ä»¶éƒ½ç´¢å¼•äº†åœ¨æŸä¸ªæ—¶é—´æ®µå†…ã€æŸä¸ªåç§»é‡æ®µå†…çš„æ‰€æœ‰æ¶ˆæ¯ï¼Œå½“æ–‡ä»¶æ»¡äº†ï¼Œå°±ä¼šç”¨å‰ä¸€ä¸ªæ–‡ä»¶çš„æœ€å¤§åç§»é‡å’Œæœ€å¤§å­˜å‚¨æ—¶é—´ä½œä¸ºèµ·å§‹å€¼ï¼Œåˆ›å»ºä¸‹ä¸€ä¸ªç´¢å¼•æ–‡ä»¶:</p>
<p><img src="/images/docs/rocketmq/rocketmq-message-indexing-flow/indexfile_list.png" alt="ç´¢å¼•æ–‡ä»¶åˆ—è¡¨"></p>
<h3 id="2-æ·»åŠ æ¶ˆæ¯">(2) æ·»åŠ æ¶ˆæ¯</h3>
<p>å½“æœ‰æ–°çš„æ¶ˆæ¯è¿‡æ¥åï¼Œ<strong>æ„å»ºç´¢å¼•æœåŠ¡</strong>ä¼šå–å‡ºè¿™æ¡æ¶ˆæ¯çš„é”®ï¼Œç„¶åå¯¹å­—ç¬¦ä¸² â€œè¯é¢˜#é”®â€ æ„å»ºç´¢å¼•ã€‚æ„å»ºç´¢å¼•çš„æ­¥éª¤å¦‚ä¸‹:</p>
<ul>
<li><strong>æ‰¾å‡ºå“ˆå¸Œæ§½</strong>: ç”Ÿæˆå­—ç¬¦ä¸²å“ˆå¸Œç ï¼Œå–ä½™è½åˆ° 500W ä¸ªæ§½ä½ä¹‹ä¸€ï¼Œå¹¶å–å‡ºå…¶ä¸­çš„å€¼ï¼Œé»˜è®¤ä¸º 0</li>
<li><strong>æ‰¾å‡ºç´¢å¼•æ§½</strong>: <code>IndexHeader</code> ç»´æŠ¤äº† <code>indexCount</code>ï¼Œå®é™…å­˜å‚¨çš„ç´¢å¼•æ§½å°±æ˜¯ç›´æ¥ä¾æ¬¡é¡ºå»¶æ·»åŠ çš„</li>
<li><strong>å­˜å‚¨ç´¢å¼•å†…å®¹</strong>: æ‰¾åˆ°ç´¢å¼•æ§½åï¼Œæ”¾å…¥é”®å“ˆå¸Œå€¼ã€å­˜å‚¨åç§»é‡ã€å­˜å‚¨æ—¶é—´æˆ³ä¸ä¸‹ä¸€ä¸ªç´¢å¼•æ§½åœ°å€ã€‚ä¸‹ä¸€ä¸ªç´¢å¼•æ§½åœ°å€å°±æ˜¯ç¬¬ä¸€æ­¥å“ˆå¸Œæ§½ä¸­å–å‡ºçš„å€¼ï¼Œ0 ä»£è¡¨è¿™ä¸ªæ§½ä½æ˜¯ç¬¬ä¸€æ¬¡è¢«ç´¢å¼•ï¼Œè€Œä¸ä¸º 0 ä»£è¡¨è¿™ä¸ªæ§½ä½ä¹‹å‰çš„ç´¢å¼•æ§½åœ°å€ã€‚ç”±æ­¤ï¼Œé€šè¿‡ç´¢å¼•æ§½åœ°å€å¯ä»¥å°†ç›¸åŒå“ˆå¸Œæ§½çš„æ¶ˆæ¯ä¸²è”èµ·æ¥ï¼Œåƒå•é“¾è¡¨é‚£æ ·ã€‚</li>
<li><strong>æ›´æ–°å“ˆå¸Œæ§½</strong>: æ›´æ–°åŸæœ‰å“ˆå¸Œæ§½ä¸­å­˜å‚¨çš„å€¼</li>
</ul>
<p>æˆ‘ä»¬ä»¥å®é™…ä¾‹å­æ¥è¯´æ˜ã€‚å‡è®¾æˆ‘ä»¬éœ€è¦ä¾æ¬¡ä¸ºé”®çš„å“ˆå¸Œå€¼ä¸º â€œ{16,29,29,8,16,16}â€ è¿™å‡ æ¡æ¶ˆæ¯æ„å»ºç´¢å¼•ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªåœ°æ–¹å¿½ç•¥äº†ç´¢å¼•ä¿¡æ¯ä¸­å­˜å‚¨çš„å­˜å‚¨æ—¶é—´å’Œåç§»é‡å­—æ®µï¼Œåªæ˜¯å­˜å‚¨<strong>é”®å“ˆå¸Œå’Œä¸‹ä¸€ç´¢å¼•æ§½ä¿¡æ¯</strong>ï¼Œé‚£ä¹ˆ:</p>
<ul>
<li>æ”¾å…¥ 16: å°† â€œ16|0â€ å­˜å‚¨åœ¨ç¬¬ 1 ä¸ªç´¢å¼•æ§½ä¸­ï¼Œå¹¶æ›´æ–°å“ˆå¸Œæ§½ä¸º 16 çš„å€¼ä¸º 1ï¼Œå³å“ˆå¸Œæ§½ä¸º 16 çš„ç¬¬ä¸€ä¸ªç´¢å¼•å—çš„åœ°å€ä¸º 1</li>
<li>æ”¾å…¥ 29: å°† â€œ29|0â€ å­˜å‚¨åœ¨ç¬¬ 2 ä¸ªç´¢å¼•æ§½ä¸­ï¼Œå¹¶æ›´æ–°å“ˆå¸Œæ§½ä¸º 29 çš„å€¼ä¸º 2ï¼Œå³å“ˆå¸Œæ§½ä¸º 29 çš„ç¬¬ä¸€ä¸ªç´¢å¼•å—çš„åœ°å€ä¸º 2</li>
<li>æ”¾å…¥ 29: å–å‡ºå“ˆå¸Œæ§½ä¸º 29 ä¸­çš„å€¼ 2ï¼Œç„¶åå°† â€œ29|2â€ å­˜å‚¨åœ¨ç¬¬ 3 ä¸ªç´¢å¼•æ§½ä¸­ï¼Œå¹¶æ›´æ–°å“ˆå¸Œæ§½ä¸º 29 çš„å€¼ä¸º 3ï¼Œå³å“ˆå¸Œæ§½ä¸º 29 çš„ç¬¬ä¸€ä¸ªç´¢å¼•å—çš„åœ°å€ä¸º 3ã€‚è€Œåœ¨æ‰¾åˆ°ç´¢å¼•å—ä¸º 3 çš„ç´¢å¼•ä¿¡æ¯åï¼Œåˆèƒ½å–å‡ºä¸Šä¸€ä¸ªç´¢å¼•å—çš„åœ°å€ 2ï¼Œæ„æˆé“¾è¡¨ä¸ºï¼š â€œ[29]-&gt;3-&gt;2â€</li>
<li>æ”¾å…¥ 8: å°† â€œ8|0â€ å­˜å‚¨åœ¨ç¬¬ 4 ä¸ªç´¢å¼•æ§½ä¸­ï¼Œå¹¶æ›´æ–°å“ˆå¸Œæ§½ä¸º 8 çš„å€¼ä¸º 4ï¼Œå³å“ˆå¸Œæ§½ä¸º 8 çš„ç¬¬ä¸€ä¸ªç´¢å¼•å—çš„åœ°å€ä¸º 4</li>
<li>æ”¾å…¥ 16: å–å‡ºå“ˆå¸Œæ§½ä¸º 16 ä¸­çš„å€¼ 1ï¼Œç„¶åå°† â€œ16|1â€ å­˜å‚¨åœ¨ç¬¬ 5 ä¸ªç´¢å¼•æ§½ä¸­ï¼Œå¹¶æ›´æ–°å“ˆå¸Œæ§½ä¸º 16 çš„å€¼ä¸º 5ã€‚æ„æˆé“¾è¡¨ä¸º: â€œ[16]-&gt;5-&gt;1â€</li>
<li>æ”¾å…¥ 16: å–å‡ºå“ˆå¸Œæ§½ä¸º 16 ä¸­çš„å€¼ 5ï¼Œç„¶åå°† â€œ16|5â€ å­˜å‚¨åœ¨ç¬¬ 6 ä¸ªç´¢å¼•æ§½ä¸­ï¼Œå¹¶æ›´æ–°å“ˆå¸Œæ§½ä¸º 16 çš„å€¼ä¸º 6ã€‚æ„æˆé“¾è¡¨ä¸º: â€œ[16]-&gt;6-&gt;5-&gt;1â€</li>
</ul>
<p>æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º:</p>
<p><img src="/images/docs/rocketmq/rocketmq-message-indexing-flow/put_key_example.png" alt="å¯¹æ¶ˆæ¯ç´¢å¼•æµç¨‹"></p>
<h3 id="3-æŸ¥è¯¢æ¶ˆæ¯">(3) æŸ¥è¯¢æ¶ˆæ¯</h3>
<p>å½“éœ€è¦æ ¹æ®é”®æ¥æŸ¥è¯¢æ¶ˆæ¯çš„æ—¶å€™ï¼Œå…¶ä¼šæŒ‰ç…§å€’åºå›æº¯æ•´ä¸ªç´¢å¼•æ–‡ä»¶åˆ—è¡¨ï¼Œå¯¹äºæ¯ä¸€ä¸ªåœ¨æ—¶é—´ä¸Šèƒ½å¤ŸåŒ¹é…ç”¨æˆ·ä¼ å…¥çš„ <code>begin</code> å’Œ <code>end</code> æ—¶é—´æˆ³å‚æ•°çš„ç´¢å¼•æ–‡ä»¶ï¼Œä¼šä¸€ä¸€è¿›è¡Œæ¶ˆæ¯æŸ¥è¯¢ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IndexService</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">public</span> QueryOffsetResult <span style="color:#a6e22e">queryOffset</span><span style="color:#f92672">(</span>String topic<span style="color:#f92672">,</span> String key<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> maxNum<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> begin<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> end<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// å€’åº
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">indexFileList</span><span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">();</span> i <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">;</span> i<span style="color:#f92672">--)</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// ä½äºæ—¶é—´æ®µå†…
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>f<span style="color:#f92672">.</span><span style="color:#a6e22e">isTimeMatched</span><span style="color:#f92672">(</span>begin<span style="color:#f92672">,</span> end<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
                <span style="color:#75715e">// æ¶ˆæ¯æŸ¥è¯¢
</span><span style="color:#75715e"></span>            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><p>è€Œå…·ä½“åˆ°æ¯ä¸€ä¸ªç´¢å¼•æ–‡ä»¶ï¼Œå…¶æŸ¥è¯¢åŒ¹é…æ¶ˆæ¯çš„è¿‡ç¨‹å¦‚ä¸‹æ‰€ç¤º:</p>
<ul>
<li><strong>ç¡®å®šå“ˆå¸Œæ§½</strong>: æ ¹æ®é”®ç”Ÿæˆå“ˆå¸Œå€¼ï¼Œå®šä½åˆ°å“ˆå¸Œæ§½</li>
<li><strong>å®šä½ç´¢å¼•æ§½</strong>: å“ˆå¸Œæ§½ä¸­çš„å€¼å­˜å‚¨çš„å°±æ˜¯é“¾è¡¨çš„ç¬¬ä¸€ä¸ªç´¢å¼•æ§½åœ°å€</li>
<li><strong>éå†ç´¢å¼•æ§½</strong>: æ²¿ç€ç´¢å¼•æ§½åœ°å€ï¼Œä¾æ¬¡å–å‡ºä¸‹ä¸€ä¸ªç´¢å¼•æ§½åœ°å€ï¼Œå³æ²¿ç€é“¾è¡¨éå†ï¼Œç›´è‡³é‡è§ä¸‹ä¸€ä¸ªç´¢å¼•æ§½åœ°å€ä¸ºéæ³•åœ°å€ 0 åœæ­¢</li>
<li><strong>æ”¶é›†åç§»é‡</strong>: åœ¨é‡åˆ°åŒ¹é…çš„æ¶ˆæ¯ä¹‹åï¼Œä¼šå°†ç›¸åº”çš„ç‰©ç†åç§»é‡æ”¾åˆ°åˆ—è¡¨ä¸­ï¼Œæœ€åæ ¹æ®ç‰©ç†åç§»é‡ï¼Œä» <code>CommitLog</code> æ–‡ä»¶ä¸­å–å‡ºæ¶ˆæ¯</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DefaultMessageStore</span> <span style="color:#66d9ef">implements</span> MessageStore <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> QueryMessageResult <span style="color:#a6e22e">queryMessage</span><span style="color:#f92672">(</span>String topic<span style="color:#f92672">,</span> String key<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> maxNum<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> begin<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> end<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> m <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> m <span style="color:#f92672">&lt;</span> queryOffsetResult<span style="color:#f92672">.</span><span style="color:#a6e22e">getPhyOffsets</span><span style="color:#f92672">().</span><span style="color:#a6e22e">size</span><span style="color:#f92672">();</span> m<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">long</span> offset <span style="color:#f92672">=</span> queryOffsetResult<span style="color:#f92672">.</span><span style="color:#a6e22e">getPhyOffsets</span><span style="color:#f92672">().</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>m<span style="color:#f92672">);</span>
            <span style="color:#75715e">// æ ¹æ®åç§»é‡ä» CommitLog æ–‡ä»¶ä¸­å–å‡ºæ¶ˆæ¯
</span><span style="color:#75715e"></span>        <span style="color:#f92672">}</span>
        
    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><p>ä»¥æŸ¥è¯¢å“ˆå¸Œå€¼ 16 çš„æ¶ˆæ¯ä¸ºä¾‹ï¼Œå›¾ç¤ºå¦‚ä¸‹:</p>
<p><img src="/images/docs/rocketmq/rocketmq-message-indexing-flow/query_message_hash_16_example.png" alt="æŸ¥è¯¢å“ˆå¸Œå€¼ 16 çš„æ¶ˆæ¯"></p>
<h2 id="äº”å”¯ä¸€é”®æŸ¥è¯¢æ¶ˆæ¯">äº”ã€å”¯ä¸€é”®æŸ¥è¯¢æ¶ˆæ¯</h2>
<h3 id="1-æ„å»ºé”®">(1) æ„å»ºé”®</h3>
<p>æ¶ˆæ¯çš„<strong>å”¯ä¸€é”®</strong>æ˜¯åœ¨å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯å‰æ„å»ºçš„:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DefaultMQProducerImpl</span> <span style="color:#66d9ef">implements</span> MQProducerInner <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> SendResult <span style="color:#a6e22e">sendKernelImpl</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> Message msg<span style="color:#f92672">,</span> <span style="color:#75715e">/** å…¶å®ƒå‚æ•° **/</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> XXXException <span style="color:#f92672">{</span>
        <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!(</span>msg <span style="color:#66d9ef">instanceof</span> MessageBatch<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
            MessageClientIDSetter<span style="color:#f92672">.</span><span style="color:#a6e22e">setUniqID</span><span style="color:#f92672">(</span>msg<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>åˆ›å»ºå”¯ä¸€ ID çš„ç®—æ³•:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MessageClientIDSetter</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> String <span style="color:#a6e22e">createUniqID</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        StringBuilder sb <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StringBuilder<span style="color:#f92672">(</span>LEN <span style="color:#f92672">*</span> 2<span style="color:#f92672">);</span>
        sb<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>FIX_STRING<span style="color:#f92672">);</span>
        sb<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>UtilAll<span style="color:#f92672">.</span><span style="color:#a6e22e">bytes2string</span><span style="color:#f92672">(</span>createUniqIDBuffer<span style="color:#f92672">()));</span>
        <span style="color:#66d9ef">return</span> sb<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><p>å”¯ä¸€é”®æ˜¯æ ¹æ®å®¢æˆ·ç«¯çš„<strong>è¿›ç¨‹ ID</strong>ã€<strong>IP åœ°å€</strong>ã€<strong>ClassLoader å“ˆå¸Œç </strong>ã€<strong>æ—¶é—´æˆ³</strong>ã€<strong>è®¡æ•°å™¨</strong>è¿™å‡ ä¸ªå€¼æ¥ç”Ÿæˆçš„ä¸€ä¸ªå”¯ä¸€çš„é”®ï¼Œç„¶åä½œä¸ºè¿™æ¡æ¶ˆæ¯çš„é™„å±å±æ€§å‘é€åˆ° Broker æœåŠ¡å™¨çš„:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MessageClientIDSetter</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setUniqID</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> Message msg<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>msg<span style="color:#f92672">.</span><span style="color:#a6e22e">getProperty</span><span style="color:#f92672">(</span>MessageConst<span style="color:#f92672">.</span><span style="color:#a6e22e">PROPERTY_UNIQ_CLIENT_MESSAGE_ID_KEYIDX</span><span style="color:#f92672">)</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            msg<span style="color:#f92672">.</span><span style="color:#a6e22e">putProperty</span><span style="color:#f92672">(</span>MessageConst<span style="color:#f92672">.</span><span style="color:#a6e22e">PROPERTY_UNIQ_CLIENT_MESSAGE_ID_KEYIDX</span><span style="color:#f92672">,</span> createUniqID<span style="color:#f92672">());</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="2-ç´¢å¼•é”®">(2) ç´¢å¼•é”®</h3>
<p>å½“æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ¶ˆæ¯ä¹‹åï¼Œç´¢å¼•æœåŠ¡ä¾¿ä¼šå–å‡ºå®¢æˆ·ç«¯ç”Ÿæˆçš„ <code>uniqKey</code> å¹¶ä¸ºä¹‹å»ºç«‹ç´¢å¼•ï¼Œæ”¾å…¥åˆ°ç´¢å¼•æ–‡ä»¶ä¸­:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IndexService</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">buildIndex</span><span style="color:#f92672">(</span>DispatchRequest req<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>req<span style="color:#f92672">.</span><span style="color:#a6e22e">getUniqKey</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            indexFile <span style="color:#f92672">=</span> putKey<span style="color:#f92672">(</span>indexFile<span style="color:#f92672">,</span> msg<span style="color:#f92672">,</span> buildKey<span style="color:#f92672">(</span>topic<span style="color:#f92672">,</span> req<span style="color:#f92672">.</span><span style="color:#a6e22e">getUniqKey</span><span style="color:#f92672">()));</span>
        <span style="color:#f92672">}</span>
        <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="3-ä½¿ç”¨é”®æŸ¥è¯¢">(3) ä½¿ç”¨é”®æŸ¥è¯¢</h3>
<p>å®¢æˆ·ç«¯åœ¨ç”Ÿæˆæ¶ˆæ¯å”¯ä¸€é”®çš„æ—¶å€™ï¼Œåœ¨ <code>ByteBuffer</code> çš„ç¬¬ 11 ä½åˆ°ç¬¬ 14 ä½æ”¾ç½®çš„æ˜¯<strong>å½“å‰çš„æ—¶é—´ä¸å½“æœˆç¬¬ä¸€å¤©</strong>çš„æ—¶é—´çš„æ¯«ç§’å·®:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MessageClientIDSetter</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> <span style="color:#a6e22e">createUniqIDBuffer</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">long</span> current <span style="color:#f92672">=</span> System<span style="color:#f92672">.</span><span style="color:#a6e22e">currentTimeMillis</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>current <span style="color:#f92672">&gt;=</span> nextStartTime<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            setStartTime<span style="color:#f92672">(</span>current<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">// æ—¶é—´å·® [å½“å‰æ—¶é—´ - è¿™ä¸ªæœˆ 1 å·çš„æ—¶é—´]
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// putInt å æ®çš„æ˜¯ç¬¬ 11 ä½åˆ°ç¬¬ 14 ä½
</span><span style="color:#75715e"></span>        buffer<span style="color:#f92672">.</span><span style="color:#a6e22e">putInt</span><span style="color:#f92672">((</span><span style="color:#66d9ef">int</span><span style="color:#f92672">)</span> <span style="color:#f92672">(</span>System<span style="color:#f92672">.</span><span style="color:#a6e22e">currentTimeMillis</span><span style="color:#f92672">()</span> <span style="color:#f92672">-</span> startTime<span style="color:#f92672">));</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">synchronized</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setStartTime</span><span style="color:#f92672">(</span><span style="color:#66d9ef">long</span> millis<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        Calendar cal <span style="color:#f92672">=</span> Calendar<span style="color:#f92672">.</span><span style="color:#a6e22e">getInstance</span><span style="color:#f92672">();</span>
        cal<span style="color:#f92672">.</span><span style="color:#a6e22e">setTimeInMillis</span><span style="color:#f92672">(</span>millis<span style="color:#f92672">);</span>
        cal<span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>Calendar<span style="color:#f92672">.</span><span style="color:#a6e22e">DAY_OF_MONTH</span><span style="color:#f92672">,</span> 1<span style="color:#f92672">);</span>
        cal<span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>Calendar<span style="color:#f92672">.</span><span style="color:#a6e22e">HOUR_OF_DAY</span><span style="color:#f92672">,</span> 0<span style="color:#f92672">);</span>
        cal<span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>Calendar<span style="color:#f92672">.</span><span style="color:#a6e22e">MINUTE</span><span style="color:#f92672">,</span> 0<span style="color:#f92672">);</span>
        cal<span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>Calendar<span style="color:#f92672">.</span><span style="color:#a6e22e">SECOND</span><span style="color:#f92672">,</span> 0<span style="color:#f92672">);</span>
        cal<span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>Calendar<span style="color:#f92672">.</span><span style="color:#a6e22e">MILLISECOND</span><span style="color:#f92672">,</span> 0<span style="color:#f92672">);</span>
        <span style="color:#75715e">// å¼€å§‹æ—¶é—´è®¾ç½®ä¸ºè¿™ä¸ªæœˆçš„ 1 å·
</span><span style="color:#75715e"></span>        startTime <span style="color:#f92672">=</span> cal<span style="color:#f92672">.</span><span style="color:#a6e22e">getTimeInMillis</span><span style="color:#f92672">();</span>
        <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><p>æˆ‘ä»¬çŸ¥é“<strong>æ¶ˆæ¯ç´¢å¼•</strong>æœåŠ¡çš„æŸ¥è¯¢éœ€è¦ç”¨æˆ·ä¼ å…¥ <code>begin</code> å’Œ <code>end</code> è¿™è¿ä¸ªæ—¶é—´å€¼ï¼Œä»¥è¿›è¡Œè¿™æ®µæ—¶é—´å†…çš„åŒ¹é…ã€‚æ‰€ä»¥ RocketMQ ä¸ºäº†åŠ é€Ÿæ¶ˆæ¯çš„æŸ¥è¯¢ï¼Œäºæ˜¯åœ¨ Admin ç«¯å¯¹ç‰¹å®š ID è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼Œé¦–å…ˆå–å‡ºäº†è¿™æ®µ<strong>æ—¶é—´å·®å€¼</strong>ï¼Œç„¶åä¸å½“æœˆæ—¶é—´è¿›è¡Œç›¸åŠ å¾—åˆ° <code>begin</code> æ—¶é—´å€¼:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MessageClientIDSetter</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> Date <span style="color:#a6e22e">getNearlyTimeFromID</span><span style="color:#f92672">(</span>String msgID<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        ByteBuffer buf <span style="color:#f92672">=</span> ByteBuffer<span style="color:#f92672">.</span><span style="color:#a6e22e">allocate</span><span style="color:#f92672">(</span>8<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> bytes <span style="color:#f92672">=</span> UtilAll<span style="color:#f92672">.</span><span style="color:#a6e22e">string2bytes</span><span style="color:#f92672">(</span>msgID<span style="color:#f92672">);</span>
        buf<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">((</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">)</span> 0<span style="color:#f92672">);</span>
        buf<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">((</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">)</span> 0<span style="color:#f92672">);</span>
        buf<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">((</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">)</span> 0<span style="color:#f92672">);</span>
        buf<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">((</span><span style="color:#66d9ef">byte</span><span style="color:#f92672">)</span> 0<span style="color:#f92672">);</span>
        <span style="color:#75715e">// å–å‡ºç¬¬ 11 ä½åˆ° 14 ä½
</span><span style="color:#75715e"></span>        buf<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>bytes<span style="color:#f92672">,</span> 10<span style="color:#f92672">,</span> 4<span style="color:#f92672">);</span>
        
        buf<span style="color:#f92672">.</span><span style="color:#a6e22e">position</span><span style="color:#f92672">(</span>0<span style="color:#f92672">);</span>
        <span style="color:#75715e">// å¾—åˆ°æ—¶é—´å·®å€¼
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">long</span> spanMS <span style="color:#f92672">=</span> buf<span style="color:#f92672">.</span><span style="color:#a6e22e">getLong</span><span style="color:#f92672">();</span>
        
        Calendar cal <span style="color:#f92672">=</span> Calendar<span style="color:#f92672">.</span><span style="color:#a6e22e">getInstance</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">long</span> now <span style="color:#f92672">=</span> cal<span style="color:#f92672">.</span><span style="color:#a6e22e">getTimeInMillis</span><span style="color:#f92672">();</span>
        cal<span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>Calendar<span style="color:#f92672">.</span><span style="color:#a6e22e">DAY_OF_MONTH</span><span style="color:#f92672">,</span> 1<span style="color:#f92672">);</span>
        cal<span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>Calendar<span style="color:#f92672">.</span><span style="color:#a6e22e">HOUR_OF_DAY</span><span style="color:#f92672">,</span> 0<span style="color:#f92672">);</span>
        cal<span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>Calendar<span style="color:#f92672">.</span><span style="color:#a6e22e">MINUTE</span><span style="color:#f92672">,</span> 0<span style="color:#f92672">);</span>
        cal<span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>Calendar<span style="color:#f92672">.</span><span style="color:#a6e22e">SECOND</span><span style="color:#f92672">,</span> 0<span style="color:#f92672">);</span>
        cal<span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>Calendar<span style="color:#f92672">.</span><span style="color:#a6e22e">MILLISECOND</span><span style="color:#f92672">,</span> 0<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">long</span> monStartTime <span style="color:#f92672">=</span> cal<span style="color:#f92672">.</span><span style="color:#a6e22e">getTimeInMillis</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>monStartTime <span style="color:#f92672">+</span> spanMS <span style="color:#f92672">&gt;=</span> now<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            cal<span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>Calendar<span style="color:#f92672">.</span><span style="color:#a6e22e">MONTH</span><span style="color:#f92672">,</span> <span style="color:#f92672">-</span>1<span style="color:#f92672">);</span>
            monStartTime <span style="color:#f92672">=</span> cal<span style="color:#f92672">.</span><span style="color:#a6e22e">getTimeInMillis</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>
        <span style="color:#75715e">// è®¾ç½®ä¸ºè¿™ä¸ªæœˆ(æˆ–è€…ä¸Šä¸ªæœˆ) + æ—¶é—´å·®å€¼
</span><span style="color:#75715e"></span>        cal<span style="color:#f92672">.</span><span style="color:#a6e22e">setTimeInMillis</span><span style="color:#f92672">(</span>monStartTime <span style="color:#f92672">+</span> spanMS<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> cal<span style="color:#f92672">.</span><span style="color:#a6e22e">getTime</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><p>ç”±äºå‘é€æ¶ˆæ¯çš„å®¢æˆ·ç«¯å’ŒæŸ¥è¯¢æ¶ˆæ¯çš„ Admin ç«¯å¯èƒ½ä¸åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šï¼Œè€Œä¸”ä»å‡½æ•°çš„å‘½å <code>getNearlyTimeFromID</code> ä¸ä¸Šè¿°å®ç°æ¥çœ‹ï¼ŒAdmin ç«¯çš„æ—¶é—´æˆ³å¾—åˆ°çš„æ˜¯ä¸€ä¸ªè¿‘ä¼¼èµ·å§‹å€¼ï¼Œå®ƒå°½å¯èƒ½åœ°åŠ é€Ÿç”¨æˆ·çš„æŸ¥è¯¢ã€‚è€Œä¸”å¤ªæ—§çš„æ¶ˆæ¯(è¶…è¿‡ä¸€ä¸ªæœˆçš„æ¶ˆæ¯)æ˜¯æŸ¥è¯¢ä¸åˆ°çš„ã€‚</p>
<p>å½“ <code>begin</code> æ—¶é—´æˆ³ç¡®å®šä»¥åï¼ŒAdmin ä¾¿ä¼šå°†å…¶å®ƒå¿…è¦çš„ä¿¡æ¯å¦‚<strong>è¯é¢˜</strong>ã€<strong>Key</strong>ç­‰ä¿¡æ¯å°è£…åˆ° <code>QUERY_MESSAGE</code> çš„åŒ…ä¸­ï¼Œç„¶åå‘ Broker æœåŠ¡å™¨ä¼ é€’è¿™ä¸ªè¯·æ±‚ï¼Œæ¥è¿›è¡Œæ¶ˆæ¯çš„æŸ¥è¯¢ã€‚Broker æœåŠ¡å™¨åœ¨è·å–åˆ°è¿™ä¸ªæŸ¥è¯¢æ¶ˆæ¯çš„è¯·æ±‚åï¼Œä¾¿ä¼šæ ¹æ® <code>Key</code> ä»ç´¢å¼•æ–‡ä»¶ä¸­æŸ¥è¯¢ç¬¦åˆçš„æ¶ˆæ¯ï¼Œæœ€ç»ˆè¿”å›åˆ° Admin ç«¯ã€‚</p>
<h2 id="å…­é”®æŸ¥è¯¢æ¶ˆæ¯">å…­ã€é”®æŸ¥è¯¢æ¶ˆæ¯</h2>
<h3 id="1-æ„å»ºé”®-1">(1) æ„å»ºé”®</h3>
<p>æˆ‘ä»¬æåˆ°è¿‡ï¼Œåœ¨å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå¯ä»¥å¡«å……ä¸€ä¸ª <code>keys</code> çš„å€¼ï¼Œè¿™ä¸ªå€¼å°†ä¼šä½œä¸ºæ¶ˆæ¯çš„ä¸€ä¸ªå±æ€§è¢«å‘é€åˆ° Broker æœåŠ¡å™¨ä¸Š:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Message</span> <span style="color:#66d9ef">implements</span> Serializable <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setKeys</span><span style="color:#f92672">(</span>String keys<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">putProperty</span><span style="color:#f92672">(</span>MessageConst<span style="color:#f92672">.</span><span style="color:#a6e22e">PROPERTY_KEYS</span><span style="color:#f92672">,</span> keys<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="2-ç´¢å¼•é”®-1">(2) ç´¢å¼•é”®</h3>
<p>å½“æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ¶ˆæ¯ä¹‹åï¼Œç´¢å¼•æœåŠ¡ä¾¿ä¼šå–å‡ºè¿™æ¡æ¶ˆæ¯çš„ <code>keys</code> å¹¶å°†å…¶ç”¨<strong>ç©ºæ ¼</strong>è¿›è¡Œåˆ†å‰²ï¼Œåˆ†å‰²åçš„æ¯ä¸€ä¸ªå­—ç¬¦ä¸²éƒ½ä¼šä½œä¸ºä¸€ä¸ªå•ç‹¬çš„<strong>é”®</strong>ï¼Œåˆ›å»ºç´¢å¼•ï¼Œæ”¾å…¥åˆ°ç´¢å¼•æ–‡ä»¶ä¸­:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IndexService</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">buildIndex</span><span style="color:#f92672">(</span>DispatchRequest req<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>keys <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> keys<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()</span> <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// ä½¿ç”¨ç©ºæ ¼è¿›è¡Œåˆ†å‰²
</span><span style="color:#75715e"></span>            String<span style="color:#f92672">[]</span> keyset <span style="color:#f92672">=</span> keys<span style="color:#f92672">.</span><span style="color:#a6e22e">split</span><span style="color:#f92672">(</span>MessageConst<span style="color:#f92672">.</span><span style="color:#a6e22e">KEY_SEPARATOR</span><span style="color:#f92672">);</span>
            <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> keyset<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">;</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
                String key <span style="color:#f92672">=</span> keyset<span style="color:#f92672">[</span>i<span style="color:#f92672">];</span>
                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>key<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()</span> <span style="color:#f92672">&gt;</span> 0<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                    indexFile <span style="color:#f92672">=</span> putKey<span style="color:#f92672">(</span>indexFile<span style="color:#f92672">,</span> msg<span style="color:#f92672">,</span> buildKey<span style="color:#f92672">(</span>topic<span style="color:#f92672">,</span> key<span style="color:#f92672">));</span>
                <span style="color:#f92672">}</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><p>ç”±æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥å¾—çŸ¥ï¼Œ<code>keys</code> é”®çš„è®¾ç½®é€šè¿‡ä½¿ç”¨ç©ºæ ¼åˆ†å‰²å­—ç¬¦ä¸²ï¼Œä¸€æ¡æ¶ˆæ¯å¯ä»¥æŒ‡å®šå¤šä¸ªé”®ã€‚</p>
<h3 id="3-ä½¿ç”¨é”®æŸ¥è¯¢-1">(3) ä½¿ç”¨é”®æŸ¥è¯¢</h3>
<p><code>keys</code> é”®æŸ¥è¯¢çš„æ–¹å¼ä¹Ÿæ˜¯é€šè¿‡å°†å‚æ•°å°è£…ä¸º <code>QUERY_MESSAGE</code> è¯·æ±‚åŒ…ä¸­å»è¯·æ±‚æœåŠ¡å™¨è¿”å›ç›¸åº”çš„ä¿¡æ¯ã€‚ç”±äºé”®æœ¬èº«ä¸èƒ½å’Œæ—¶é—´æˆ³ç›¸å…³è”ï¼Œå› æ­¤ <code>begin</code> å€¼è®¾ç½®çš„æ˜¯ 0ï¼Œè¿™æ˜¯å’Œç¬¬äº”èŠ‚çš„ä¸åŒä¹‹å¤„:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">QueryMsgByKeySubCommand</span> <span style="color:#66d9ef">implements</span> SubCommand <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">queryByKey</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> DefaultMQAdminExt admin<span style="color:#f92672">,</span> <span style="color:#66d9ef">final</span> String topic<span style="color:#f92672">,</span> <span style="color:#66d9ef">final</span> String key<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">throws</span> MQClientException<span style="color:#f92672">,</span> InterruptedException <span style="color:#f92672">{</span>
        <span style="color:#75715e">// begin: 0
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// end: Long.MAX_VALUE
</span><span style="color:#75715e"></span>        QueryResult queryResult <span style="color:#f92672">=</span> admin<span style="color:#f92672">.</span><span style="color:#a6e22e">queryMessage</span><span style="color:#f92672">(</span>topic<span style="color:#f92672">,</span> key<span style="color:#f92672">,</span> 64<span style="color:#f92672">,</span> 0<span style="color:#f92672">,</span> Long<span style="color:#f92672">.</span><span style="color:#a6e22e">MAX_VALUE</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><p>æ‰«æä¸‹é¢äºŒç»´ç ï¼Œåœ¨æ‰‹æœºç«¯é˜…è¯»ï¼š</p>
<p><img src="/images/docs/rocketmq/rocketmq-message-indexing-flow/qrcode.png" alt=""></p>
</article>
 

      <footer class="book-footer">
        
  <div class="flex justify-between">





</div>

 
        
  
  <div class="book-comments">  
  
  <div id="vcomments"></div>
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src='//unpkg.com/valine/dist/Valine.min.js'></script>

  <script type="text/javascript">
    new Valine({
        el: '#vcomments' ,
        appId: 'Hw2fQnNQyghcgeRvQosC5cIy-gzGzoHsz',
        appKey: '0ULuPWcxGRLCaHz84icXvBgn',
        notify: 'false', 
        verify: 'false', 
        avatar:'mm', 
        placeholder: 'è¯´ç‚¹ä»€ä¹ˆå§...',
        visitor: 'true'
    });
  </script></div>
  
 
      </footer>
      
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#ä¸€æ¶ˆæ¯æŸ¥è¯¢æ–¹å¼">ä¸€ã€æ¶ˆæ¯æŸ¥è¯¢æ–¹å¼</a>
      <ul>
        <li><a href="#1-æ ¹æ®é”®æŸ¥è¯¢æ¶ˆæ¯">(1) æ ¹æ®é”®æŸ¥è¯¢æ¶ˆæ¯</a></li>
        <li><a href="#2-æ ¹æ®idåç§»é‡æŸ¥è¯¢æ¶ˆæ¯">(2) æ ¹æ®ID(åç§»é‡)æŸ¥è¯¢æ¶ˆæ¯</a></li>
        <li><a href="#3-æ ¹æ®å”¯ä¸€é”®æŸ¥è¯¢æ¶ˆæ¯">(3) æ ¹æ®å”¯ä¸€é”®æŸ¥è¯¢æ¶ˆæ¯</a></li>
        <li><a href="#4-æ ¹æ®æ¶ˆæ¯é˜Ÿåˆ—åç§»é‡æŸ¥è¯¢æ¶ˆæ¯">(4) æ ¹æ®æ¶ˆæ¯é˜Ÿåˆ—åç§»é‡æŸ¥è¯¢æ¶ˆæ¯</a></li>
      </ul>
    </li>
    <li><a href="#äºŒid-åç§»é‡-æŸ¥è¯¢">äºŒã€ID (åç§»é‡) æŸ¥è¯¢</a>
      <ul>
        <li><a href="#1-ç”Ÿæˆ-id">(1) ç”Ÿæˆ ID</a></li>
        <li><a href="#2-ä½¿ç”¨-id-æŸ¥è¯¢">(2) ä½¿ç”¨ ID æŸ¥è¯¢</a></li>
      </ul>
    </li>
    <li><a href="#ä¸‰æ¶ˆæ¯é˜Ÿåˆ—åç§»é‡æŸ¥è¯¢">ä¸‰ã€æ¶ˆæ¯é˜Ÿåˆ—åç§»é‡æŸ¥è¯¢</a></li>
    <li><a href="#å››æ¶ˆæ¯ç´¢å¼•æœåŠ¡">å››ã€æ¶ˆæ¯ç´¢å¼•æœåŠ¡</a>
      <ul>
        <li><a href="#1-ç´¢å¼•æ–‡ä»¶ç»“æ„">(1) ç´¢å¼•æ–‡ä»¶ç»“æ„</a></li>
        <li><a href="#2-æ·»åŠ æ¶ˆæ¯">(2) æ·»åŠ æ¶ˆæ¯</a></li>
        <li><a href="#3-æŸ¥è¯¢æ¶ˆæ¯">(3) æŸ¥è¯¢æ¶ˆæ¯</a></li>
      </ul>
    </li>
    <li><a href="#äº”å”¯ä¸€é”®æŸ¥è¯¢æ¶ˆæ¯">äº”ã€å”¯ä¸€é”®æŸ¥è¯¢æ¶ˆæ¯</a>
      <ul>
        <li><a href="#1-æ„å»ºé”®">(1) æ„å»ºé”®</a></li>
        <li><a href="#2-ç´¢å¼•é”®">(2) ç´¢å¼•é”®</a></li>
        <li><a href="#3-ä½¿ç”¨é”®æŸ¥è¯¢">(3) ä½¿ç”¨é”®æŸ¥è¯¢</a></li>
      </ul>
    </li>
    <li><a href="#å…­é”®æŸ¥è¯¢æ¶ˆæ¯">å…­ã€é”®æŸ¥è¯¢æ¶ˆæ¯</a>
      <ul>
        <li><a href="#1-æ„å»ºé”®-1">(1) æ„å»ºé”®</a></li>
        <li><a href="#2-ç´¢å¼•é”®-1">(2) ç´¢å¼•é”®</a></li>
        <li><a href="#3-ä½¿ç”¨é”®æŸ¥è¯¢-1">(3) ä½¿ç”¨é”®æŸ¥è¯¢</a></li>
      </ul>
    </li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>



</html>












