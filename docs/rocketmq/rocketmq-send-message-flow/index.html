<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="RocketMQ æ¶ˆæ¯å‘é€æµç¨‹"><meta property="og:title" content="RocketMQ æ¶ˆæ¯å‘é€æµç¨‹" />
<meta property="og:description" content="RocketMQ æ¶ˆæ¯å‘é€æµç¨‹ æœ¬æ–‡è®²è¿° RocketMQ å‘é€ä¸€æ¡æ™®é€šæ¶ˆæ¯çš„æµç¨‹ã€‚
ä¸€ã€æœåŠ¡å™¨å¯åŠ¨ æˆ‘ä»¬å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£æ¥å¯åŠ¨æœåŠ¡:
 å¯åŠ¨ Name æœåŠ¡å™¨:  sh bin/mqnamesrv  å¯åŠ¨ Broker æœåŠ¡å™¨:  sh bin/mqbroker -n localhost:9876 äºŒã€æ„å»ºæ¶ˆæ¯ä½“ ä¸€æ¡æ¶ˆæ¯ä½“æœ€å°‘éœ€è¦æŒ‡å®šä¸¤ä¸ªå€¼:
 æ‰€å±è¯é¢˜ æ¶ˆæ¯å†…å®¹  å¦‚ä¸‹å°±æ˜¯åˆ›å»ºäº†ä¸€æ¡è¯é¢˜ä¸º â€œTestâ€ï¼Œæ¶ˆæ¯ä½“ä¸º â€œHello Worldâ€ çš„æ¶ˆæ¯:
Message msg = new Message( &#34;Test&#34;, &#34;Hello World&#34;.getBytes() ); ä¸‰ã€å¯åŠ¨ Producer å‡†å¤‡å‘é€æ¶ˆæ¯ å¦‚æœæˆ‘ä»¬æƒ³è¦å‘é€æ¶ˆæ¯å‘¢ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å†å¯åŠ¨ä¸€ä¸ª DefaultProducer (ç”Ÿäº§è€…) ç±»æ¥å‘æ¶ˆæ¯:
DefaultMQProducer producer = new DefaultMQProducer(); producer.start(); ç°åœ¨æˆ‘ä»¬æ‰€å¯åŠ¨çš„æœåŠ¡å¦‚ä¸‹æ‰€ç¤º:
å››ã€Name æœåŠ¡å™¨çš„å‡ç­‰æ€§ æ³¨æ„æˆ‘ä»¬ä¸Šè¿°å¼€å¯çš„æ˜¯å•ä¸ªæœåŠ¡ï¼Œä¹Ÿå³ä¸€ä¸ª Broker å’Œä¸€ä¸ª Name æœåŠ¡å™¨ï¼Œä½†æ˜¯å®é™…ä¸Šä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ­å»ºçš„æ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œå¦‚ä¸‹æ‰€ç¤º:
åœ¨ RocketMQ çš„è®¾è®¡ä¸­ï¼Œå®¢æˆ·ç«¯éœ€è¦é¦–å…ˆè¯¢é—® Name æœåŠ¡å™¨æ‰èƒ½ç¡®å®šä¸€ä¸ªåˆé€‚çš„ Broker ä»¥è¿›è¡Œæ¶ˆæ¯çš„å‘é€:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kunzhao.org/docs/rocketmq/rocketmq-send-message-flow/" />

<title>RocketMQ æ¶ˆæ¯å‘é€æµç¨‹ | èµµå¤çš„ä¸ªäººç½‘ç«™</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/book.min.a04069c4ba149e24630fa6fbc98cd4da6e386beb4688b0aae5809dbb5660cd77.css" integrity="sha256-oEBpxLoUniRjD6b7yYzU2m44a&#43;tGiLCq5YCdu1ZgzXc=">


<script defer src="/en.search.min.9d20587692ac68362f6c0d8fa4604d0a1e1a494ed2f85674279f98bde4614052.js" integrity="sha256-nSBYdpKsaDYvbA2PpGBNCh4aSU7S&#43;FZ0J5&#43;YveRhQFI="></script>
<script>
var _hmt = _hmt || [];
(function() {
  if (location.hostname === "localhost" || 
    location.hostname === "127.0.0.1") {
    return;
  }

  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d04ff9e23cec6cb39ebbee1b4883e269";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<script data-ad-client="ca-pub-8950855178079071" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><span>èµµå¤çš„ä¸ªäººç½‘ç«™</span>
  </a>
</h2>








  

  
  





 
  
    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/" >
      ğŸ’¡æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/hire/" >
      ğŸ‘‰æ‹›è˜
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/it-zone/" >
      IT åœˆ
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/rocketmq/" >
      RocketMQ æºç åˆ†æ
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/docs/rocketmq/rocketmq-send-message-flow/"  class="active">
      RocketMQ æ¶ˆæ¯å‘é€æµç¨‹
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/rocketmq/rocketmq-message-store-flow/" >
      RocketMQ æ¶ˆæ¯å­˜å‚¨æµç¨‹
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/rocketmq/rocketmq-message-receive-flow/" >
      RocketMQ æ¶ˆæ¯æ¥å—æµç¨‹
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/rocketmq/rocketmq-message-filter-flow/" >
      RocketMQ æ¶ˆæ¯è¿‡æ»¤æµç¨‹
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/rocketmq/rocketmq-message-indexing-flow/" >
      RocketMQ æ¶ˆæ¯ç´¢å¼•æµç¨‹
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/rocketmq/rocketmq-timing-message-and-retry-message/" >
      RocketMQ å®šæ—¶æ¶ˆæ¯å’Œé‡è¯•æ¶ˆæ¯
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/rocketmq/rocketmq-master-slave-sync/" >
      RocketMQ ä¸»å¤‡åŒæ­¥
  </a>

</li>
      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/javascript/" >
      JavaScript ä¸“æ 
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/books/" >
      ä¹¦ç±
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/programmer-interview/" >
      ğŸ‘ ç¨‹åºå‘˜é¢è¯•é¢˜
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/cloud-plus-bbs/" >
      äº‘&#43;ç¤¾åŒºæŠ€æœ¯æ²™é¾™
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tools/" >
      å®ç”¨å·¥å…·
  </a>


    

    






  </li>


      
    
  </ul>
  



  












<ul>
  
  <li>
    <a href="/posts/" >
        åšå®¢
      </a>
  </li>
  
</ul>



</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>RocketMQ æ¶ˆæ¯å‘é€æµç¨‹</strong>

  <label for="toc-control">
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#ä¸€æœåŠ¡å™¨å¯åŠ¨">ä¸€ã€æœåŠ¡å™¨å¯åŠ¨</a></li>
    <li><a href="#äºŒæ„å»ºæ¶ˆæ¯ä½“">äºŒã€æ„å»ºæ¶ˆæ¯ä½“</a></li>
    <li><a href="#ä¸‰å¯åŠ¨-producer-å‡†å¤‡å‘é€æ¶ˆæ¯">ä¸‰ã€å¯åŠ¨ Producer å‡†å¤‡å‘é€æ¶ˆæ¯</a></li>
    <li><a href="#å››name-æœåŠ¡å™¨çš„å‡ç­‰æ€§">å››ã€Name æœåŠ¡å™¨çš„å‡ç­‰æ€§</a></li>
    <li><a href="#äº”é€‰æ‹©-name-æœåŠ¡å™¨">äº”ã€é€‰æ‹© Name æœåŠ¡å™¨</a></li>
    <li><a href="#å…­å¯»æ‰¾è¯é¢˜è·¯ç”±ä¿¡æ¯">å…­ã€å¯»æ‰¾è¯é¢˜è·¯ç”±ä¿¡æ¯</a>
      <ul>
        <li><a href="#1-æ–°å»ºè¯é¢˜">(1) æ–°å»ºè¯é¢˜</a></li>
        <li><a href="#2-å·²å­˜è¯é¢˜">(2) å·²å­˜è¯é¢˜</a></li>
      </ul>
    </li>
    <li><a href="#ä¸ƒç»™-broker-å‘é€æ¶ˆæ¯">ä¸ƒã€ç»™ Broker å‘é€æ¶ˆæ¯</a></li>
    <li><a href="#å…«broker-æ£€æŸ¥è¯é¢˜ä¿¡æ¯">å…«ã€Broker æ£€æŸ¥è¯é¢˜ä¿¡æ¯</a></li>
    <li><a href="#ä¹æ¶ˆæ¯å­˜å‚¨">ä¹ã€æ¶ˆæ¯å­˜å‚¨</a></li>
    <li><a href="#åæ•´ä½“æµç¨‹">åã€æ•´ä½“æµç¨‹</a></li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
<article class="markdown"><h1 id="rocketmq-æ¶ˆæ¯å‘é€æµç¨‹">RocketMQ æ¶ˆæ¯å‘é€æµç¨‹</h1>
<p>æœ¬æ–‡è®²è¿° RocketMQ å‘é€ä¸€æ¡<strong>æ™®é€šæ¶ˆæ¯</strong>çš„æµç¨‹ã€‚</p>
<h2 id="ä¸€æœåŠ¡å™¨å¯åŠ¨">ä¸€ã€æœåŠ¡å™¨å¯åŠ¨</h2>
<p>æˆ‘ä»¬å¯ä»¥å‚è€ƒ<a href="https://rocketmq.apache.org/docs/quick-start/">å®˜æ–¹æ–‡æ¡£</a>æ¥å¯åŠ¨æœåŠ¡:</p>
<ul>
<li>å¯åŠ¨ Name æœåŠ¡å™¨:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sh bin/mqnamesrv
</code></pre></div><ul>
<li>å¯åŠ¨ Broker æœåŠ¡å™¨:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sh bin/mqbroker -n localhost:9876
</code></pre></div><p><img src="/images/docs/rocketmq/rocketmq-send-message-flow/nameserver_broker_startup.png" alt="å¯åŠ¨æœåŠ¡å™¨"></p>
<h2 id="äºŒæ„å»ºæ¶ˆæ¯ä½“">äºŒã€æ„å»ºæ¶ˆæ¯ä½“</h2>
<p>ä¸€æ¡æ¶ˆæ¯ä½“æœ€å°‘éœ€è¦æŒ‡å®šä¸¤ä¸ªå€¼:</p>
<ul>
<li>æ‰€å±è¯é¢˜</li>
<li>æ¶ˆæ¯å†…å®¹</li>
</ul>
<p>å¦‚ä¸‹å°±æ˜¯åˆ›å»ºäº†ä¸€æ¡è¯é¢˜ä¸º â€œTestâ€ï¼Œæ¶ˆæ¯ä½“ä¸º â€œHello Worldâ€ çš„æ¶ˆæ¯:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Message msg <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Message<span style="color:#f92672">(</span> <span style="color:#e6db74">&#34;Test&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;Hello World&#34;</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getBytes</span><span style="color:#f92672">()</span> <span style="color:#f92672">);</span>
</code></pre></div><h2 id="ä¸‰å¯åŠ¨-producer-å‡†å¤‡å‘é€æ¶ˆæ¯">ä¸‰ã€å¯åŠ¨ Producer å‡†å¤‡å‘é€æ¶ˆæ¯</h2>
<p>å¦‚æœæˆ‘ä»¬æƒ³è¦å‘é€æ¶ˆæ¯å‘¢ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å†å¯åŠ¨ä¸€ä¸ª DefaultProducer (ç”Ÿäº§è€…) ç±»æ¥å‘æ¶ˆæ¯:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">DefaultMQProducer producer <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> DefaultMQProducer<span style="color:#f92672">();</span>
producer<span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">();</span>
</code></pre></div><p>ç°åœ¨æˆ‘ä»¬æ‰€å¯åŠ¨çš„æœåŠ¡å¦‚ä¸‹æ‰€ç¤º:</p>
<p><img src="/images/docs/rocketmq/rocketmq-send-message-flow/nameserver_broker_client_startup.png" alt="å¯åŠ¨å®¢æˆ·ç«¯"></p>
<h2 id="å››name-æœåŠ¡å™¨çš„å‡ç­‰æ€§">å››ã€Name æœåŠ¡å™¨çš„å‡ç­‰æ€§</h2>
<p>æ³¨æ„æˆ‘ä»¬ä¸Šè¿°å¼€å¯çš„æ˜¯å•ä¸ªæœåŠ¡ï¼Œä¹Ÿå³ä¸€ä¸ª Broker å’Œä¸€ä¸ª Name æœåŠ¡å™¨ï¼Œä½†æ˜¯å®é™…ä¸Šä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ­å»ºçš„æ˜¯ä¸€ä¸ªé›†ç¾¤ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p>
<p><img src="/images/docs/rocketmq/rocketmq-send-message-flow/nameserver_broker_cluster.png" alt="RocketMQ é›†ç¾¤"></p>
<p>åœ¨ RocketMQ çš„è®¾è®¡ä¸­ï¼Œå®¢æˆ·ç«¯éœ€è¦é¦–å…ˆ<strong>è¯¢é—® Name æœåŠ¡å™¨</strong>æ‰èƒ½ç¡®å®šä¸€ä¸ªåˆé€‚çš„ Broker ä»¥è¿›è¡Œæ¶ˆæ¯çš„å‘é€:</p>
<p><img src="/images/docs/rocketmq/rocketmq-send-message-flow/producer_find_broker_though_nameserver.png" alt="è¯¢é—® Name æœåŠ¡å™¨"></p>
<p>ç„¶è€Œè¿™ä¹ˆå¤š Name æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯æ˜¯å¦‚ä½•é€‰æ‹©ä¸€ä¸ªåˆé€‚çš„ Name æœåŠ¡å™¨å‘¢?</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦æ„è¯†åˆ°å¾ˆé‡è¦çš„ä¸€ç‚¹ï¼ŒName æœåŠ¡å™¨å…¨éƒ¨éƒ½æ˜¯å¤„äºç›¸åŒçŠ¶æ€çš„ï¼Œä¿å­˜çš„éƒ½æ˜¯ç›¸åŒçš„ä¿¡æ¯ã€‚åœ¨ Broker å¯åŠ¨çš„æ—¶å€™ï¼Œå…¶ä¼šå°†è‡ªå·±åœ¨æœ¬åœ°å­˜å‚¨çš„è¯é¢˜é…ç½®æ–‡ä»¶ (é»˜è®¤ä½äº <code>$HOME/store/config/topics.json</code> ç›®å½•) ä¸­çš„æ‰€æœ‰è¯é¢˜åŠ è½½åˆ°å†…å­˜ä¸­å»ï¼Œç„¶åä¼šå°†è¿™äº›æ‰€æœ‰çš„è¯é¢˜å…¨éƒ¨åŒæ­¥åˆ°æ‰€æœ‰çš„ Name æœåŠ¡å™¨ä¸­ã€‚ä¸æ­¤åŒæ—¶ï¼ŒBroker ä¹Ÿä¼šå¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œé»˜è®¤æ¯éš” 30 ç§’æ¥æ‰§è¡Œä¸€æ¬¡è¯é¢˜å…¨åŒæ­¥:</p>
<p><img src="/images/docs/rocketmq/rocketmq-send-message-flow/broker_sync_topics_to_namesrv.png" alt="åŒæ­¥è¯é¢˜"></p>
<h2 id="äº”é€‰æ‹©-name-æœåŠ¡å™¨">äº”ã€é€‰æ‹© Name æœåŠ¡å™¨</h2>
<p>ç”±äº Name æœåŠ¡å™¨æ¯å°æœºå™¨å­˜å‚¨çš„æ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ã€‚å› æ­¤æˆ‘ä»¬å®¢æˆ·ç«¯ä»»æ„é€‰æ‹©ä¸€å°æœåŠ¡å™¨è¿›è¡Œæ²Ÿé€šå³å¯ã€‚</p>
<p><img src="/images/docs/rocketmq/rocketmq-send-message-flow/client_random_pickup_nameserver.png" alt="é€‰æ‹© Name æœåŠ¡å™¨"></p>
<p>å…¶ä¸­å®¢æˆ·ç«¯ä¸€å¼€å§‹é€‰æ‹© Name æœåŠ¡å™¨çš„æºç å¦‚ä¸‹æ‰€ç¤º:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NettyRemotingClient</span> <span style="color:#66d9ef">extends</span> NettyRemotingAbstract <span style="color:#66d9ef">implements</span> RemotingClient <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> AtomicInteger namesrvIndex <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> AtomicInteger<span style="color:#f92672">(</span>initValueIndex<span style="color:#f92672">());</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">initValueIndex</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        Random r <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> Random<span style="color:#f92672">();</span>
        <span style="color:#66d9ef">return</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">abs</span><span style="color:#f92672">(</span>r<span style="color:#f92672">.</span><span style="color:#a6e22e">nextInt</span><span style="color:#f92672">()</span> <span style="color:#f92672">%</span> 999<span style="color:#f92672">)</span> <span style="color:#f92672">%</span> 999<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">private</span> Channel <span style="color:#a6e22e">getAndCreateNameserverChannel</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> InterruptedException <span style="color:#f92672">{</span>

        <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>        
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> addrList<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">();</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">int</span> index <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">namesrvIndex</span><span style="color:#f92672">.</span><span style="color:#a6e22e">incrementAndGet</span><span style="color:#f92672">();</span>
            index <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">abs</span><span style="color:#f92672">(</span>index<span style="color:#f92672">);</span>
            index <span style="color:#f92672">=</span> index <span style="color:#f92672">%</span> addrList<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">();</span>
            String newAddr <span style="color:#f92672">=</span> addrList<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>index<span style="color:#f92672">);</span>

            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">namesrvAddrChoosed</span><span style="color:#f92672">.</span><span style="color:#a6e22e">set</span><span style="color:#f92672">(</span>newAddr<span style="color:#f92672">);</span>
            Channel channelNew <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">createChannel</span><span style="color:#f92672">(</span>newAddr<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>channelNew <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span>
                <span style="color:#66d9ef">return</span> channelNew<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><p>ä»¥åï¼Œå¦‚æœ <code>namesrvAddrChoosed</code> é€‰æ‹©çš„æœåŠ¡å™¨å¦‚æœä¸€ç›´å¤„äºè¿æ¥çŠ¶æ€ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å°±ä¼šä¸€ç›´ä¸è¿™å°æœåŠ¡å™¨è¿›è¡Œæ²Ÿé€šã€‚å¦åˆ™çš„è¯ï¼Œå¦‚ä¸Šæºä»£ç æ‰€ç¤ºï¼Œå°±ä¼šè‡ªåŠ¨è½®å¯»ä¸‹ä¸€å°å¯ç”¨æœåŠ¡å™¨ã€‚</p>
<h2 id="å…­å¯»æ‰¾è¯é¢˜è·¯ç”±ä¿¡æ¯">å…­ã€å¯»æ‰¾è¯é¢˜è·¯ç”±ä¿¡æ¯</h2>
<p>å½“å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œå…¶é¦–å…ˆä¼šå°è¯•å¯»æ‰¾è¯é¢˜è·¯ç”±ä¿¡æ¯ã€‚å³è¿™æ¡æ¶ˆæ¯åº”è¯¥è¢«å‘é€åˆ°å“ªä¸ªåœ°æ–¹å»ã€‚</p>
<p>å®¢æˆ·ç«¯åœ¨å†…å­˜ä¸­ç»´æŠ¤äº†ä¸€ä»½å’Œè¯é¢˜ç›¸å…³çš„è·¯ç”±ä¿¡æ¯è¡¨ <code>topicPublishInfoTable</code>ï¼Œå½“å‘é€æ¶ˆæ¯çš„æ—¶å€™ï¼Œä¼šé¦–å…ˆå°è¯•ä»æ­¤è¡¨ä¸­è·å–ä¿¡æ¯ã€‚å¦‚æœæ­¤è¡¨ä¸å­˜åœ¨è¿™æ¡è¯é¢˜çš„è¯ï¼Œé‚£ä¹ˆä¾¿ä¼šä» Name æœåŠ¡å™¨è·å–è·¯ç”±æ¶ˆæ¯ã€‚</p>
<p><img src="/images/docs/rocketmq/rocketmq-send-message-flow/get_test_topic_route_info.png" alt="è·å–è¯é¢˜è·¯ç”±ä¿¡æ¯"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DefaultMQProducerImpl</span> <span style="color:#66d9ef">implements</span> MQProducerInner <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> TopicPublishInfo <span style="color:#a6e22e">tryToFindTopicPublishInfo</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> String topic<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        TopicPublishInfo topicPublishInfo <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">topicPublishInfoTable</span><span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>topic<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">null</span> <span style="color:#f92672">==</span> topicPublishInfo <span style="color:#f92672">||</span> <span style="color:#f92672">!</span>topicPublishInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">ok</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">topicPublishInfoTable</span><span style="color:#f92672">.</span><span style="color:#a6e22e">putIfAbsent</span><span style="color:#f92672">(</span>topic<span style="color:#f92672">,</span> <span style="color:#66d9ef">new</span> TopicPublishInfo<span style="color:#f92672">());</span>
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">mQClientFactory</span><span style="color:#f92672">.</span><span style="color:#a6e22e">updateTopicRouteInfoFromNameServer</span><span style="color:#f92672">(</span>topic<span style="color:#f92672">);</span>
            topicPublishInfo <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">topicPublishInfoTable</span><span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>topic<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>

        <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>        
    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><p>å½“å°è¯•ä» Name æœåŠ¡å™¨è·å–è·¯ç”±ä¿¡æ¯çš„æ—¶å€™ï¼Œå…¶å¯èƒ½ä¼šè¿”å›ä¸¤ç§æƒ…å†µ:</p>
<h3 id="1-æ–°å»ºè¯é¢˜">(1) æ–°å»ºè¯é¢˜</h3>
<p>è¿™ä¸ªè¯é¢˜æ˜¯æ–°åˆ›å»ºçš„ï¼ŒName æœåŠ¡å™¨ä¸å­˜åœ¨å’Œæ­¤è¯é¢˜ç›¸å…³çš„ä¿¡æ¯ï¼š</p>
<p><img src="/images/docs/rocketmq/rocketmq-send-message-flow/nameserver_not_exist_topic.png" alt="NameServer ä¸å­˜åœ¨è¯é¢˜"></p>
<h3 id="2-å·²å­˜è¯é¢˜">(2) å·²å­˜è¯é¢˜</h3>
<p>è¯é¢˜ä¹‹å‰åˆ›å»ºè¿‡ï¼ŒName æœåŠ¡å™¨å­˜åœ¨æ­¤è¯é¢˜ä¿¡æ¯ï¼š</p>
<p><img src="/images/docs/rocketmq/rocketmq-send-message-flow/read_topic_info_from_nameserver.png" alt="NameServer å­˜åœ¨è¯é¢˜"></p>
<p>æœåŠ¡å™¨è¿”å›çš„è¯é¢˜è·¯ç”±ä¿¡æ¯åŒ…æ‹¬ä»¥ä¸‹å†…å®¹:</p>
<p><img src="/images/docs/rocketmq/rocketmq-send-message-flow/topic_route_data.png" alt="è·¯ç”±ä¿¡æ¯å†…å®¹"></p>
<p>â€œbroker-1â€ã€â€broker-2â€ åˆ†åˆ«ä¸ºä¸¤ä¸ª Broker æœåŠ¡å™¨çš„åç§°ï¼Œç›¸åŒåç§°ä¸‹å¯ä»¥æœ‰ä¸»ä» Brokerï¼Œå› æ­¤æ¯ä¸ª Broker åˆéƒ½æœ‰ brokerId ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒBrokerId å¦‚æœä¸º <code>MixAll.MASTER_ID</code> ï¼ˆå€¼ä¸º 0ï¼‰ çš„è¯ï¼Œé‚£ä¹ˆè®¤ä¸ºè¿™ä¸ª Broker ä¸º MASTER ä¸»æœºï¼Œå…¶ä½™çš„ä½äºç›¸åŒåç§°ä¸‹çš„ Broker ä¸ºè¿™å° MASTER ä¸»æœºçš„ SLAVE ä¸»æœºã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MQClientInstance</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">findBrokerAddressInPublish</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> String brokerName<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        HashMap<span style="color:#f92672">&lt;</span>Long<span style="color:#75715e">/* brokerId */</span><span style="color:#f92672">,</span> String<span style="color:#75715e">/* address */</span><span style="color:#f92672">&gt;</span> map <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">brokerAddrTable</span><span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>brokerName<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>map <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>map<span style="color:#f92672">.</span><span style="color:#a6e22e">isEmpty</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> map<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>MixAll<span style="color:#f92672">.</span><span style="color:#a6e22e">MASTER_ID</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><p>æ¯ä¸ª Broker ä¸Šé¢å¯ä»¥ç»‘å®šå¤šä¸ªå¯å†™æ¶ˆæ¯é˜Ÿåˆ—å’Œå¤šä¸ªå¯è¯»æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®¢æˆ·ç«¯æ ¹æ®è¿”å›çš„æ‰€æœ‰ Broker åœ°å€åˆ—è¡¨å’Œæ¯ä¸ª Broker çš„å¯å†™æ¶ˆæ¯é˜Ÿåˆ—åˆ—è¡¨ä¼šåœ¨å†…å­˜ä¸­æ„å»ºä¸€ä»½æ‰€æœ‰çš„æ¶ˆæ¯é˜Ÿåˆ—åˆ—è¡¨ã€‚ä¹‹åå®¢æˆ·ç«¯æ¯æ¬¡å‘é€æ¶ˆæ¯ï¼Œéƒ½ä¼šåœ¨æ¶ˆæ¯é˜Ÿåˆ—åˆ—è¡¨ä¸Šè½®å¾ªé€‰æ‹©é˜Ÿåˆ— (æˆ‘ä»¬å‡è®¾è¿”å›äº†ä¸¤ä¸ª Brokerï¼Œæ¯ä¸ª Broker å‡æœ‰ 4 ä¸ªå¯å†™æ¶ˆæ¯é˜Ÿåˆ—):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TopicPublishInfo</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">public</span> MessageQueue <span style="color:#a6e22e">selectOneMessageQueue</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">int</span> index <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">sendWhichQueue</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getAndIncrement</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">int</span> pos <span style="color:#f92672">=</span> Math<span style="color:#f92672">.</span><span style="color:#a6e22e">abs</span><span style="color:#f92672">(</span>index<span style="color:#f92672">)</span> <span style="color:#f92672">%</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">messageQueueList</span><span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>pos <span style="color:#f92672">&lt;</span> 0<span style="color:#f92672">)</span>
            pos <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">messageQueueList</span><span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>pos<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><p><img src="/images/docs/rocketmq/rocketmq-send-message-flow/client_select_message_queue.png" alt="å®¢æˆ·ç«¯è½®è¯¢æ¶ˆæ¯é˜Ÿåˆ—"></p>
<h2 id="ä¸ƒç»™-broker-å‘é€æ¶ˆæ¯">ä¸ƒã€ç»™ Broker å‘é€æ¶ˆæ¯</h2>
<p>åœ¨ç¡®å®šäº† Master Broker åœ°å€å’Œè¿™ä¸ª Broker çš„æ¶ˆæ¯é˜Ÿåˆ—ä»¥åï¼Œå®¢æˆ·ç«¯æ‰å¼€å§‹çœŸæ­£åœ°å‘é€æ¶ˆæ¯ç»™è¿™ä¸ª Brokerï¼Œä¹Ÿæ˜¯ä»è¿™é‡Œå®¢æˆ·ç«¯æ‰å¼€å§‹ä¸ Broker è¿›è¡Œäº¤äº’:</p>
<p><img src="/images/docs/rocketmq/rocketmq-send-message-flow/client_send_msg_to_broker.png" alt="å‘é€æ¶ˆæ¯"></p>
<p>è¿™é‡Œæˆ‘ä»¬æš‚ä¸”å…ˆå¿½ç•¥æ¶ˆæ¯ä½“æ ¼å¼çš„å…·ä½“ç¼–/è§£ç è¿‡ç¨‹ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶ä¸æƒ³ä¸€å¼€å§‹å°±å·å…¥è¿™äº›ç¹æç»†èŠ‚ä¸­ï¼Œç°åœ¨å…ˆä»å¤§ä½“ä¸Šäº†è§£ä¸€ä¸‹æ•´ä¸ªæ¶ˆæ¯çš„å‘é€æµç¨‹ï¼Œåç»­ä¼šå†™ä¸“é—¨çš„æ–‡ç« æ¥è¯´æ˜ã€‚</p>
<h2 id="å…«broker-æ£€æŸ¥è¯é¢˜ä¿¡æ¯">å…«ã€Broker æ£€æŸ¥è¯é¢˜ä¿¡æ¯</h2>
<p>åˆšæ‰è¯´åˆ°ï¼Œå¦‚æœè¯é¢˜ä¿¡æ¯åœ¨ Name æœåŠ¡å™¨ä¸å­˜åœ¨çš„è¯ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨é»˜è®¤è¯é¢˜ä¿¡æ¯è¿›è¡Œæ¶ˆæ¯çš„å‘é€ã€‚ç„¶è€Œä¸€æ—¦è¿™æ¡æ¶ˆæ¯åˆ°æ¥ä¹‹åï¼ŒBroker ç«¯è¿˜å¹¶æ²¡æœ‰è¿™ä¸ªè¯é¢˜ã€‚æ‰€ä»¥ Broker éœ€è¦æ£€æŸ¥è¯é¢˜çš„å­˜åœ¨æ€§:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AbstractSendMessageProcessor</span> <span style="color:#66d9ef">implements</span> NettyRequestProcessor <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">protected</span> RemotingCommand <span style="color:#a6e22e">msgCheck</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> ChannelHandlerContext ctx<span style="color:#f92672">,</span>
                                       <span style="color:#66d9ef">final</span> SendMessageRequestHeader requestHeader<span style="color:#f92672">,</span> <span style="color:#66d9ef">final</span> RemotingCommand response<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

        <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>
        TopicConfig topicConfig <span style="color:#f92672">=</span>
            <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">brokerController</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">getTopicConfigManager</span><span style="color:#f92672">()</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">selectTopicConfig</span><span style="color:#f92672">(</span>requestHeader<span style="color:#f92672">.</span><span style="color:#a6e22e">getTopic</span><span style="color:#f92672">());</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">null</span> <span style="color:#f92672">==</span> topicConfig<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

            <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>
            topicConfig <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">brokerController</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">getTopicConfigManager</span><span style="color:#f92672">()</span>
                <span style="color:#f92672">.</span><span style="color:#a6e22e">createTopicInSendMessageMethod</span><span style="color:#f92672">(</span> <span style="color:#f92672">...</span> <span style="color:#f92672">);</span>
            
        <span style="color:#f92672">}</span>
        
    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><p>å¦‚æœè¯é¢˜ä¸å­˜åœ¨çš„è¯ï¼Œé‚£ä¹ˆä¾¿ä¼šåˆ›å»ºä¸€ä¸ªè¯é¢˜ä¿¡æ¯å­˜å‚¨åˆ°æœ¬åœ°ï¼Œå¹¶å°†æ‰€æœ‰è¯é¢˜å†è¿›è¡Œä¸€æ¬¡åŒæ­¥ç»™æ‰€æœ‰çš„ Name æœåŠ¡å™¨:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TopicConfigManager</span> <span style="color:#66d9ef">extends</span> ConfigManager <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">public</span> TopicConfig <span style="color:#a6e22e">createTopicInSendMessageMethod</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> String topic<span style="color:#f92672">,</span> <span style="color:#75715e">/** params **/</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>        topicConfig <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> TopicConfig<span style="color:#f92672">(</span>topic<span style="color:#f92672">);</span>
        
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">topicConfigTable</span><span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span>topic<span style="color:#f92672">,</span> topicConfig<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">persist</span><span style="color:#f92672">();</span>

        <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>        
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">brokerController</span><span style="color:#f92672">.</span><span style="color:#a6e22e">registerBrokerAll</span><span style="color:#f92672">(</span><span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>

        <span style="color:#66d9ef">return</span> topicConfig<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><p>è¯é¢˜æ£€æŸ¥çš„æ•´ä½“æµç¨‹å¦‚ä¸‹æ‰€ç¤º:</p>
<p><img src="/images/docs/rocketmq/rocketmq-send-message-flow/broker_check_topic_and_sync_to_nameserver.png" alt="æ£€æŸ¥è¯é¢˜æµç¨‹"></p>
<h2 id="ä¹æ¶ˆæ¯å­˜å‚¨">ä¹ã€æ¶ˆæ¯å­˜å‚¨</h2>
<p>å½“ Broker å¯¹æ¶ˆæ¯çš„ä¸€äº›å­—æ®µåšè¿‡ä¸€ç•ªå¿…è¦çš„æ£€æŸ¥ä¹‹åï¼Œä¾¿ä¼šå­˜å‚¨åˆ°ç£ç›˜ä¸­å»:</p>
<p><img src="/images/docs/rocketmq/rocketmq-send-message-flow/broker_save_message.png" alt="æ¶ˆæ¯å­˜å‚¨"></p>
<h2 id="åæ•´ä½“æµç¨‹">åã€æ•´ä½“æµç¨‹</h2>
<p>å‘é€æ¶ˆæ¯çš„æ•´ä½“æµç¨‹:</p>
<p><img src="/images/docs/rocketmq/rocketmq-send-message-flow/send_message_full_flow.png" alt="å‘é€æ¶ˆæ¯æµç¨‹"></p>
<p>æ‰«æä¸‹é¢äºŒç»´ç ï¼Œåœ¨æ‰‹æœºç«¯é˜…è¯»ï¼š</p>
<p><img src="/images/docs/rocketmq/rocketmq-send-message-flow/qrcode.png" alt=""></p>
</article>
 

      <footer class="book-footer">
        
  <div class="flex justify-between">





</div>

 
        
  
  <div class="book-comments">  
  
  <div id="vcomments"></div>
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src='//unpkg.com/valine/dist/Valine.min.js'></script>

  <script type="text/javascript">
    new Valine({
        el: '#vcomments' ,
        appId: 'Hw2fQnNQyghcgeRvQosC5cIy-gzGzoHsz',
        appKey: '0ULuPWcxGRLCaHz84icXvBgn',
        notify: 'false', 
        verify: 'false', 
        avatar:'mm', 
        placeholder: 'è¯´ç‚¹ä»€ä¹ˆå§...',
        visitor: 'true'
    });
  </script></div>
  
 
      </footer>
      
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#ä¸€æœåŠ¡å™¨å¯åŠ¨">ä¸€ã€æœåŠ¡å™¨å¯åŠ¨</a></li>
    <li><a href="#äºŒæ„å»ºæ¶ˆæ¯ä½“">äºŒã€æ„å»ºæ¶ˆæ¯ä½“</a></li>
    <li><a href="#ä¸‰å¯åŠ¨-producer-å‡†å¤‡å‘é€æ¶ˆæ¯">ä¸‰ã€å¯åŠ¨ Producer å‡†å¤‡å‘é€æ¶ˆæ¯</a></li>
    <li><a href="#å››name-æœåŠ¡å™¨çš„å‡ç­‰æ€§">å››ã€Name æœåŠ¡å™¨çš„å‡ç­‰æ€§</a></li>
    <li><a href="#äº”é€‰æ‹©-name-æœåŠ¡å™¨">äº”ã€é€‰æ‹© Name æœåŠ¡å™¨</a></li>
    <li><a href="#å…­å¯»æ‰¾è¯é¢˜è·¯ç”±ä¿¡æ¯">å…­ã€å¯»æ‰¾è¯é¢˜è·¯ç”±ä¿¡æ¯</a>
      <ul>
        <li><a href="#1-æ–°å»ºè¯é¢˜">(1) æ–°å»ºè¯é¢˜</a></li>
        <li><a href="#2-å·²å­˜è¯é¢˜">(2) å·²å­˜è¯é¢˜</a></li>
      </ul>
    </li>
    <li><a href="#ä¸ƒç»™-broker-å‘é€æ¶ˆæ¯">ä¸ƒã€ç»™ Broker å‘é€æ¶ˆæ¯</a></li>
    <li><a href="#å…«broker-æ£€æŸ¥è¯é¢˜ä¿¡æ¯">å…«ã€Broker æ£€æŸ¥è¯é¢˜ä¿¡æ¯</a></li>
    <li><a href="#ä¹æ¶ˆæ¯å­˜å‚¨">ä¹ã€æ¶ˆæ¯å­˜å‚¨</a></li>
    <li><a href="#åæ•´ä½“æµç¨‹">åã€æ•´ä½“æµç¨‹</a></li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  

  <script type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1279346965'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1279346965%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</body>



</html>












