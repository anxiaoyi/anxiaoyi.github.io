<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="JVM BOX"><meta property="og:title" content="JVM BOX" />
<meta property="og:description" content="JVM å‘½ä»¤å·¥å…·ç®±  åœ¨ Ubuntu 18.04 ä¸ŠéªŒè¯
 åˆ‡æ¢ Java ç‰ˆæœ¬ $ update-alternatives --config java JDK å‘½ä»¤æ— æ³•æ‰§è¡Œ æŠ¥é”™ï¼š
Error attaching to process: sun.jvm.hotspot.debugger.DebuggerException: Can&#39;t attach to the process: ptrace(PTRACE_ATTACH, ..) failed for 34131: Operation not permitted è§£å†³æ–¹æ³•ï¼š
# æŠŠè¿™ä¸ªæ–‡ä»¶é‡Œé¢çš„å€¼ä» 1 æ”¹ä¸º 0 å³å¯ echo 0 | sudo tee /proc/sys/kernel/yama/ptrace_scope  æŠ¥é”™ï¼š
Exception in thread &quot;main&quot; java.lang.reflect.InvocationTargetException at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at sun.tools.jinfo.JInfo.runTool(JInfo.java:108) at sun.tools.jinfo.JInfo.main(JInfo.java:76) Caused by: java." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kunzhao.org/docs/tutorial/java/jvmbox/" /><meta property="article:section" content="docs" />



<title>JVM BOX | èµµå¤çš„ä¸ªäººç½‘ç«™</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/book.min.827556f4a4b428e6ff4e68c72777003c28afbb68322bd35664dd0889a941daa0.css" integrity="sha256-gnVW9KS0KOb/TmjHJ3cAPCivu2gyK9NWZN0IialB2qA=">


<script defer src="/en.search.min.c41e2d56fb8780ede7944020c03cc31855b9adc615b14e19966073539bd6e2c4.js" integrity="sha256-xB4tVvuHgO3nlEAgwDzDGFW5rcYVsU4ZlmBzU5vW4sQ="></script>
<script>
var _hmt = _hmt || [];
(function() {
  if (location.hostname === "localhost" || 
    location.hostname === "127.0.0.1") {
    return;
  }

  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d04ff9e23cec6cb39ebbee1b4883e269";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<script data-ad-client="ca-pub-8950855178079071" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><span>èµµå¤çš„ä¸ªäººç½‘ç«™</span>
  </a>
</h2>








  

  
  





 
  
    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/" >
      ğŸ’¡ æ•™ç¨‹
  </a>


    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/front-end-optimization-guide/" >
      å‰ç«¯ä¼˜åŒ–æŒ‡å—
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/algorithm/" >
      ç®—æ³•
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/raft/" >
      raft
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/unix-command/" >
      UNIX å¸¸ç”¨å‘½ä»¤å¤§å…¨
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/unix-optimize/" >
      UNIX æ€§èƒ½ä¼˜åŒ–
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/vue3/" >
      Vue.js æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/git/" >
      Git æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/network/" >
      ç½‘ç»œåè®®
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/awk/" >
      AWK æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/devops/" >
      DevOps
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/sentinel/" >
      é˜¿é‡Œå·´å·´ Sentinel
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/zipkin/" >
      Zipkin æºç åˆ†æ
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/eureka/" >
      Netflix Eureka æºç åˆ†æ
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/distributed-storage/" >
      åˆ†å¸ƒå¼å­˜å‚¨
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/maven/" >
      Maven æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/java/" >
      Java æ•™ç¨‹
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/docs/tutorial/java/stream/" >
      Stream ç¼–ç¨‹
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/java/date-time/" >
      Java Date å’Œ Time
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/java/classloader/" >
      Java ç±»åŠ è½½
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/java/juc/" >
      JUC å¹¶å‘åŒ…
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/java/gc-analyze/" >
      Hotspot GC æºç åˆ†æ
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/java/java-io/" >
      Java IO
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/java/jvm/" >
      JVM
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/java/jvmbox/"  class="active">
      JVM BOX
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/java/g1-gc-analyze/" >
      Hotspot G1 GC æºç åˆ†æ
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/java/basic/" >
      Java åŸºç¡€
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/java/btrace/" >
      BTrace
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/java/java-collection/" >
      Java é›†åˆç±»
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/java/concurrency/" >
      å¤šçº¿ç¨‹å¹¶å‘ç¤ºä¾‹
  </a>

</li>
      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/spring/" >
      Spring æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/distributed/" >
      åˆ†å¸ƒå¼ç³»ç»Ÿä¸æ¶æ„è®¾è®¡
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/softskill/" >
      ç®´è¨€ç®´å¥
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/database/" >
      æ•°æ®åº“
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/redis/" >
      Redis
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/bigdata/" >
      å¤§æ•°æ®åœºæ™¯
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/technique/" >
      æŠ€æœ¯
  </a>


    

    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/programmer-interview/" >
      ğŸ‘ ç¨‹åºå‘˜é¢è¯•é¢˜
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/rocketmq/" >
      RocketMQ æºç åˆ†æ
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/books/" >
      ä¹¦ç±
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/javascript/" >
      JavaScript ä¸“æ 
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/it-zone/" >
      IT åœˆ
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/hire/" >
      æ‹›è˜
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/cloud-plus-bbs/" >
      äº‘&#43;ç¤¾åŒºæŠ€æœ¯æ²™é¾™
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tools/" >
      å®ç”¨å·¥å…·
  </a>


    

    






  </li>


      
    
  </ul>
  



  












<ul>
  
  <li>
    <a href="/posts/" >
        åšå®¢
      </a>
  </li>
  
</ul>



</nav>




  <script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>JVM BOX</strong>

  <label for="toc-control">
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#åˆ‡æ¢-java-ç‰ˆæœ¬">åˆ‡æ¢ Java ç‰ˆæœ¬</a></li>
    <li><a href="#jdk-å‘½ä»¤æ— æ³•æ‰§è¡Œ">JDK å‘½ä»¤æ— æ³•æ‰§è¡Œ</a></li>
    <li><a href="#æŸ¥çœ‹è¿›ç¨‹åŸºç¡€ä¿¡æ¯">æŸ¥çœ‹è¿›ç¨‹åŸºç¡€ä¿¡æ¯</a></li>
    <li><a href="#æŸ¥çœ‹è¿›ç¨‹ç³»ç»Ÿä¿¡æ¯">æŸ¥çœ‹è¿›ç¨‹ç³»ç»Ÿä¿¡æ¯</a></li>
    <li><a href="#æŸ¥çœ‹-gc-æƒ…å†µ">æŸ¥çœ‹ GC æƒ…å†µ</a></li>
    <li><a href="#æŸ¥çœ‹å †æƒ…å†µ">æŸ¥çœ‹å †æƒ…å†µ</a></li>
    <li><a href="#æŸ¥çœ‹æ ˆä¿¡æ¯">æŸ¥çœ‹æ ˆä¿¡æ¯</a></li>
    <li><a href="#jvm-å‚æ•°è§£é‡Š">JVM å‚æ•°è§£é‡Š</a></li>
    <li><a href="#å„å‘½ä»¤å«ä¹‰å…·ä½“è§£é‡Š">å„å‘½ä»¤å«ä¹‰å…·ä½“è§£é‡Š</a>
      <ul>
        <li><a href="#class-name">class name</a></li>
        <li><a href="#xx-å‚æ•°è¯­æ³•">XX å‚æ•°è¯­æ³•</a></li>
        <li><a href="#maxmetaspacesize-å€¼è¿‡å¤§">MaxMetaspaceSize å€¼è¿‡å¤§</a></li>
        <li><a href="#é»˜è®¤å †å¤§å°">é»˜è®¤å †å¤§å°</a></li>
        <li><a href="#nativememorytracking">NativeMemoryTracking</a></li>
        <li><a href="#gc-åå†…å­˜ä½•æ—¶é‡Šæ”¾ç»™-os">GC åå†…å­˜ä½•æ—¶é‡Šæ”¾ç»™ OS</a></li>
        <li><a href="#jdk-18-å†…å­˜å ç”¨">JDK 1.8 å†…å­˜å ç”¨</a></li>
        <li><a href="#jvm-è¿è¡Œåœ¨-pod-ä¸­">JVM è¿è¡Œåœ¨ Pod ä¸­</a></li>
      </ul>
    </li>
    <li><a href="#å‚è€ƒ">å‚è€ƒ</a></li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
<article class="markdown">
  
<ins class="adsbygoogle"
style="display:block"
data-ad-client="ca-pub-8950855178079071"
data-ad-slot="6142361626"
data-ad-format="auto"
data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script><h1 id="jvm-å‘½ä»¤å·¥å…·ç®±">JVM å‘½ä»¤å·¥å…·ç®±</h1>
<blockquote>
<p>åœ¨ Ubuntu 18.04 ä¸ŠéªŒè¯</p>
</blockquote>
<h2 id="åˆ‡æ¢-java-ç‰ˆæœ¬">åˆ‡æ¢ Java ç‰ˆæœ¬</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ update-alternatives --config java
</code></pre></div><h2 id="jdk-å‘½ä»¤æ— æ³•æ‰§è¡Œ">JDK å‘½ä»¤æ— æ³•æ‰§è¡Œ</h2>
<p>æŠ¥é”™ï¼š</p>
<pre><code>Error attaching to process: sun.jvm.hotspot.debugger.DebuggerException: Can't attach to the process: ptrace(PTRACE_ATTACH, ..) failed for 34131: Operation not permitted
</code></pre><p>è§£å†³æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># æŠŠè¿™ä¸ªæ–‡ä»¶é‡Œé¢çš„å€¼ä» 1 æ”¹ä¸º 0 å³å¯</span>
echo <span style="color:#ae81ff">0</span> | sudo tee /proc/sys/kernel/yama/ptrace_scope
</code></pre></div><hr>
<p>æŠ¥é”™ï¼š</p>
<pre><code>Exception in thread &quot;main&quot; java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at sun.tools.jinfo.JInfo.runTool(JInfo.java:108)
	at sun.tools.jinfo.JInfo.main(JInfo.java:76)
Caused by: java.lang.InternalError: Metadata does not appear to be polymorphic
	at sun.jvm.hotspot.types.basic.BasicTypeDataBase.findDynamicTypeForAddress(BasicTypeDataBase.java:278)
	at sun.jvm.hotspot.runtime.VirtualBaseConstructor.instantiateWrapperFor(VirtualBaseConstructor.java:102)
	at sun.jvm.hotspot.oops.Metadata.instantiateWrapperFor(Metadata.java:68)
	at sun.jvm.hotspot.memory.SystemDictionary.getSystemKlass(SystemDictionary.java:127)
	at sun.jvm.hotspot.runtime.VM.readSystemProperties(VM.java:879)
</code></pre><p>æˆ–</p>
<pre><code>Heap Usage:
Exception in thread &quot;main&quot; java.lang.reflect.InvocationTargetException
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at sun.tools.jmap.JMap.runTool(JMap.java:201)
	at sun.tools.jmap.JMap.main(JMap.java:130)
Caused by: java.lang.RuntimeException: unknown CollectedHeap type : class sun.jvm.hotspot.gc_interface.CollectedHeap
	at sun.jvm.hotspot.tools.HeapSummary.run(HeapSummary.java:144)
	at sun.jvm.hotspot.tools.Tool.startInternal(Tool.java:260)
	at sun.jvm.hotspot.tools.Tool.start(Tool.java:223)
	at sun.jvm.hotspot.tools.Tool.execute(Tool.java:118)
</code></pre><p>è§£å†³æ–¹æ³•ï¼Œåº”è¯¥å®‰è£…å¯¹åº”çš„ Java ç‰ˆæœ¬çš„ debug åŒ…ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo apt install openjdk-8-dbg
</code></pre></div><h2 id="æŸ¥çœ‹è¿›ç¨‹åŸºç¡€ä¿¡æ¯">æŸ¥çœ‹è¿›ç¨‹åŸºç¡€ä¿¡æ¯</h2>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>jps -l</code></td>
<td>åˆ—ä¸¾å…¨éƒ¨ JVM çš„è¿›ç¨‹</td>
</tr>
<tr>
<td><code>jps -l -m</code></td>
<td>åˆ—ä¸¾å…¨éƒ¨ JVM çš„è¿›ç¨‹, <code>-m</code> åˆ—ä¸¾ä¼ é€’ç»™ <code>main()</code> æ–¹æ³•çš„å‚æ•°</td>
</tr>
<tr>
<td><code>java -version</code></td>
<td>æŸ¥çœ‹ JVM å·¥ä½œæ¨¡å¼</td>
</tr>
<tr>
<td><code>jinfo &lt;pid&gt;</code></td>
<td>æŸ¥çœ‹é…ç½®ä¿¡æ¯: System propertiesã€JVM å‘½ä»¤è¡Œå‚æ•°</td>
</tr>
<tr>
<td><code>jinfo -flag OldSize &lt;pid&gt;</code></td>
<td>æŸ¥çœ‹è€å¹´ä»£å†…å­˜å¤§å°</td>
</tr>
<tr>
<td><code>java -XX:+PrintCommandLineFlags -version</code></td>
<td>è®© JVM æ‰“å°å‡ºé‚£äº›å·²ç»è¢«ç”¨æˆ·æˆ–è€…JVMè®¾ç½®è¿‡çš„è¯¦ç»†çš„XXå‚æ•°çš„åç§°å’Œå€¼</td>
</tr>
<tr>
<td><code>java -XX:+PrintFlagsInitial -version</code></td>
<td>çœ‹ä¸‹æ‰€æœ‰ XX å‚æ•°çš„åˆå§‹å€¼</td>
</tr>
<tr>
<td><code>java -XX:+PrintFlagsFinal -version</code></td>
<td>çœ‹ä¸‹æ‰€æœ‰ XX å‚æ•°çš„æœ€ç»ˆå€¼ï¼Œè¿™ä¸ªå°±æ˜¯ç¨‹åºæœ€ç»ˆä½¿ç”¨çš„å †çš„é…ç½®</td>
</tr>
</tbody>
</table>
<h2 id="æŸ¥çœ‹è¿›ç¨‹ç³»ç»Ÿä¿¡æ¯">æŸ¥çœ‹è¿›ç¨‹ç³»ç»Ÿä¿¡æ¯</h2>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>uname -a</code></td>
<td>æ“ä½œç³»ç»Ÿä¿¡æ¯</td>
</tr>
<tr>
<td><code>cat /proc/&lt;pid&gt;/status</code></td>
<td><code>VmRSS</code> çš„å€¼æ˜¯å½“å‰å ç”¨çš„<strong>ç‰©ç†å†…å­˜</strong></td>
</tr>
<tr>
<td><code>ps -p 51748 -o rss, vsz, sz</code></td>
<td><code>RSS</code> æ˜¯å®é™…ä½¿ç”¨çš„å†…å­˜ï¼Œ<code>VSZ</code> æ˜¯è™šæ‹Ÿå†…å­˜ï¼Œå•ä½éƒ½æ˜¯ KB</td>
</tr>
<tr>
<td>JVM å‚æ•° <code>-XX:NativeMemoryTracking=detail</code></td>
<td>è¿½è¸ª JVM çš„<strong>å†…éƒ¨å†…å­˜</strong>ä½¿ç”¨ï¼Œç”Ÿäº§ç¯èŠ‚å‹¿ç”¨</td>
</tr>
<tr>
<td><code>jcmd &lt;pid&gt; VM.native_memory scale=MB</code></td>
<td>è·å–<strong>å†…å­˜</strong>ä¿¡æ¯</td>
</tr>
</tbody>
</table>
<h2 id="æŸ¥çœ‹-gc-æƒ…å†µ">æŸ¥çœ‹ GC æƒ…å†µ</h2>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>jstat -gc &lt;pid&gt; 1000 5</code></td>
<td>å †å„ä¸ªåŒºå ç”¨æƒ…å†µã€åƒåœ¾å›æ”¶æ¬¡æ•°ï¼Œæ¯ 1000 æ¯«ç§’è¾“å‡ºä¸€æ¬¡ï¼Œå…±è¾“å‡º 5 æ¬¡</td>
</tr>
<tr>
<td><code>jstat -gccapacity &lt;pid&gt; 1000 5</code></td>
<td>æ¯”ä¸Šé¢å‘½ä»¤å¤šè¾“å‡º: å„åŒºåŸŸæœ€å¤§æœ€å°ç©ºé—´</td>
</tr>
<tr>
<td><code>jstat -gcutil &lt;pid&gt; 1000 5</code></td>
<td>å„åŒºåŸŸæ‰€å çš„<strong>ç™¾åˆ†æ¯”</strong></td>
</tr>
<tr>
<td><code>jstat -gccause &lt;pid&gt; 1000 5</code></td>
<td>é™„åŠ æœ€è¿‘ä¸¤æ¬¡åƒåœ¾å›æ”¶äº‹ä»¶çš„åŸå› </td>
</tr>
</tbody>
</table>
<h2 id="æŸ¥çœ‹å †æƒ…å†µ">æŸ¥çœ‹å †æƒ…å†µ</h2>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>jmap -heap &lt;pid&gt;</code></td>
<td>æŸ¥çœ‹å½“å‰å †å†…å­˜é…ç½®ä¿¡æ¯å’Œä½¿ç”¨æƒ…å†µ</td>
</tr>
<tr>
<td>`jmap -histo <!-- raw HTML omitted --></td>
<td>sort -n -r -k 3</td>
</tr>
<tr>
<td>`jmap -histo <!-- raw HTML omitted --></td>
<td>sort -n -r -k 2</td>
</tr>
<tr>
<td>`jmap -histo:live <!-- raw HTML omitted --></td>
<td>sort -n -r -k 2</td>
</tr>
<tr>
<td><code>jmap -dump:live,format=b,file=/home/myheapdump.hprof &lt;pid&gt;</code></td>
<td>Dump å †å†…å­˜</td>
</tr>
<tr>
<td><code>jhat /home/myheapdump.hprof</code></td>
<td>æœ¬åœ°å¯åŠ¨ HTTP Server åˆ†æå †å†…å­˜</td>
</tr>
<tr>
<td><code>jstat -class &lt;pid&gt;</code></td>
<td>æŸ¥çœ‹<strong>ç±»åŠ è½½</strong>æƒ…å†µ</td>
</tr>
<tr>
<td><code>jmap -clstats &lt;pid&gt;</code></td>
<td>æŸ¥çœ‹<strong>ç±»åŠ è½½</strong>æƒ…å†µ</td>
</tr>
</tbody>
</table>
<h2 id="æŸ¥çœ‹æ ˆä¿¡æ¯">æŸ¥çœ‹æ ˆä¿¡æ¯</h2>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>jstack -l &lt;pid&gt;</code></td>
<td>æŸ¥çœ‹å½“å‰æ ˆä¿¡æ¯</td>
</tr>
</tbody>
</table>
<h2 id="jvm-å‚æ•°è§£é‡Š">JVM å‚æ•°è§£é‡Š</h2>
<table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-XX:InitialHeapSize=96468992</code> æˆ– <code>-Xms</code></td>
<td>JVM åˆå§‹å †å†…å­˜ï¼Œå•ä½ Byte</td>
</tr>
<tr>
<td><code>-XX:MaxHeapSize=1541406720</code> æˆ– <code>-Xmx</code></td>
<td>JVM æœ€å¤§å †å†…å­˜</td>
</tr>
<tr>
<td><code>-XX:MaxNewSize=513802240</code></td>
<td>JVM æ–°ç”Ÿä»£æœ€å¤§ç©ºé—´</td>
</tr>
<tr>
<td><code>-XX:NewSize=31981568</code></td>
<td>JVM æ–°ç”Ÿä»£åˆå§‹å¤§å°</td>
</tr>
<tr>
<td><code>-XX:OldSize=64487424</code></td>
<td>è€å¹´ä»£çš„é»˜è®¤å¤§å°ï¼Œå‚æ•°ä¸ä¸€å®šç”Ÿæ•ˆ</td>
</tr>
<tr>
<td><code>-XX:NewRatio</code></td>
<td>è€å¹´ä»£ä¸æ–°ç”Ÿä»£çš„æ¯”ä¾‹</td>
</tr>
<tr>
<td><code>-XX:SurvivorRatio</code></td>
<td>Eden ä¸ Survivor å¹¸å­˜åŒº To/From çš„æ¯”ä¾‹</td>
</tr>
<tr>
<td><code>-XX:+HeapDumpBeforeFullGC</code> å’Œ <code>-XX:+HeapDumpAfterFullGC</code></td>
<td><code>FullGC</code> å‰ååˆ†åˆ«å¯¹å†…å­˜åš Heap Dump</td>
</tr>
<tr>
<td><code>-XX:+UnlockDiagnosticVMOptions -XX:+PrintNMTStatistics</code></td>
<td>JVM shutdown çš„æ—¶å€™è¾“å‡ºæ•´ä½“çš„ native memory ç»Ÿè®¡</td>
</tr>
</tbody>
</table>
<ul>
<li><a href="https://www.oracle.com/java/technologies/javase/vmoptions-jsp.html">æ›´å¤šå‚æ•°</a></li>
</ul>
<h2 id="å„å‘½ä»¤å«ä¹‰å…·ä½“è§£é‡Š">å„å‘½ä»¤å«ä¹‰å…·ä½“è§£é‡Š</h2>
<h3 id="class-name">class name</h3>
<p><code>jmap -histo</code> åˆ—ä¸¾çš„æœ€åä¸€åˆ—çš„ <code>class name</code> çš„å«ä¹‰ï¼š</p>
<ul>
<li><code>B</code>: byte</li>
<li><code>C</code>: char</li>
<li><code>S</code>: short</li>
<li><code>D</code>: double</li>
<li><code>F</code>: float</li>
<li><code>I</code>: int</li>
<li><code>J</code>: long</li>
<li><code>Z</code>: boolean</li>
<li><code>[</code>: æ•°ç»„ï¼Œä¾‹å¦‚ <code>[i</code> è¡¨ç¤º <code>int[]</code></li>
<li><code>[L ç±»å</code>: è¡¨ç¤ºæŸä¸ªç±»çš„æ•°ç»„</li>
</ul>
<h3 id="xx-å‚æ•°è¯­æ³•">XX å‚æ•°è¯­æ³•</h3>
<p>æ‰€æœ‰çš„XXå‚æ•°éƒ½ä»¥â€-XX:â€å¼€å§‹ï¼Œä½†æ˜¯éšåçš„è¯­æ³•ä¸åŒï¼Œå–å†³äºå‚æ•°çš„ç±»å‹ã€‚</p>
<ul>
<li>å¯¹äº<strong>å¸ƒå°”ç±»å‹</strong>çš„å‚æ•°ï¼Œæˆ‘ä»¬æœ‰â€+â€æˆ–â€-â€œï¼Œç„¶åæ‰è®¾ç½®JVMé€‰é¡¹çš„å®é™…åç§°ã€‚ä¾‹å¦‚ï¼Œ<code>-XX:+&lt;name&gt;</code>ç”¨äºæ¿€æ´»<code>&lt;name&gt;</code>é€‰é¡¹ï¼Œè€Œ<code>-XX:-&lt;name&gt;</code>ç”¨äºæ³¨é”€é€‰é¡¹ã€‚</li>
<li>å¯¹äºéœ€è¦<strong>éå¸ƒå°”å€¼</strong>çš„å‚æ•°ï¼Œå¦‚stringæˆ–è€…integerï¼Œæˆ‘ä»¬å…ˆå†™å‚æ•°çš„åç§°ï¼Œåé¢åŠ ä¸Šâ€=â€ï¼Œæœ€åèµ‹å€¼ã€‚ä¾‹å¦‚ï¼Œ  <code>-XX:&lt;name&gt;=&lt;value&gt;</code>ç»™<code>&lt;name&gt;</code>èµ‹å€¼<code>&lt;value&gt;</code></li>
</ul>
<h3 id="maxmetaspacesize-å€¼è¿‡å¤§">MaxMetaspaceSize å€¼è¿‡å¤§</h3>
<p>ç”¨ <code>jmap -heap &lt;pid&gt;</code> æ˜¾ç¤ºçš„ <code>MaxMetaspaceSize</code> å€¼ç‰¹åˆ«å¤§ï¼Œçœ‹èµ·æ¥å°±å’Œæ²¡æœ‰é™åˆ¶ä¸€æ ·ã€‚JDK 1.8 ä¹‹å<strong>åº”è¯¥</strong>ä½¿ç”¨ <code>-XX:MetaspaceSize=64m</code> å’Œ <code>-XX:MaxMetaspaceSize=128m</code> è¿™ä¸¤ä¸ªå‚æ•°é™åˆ¶<strong>å…ƒç©ºé—´</strong>çš„å¤§å°ã€‚</p>
<h3 id="é»˜è®¤å †å¤§å°">é»˜è®¤å †å¤§å°</h3>
<p>é»˜è®¤æœ€å¤šä½¿ç”¨å¤šå¤§å†…å­˜çš„å †ç©ºé—´æ˜¯æ ¹æ®æ¯å°æœºå™¨çš„<strong>é…ç½®</strong>ã€<strong>ç‰©ç†å†…å­˜</strong>å†³å®šçš„ã€‚å¯ä»¥ä½¿ç”¨å‘½ä»¤</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">java -XX:+PrintFlagsFinal -version | grep HeapSize
</code></pre></div><p>æ¥æŸ¥çœ‹<strong>åˆå§‹å †å†…å­˜</strong>å’Œ<strong>æœ€å¤§å †å†…å­˜</strong>å¤§å°ã€‚å¯¹äº JDK 8 è€Œè¨€ï¼Œä¸€èˆ¬æœ€å°å’Œæœ€å¤§å †å†…å­˜ä½äºæœºå™¨ç‰©ç†å†…å­˜çš„ 1/64 ~ 1/4 ä¹‹é—´ï¼Œå…¶ä¸­ç‰©ç†å†…å­˜ä» <code>cat /proc/meminfo</code> ä¿¡æ¯ä¸­è·å–ã€‚ä»å¦‚ä¸‹å‚æ•°ä¹Ÿå¯ä»¥çœ‹åˆ°ä½¿ç”¨ RAM çš„ç™¾åˆ†æ¯”ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">java -XX:+PrintFlagsFinal -version | grep RAM
</code></pre></div><p>å¯¹äºå®¹å™¨è€Œè¨€ï¼ŒDocker å®¹å™¨æœ¬è´¨æ˜¯æ˜¯å®¿ä¸»æœºä¸Šçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œå®ƒä¸å®¿ä¸»æœºå…±äº«ä¸€ä¸ª <code>/proc</code> ç›®å½•ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åœ¨å®¹å™¨å†…çœ‹åˆ°çš„ <code>/proc/meminfo</code>ï¼Œ<code>/proc/cpuinfo</code> ä¸ç›´æ¥åœ¨å®¿ä¸»æœºä¸Šçœ‹åˆ°çš„ä¸€è‡´ï¼Œå¦‚æœä¸åŠ é™åˆ¶ï¼Œå¯èƒ½å­˜åœ¨ JVM è¶…é¢ä½¿ç”¨å†…å­˜è¢« OS Kill æ‰çš„é£é™©ã€‚</p>
<p>å¯¹äº Java SE 8u131 ä¹‹å‰çš„ JDK ç‰ˆæœ¬ï¼Œéœ€è¦å°† <code>-Xmx</code> å‚æ•°å®šä¹‰ä¸ºä¸å®¹å™¨é™åˆ¶çš„èµ„æºä¸€æ ·çš„å‚æ•°ã€‚</p>
<p>å¯¹äº Java SE 8u131 ä¹‹åå’Œ JDK 9 çš„ç‰ˆæœ¬ï¼Œå¦‚æœ JVM æ˜¯è¿è¡Œåœ¨å®¹å™¨ä¸­ï¼Œé‚£ä¹ˆéœ€è¦æ­£ç¡®çš„é…ç½® JVM å‚æ•°ä»¥ä¾¿æ„ŸçŸ¥åˆ°å®¹å™¨å¯¹äº JVM æœ€å¤§å¯ç”¨å†…å­˜çš„é™åˆ¶ã€‚å½“é…ç½®ä¸Š <code>UseCGroupMemoryLimitForHeap</code> å‚æ•°åï¼ŒJVM ä¼šæ ¹æ® Linux cgroup ä¸­çš„é…ç½®æ¥å†³å®šæœ€å¤§å†…å­˜ï¼Œå¦‚ä¸‹å‚æ•°å¯ä»¥é…ç½®åœ¨ Tomcat çš„ <code>JAVA_OPTS</code> å‚æ•°ä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">-XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap
</code></pre></div><p>åœ¨æ­¤å¤šå°‘ä¸€å¥ï¼Œå¯¹äº <code>-XX:ParalllelGCThreads</code>ã€<code>-XX:CICompilerCount</code> æœªè®¾ç½®çš„æƒ…å†µä¸‹ï¼ŒJVM Java SE 8u131 å’Œ JDK 9 ç‰ˆæœ¬èƒ½å¤Ÿè‡ªåŠ¨é€æ˜è‡ªåŠ¨æ„ŸçŸ¥åˆ° Docker å¯¹äº CPU çš„å¦‚<strong>ä¸ªæ•°</strong>ç­‰èµ„æºçš„é™åˆ¶ã€‚</p>
<p>å¯¹äº JDK8 çš„ç‰ˆæœ¬é«˜äº 191 ä»¥åŠ JDK 10ï¼Œ<code>XXFraction</code> è¢«æ ‡è®°ä¸º deprecatedï¼Œå¯ä»¥ä½¿ç”¨ <code>Percentage</code> æ¥æ›´ä¸ºçµæ´»çš„å®šä¹‰<strong>å †ç©ºé—´å¯ç”¨æ¯”ä¾‹</strong>ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">-XX:+UseContainerSupport -XX:MaxRAMPercentage<span style="color:#f92672">=</span>75.0 -XX:InitialRAMPercentage<span style="color:#f92672">=</span>75.0 -XX:MinRAMPercentage<span style="color:#f92672">=</span>75.0
</code></pre></div><h3 id="nativememorytracking">NativeMemoryTracking</h3>
<ul>
<li>reserved è¡¨ç¤ºåº”ç”¨<strong>å¯ç”¨</strong>çš„å†…å­˜å¤§å°ï¼Œæ˜¯ JVM é€šè¿‡ mmaped <strong>ç”³è¯·</strong>çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œæƒé™æ˜¯ <code>PROT_NONE</code>ï¼Œåœ¨é¡µè¡¨ä¸­å·²ç»å­˜åœ¨äº†è®°å½•ï¼ˆentriesï¼‰ï¼Œä¿è¯äº†å…¶ä»–è¿›ç¨‹ä¸ä¼šè¢«å ç”¨ï¼Œä½†æ˜¯ JVM è¿˜ä¸èƒ½ç›´æ¥ä½¿ç”¨è¿™å—å†…å­˜ã€‚</li>
<li>committed è¡¨ç¤ºåº”ç”¨<strong>æ­£åœ¨ä½¿ç”¨</strong>çš„å†…å­˜å¤§å°ï¼Œæ˜¯ JVM å‘æ“ä½œç³»ç»Ÿ<strong>å®é™…åˆ†é…</strong>çš„å†…å­˜ï¼ˆmalloc/mmapï¼‰,mmaped æƒé™æ˜¯ <code>PROT_READ | PROT_WRITE</code>ï¼Œè¿™å—å†…å­˜å¯ä»¥è¢«ç›´æ¥ä½¿ç”¨ã€‚</li>
</ul>
<p><code>mmap</code> å‡½æ•°å¯ä»¥<strong>æŠŠä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹åœ¨å†…å­˜é‡Œé¢åšä¸€ä¸ªæ˜ åƒ</strong>ã€‚æ˜ å°„æˆåŠŸåï¼Œç”¨æˆ·å¯¹è¿™æ®µå†…å­˜åŒºåŸŸçš„ä¿®æ”¹å¯ä»¥ç›´æ¥åæ˜ åˆ°å†…æ ¸ç©ºé—´ï¼ŒåŒæ ·ï¼Œå†…æ ¸ç©ºé—´å¯¹è¿™æ®µåŒºåŸŸçš„ä¿®æ”¹ä¹Ÿç›´æ¥åæ˜ ç”¨æˆ·ç©ºé—´ã€‚é‚£ä¹ˆå¯¹äº<strong>å†…æ ¸ç©ºé—´&lt;&ndash;&gt;ç”¨æˆ·ç©ºé—´</strong>ä¸¤è€…ä¹‹é—´éœ€è¦å¤§é‡æ•°æ®ä¼ è¾“ç­‰æ“ä½œçš„è¯æ•ˆç‡æ˜¯éå¸¸é«˜çš„ã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">mmap</span>(<span style="color:#66d9ef">void</span> <span style="color:#f92672">*</span>start, size_t length, <span style="color:#66d9ef">int</span> prot , <span style="color:#66d9ef">int</span> flags, <span style="color:#66d9ef">int</span> fd, off_t offset);
</code></pre></div><p><code>mmap</code> å‡½æ•°é‡Œé¢çš„ <code>prot</code> å‚æ•°æœ‰å¦‚ä¸‹å–å€¼ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C">PROT_EXEC <span style="color:#75715e">//é¡µå†…å®¹å¯ä»¥è¢«æ‰§è¡Œ
</span><span style="color:#75715e"></span>PROT_READ  <span style="color:#75715e">//é¡µå†…å®¹å¯ä»¥è¢«è¯»å–
</span><span style="color:#75715e"></span>PROT_WRITE <span style="color:#75715e">//é¡µå¯ä»¥è¢«å†™å…¥
</span><span style="color:#75715e"></span>PROT_NONE  <span style="color:#75715e">//é¡µä¸å¯è®¿é—®
</span></code></pre></div><h3 id="gc-åå†…å­˜ä½•æ—¶é‡Šæ”¾ç»™-os">GC åå†…å­˜ä½•æ—¶é‡Šæ”¾ç»™ OS</h3>
<p>JVM GC æ˜¯æŠŠå ç”¨çš„åƒåœ¾å†…å­˜å›æ”¶åˆ° JVMï¼Œè€Œä¸æ˜¯æŠŠ JVM çš„å†…å­˜å›æ”¶ç»™<strong>æ“ä½œç³»ç»Ÿ</strong>ã€‚å¯æ˜¯ JVM åœ¨ç”³è¯·å†…å­˜çš„æ—¶å€™å´ä¸ä½¿ç”¨å›æ”¶æ¥çš„å†…å­˜ï¼Œè€Œæ˜¯ç»§ç»­å»<strong>æœªå¼€å‘çš„å†…å­˜é‡Œ</strong>å»ç”³è¯·ï¼Œç›´åˆ°ç”³è¯·åˆ°å®šä¹‰çš„ <code>max</code> çš„å†…å­˜ã€‚</p>
<p><strong>å †æ”¶ç¼©èƒ½åŠ›</strong>å–å†³äº JVM å’Œ GC åƒåœ¾æ”¶é›†å™¨çš„ç‰ˆæœ¬ï¼š</p>
<ul>
<li>JDK 1.8 ä¸­é»˜è®¤çš„ GC æ”¶é›†å™¨ä¸º Parallel GCï¼Œè¿™ä¸ª GC æ”¶é›†å™¨åœ¨ GC ä¹‹åä¸ä¼šå°†å†…å­˜è¿”è¿˜ç»™ OSï¼Œæ‰€ä»¥ GC ä¹‹åè¿›ç¨‹å†…å­˜å ç”¨ä¸ä¼šé™ä½ã€‚<a href="https://www.cnblogs.com/ynx01/p/10876460.html">å‚è€ƒ</a></li>
<li>JDK 8 ä»¥åŠæ›´æ—©ç‰ˆæœ¬ï¼Œæ²¡æœ‰æ˜ç¡®çš„é€‰é¡¹ä¸€å®šä¼šè®©å†…å­˜å›æ”¶ç»™æ“ä½œç³»ç»Ÿï¼Œä½†æ˜¯é€šè¿‡é…ç½®å¦‚ä¸‹è¿™äº›å‚æ•° <code>-XX:GCTimeRatio=19</code>ã€<code>-XX:MinHeapFreeRatio=20</code>ã€<code>-XX:MaxHeapFreeRatio=30</code> å¯ä»¥è®© GC æ›´å…· aggresiveï¼ŒèŠ±è´¹æ›´å¤šçš„æ—¶é—´åœ¨ CPU ä¸Šï¼Œä»è€Œåœ¨ GC ä¹‹åçº¦æŸ<strong>åˆ†é…ä½†æœªä½¿ç”¨çš„å †å†…å­˜</strong>çš„æ€»é‡ã€‚</li>
<li>å¯¹äºå¹¶å‘æ”¶é›†å™¨ï¼Œå¯ä»¥è®¾ç½® <code>-XX:InitiatingHeapOccupancyPercent=N</code> å‚æ•°ä¸º<strong>æ¯”è¾ƒä½</strong>çš„å€¼ï¼Œå¯ä»¥è®© GC å‡ ä¹è¿ç»­ä¸åœåœ°æ”¶é›†åƒåœ¾ï¼Œè™½ç„¶ä¼šè€—è´¹æ›´å¤šçš„ CPU ä½†ä¼šæ›´å¿«çš„<strong>æ”¶ç¼©å †</strong>ã€‚</li>
<li><code>-XX:+UseAdaptiveSizePolicy</code> å¯ä»¥è‡ªåŠ¨è°ƒæ•´å †å¤§å°ã€‚</li>
<li>G1 æ”¶é›†å™¨ï¼Œå¹¶ä¸”ç¨‹åºé‡Œé¢æ—¶ä¸æ—¶çš„è°ƒç”¨ <code>System.gc()</code>ï¼ŒJava å°†ä¼šé‡Šæ”¾å†…å­˜ç»™ OSã€‚ä» JDK 12 å¼€å§‹ï¼Œç©ºé—²çš„æ—¶å€™ G1 æ”¶é›†å™¨å¯ä»¥è‡ªåŠ¨é‡Šæ”¾å†…å­˜ç»™ OSã€‚</li>
<li>ZGC ä¼šè‡ªåŠ¨é‡Šæ”¾å†…å­˜ç»™ OSã€‚</li>
</ul>
<h3 id="jdk-18-å†…å­˜å ç”¨">JDK 1.8 å†…å­˜å ç”¨</h3>
<p><img src="/images/docs/tutorial/java/jvmbox/jvm-memory.png" alt="">
<img src="/images/docs/tutorial/java/jvmbox/1521449812178.png" alt=""></p>
<h3 id="jvm-è¿è¡Œåœ¨-pod-ä¸­">JVM è¿è¡Œåœ¨ Pod ä¸­</h3>
<ul>
<li>Docker æ±‡æŠ¥çš„å†…å­˜ = file cache + <code>top</code> å‘½ä»¤æ±‡æŠ¥çš„ <code>RSS</code></li>
<li><code>RSS</code> = <code>Heap</code> å¤§å° + <code>MetaSpace</code> + <code>OffHeap</code></li>
<li><code>OffHeap</code> = <code>threads stack</code> + <code>direct buffer</code> (NIO) + <code>mapped files</code> (libraries/jars) + <code>JVM code</code></li>
</ul>
<p>ä½¿ç”¨ JVisualVM å¯ä»¥çœ‹åˆ° JVM æ€»å…±æœ‰å¤šå°‘ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹å ç”¨çš„å¤§å°å¯ä»¥ç”¨ <code>java -XX:+PrintFlagsFinal -version |grep ThreadStackSize</code> å‘½ä»¤çœ‹åˆ°ï¼Œä¸€èˆ¬æ˜¯ <strong>1MB</strong>ã€‚<code>direct buffer</code> çš„å¤§å°å¯ä»¥ç”¨ JMX å·¥å…·çœ‹åˆ°ã€‚</p>
<p>ä» JDK 1.8.40 å¯ä»¥çœ‹åˆ°ï¼Œå¯ä»¥ä½¿ç”¨ Native Memory Tracker æ¥è¿½è¸ª JVM è¯¦ç»†çš„å†…å­˜å¼€é”€ï¼ŒNMT å±•ç¤ºçš„æ˜¯ <code>committed</code> å†…å­˜ï¼Œè€Œé <code>ps</code> å‘½ä»¤æ±‡æŠ¥çš„ <code>resident</code> å†…å­˜ï¼Œæ‰€ä»¥ NMT å±•ç¤ºçš„éå †å†…å­˜å¯èƒ½é«˜äº <code>ps</code> å‘½ä»¤æ±‡æŠ¥çš„ <code>resident</code> å†…å­˜ã€‚</p>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<ul>
<li><a href="http://ifeve.com/useful-jvm-flags-part-3-printing-all-xx-flags-and-their-values/">JVMå®ç”¨å‚æ•°ï¼ˆä¸‰ï¼‰æ‰“å°æ‰€æœ‰XXå‚æ•°åŠå€¼</a></li>
<li><a href="http://ifeve.com/useful-jvm-flags-part-5-young-generation-garbage-collection/">JVMå®ç”¨å‚æ•°ï¼ˆäº”ï¼‰æ–°ç”Ÿä»£åƒåœ¾å›æ”¶</a></li>
<li><a href="https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/index.html">Oracle GC Tuning Guide</a></li>
<li><a href="https://www.cnblogs.com/cn-coder/p/13716457.html">Javaè™šæ‹Ÿæœºä¸­ -XX:+PrintFlagsFinalä¸XX:+PrintCommandLineFlags ä¸­MaxHeapSizeçš„å€¼ä¸åŒçš„åŸå› </a></li>
<li><a href="https://www.cnblogs.com/rude3knife/p/13570423.html">ä¸€æ¬¡å®Œæ•´çš„JVMå †å¤–å†…å­˜æ³„æ¼æ•…éšœæ’æŸ¥è®°å½•</a></li>
<li><a href="https://cloud.tencent.com/developer/article/1406522">èŠèŠHotSpot VMçš„Native Memory Tracking</a></li>
<li><a href="https://www.itdaan.com/blog/2016/11/23/1efed2e6a4229e7892e586f6ce30ee8a.html">è¯·æ•™ä¸ºä½•JVMä¸æŠŠç©ºé—²å†…å­˜å½’è¿˜ç»™æ“ä½œç³»ç»Ÿ</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/350828180">Javaå†…å­˜å ç”¨åˆ†æ</a></li>
<li><a href="https://stackoverflow.com/questions/30458195/does-gc-release-back-memory-to-os">Does GC release back memory to OS?</a></li>
<li><a href="https://blog.csdn.net/DLUTBruceZhang/article/details/9080173">Linux å†…å­˜æ˜ å°„å‡½æ•° mmapï¼ˆï¼‰å‡½æ•°è¯¦è§£</a></li>
<li><a href="https://stackoverflow.com/questions/4667483/how-is-the-default-max-java-heap-size-determined">How is the default max Java heap size determined?</a></li>
<li><a href="https://blogs.oracle.com/java/post/java-se-support-for-docker-cpu-and-memory-limits">Java SE support for Docker CPU and memory limits</a></li>
<li><a href="https://blog.51cto.com/daisywei/2697536">Kubernetes_pod_javajdk_åŠ¨æ€JVMå †å†…å­˜å¤§å°é™åˆ¶</a></li>
<li><a href="https://www.jianshu.com/p/c3a4d7b20024">å…³äºDockerä¸­è®¾ç½®Javaåº”ç”¨çš„JVM</a></li>
<li><a href="http://trustmeiamadeveloper.com/2016/03/18/where-is-my-memory-java/">Analyzing java memory usage in a Docker container</a></li>
<li><a href="https://blog.csdn.net/weishuai528/article/details/96899513">JVMè°ƒä¼˜ä¹‹æ¢ç´¢CMSå’ŒG1çš„ç‰©ç†å†…å­˜å½’è¿˜æœºåˆ¶</a></li>
</ul>

<ins class="adsbygoogle"
style="display:block"
data-ad-client="ca-pub-8950855178079071"
data-ad-slot="6142361626"
data-ad-format="auto"
data-full-width-responsive="true"></ins>
</article>
 

      <footer class="book-footer">
        
  <div class="flex justify-between">





</div>

 
        
  
  <div class="book-comments">  </div>
  
 
      </footer>
      
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#åˆ‡æ¢-java-ç‰ˆæœ¬">åˆ‡æ¢ Java ç‰ˆæœ¬</a></li>
    <li><a href="#jdk-å‘½ä»¤æ— æ³•æ‰§è¡Œ">JDK å‘½ä»¤æ— æ³•æ‰§è¡Œ</a></li>
    <li><a href="#æŸ¥çœ‹è¿›ç¨‹åŸºç¡€ä¿¡æ¯">æŸ¥çœ‹è¿›ç¨‹åŸºç¡€ä¿¡æ¯</a></li>
    <li><a href="#æŸ¥çœ‹è¿›ç¨‹ç³»ç»Ÿä¿¡æ¯">æŸ¥çœ‹è¿›ç¨‹ç³»ç»Ÿä¿¡æ¯</a></li>
    <li><a href="#æŸ¥çœ‹-gc-æƒ…å†µ">æŸ¥çœ‹ GC æƒ…å†µ</a></li>
    <li><a href="#æŸ¥çœ‹å †æƒ…å†µ">æŸ¥çœ‹å †æƒ…å†µ</a></li>
    <li><a href="#æŸ¥çœ‹æ ˆä¿¡æ¯">æŸ¥çœ‹æ ˆä¿¡æ¯</a></li>
    <li><a href="#jvm-å‚æ•°è§£é‡Š">JVM å‚æ•°è§£é‡Š</a></li>
    <li><a href="#å„å‘½ä»¤å«ä¹‰å…·ä½“è§£é‡Š">å„å‘½ä»¤å«ä¹‰å…·ä½“è§£é‡Š</a>
      <ul>
        <li><a href="#class-name">class name</a></li>
        <li><a href="#xx-å‚æ•°è¯­æ³•">XX å‚æ•°è¯­æ³•</a></li>
        <li><a href="#maxmetaspacesize-å€¼è¿‡å¤§">MaxMetaspaceSize å€¼è¿‡å¤§</a></li>
        <li><a href="#é»˜è®¤å †å¤§å°">é»˜è®¤å †å¤§å°</a></li>
        <li><a href="#nativememorytracking">NativeMemoryTracking</a></li>
        <li><a href="#gc-åå†…å­˜ä½•æ—¶é‡Šæ”¾ç»™-os">GC åå†…å­˜ä½•æ—¶é‡Šæ”¾ç»™ OS</a></li>
        <li><a href="#jdk-18-å†…å­˜å ç”¨">JDK 1.8 å†…å­˜å ç”¨</a></li>
        <li><a href="#jvm-è¿è¡Œåœ¨-pod-ä¸­">JVM è¿è¡Œåœ¨ Pod ä¸­</a></li>
      </ul>
    </li>
    <li><a href="#å‚è€ƒ">å‚è€ƒ</a></li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</body>



</html>












