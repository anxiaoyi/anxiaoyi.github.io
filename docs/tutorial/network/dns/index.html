<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="DNS"><meta property="og:title" content="DNS" />
<meta property="og:description" content="DNS DNS 使用的传输层协议 主要使用 UDP 协议，端口 53, 也有一些采用 TCP 来实现。
DNS 其实两种协议都使用(DNS or other Services works on both TCP and UDP)。UDP 包不能大于 512 字节。DNS uses TCP for Zone transfer and UDP for name, and queries either regular (primary) or reverse. 传输少量信息的可以使用 UDP，然而大于 512 字节的必须使用 TCP. If a client doesn&rsquo;t get response from DNS, it must retransmit the data using TCP after 3-5 seconds of interval.
There should be consistency in DNS Zone database." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kunzhao.org/docs/tutorial/network/dns/" />

<title>DNS | 赵坤的个人网站</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/book.min.7ebac727e739c3b4aee6328926e3b77ac1ddd5e9035221b7ec206fda1a413a4d.css" integrity="sha256-frrHJ&#43;c5w7Su5jKJJuO3esHd1ekDUiG37CBv2hpBOk0=">


<script defer src="/en.search.min.445d3520f28f09015151f551c6990497f854d2fe515b552ed0a17bb5c6f8b1fd.js" integrity="sha256-RF01IPKPCQFRUfVRxpkEl/hU0v5RW1Uu0KF7tcb4sf0="></script>
<script>
var _hmt = _hmt || [];
(function() {
  if (location.hostname === "localhost" || 
    location.hostname === "127.0.0.1") {
    return;
  }

  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d04ff9e23cec6cb39ebbee1b4883e269";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<script data-ad-client="ca-pub-8950855178079071" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><span>赵坤的个人网站</span>
  </a>
</h2>








  

  
  





 
  
    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/" >
      💡 教程
  </a>


    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/front-end-optimization-guide/" >
      前端优化指南
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/algorithm/" >
      算法
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/raft/" >
      raft
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/unix-command/" >
      UNIX 常用命令大全
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/unix-optimize/" >
      UNIX 性能优化
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/vue3/" >
      Vue.js 教程
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/git/" >
      Git 教程
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/network/" >
      网络协议
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/docs/tutorial/network/dhcp/" >
      DHCP
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/http/" >
      HTTP
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/http2/" >
      HTTP2
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/http3/" >
      HTTP3
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/https/" >
      HTTPS
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/cdn/" >
      CDN
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/dns/"  class="active">
      DNS
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/tcp/" >
      TCP
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/udp/" >
      UDP
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/arp/" >
      ARP
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/icmp/" >
      ICMP
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/ip/" >
      IP
  </a>

</li>
      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/awk/" >
      AWK 教程
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/devops/" >
      DevOps
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/sentinel/" >
      阿里巴巴 Sentinel
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/zipkin/" >
      Zipkin 源码分析
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/eureka/" >
      Netflix Eureka 源码分析
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/distributed-storage/" >
      分布式存储
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/maven/" >
      Maven 教程
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/java/" >
      Java 教程
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/spring/" >
      Spring 教程
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/distributed/" >
      分布式系统与架构设计
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/softskill/" >
      箴言箴句
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/database/" >
      数据库
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/redis/" >
      Redis
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/bigdata/" >
      大数据场景
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/technique/" >
      技术
  </a>


    

    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/programmer-interview/" >
      👍 程序员面试题
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/rocketmq/" >
      RocketMQ 源码分析
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/books/" >
      书籍
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/javascript/" >
      JavaScript 专栏
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/it-zone/" >
      IT 圈
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/hire/" >
      招聘
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/cloud-plus-bbs/" >
      云&#43;社区技术沙龙
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tools/" >
      实用工具
  </a>


    

    






  </li>


      
    
  </ul>
  



  












<ul>
  
  <li>
    <a href="/posts/" >
        博客
      </a>
  </li>
  
</ul>



</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>DNS</strong>

  <label for="toc-control">
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#dns-使用的传输层协议">DNS 使用的传输层协议</a></li>
    <li><a href="#dns-层次结构">DNS 层次结构</a></li>
    <li><a href="#dns-数据库的记录类型">DNS 数据库的记录类型</a></li>
    <li><a href="#dns-的解析流程">DNS 的解析流程</a>
      <ul>
        <li><a href="#recursive-递归">recursive 递归</a></li>
        <li><a href="#iteration-迭代">iteration 迭代</a></li>
      </ul>
    </li>
    <li><a href="#dns-做负载均衡">DNS 做负载均衡</a></li>
    <li><a href="#dns-做全局负载均衡">DNS 做全局负载均衡</a></li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
<article class="markdown">
  
<ins class="adsbygoogle"
style="display:block"
data-ad-client="ca-pub-8950855178079071"
data-ad-slot="6142361626"
data-ad-format="auto"
data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script><h1 id="dns">DNS</h1>
<h2 id="dns-使用的传输层协议">DNS 使用的传输层协议</h2>
<p><strong>主要使用 UDP 协议，端口 53</strong>, 也有一些采用 TCP 来实现。</p>
<p>DNS 其实两种协议都使用(<a href="https://docs.microsoft.com/en-us/troubleshoot/windows-server/networking/dns-works-on-tcp-and-udp#:~:text=DNS%20uses%20TCP%20for%20Zone%20transfer%20and%20UDP,data%20using%20TCP%20after%203-5%20seconds%20of%20interval.">DNS or other Services works on both TCP and UDP</a>)。UDP 包不能大于 512 字节。DNS uses TCP for <strong>Zone transfer</strong> and UDP for name, and queries either regular (primary) or reverse. 传输少量信息的可以使用 UDP，然而大于 512 字节的必须使用 TCP. If a client doesn&rsquo;t get response from DNS, it must retransmit the data using TCP after 3-5 seconds of interval.</p>
<p>There should be consistency in DNS Zone database. To make this, DNS always transfers Zone data using TCP because TCP is reliable and make sure zone data is consistent by transferring the full zone to other DNS servers who has requested the data.</p>
<hr>
<p>域维护是指通过DNS协议来在主域名服务器和从域名服务器之间维护同一个<code>zone</code>文件。DNS中有两种域维护手段，一种是全量传输AXFR(full zone transfer)，另一种是增量传输IXFR(incremental zone transfer)。</p>
<h2 id="dns-层次结构">DNS 层次结构</h2>
<p><img src="/images/docs/tutorial/network/dns/dns-architecture.jpg" alt=""></p>
<ul>
<li>根 DNS 服务器 ：返回顶级域 DNS 服务器的 IP 地址</li>
<li>顶级域 DNS 服务器：返回权威 DNS 服务器的 IP 地址</li>
<li>权威 DNS 服务器 ：返回相应主机的 IP 地址</li>
</ul>
<h2 id="dns-数据库的记录类型">DNS 数据库的记录类型</h2>
<table>
<thead>
<tr>
<th>类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>A、AAAA</td>
<td>IP 地址</td>
</tr>
<tr>
<td>MX</td>
<td>SMTP mail exchangers</td>
</tr>
<tr>
<td>NS</td>
<td>name servers</td>
</tr>
<tr>
<td>CNAME</td>
<td>domain name aliases</td>
</tr>
</tbody>
</table>
<h2 id="dns-的解析流程">DNS 的解析流程</h2>
<p><img src="/images/docs/tutorial/network/dns/dns-resolve.jpg" alt=""></p>
<p>DNS解析流程分为<strong>递归查询</strong>和<strong>迭代查询</strong>，递归查询是以本地名称服务器为中心查询， 递归查询是默认方式，迭代查询是以DNS客户端，也就是客户机器为中心查询。其实DNS客户端和本地名称服务器是递归，而本地名称服务器和其他名称服务器之间是迭代。(<a href="https://www.jianshu.com/p/6b502d0f2ede">简书</a>)</p>
<h3 id="recursive-递归">recursive 递归</h3>
<p>递归解析：客户端和本地服务器之间，一去一回得到域名结果的过程</p>
<p><img src="/images/docs/tutorial/network/dns/Screenshot-2016-07-20-12.31.00.png" alt=""></p>
<h3 id="iteration-迭代">iteration 迭代</h3>
<p>迭代解析：本地服务器，一步步，经过多个步骤得到域名结果的过程。</p>
<p><img src="/images/docs/tutorial/network/dns/Snipaste_2021-10-07_22-00-53.png" alt=""></p>
<h2 id="dns-做负载均衡">DNS 做负载均衡</h2>
<p>DNS 除了可以通过<strong>名称映射为 IP 地址</strong>，它还可以做另外一件事，就是<strong>负载均衡</strong>。</p>
<p>一个应用要访问数据库，在这个应用里面应该配置这个数据库的 IP 地址，还是应该配置这个数据库的域名呢？显然<strong>应该配置域名</strong>，因为一旦这个数据库，因为某种原因，换到了另外一台机器上，而如果有多个应用都配置了这台数据库的话，一换 IP 地址，就需要将这些应用全部修改一遍。但是如果配置了域名，则只要在 DNS 服务器里，将域名映射为新的 IP 地址，这个工作就完成了，大大简化了运维。</p>
<p>某个应用要访问另外一个应用，如果配置另外一个应用的 IP 地址，那么这个访问就是一对一的。但是当被访问的应用撑不住的时候，我们其实可以部署多个。但是，访问它的应用，如何在多个之间进行负载均衡？只要配置成为域名就可以了。在域名解析的时候，我们只要配置策略，这次返回第一个 IP，下次返回第二个 IP，就可以实现负载均衡了。</p>
<h2 id="dns-做全局负载均衡">DNS 做全局负载均衡</h2>
<p>为了保证我们的应用高可用，往往会部署在多个机房，每个地方都会有自己的 IP 地址。当用户访问某个域名的时候，这个 IP 地址可以轮询访问多个数据中心。如果一个数据中心因为某种原因挂了，只要在 DNS 服务器里面，将这个数据中心对应的 IP 地址删除，就可以实现一定的高可用。另外，我们肯定希望<strong>北京的用户访问北京的数据中心，上海的用户访问上海的数据中心</strong>，这样，客户体验就会非常好，访问速度就会超快。这就是全局负载均衡的概念。</p>
<p><img src="/images/docs/tutorial/network/dns/global-loadbalance.jpg" alt=""></p>
<ul>
<li>图中的 <code>AZ</code> 代表 <code>Available Zone</code></li>
</ul>
<p>对于不需要做全局负载均衡的简单应用来讲，yourcompany.com 的权威 DNS 服务器可以直接将 object.yourcompany.com 这个域名<strong>解析为一个或者多个 IP 地址</strong>，然后客户端可以通过多个 IP 地址，进行简单的轮询，实现简单的负载均衡。</p>
<p>但是对于复杂的应用，尤其是<strong>跨地域跨运营商的大型应用</strong>，则需要更加复杂的全局负载均衡机制，因而需要专门的设备或者服务器来做这件事情，这就是<strong>全局负载均衡器（GSLB，Global Server Load Balance）</strong>。</p>
<p>这种情况下，在 yourcompany.com 的 DNS 服务器中，返回的就不再是 IP 了，而是通过配置 <strong><code>CNAME</code></strong> 的方式，给 object.yourcompany.com 起一个别名，例如 object.vip.yourcomany.com，然后告诉本地 DNS 服务器，让它请求 GSLB 解析这个域名，GSLB 就可以在解析这个域名的过程中，通过自己的策略实现负载均衡。</p>

<ins class="adsbygoogle"
style="display:block"
data-ad-client="ca-pub-8950855178079071"
data-ad-slot="6142361626"
data-ad-format="auto"
data-full-width-responsive="true"></ins>
</article>
 

      <footer class="book-footer">
        
  <div class="flex justify-between">





</div>

 
        
  
  <div class="book-comments">  </div>
  
 
      </footer>
      
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#dns-使用的传输层协议">DNS 使用的传输层协议</a></li>
    <li><a href="#dns-层次结构">DNS 层次结构</a></li>
    <li><a href="#dns-数据库的记录类型">DNS 数据库的记录类型</a></li>
    <li><a href="#dns-的解析流程">DNS 的解析流程</a>
      <ul>
        <li><a href="#recursive-递归">recursive 递归</a></li>
        <li><a href="#iteration-迭代">iteration 迭代</a></li>
      </ul>
    </li>
    <li><a href="#dns-做负载均衡">DNS 做负载均衡</a></li>
    <li><a href="#dns-做全局负载均衡">DNS 做全局负载均衡</a></li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</body>



</html>












