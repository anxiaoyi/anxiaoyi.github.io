<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="HTTP"><meta property="og:title" content="HTTP" />
<meta property="og:description" content="HTTP 常见状态码    状态码 含义     1xx Information response   100 continue   101 Switching Protocols   2xx success   200 OK: 成功响应   201 Created   202 Accepted   204 No Content: 服务器已经成功处理请求，没有返回任何 Body (比如服务器收到一个发邮件的请求，服务器返回 204，表示已经收到请求，邮件后续会发送)   206 Partial Content: 服务器返回了某个文件的一部分   3xx redirection   300 Multiple Choices 是一个用来表示重定向的响应状态码，表示该请求拥有多种可能的响应。用户代理或者用户自身应该从中选择一个。   301 Moved Permanently: 永久重定向   302 Found: 临时重定向   304 Not Modified: 浏览器通过 If-None-Match 头或 If-Modified-Since 头询问，服务器告知文件未改动   4xx client errors   400 Bad Request: 客户端发送的 HTTP 有语法错误、太大、帧错误等   401 Unauthorized   403 Forbidden   404 Not Found   405 Method Not Allowed   429 Too Many Requests   499 Nginx 自己定义的，client has closed connection   5xx server errors   500 Internal Server Error   502 Bad Gateway   503 Service Unavailable   504 Gateway Timeout    HTTP 方法    方法 含义     GET 获取数据   HEAD 与 GET 类似，但只返回响应头   POST 提交表单   PUT 用一个新的资源完全替换掉服务器的资源   DELETE 删除资源   CONNECT 建立一个 tunnel   OPTIONS 询问服务器支持哪些方法   TRACE 发起环回诊断，主要用于诊断   PATCH 对服务器资源进行部分更新    HTTP 报文 在浏览器中输入 &ldquo;kunzhao." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kunzhao.org/docs/tutorial/network/http/" />

<title>HTTP | 赵坤的个人网站</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/book.min.7ebac727e739c3b4aee6328926e3b77ac1ddd5e9035221b7ec206fda1a413a4d.css" integrity="sha256-frrHJ&#43;c5w7Su5jKJJuO3esHd1ekDUiG37CBv2hpBOk0=">


<script defer src="/en.search.min.04a53f033623e53a68db459286b910a62c5fa8dde58d8d74933c43cc61995fe2.js" integrity="sha256-BKU/AzYj5Tpo20WShrkQpixfqN3ljY10kzxDzGGZX&#43;I="></script>
<script>
var _hmt = _hmt || [];
(function() {
  if (location.hostname === "localhost" || 
    location.hostname === "127.0.0.1") {
    return;
  }

  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d04ff9e23cec6cb39ebbee1b4883e269";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<script data-ad-client="ca-pub-8950855178079071" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><span>赵坤的个人网站</span>
  </a>
</h2>








  

  
  





 
  
    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/" >
      💡 教程
  </a>


    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/front-end-optimization-guide/" >
      前端优化指南
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/algorithm/" >
      算法
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/unix-command/" >
      UNIX 常用命令大全
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/unix-optimize/" >
      UNIX 性能优化
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/vue3/" >
      Vue.js 教程
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/git/" >
      Git 教程
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/network/" >
      网络协议
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/docs/tutorial/network/dhcp/" >
      DHCP
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/http/"  class="active">
      HTTP
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/http2/" >
      HTTP2
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/http3/" >
      HTTP3
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/https/" >
      HTTPS
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/cdn/" >
      CDN
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/dns/" >
      DNS
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/tcp/" >
      TCP
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/udp/" >
      UDP
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/arp/" >
      ARP
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/icmp/" >
      ICMP
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/network/ip/" >
      IP
  </a>

</li>
      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/awk/" >
      AWK 教程
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/devops/" >
      DevOps
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/sentinel/" >
      阿里巴巴 Sentinel
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/zipkin/" >
      Zipkin 源码分析
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/eureka/" >
      Netflix Eureka 源码分析
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/distributed-storage/" >
      分布式存储
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/maven/" >
      Maven 教程
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/java/" >
      Java 教程
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/spring/" >
      Spring 教程
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/distributed/" >
      分布式系统与架构设计
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/softskill/" >
      箴言箴句
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/database/" >
      数据库
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/redis/" >
      Redis
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/bigdata/" >
      大数据场景
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/technique/" >
      技术
  </a>


    

    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/programmer-interview/" >
      👍 程序员面试题
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/rocketmq/" >
      RocketMQ 源码分析
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/books/" >
      书籍
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/javascript/" >
      JavaScript 专栏
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/it-zone/" >
      IT 圈
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/hire/" >
      招聘
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/cloud-plus-bbs/" >
      云&#43;社区技术沙龙
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tools/" >
      实用工具
  </a>


    

    






  </li>


      
    
  </ul>
  



  












<ul>
  
  <li>
    <a href="/posts/" >
        博客
      </a>
  </li>
  
</ul>



</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>HTTP</strong>

  <label for="toc-control">
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#常见状态码">常见状态码</a></li>
    <li><a href="#http-方法">HTTP 方法</a></li>
    <li><a href="#http-报文">HTTP 报文</a></li>
    <li><a href="#常见-http-头">常见 HTTP 头</a>
      <ul>
        <li><a href="#通用头">通用头</a></li>
        <li><a href="#请求头">请求头</a></li>
        <li><a href="#响应头">响应头</a></li>
        <li><a href="#entity-头">Entity 头</a></li>
        <li><a href="#http-11-upgrade">HTTP 1.1 upgrade</a></li>
      </ul>
    </li>
    <li><a href="#post-vs-get">POST vs GET</a>
      <ul>
        <li><a href="#get-存在的必要">GET 存在的必要</a></li>
      </ul>
    </li>
    <li><a href="#持久连接">持久连接</a>
      <ul>
        <li><a href="#http-10">HTTP 1.0</a></li>
        <li><a href="#http-11">HTTP 1.1</a></li>
      </ul>
    </li>
    <li><a href="#http-轮询">HTTP 轮询</a></li>
    <li><a href="#http-长轮询">HTTP 长轮询</a></li>
    <li><a href="#设计-http-幂等接口">设计 HTTP 幂等接口</a></li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
<article class="markdown">
  
<ins class="adsbygoogle"
style="display:block"
data-ad-client="ca-pub-8950855178079071"
data-ad-slot="6142361626"
data-ad-format="auto"
data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script><h1 id="http">HTTP</h1>
<h2 id="常见状态码">常见状态码</h2>
<table>
<thead>
<tr>
<th>状态码</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>1xx</strong></td>
<td><strong>Information response</strong></td>
</tr>
<tr>
<td>100</td>
<td>continue</td>
</tr>
<tr>
<td>101</td>
<td>Switching Protocols</td>
</tr>
<tr>
<td><strong>2xx</strong></td>
<td><strong>success</strong></td>
</tr>
<tr>
<td>200</td>
<td>OK: 成功响应</td>
</tr>
<tr>
<td>201</td>
<td>Created</td>
</tr>
<tr>
<td>202</td>
<td>Accepted</td>
</tr>
<tr>
<td>204</td>
<td>No Content: 服务器已经成功处理请求，没有返回任何 Body (比如服务器收到一个<strong>发邮件</strong>的请求，服务器返回 204，表示已经收到请求，邮件后续会发送)</td>
</tr>
<tr>
<td>206</td>
<td>Partial Content: 服务器返回了某个文件的一部分</td>
</tr>
<tr>
<td><strong>3xx</strong></td>
<td><strong>redirection</strong></td>
</tr>
<tr>
<td>300</td>
<td>Multiple Choices 是一个用来表示重定向的响应状态码，表示该请求拥有多种可能的响应。用户代理或者用户自身应该从中选择一个。</td>
</tr>
<tr>
<td>301</td>
<td>Moved Permanently: 永久重定向</td>
</tr>
<tr>
<td>302</td>
<td>Found: 临时重定向</td>
</tr>
<tr>
<td>304</td>
<td>Not Modified: 浏览器通过 <code>If-None-Match</code> 头或 <code>If-Modified-Since</code> 头询问，服务器告知文件未改动</td>
</tr>
<tr>
<td><strong>4xx</strong></td>
<td><strong>client errors</strong></td>
</tr>
<tr>
<td>400</td>
<td>Bad Request: 客户端发送的 HTTP 有语法错误、太大、帧错误等</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden</td>
</tr>
<tr>
<td>404</td>
<td>Not Found</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests</td>
</tr>
<tr>
<td>499</td>
<td>Nginx 自己定义的，<strong>client has closed connection</strong></td>
</tr>
<tr>
<td><strong>5xx</strong></td>
<td><strong>server errors</strong></td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error</td>
</tr>
<tr>
<td>502</td>
<td>Bad Gateway</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable</td>
</tr>
<tr>
<td>504</td>
<td>Gateway Timeout</td>
</tr>
</tbody>
</table>
<h2 id="http-方法">HTTP 方法</h2>
<table>
<thead>
<tr>
<th>方法</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>GET</td>
<td>获取数据</td>
</tr>
<tr>
<td>HEAD</td>
<td>与 <code>GET</code> 类似，但<strong>只返回响应头</strong></td>
</tr>
<tr>
<td>POST</td>
<td>提交表单</td>
</tr>
<tr>
<td>PUT</td>
<td>用一个新的资源<strong>完全替换</strong>掉服务器的资源</td>
</tr>
<tr>
<td>DELETE</td>
<td>删除资源</td>
</tr>
<tr>
<td>CONNECT</td>
<td>建立一个 tunnel</td>
</tr>
<tr>
<td>OPTIONS</td>
<td>询问服务器支持哪些方法</td>
</tr>
<tr>
<td>TRACE</td>
<td>发起环回诊断，主要用于诊断</td>
</tr>
<tr>
<td>PATCH</td>
<td>对服务器资源进行<strong>部分更新</strong></td>
</tr>
</tbody>
</table>
<h2 id="http-报文">HTTP 报文</h2>
<p>在浏览器中输入 &ldquo;kunzhao.org&rdquo;，然后敲击回车的时候，浏览器发送的<strong>请求</strong>报文示例：</p>
<pre><code>GET / HTTP/1.1
Host: kunzhao.org
Accept-Language: en-US
</code></pre><p><img src="/images/docs/tutorial/network/http/http-request-msg.png" alt=""></p>
<p>服务器对应的返回的<strong>响应</strong>报文示例：</p>
<pre><code>HTTP/1.1 200 OK
Date: Mon, 23 May 2005 22:38:34 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 155
Last-Modified: Wed, 08 Aug 2020 23:11:55 GMT
Server: Apache/1.3.3.7 (Unix) (Red-Hat/Linux)
ETag: &quot;3f80f-1b6-3e1cb03b&quot;
Accept-Ranges: bytes
Connection: close

&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;首页|赵坤的个人网站&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;p&gt;首页内容示例&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre><p><img src="/images/docs/tutorial/network/http/http-response-msg.png" alt=""></p>
<h2 id="常见-http-头">常见 HTTP 头</h2>
<h3 id="通用头">通用头</h3>
<blockquote>
<p>通用头：<strong>请求和响应</strong>都可以使用的头。</p>
</blockquote>
<table>
<thead>
<tr>
<th>HTTP 头</th>
<th>示例</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>Date</td>
<td>Date: Wed, 21 Oct 2015 07:28:00 GMT</td>
<td>消息的日期和时间</td>
</tr>
<tr>
<td>Cache-Control</td>
<td>Cache-Control: no-cache</td>
<td>控制缓存的策略</td>
</tr>
<tr>
<td>Connection</td>
<td>Connection: keep-alive</td>
<td>服务器/浏览器读/写完消息后，这个 TCP 连接是否应该维持打开的状态，还是说立即关闭</td>
</tr>
</tbody>
</table>
<h3 id="请求头">请求头</h3>
<table>
<thead>
<tr>
<th>HTTP 头</th>
<th>示例</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>User-Agent</td>
<td>User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.102 Safari/537.36 Edg/85.0.564.51</td>
<td>包含操作系统、浏览器等字符串形式的描述信息</td>
</tr>
<tr>
<td>Host</td>
<td>Host: example.com:8001</td>
<td>服务器的域名和端口</td>
</tr>
<tr>
<td>Cookie</td>
<td>Cookie: PHPSESSID=298zf09hf012fh2; csrftoken=u32t4o3tb3gg43; _gat=1</td>
<td>存储了由服务器 <code>Set-Cookie</code> 头设置的 <code>Cookie</code> 信息</td>
</tr>
<tr>
<td>Referer</td>
<td>Referer: example.org</td>
<td>哪个 URL 跳转到当前页面的</td>
</tr>
<tr>
<td>Accept</td>
<td>Accept: text/html;q=0.9,image/webp,image/apng</td>
<td>浏览器期望收到的是什么 MIME 类型的资源</td>
</tr>
<tr>
<td>Accept-Charset</td>
<td>Accept-Charset: utf-8, iso-8859-1;q=0.5</td>
<td>浏览器理解哪些字符编码</td>
</tr>
<tr>
<td>Accept-Encoding</td>
<td>Accept-Encoding: deflate, gzip;q=1.0, *;q=0.5</td>
<td>浏览器能够处理哪些压缩算法</td>
</tr>
<tr>
<td>Accept-Language</td>
<td>Accept-Language: fr-CH, fr;q=0.9, en;q=0.8, de;q=0.7, *;q=0.5</td>
<td>浏览器期望返回的是英文？中文？还是俄文？</td>
</tr>
<tr>
<td>If-Match</td>
<td>If-Match: &ldquo;67ab43&rdquo;, &ldquo;54ed21&rdquo;, &ldquo;7892dd&rdquo;</td>
<td>只有匹配任意一个 ETag，服务器才会返回资源</td>
</tr>
<tr>
<td>If-None-Match</td>
<td>If-None-Match: &ldquo;bfc13a64729c4290ef5b2c2730249c88ca92d82d&rdquo;</td>
<td>只要有不匹配的 ETag，服务器就会返回资源，响应码：200</td>
</tr>
<tr>
<td>If-Modified-Since</td>
<td>If-Modified-Since: Wed, 21 Oct 2015 07:28:00 GMT</td>
<td>只有在这个日期之后修改后，服务器才返回资源，响应码：200</td>
</tr>
<tr>
<td>If-Unmodified-Since</td>
<td>If-Unmodified-Since: Wed, 21 Oct 2015 07:28:00 GMT</td>
<td>只有在这个日期之后未被修改过，服务器才会返回资源</td>
</tr>
</tbody>
</table>
<h3 id="响应头">响应头</h3>
<table>
<thead>
<tr>
<th>HTTP 头</th>
<th>示例</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>Age</td>
<td>Age: 24</td>
<td>这个资源在代理缓存中待了有多少秒了</td>
</tr>
<tr>
<td>Location</td>
<td>Location: /index.html</td>
<td>页面重定向到哪个 URL 了</td>
</tr>
<tr>
<td>Server</td>
<td>Server: Apache/2.4.1 (Unix)</td>
<td>服务器用的是哪款 Web 服务器软件/框架</td>
</tr>
<tr>
<td>Set-Cookie</td>
<td>Set-Cookie: id=a3fWa; Max-Age=2592000</td>
<td>设置 Cookie</td>
</tr>
<tr>
<td>Last-Modified</td>
<td>Last-Modified: Wed, 21 Oct 2015 07:28:00 GMT</td>
<td>资源的上次修改时间</td>
</tr>
<tr>
<td>ETag</td>
<td>ETag: &ldquo;33a64df551425fcc55e4d42a148795d9f25f89d4&rdquo;</td>
<td>唯一标识一个资源</td>
</tr>
</tbody>
</table>
<h3 id="entity-头">Entity 头</h3>
<blockquote>
<p>Entity 头：<strong>请求和响应</strong>都可以使用的头，并且是用来描述<strong>消息体</strong>的头。</p>
</blockquote>
<table>
<thead>
<tr>
<th>HTTP 头</th>
<th>示例</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>Content-Length</td>
<td>Content-Length:128</td>
<td>描述 entity body 的大小（单位：字节）</td>
</tr>
<tr>
<td>Content-Language</td>
<td>Content-Language: en-US</td>
<td>描述这个 entity 面向的受众，是中国用户？还是美国用户？</td>
</tr>
<tr>
<td>Content-Encoding</td>
<td>Content-Encoding: gzip</td>
<td>采用的什么压缩算法?</td>
</tr>
</tbody>
</table>
<h3 id="http-11-upgrade">HTTP 1.1 upgrade</h3>
<ul>
<li>升级为 <strong>HTTP over TLS</strong></li>
</ul>
<p>浏览器发送：</p>
<pre><code>GET http://example.bank.com/acct_stat.html?749394889300 HTTP/1.1
Host: example.bank.com
Upgrade: TLS/1.0
Connection: Upgrade
</code></pre><p>服务器响应：</p>
<pre><code>HTTP/1.1 101 Switching Protocols
Upgrade: TLS/1.0, HTTP/1.1
Connection: Upgrade
</code></pre><ul>
<li>升级为 <strong>WebSocket</strong></li>
</ul>
<p>浏览器发送：</p>
<pre><code>GET /chat HTTP/1.1
Host: server.example.com
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Key: x3JJHMbDL1EzLkh9GBhXDw==
Sec-WebSocket-Protocol: chat, superchat
Sec-WebSocket-Version: 13
Origin: http://example.com
</code></pre><p>服务器响应：</p>
<pre><code>HTTP/1.1 101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: HSmrc0sMlYUkAGmm5OPpG2HaGWk=
Sec-WebSocket-Protocol: chat
</code></pre><ul>
<li>升级为 <strong>HTTP/2</strong></li>
</ul>
<p>浏览器发送：</p>
<pre><code>GET / HTTP/1.1
Host: server.example.com
Connection: Upgrade, HTTP2-Settings
Upgrade: h2c
HTTP2-Settings: &lt;base64url encoding of HTTP/2 SETTINGS payload&gt;
</code></pre><p>服务器响应：</p>
<pre><code>HTTP/1.1 101 Switching Protocols
Connection: Upgrade
Upgrade: h2c
</code></pre><h2 id="post-vs-get">POST vs GET</h2>
<ul>
<li>在某些浏览器中，通过 Ajax 请求调用 GET 请求会<strong>缓存</strong>结果，拿到的响应可能只是一个缓存结果</li>
<li>GET 参数暴露在了 URL 中</li>
<li>POST 可以传递更多的信息、更多的数据</li>
</ul>
<h3 id="get-存在的必要">GET 存在的必要</h3>
<p>既然数据通过 POST 请求也可以获取到，那 GET 存在的必要是什么？</p>
<ul>
<li>浏览器地址栏、<code>&lt;a href=&quot;kunzhao.org&quot;&gt;</code> 这些链接等发送的都是 <code>GET</code> 请求</li>
<li>GET 请求的 URL 可以放到<strong>收藏夹</strong></li>
<li>GET 请求的 URL 可以<strong>多次刷新</strong></li>
</ul>
<h2 id="持久连接">持久连接</h2>
<p><img src="/images/docs/tutorial/network/http/http-connection.png" alt=""></p>
<h3 id="http-10">HTTP 1.0</h3>
<pre><code>Connection: keep-alive
</code></pre><h3 id="http-11">HTTP 1.1</h3>
<p>所有连接<strong>默认</strong>都是持久连接。除非在请求头部显式加上 <code>Connection:Close</code> 属性，服务器才会处理完请求主动关闭连接。<code>Content-Length</code> 对于服务器计算比较困难、耗时，因此引入 <code>Transfer-Encoding: chunked</code> 属性，告诉客户端，响应的 Body 分成了一块块的，块与块之间有间隔符，所有块结尾有特殊标记，<strong>方便客户端判断出响应的末尾</strong>。</p>
<p><img src="/images/docs/tutorial/network/http/Snipaste_2020-12-27_21-56-07.png" alt=""></p>
<blockquote>
<p>Server 如何知道接受完一个 HTTP 请求了 ?</p>
</blockquote>
<ul>
<li>GET 方法：收到<strong>请求头部</strong>结束后的空行，就代表接受完了。</li>
<li>POST 方法：① 如果没有 <code>Transfer-Encoding</code>，那么以 <code>Content-Length</code> 的长度进行接受，接受完为止；② 有设置 <code>Transfer-Encoding</code>，则以 <code>chunked</code> 协议设定的 <code>boundary</code> 进行接受。</li>
</ul>
<h2 id="http-轮询">HTTP 轮询</h2>
<p>“轮询”是指不管服务端数据有无更新，客户端每隔定长时间请求拉取一次数据，可能有更新数据返回，也可能什么都没有。配置中心如果使用「轮询」实现动态推送，会有以下问题：</p>
<ul>
<li>
<p><strong>推送延迟</strong>。客户端每隔 5s 拉取一次配置，若配置变更发生在第 6s，则配置推送的延迟会达到 4s。</p>
</li>
<li>
<p><strong>服务端压力</strong>。配置一般不会发生变化，频繁的轮询会给服务端造成很大的压力。</p>
</li>
<li>
<p><strong>推送延迟和服务端压力无法中和</strong>。降低轮询的间隔，延迟降低，压力增加；增加轮询的间隔，压力降低，延迟增高。</p>
</li>
</ul>
<h2 id="http-长轮询">HTTP 长轮询</h2>
<p>携程的 DCC 客户端设计了一个 <a href="https://github.com/ctripcorp/apollo/blob/849ad711058b0a553e6192bae31e3fb0fb8daec8/apollo-client/src/main/java/com/ctrip/framework/apollo/internals/RemoteConfigLongPollService.java"><code>LongPollService</code></a>。</p>
<p>看源码其实就是有一个<strong>线程池</strong>，<strong>定时</strong>去请求远程的服务：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#75715e">//90 seconds, should be longer than server side&#39;s long polling timeout, which is now 60 seconds
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> LONG_POLLING_READ_TIMEOUT <span style="color:#f92672">=</span> 90 <span style="color:#f92672">*</span> 1000<span style="color:#f92672">;</span>

HttpRequest request <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HttpRequest<span style="color:#f92672">(</span>url<span style="color:#f92672">);</span>
request<span style="color:#f92672">.</span><span style="color:#a6e22e">setReadTimeout</span><span style="color:#f92672">(</span>LONG_POLLING_READ_TIMEOUT<span style="color:#f92672">);</span>
</code></pre></div><p>客户端发起长轮询，如果服务端的数据没有发生变更，会 hold 住请求，直到服务端的数据发生变化，或者等待一定时间超时才会返回。返回后，客户端又会立即再次发起下一次长轮询。</p>
<p>可能有人会有疑问，为什么一次长轮询需要等待一定时间超时，超时后又发起长轮询，为什么不让服务端一直 hold 住？主要有两个层面的考虑，一是连接稳定性的考虑，长轮询在传输层本质上还是走的 TCP 协议，如果服务端假死、fullgc 等异常问题，或者是重启等常规操作，长轮询没有应用层的心跳机制，仅仅依靠 TCP 层的心跳保活很难确保可用性，所以<strong>一次长轮询设置一定的超时时间也是在确保可用性</strong>。除此之外，在配置中心场景，还有一定的业务需求需要这么设计。在配置中心的使用过程中，<strong>用户可能随时新增配置监听，而在此之前，长轮询可能已经发出，新增的配置监听无法包含在旧的长轮询中，所以在配置中心的设计中，一般会在一次长轮询结束后，将新增的配置监听给捎带上</strong>，而如果长轮询没有超时时间，只要配置一直不发生变化，响应就无法返回，新增的配置也就没法设置监听了。</p>
<p>配置中心在实现长轮询时，往往采用<strong>异步响应</strong>的方式来实现。而比较方便实现异步 HTTP 的常见手段便是 Servlet3.0 提供的 <code>AsyncContext</code> 机制。</p>
<h2 id="设计-http-幂等接口">设计 HTTP 幂等接口</h2>
<p>生成唯一的处理号，用于标识后续操作。</p>
<p>取钱的 API 设计：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">bool</span> withdraw(account_id, amount)
</code></pre></div><p>如果取钱的 API 设计需要考虑幂等性：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-C" data-lang="C"><span style="color:#66d9ef">int</span> create_ticket() 
<span style="color:#66d9ef">bool</span> idempotent_withdraw(ticket_id, account_id, amount)
</code></pre></div><h2 id="参考">参考</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/List_of_HTTP_status_codes">List of HTTP status codes</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers">Headers</a></li>
<li><a href="https://stackoverflow.com/questions/3477333/what-is-the-difference-between-post-and-get">What is the difference between POST and GET?</a></li>
<li><a href="https://mp.weixin.qq.com/s/YjvL0sUTGHxR3GJFqrP8qg">认识长轮询：配置中心是如何实现推送的？</a></li>
</ul>

<ins class="adsbygoogle"
style="display:block"
data-ad-client="ca-pub-8950855178079071"
data-ad-slot="6142361626"
data-ad-format="auto"
data-full-width-responsive="true"></ins>
</article>
 

      <footer class="book-footer">
        
  <div class="flex justify-between">





</div>

 
        
  
  <div class="book-comments">  </div>
  
 
      </footer>
      
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#常见状态码">常见状态码</a></li>
    <li><a href="#http-方法">HTTP 方法</a></li>
    <li><a href="#http-报文">HTTP 报文</a></li>
    <li><a href="#常见-http-头">常见 HTTP 头</a>
      <ul>
        <li><a href="#通用头">通用头</a></li>
        <li><a href="#请求头">请求头</a></li>
        <li><a href="#响应头">响应头</a></li>
        <li><a href="#entity-头">Entity 头</a></li>
        <li><a href="#http-11-upgrade">HTTP 1.1 upgrade</a></li>
      </ul>
    </li>
    <li><a href="#post-vs-get">POST vs GET</a>
      <ul>
        <li><a href="#get-存在的必要">GET 存在的必要</a></li>
      </ul>
    </li>
    <li><a href="#持久连接">持久连接</a>
      <ul>
        <li><a href="#http-10">HTTP 1.0</a></li>
        <li><a href="#http-11">HTTP 1.1</a></li>
      </ul>
    </li>
    <li><a href="#http-轮询">HTTP 轮询</a></li>
    <li><a href="#http-长轮询">HTTP 长轮询</a></li>
    <li><a href="#设计-http-幂等接口">设计 HTTP 幂等接口</a></li>
    <li><a href="#参考">参考</a></li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</body>



</html>












