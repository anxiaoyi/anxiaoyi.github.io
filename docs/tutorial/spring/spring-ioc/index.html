<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Spring IOC"><meta property="og:title" content="Spring IOC" />
<meta property="og:description" content="Spring IOC Bean åŠ è½½è¿‡ç¨‹ è½¬åŒ– BeanName æˆ‘ä»¬è§£æå®Œ XML é…ç½®ååˆ›å»ºçš„ Mapï¼Œä½¿ç”¨çš„æ˜¯ beanName ä½œä¸º keyï¼š
public class DefaultListableBeanFactory extends AbstractAutowireCapableBeanFactory implements ConfigurableListableBeanFactory, BeanDefinitionRegistry, Serializable { // key: bean name  private final Map&lt;String, BeanDefinition&gt; beanDefinitionMap = new ConcurrentHashMap&lt;&gt;(256); } åœ¨è·å– Bean çš„æ—¶å€™ï¼Œalias bean nameã€factory bean name éƒ½è¦è½¬åŒ–ä¸º bean nameï¼š
public abstract class AbstractBeanFactory extends FactoryBeanRegistrySupport implements ConfigurableBeanFactory { protected &lt;T&gt; T doGetBean(final String name, @Nullable final Class&lt;T&gt; requiredType, @Nullable final Object[] args, boolean typeCheckOnly) throws BeansException { final String beanName = transformedBeanName(name); } protected String transformedBeanName(String name) { return canonicalName(BeanFactoryUtils." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kunzhao.org/docs/tutorial/spring/spring-ioc/" />

<title>Spring IOC | èµµå¤çš„ä¸ªäººç½‘ç«™</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/book.min.c8ac34190f548946cdf00c75980f55bfec0ade2e9e49918cccdcace897f8b279.css" integrity="sha256-yKw0GQ9UiUbN8Ax1mA9Vv&#43;wK3i6eSZGMzNys6Jf4snk=">


<script defer src="/en.search.min.7edde1c7c0cec69be3f17c936c12b56c6b3967da602c4bd11478a7bb6794110e.js" integrity="sha256-ft3hx8DOxpvj8XyTbBK1bGs5Z9pgLEvRFHinu2eUEQ4="></script>
<script>
var _hmt = _hmt || [];
(function() {
  if (location.hostname === "localhost" || 
    location.hostname === "127.0.0.1") {
    return;
  }

  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d04ff9e23cec6cb39ebbee1b4883e269";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<script data-ad-client="ca-pub-8950855178079071" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><span>èµµå¤çš„ä¸ªäººç½‘ç«™</span>
  </a>
</h2>








  

  
  





 
  
    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/" >
      ğŸ’¡ æ•™ç¨‹
  </a>


    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/front-end-optimization-guide/" >
      å‰ç«¯ä¼˜åŒ–æŒ‡å—
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/unix-command/" >
      UNIX å¸¸ç”¨å‘½ä»¤å¤§å…¨
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/unix-optimize/" >
      UNIX æ€§èƒ½ä¼˜åŒ–
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/vue3/" >
      Vue.js æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/git/" >
      Git æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/network/" >
      ç½‘ç»œåè®®
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/awk/" >
      AWK æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/devops/" >
      DevOps
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/sentinel/" >
      é˜¿é‡Œå·´å·´ Sentinel
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/zipkin/" >
      Zipkin æºç åˆ†æ
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/eureka/" >
      Netflix Eureka æºç åˆ†æ
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/distributed-storage/" >
      åˆ†å¸ƒå¼å­˜å‚¨
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/maven/" >
      Maven æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/java/" >
      Java æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/spring/" >
      Spring æ•™ç¨‹
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/docs/tutorial/spring/annotations/" >
      Spring å¸¸ç”¨æ³¨è§£
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/spring/resttemplate/" >
      RestTemplate
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/spring/ots-parsing-error/" >
      ots parsing error
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/spring/deploy-to-tomcat/" >
      SpringBoot æ‰“åŒ…æˆ WAR éƒ¨ç½²åˆ° Tomcat
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/spring/transactional/" >
      Transactional
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/spring/spring-plugin/" >
      Spring æ’ä»¶æ‰©å±•
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/spring/spring-read-properties/" >
      Spring è¯»å– Properties å®ç°åŸç†
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/spring/spring-ioc/"  class="active">
      Spring IOC
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/spring/spring-aop/" >
      Spring AOP
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/spring/spring-webmvc/" >
      Spring WebMVC
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/spring/springboot-autoconfig/" >
      SpringBoot è‡ªåŠ¨é…ç½®åŸç†
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/spring/springboot-startup/" >
      SpringBoot å¯åŠ¨è¿‡ç¨‹
  </a>

</li>
      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/distributed/" >
      åˆ†å¸ƒå¼ç³»ç»Ÿä¸æ¶æ„è®¾è®¡
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/database/" >
      æ•°æ®åº“
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/redis/" >
      Redis
  </a>


    

    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/programmer-interview/" >
      ğŸ‘ ç¨‹åºå‘˜é¢è¯•é¢˜
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/rocketmq/" >
      RocketMQ æºç åˆ†æ
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/books/" >
      ä¹¦ç±
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/javascript/" >
      JavaScript ä¸“æ 
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/it-zone/" >
      IT åœˆ
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/hire/" >
      æ‹›è˜
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/cloud-plus-bbs/" >
      äº‘&#43;ç¤¾åŒºæŠ€æœ¯æ²™é¾™
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tools/" >
      å®ç”¨å·¥å…·
  </a>


    

    






  </li>


      
    
  </ul>
  



  












<ul>
  
  <li>
    <a href="/posts/" >
        åšå®¢
      </a>
  </li>
  
</ul>



</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Spring IOC</strong>

  <label for="toc-control">
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#bean-åŠ è½½è¿‡ç¨‹">Bean åŠ è½½è¿‡ç¨‹</a>
      <ul>
        <li><a href="#è½¬åŒ–-beanname">è½¬åŒ– BeanName</a></li>
        <li><a href="#åˆå¹¶-rootbeandefinition">åˆå¹¶ RootBeanDefinition</a></li>
        <li><a href="#å¤„ç†å¾ªç¯ä¾èµ–">å¤„ç†å¾ªç¯ä¾èµ–</a></li>
        <li><a href="#åˆ›å»ºå®ä¾‹">åˆ›å»ºå®ä¾‹</a></li>
        <li><a href="#æ³¨å…¥å±æ€§">æ³¨å…¥å±æ€§</a></li>
        <li><a href="#åˆå§‹åŒ–">åˆå§‹åŒ–</a></li>
        <li><a href="#ç±»å‹è½¬æ¢">ç±»å‹è½¬æ¢</a></li>
      </ul>
    </li>
    <li><a href="#bean-ç”Ÿå‘½å‘¨æœŸ-åˆå§‹åŒ–">Bean ç”Ÿå‘½å‘¨æœŸ (åˆå§‹åŒ–)</a>
      <ul>
        <li><a href="#invokeawaremethods">invokeAwareMethods</a></li>
        <li><a href="#beanpostprocessorsbeforeinitialization">BeanPostProcessorsBeforeInitialization</a></li>
        <li><a href="#invokeinitmethods">invokeInitMethods</a></li>
        <li><a href="#beanpostprocessorsafterinitialization">BeanPostProcessorsAfterInitialization</a></li>
        <li><a href="#destroy">destroy</a></li>
      </ul>
    </li>
    <li><a href="#æ³¨å†Œ-bean-åˆ°-ioc-å®¹å™¨">æ³¨å†Œ Bean åˆ° IoC å®¹å™¨</a></li>
    <li><a href="#beanfactory">BeanFactory</a></li>
    <li><a href="#factorybean">FactoryBean</a>
      <ul>
        <li><a href="#mybatis-ç”¨æ³•ç¤ºä¾‹">Mybatis ç”¨æ³•ç¤ºä¾‹</a></li>
      </ul>
    </li>
    <li><a href="#å‚è€ƒ">å‚è€ƒ</a></li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
<article class="markdown">
  
<ins class="adsbygoogle"
style="display:block"
data-ad-client="ca-pub-8950855178079071"
data-ad-slot="6142361626"
data-ad-format="auto"
data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script><h1 id="spring-ioc">Spring IOC</h1>
<h2 id="bean-åŠ è½½è¿‡ç¨‹">Bean åŠ è½½è¿‡ç¨‹</h2>
<h3 id="è½¬åŒ–-beanname">è½¬åŒ– BeanName</h3>
<p>æˆ‘ä»¬è§£æå®Œ XML é…ç½®ååˆ›å»ºçš„ Mapï¼Œä½¿ç”¨çš„æ˜¯ beanName ä½œä¸º keyï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DefaultListableBeanFactory</span> <span style="color:#66d9ef">extends</span> AbstractAutowireCapableBeanFactory
		<span style="color:#66d9ef">implements</span> ConfigurableListableBeanFactory<span style="color:#f92672">,</span> BeanDefinitionRegistry<span style="color:#f92672">,</span> Serializable <span style="color:#f92672">{</span>
    <span style="color:#75715e">// key: bean name
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> BeanDefinition<span style="color:#f92672">&gt;</span> beanDefinitionMap <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> ConcurrentHashMap<span style="color:#f92672">&lt;&gt;(</span>256<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>åœ¨è·å– Bean çš„æ—¶å€™ï¼Œ<code>alias bean name</code>ã€<code>factory bean name</code> éƒ½è¦è½¬åŒ–ä¸º <code>bean name</code>ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AbstractBeanFactory</span> <span style="color:#66d9ef">extends</span> FactoryBeanRegistrySupport <span style="color:#66d9ef">implements</span> ConfigurableBeanFactory <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">protected</span> <span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> T <span style="color:#a6e22e">doGetBean</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> String name<span style="color:#f92672">,</span> <span style="color:#a6e22e">@Nullable</span> <span style="color:#66d9ef">final</span> Class<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> requiredType<span style="color:#f92672">,</span>
			<span style="color:#a6e22e">@Nullable</span> <span style="color:#66d9ef">final</span> Object<span style="color:#f92672">[]</span> args<span style="color:#f92672">,</span> <span style="color:#66d9ef">boolean</span> typeCheckOnly<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> BeansException <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">final</span> String beanName <span style="color:#f92672">=</span> transformedBeanName<span style="color:#f92672">(</span>name<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">protected</span> String <span style="color:#a6e22e">transformedBeanName</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">return</span> canonicalName<span style="color:#f92672">(</span>BeanFactoryUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">transformedBeanName</span><span style="color:#f92672">(</span>name<span style="color:#f92672">));</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><code>FACTORY_BEAN_PREFIX</code> çš„å€¼æ˜¯ <code>&amp;</code>ï¼Œå½“ä»¥ <code>&amp;</code> å¼€å¤´çš„æ—¶å€™ï¼Œä»£è¡¨è¿™æ˜¯ä¸€ä¸ª <code>FactoryBean</code>ï¼Œå°±è¦é€æ¬¡å»æ‰ <code>&amp;</code>ï¼Œä»¥ä¾¿æ‰¾åˆ°çœŸæ­£çš„ <code>name</code>ï¼›å¦åˆ™ï¼Œç›´æ¥ä½¿ç”¨ <code>name</code>ã€‚æ­¤æ—¶çš„è¿™ä¸ª <code>name</code> å¯èƒ½åªæ˜¯ä¸€ä¸ªåˆ«åï¼Œå› æ­¤éšåä¼šç”¨è¿™ä¸ª <code>name</code> å½“åš <code>key</code>ï¼Œå» <code>aliasMap</code> ä¸­å»å¯»æ‰¾æœ€ç»ˆçš„ <code>bean name</code>ã€‚</p>
<p>å…¶ä¸­ <code>aliasMap</code> çš„å†…å®¹æ˜¯ Spring åœ¨è§£æé˜¶æ®µï¼Œå°† <code>alias name</code> å’Œ <code>bean name</code> çš„æ˜ å°„å…³ç³»æ³¨å†Œåˆ°äº† <code>SimpleAliasRegistry</code> ä¸­ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> String <span style="color:#a6e22e">transformedBeanName</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>name<span style="color:#f92672">.</span><span style="color:#a6e22e">startsWith</span><span style="color:#f92672">(</span>BeanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">FACTORY_BEAN_PREFIX</span><span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> name<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">return</span> transformedBeanNameCache<span style="color:#f92672">.</span><span style="color:#a6e22e">computeIfAbsent</span><span style="color:#f92672">(</span>name<span style="color:#f92672">,</span> beanName <span style="color:#f92672">-&gt;</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">do</span> <span style="color:#f92672">{</span>
            beanName <span style="color:#f92672">=</span> beanName<span style="color:#f92672">.</span><span style="color:#a6e22e">substring</span><span style="color:#f92672">(</span>BeanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">FACTORY_BEAN_PREFIX</span><span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">());</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">while</span> <span style="color:#f92672">(</span>beanName<span style="color:#f92672">.</span><span style="color:#a6e22e">startsWith</span><span style="color:#f92672">(</span>BeanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">FACTORY_BEAN_PREFIX</span><span style="color:#f92672">));</span>
        <span style="color:#66d9ef">return</span> beanName<span style="color:#f92672">;</span>
    <span style="color:#f92672">});</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">canonicalName</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    String canonicalName <span style="color:#f92672">=</span> name<span style="color:#f92672">;</span>

    String resolvedName<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">do</span> <span style="color:#f92672">{</span>
        resolvedName <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>String<span style="color:#f92672">)</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">aliasMap</span><span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>canonicalName<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>resolvedName <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            canonicalName <span style="color:#f92672">=</span> resolvedName<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span> <span style="color:#66d9ef">while</span><span style="color:#f92672">(</span>resolvedName <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>

    <span style="color:#66d9ef">return</span> canonicalName<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><img src="/images/docs/tutorial/spring/spring-ioc/Snipaste_2021-02-09_20-54-04.png" alt=""></p>
<h3 id="åˆå¹¶-rootbeandefinition">åˆå¹¶ RootBeanDefinition</h3>
<p>æŸä¸ª Bean åªæœ‰å’Œçˆ¶ Bean çš„å±æ€§ä¿¡æ¯åˆå¹¶æˆ <code>RootBeanDefinition</code> æ‰æ˜¯<strong>å®Œæ•´</strong>çš„ï¼Œå¦åˆ™åªæ˜¯ <code>GenericBeanDefinition</code>ã€‚</p>
<p>æ¯ä¸ª <code>GenericBeanDefinition</code> å†…éƒ¨éƒ½å£°æ˜äº†ä¸€ä¸ªçˆ¶ Bean çš„ <code>parentName</code> å±æ€§ï¼Œè¿™ä¸ªå±æ€§ä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œå°±æ˜¯ä¸ºäº†æ‰¾åˆ°çˆ¶ç±»ï¼Œ<strong>é€’å½’</strong>åˆå¹¶çˆ¶ç±»ä¿¡æ¯ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">GenericBeanDefinition</span> <span style="color:#66d9ef">extends</span> AbstractBeanDefinition <span style="color:#f92672">{</span>

	<span style="color:#a6e22e">@Nullable</span>
	<span style="color:#66d9ef">private</span> String parentName<span style="color:#f92672">;</span>

<span style="color:#f92672">}</span>
</code></pre></div><p>åˆå¹¶ä¸º <code>RootBeanDefinition</code> çš„è¿‡ç¨‹ï¼Œæ˜¯åœ¨ <code>doGetBean</code> çš„æ—¶å€™è¿›è¡Œçš„ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#66d9ef">protected</span> <span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> T <span style="color:#a6e22e">doGetBean</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> String name<span style="color:#f92672">,</span> <span style="color:#a6e22e">@Nullable</span> <span style="color:#66d9ef">final</span> Class<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> requiredType<span style="color:#f92672">,</span>
			<span style="color:#a6e22e">@Nullable</span> <span style="color:#66d9ef">final</span> Object<span style="color:#f92672">[]</span> args<span style="color:#f92672">,</span> <span style="color:#66d9ef">boolean</span> typeCheckOnly<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> BeansException <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">final</span> RootBeanDefinition mbd <span style="color:#f92672">=</span> getMergedLocalBeanDefinition<span style="color:#f92672">(</span>beanName<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="å¤„ç†å¾ªç¯ä¾èµ–">å¤„ç†å¾ªç¯ä¾èµ–</h3>
<p><strong>æ„é€ å™¨å¾ªç¯ä¾èµ–</strong>ï¼Œæœ¬è´¨ä¸Šæ˜¯æ— æ³•è§£å†³çš„ã€‚æ¯”å¦‚æˆ‘ä»¬å‡†è°ƒç”¨ A çš„æ„é€ å™¨ï¼Œå‘ç°ä¾èµ– Bï¼Œäºæ˜¯å»è°ƒç”¨ B çš„æ„é€ å™¨è¿›è¡Œå®ä¾‹åŒ–ï¼Œå‘ç°åˆä¾èµ– Cï¼Œäºæ˜¯è°ƒç”¨ C çš„æ„é€ å™¨å»åˆå§‹åŒ–ï¼Œç»“æœä¾èµ– Aï¼Œæ•´ä¸ªå½¢æˆä¸€ä¸ªæ­»ç»“ï¼Œå¯¼è‡´ A æ— æ³•åˆ›å»ºã€‚</p>
<p>å¦‚æœæ˜¯ <strong>Setter å¾ªç¯ä¾èµ–</strong>ï¼ŒSpring æ¡†æ¶åªæ”¯æŒå•ä¾‹ä¸‹çš„ Setter å¾ªç¯ä¾èµ–ã€‚Spring é€šè¿‡å¯¹è¿˜åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­çš„å•ä¾‹ï¼Œ<strong>ç¼“å­˜å¹¶æå‰æš´éœ²è¯¥å•ä¾‹</strong>ï¼Œä½¿å¾—å…¶ä»–å®ä¾‹å¯ä»¥å¼•ç”¨è¯¥ä¾èµ–ã€‚</p>
<p>å•ä¾‹æ¨¡å¼ç”¨äº†ä¸€ä¸ª <code>Set</code> æ¥è®°å½•<strong>æ­£åœ¨åˆ›å»ºä¸­çš„ beanName</strong>ï¼Œä½¿ç”¨äº†å¦å¤–ä¸€ä¸ª <code>Map</code> æ¥æå‰æš´éœ²æœªå®Œå…¨åˆ›å»ºå¥½çš„ Objectã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DefaultSingletonBeanRegistry</span> <span style="color:#66d9ef">extends</span> SimpleAliasRegistry <span style="color:#66d9ef">implements</span> SingletonBeanRegistry <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Set<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> singletonsCurrentlyInCreation <span style="color:#f92672">=</span>
			Collections<span style="color:#f92672">.</span><span style="color:#a6e22e">newSetFromMap</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> ConcurrentHashMap<span style="color:#f92672">&lt;&gt;(</span>16<span style="color:#f92672">));</span>

    <span style="color:#75715e">// Cache of early singleton objects: bean name to bean instance.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Object<span style="color:#f92672">&gt;</span> earlySingletonObjects <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;(</span>16<span style="color:#f92672">);</span>

    <span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">beforeSingletonCreation</span><span style="color:#f92672">(</span>String beanName<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
		<span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">inCreationCheckExclusions</span><span style="color:#f92672">.</span><span style="color:#a6e22e">contains</span><span style="color:#f92672">(</span>beanName<span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">singletonsCurrentlyInCreation</span><span style="color:#f92672">.</span><span style="color:#a6e22e">add</span><span style="color:#f92672">(</span>beanName<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
			<span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> BeanCurrentlyInCreationException<span style="color:#f92672">(</span>beanName<span style="color:#f92672">);</span>
		<span style="color:#f92672">}</span>
	<span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><img src="/images/docs/tutorial/spring/spring-ioc/Snipaste_2021-02-09_21-59-15.png" alt=""></p>
<h3 id="åˆ›å»ºå®ä¾‹">åˆ›å»ºå®ä¾‹</h3>
<p>åˆ›å»ºå®ä¾‹æœ‰ 4 ç§ç­–ç•¥ï¼š</p>
<ul>
<li><strong>Supplier</strong> åˆ›å»º</li>
<li><strong>å·¥å‚æ–¹æ³•æ¨¡å¼</strong>åˆ›å»ºï¼šæ‰¾åˆ° <code>FactoryBean</code> è¿›è¡Œå®ä¾‹åŒ–</li>
<li><strong>æœ‰å‚æ„é€ å™¨</strong>åˆ›å»º</li>
<li><strong>æ— å‚æ„é€ å™¨</strong>åˆ›å»º</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#75715e">// AbstractAutowireCapableBeanFactory.java
</span><span style="color:#75715e"></span><span style="color:#66d9ef">protected</span> BeanWrapper <span style="color:#a6e22e">createBeanInstance</span><span style="color:#f92672">(</span>String beanName<span style="color:#f92672">,</span> RootBeanDefinition mbd<span style="color:#f92672">,</span> <span style="color:#a6e22e">@Nullable</span> Object<span style="color:#f92672">[]</span> args<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    Supplier<span style="color:#f92672">&lt;?&gt;</span> instanceSupplier <span style="color:#f92672">=</span> mbd<span style="color:#f92672">.</span><span style="color:#a6e22e">getInstanceSupplier</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>instanceSupplier <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> obtainFromSupplier<span style="color:#f92672">(</span>instanceSupplier<span style="color:#f92672">,</span> beanName<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mbd<span style="color:#f92672">.</span><span style="color:#a6e22e">getFactoryMethodName</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> instantiateUsingFactoryMethod<span style="color:#f92672">(</span>beanName<span style="color:#f92672">,</span> mbd<span style="color:#f92672">,</span> args<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">// Preferred constructors for default construction?
</span><span style="color:#75715e"></span>    ctors <span style="color:#f92672">=</span> mbd<span style="color:#f92672">.</span><span style="color:#a6e22e">getPreferredConstructors</span><span style="color:#f92672">();</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>ctors <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> autowireConstructor<span style="color:#f92672">(</span>beanName<span style="color:#f92672">,</span> mbd<span style="color:#f92672">,</span> ctors<span style="color:#f92672">,</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">// No special handling: simply use no-arg constructor.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> instantiateBean<span style="color:#f92672">(</span>beanName<span style="color:#f92672">,</span> mbd<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>æœ€ç»ˆçš„<strong>å®ä¾‹åŒ–</strong>é€»è¾‘ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">instantiate</span><span style="color:#f92672">(</span>RootBeanDefinition bd<span style="color:#f92672">,</span> <span style="color:#a6e22e">@Nullable</span> String beanName<span style="color:#f92672">,</span> BeanFactory owner<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// Don&#39;t override the class with CGLIB if no overrides.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>bd<span style="color:#f92672">.</span><span style="color:#a6e22e">hasMethodOverrides</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// ctor.newInstance(args)
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> BeanUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">instantiateClass</span><span style="color:#f92672">(</span>constructorToUse<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// Must generate CGLIB subclass.
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> instantiateWithMethodInjection<span style="color:#f92672">(</span>bd<span style="color:#f92672">,</span> beanName<span style="color:#f92672">,</span> owner<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="æ³¨å…¥å±æ€§">æ³¨å…¥å±æ€§</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#75715e">// AbstractAutowireCapableBeanFactory.java
</span><span style="color:#75715e"></span><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">populateBean</span><span style="color:#f92672">(</span>String beanName<span style="color:#f92672">,</span> RootBeanDefinition mbd<span style="color:#f92672">,</span> <span style="color:#a6e22e">@Nullable</span> BeanWrapper bw<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// Add property values based on autowire by name if applicable.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mbd<span style="color:#f92672">.</span><span style="color:#a6e22e">getResolvedAutowireMode</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> AUTOWIRE_BY_NAME<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        autowireByName<span style="color:#f92672">(</span>beanName<span style="color:#f92672">,</span> mbd<span style="color:#f92672">,</span> bw<span style="color:#f92672">,</span> newPvs<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">// Add property values based on autowire by type if applicable.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mbd<span style="color:#f92672">.</span><span style="color:#a6e22e">getResolvedAutowireMode</span><span style="color:#f92672">()</span> <span style="color:#f92672">==</span> AUTOWIRE_BY_TYPE<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        autowireByType<span style="color:#f92672">(</span>beanName<span style="color:#f92672">,</span> mbd<span style="color:#f92672">,</span> bw<span style="color:#f92672">,</span> newPvs<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    applyPropertyValues<span style="color:#f92672">(</span>beanName<span style="color:#f92672">,</span> mbd<span style="color:#f92672">,</span> bw<span style="color:#f92672">,</span> pvs<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="åˆå§‹åŒ–">åˆå§‹åŒ–</h3>
<p>è§ä¸‹ä¸€èŠ‚</p>
<h3 id="ç±»å‹è½¬æ¢">ç±»å‹è½¬æ¢</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#66d9ef">protected</span> <span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> T <span style="color:#a6e22e">doGetBean</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> String name<span style="color:#f92672">,</span> <span style="color:#a6e22e">@Nullable</span> <span style="color:#66d9ef">final</span> Class<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> requiredType<span style="color:#f92672">,</span>
			<span style="color:#a6e22e">@Nullable</span> <span style="color:#66d9ef">final</span> Object<span style="color:#f92672">[]</span> args<span style="color:#f92672">,</span> <span style="color:#66d9ef">boolean</span> typeCheckOnly<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> BeansException <span style="color:#f92672">{</span>
    <span style="color:#75715e">// Check if required type matches the type of the actual bean instance.
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>requiredType <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>requiredType<span style="color:#f92672">.</span><span style="color:#a6e22e">isInstance</span><span style="color:#f92672">(</span>bean<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
        T convertedBean <span style="color:#f92672">=</span> getTypeConverter<span style="color:#f92672">().</span><span style="color:#a6e22e">convertIfNecessary</span><span style="color:#f92672">(</span>bean<span style="color:#f92672">,</span> requiredType<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">return</span> convertedBean<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">return</span> <span style="color:#f92672">(</span>T<span style="color:#f92672">)</span> bean<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="bean-ç”Ÿå‘½å‘¨æœŸ-åˆå§‹åŒ–">Bean ç”Ÿå‘½å‘¨æœŸ (åˆå§‹åŒ–)</h2>
<pre><code>BeanNameAware.setBeanName
          â¬‡ï¸
BeanClassLoaderAware.setBeanClassLoader
          â¬‡ï¸
BeanFactoryAware.setBeanFactory
          â¬‡ï¸
EnvironmentAware.setEnvironment
          â¬‡ï¸
EmbeddedValueResolverAware.setEmbeddedValueResolver
          â¬‡ï¸
ResourceLoaderAware.setResourceLoader (only applicable when running in an application context)
          â¬‡ï¸
ApplicationEventPublisherAware.setApplicationEventPublisher (only applicable when running in an application context)
          â¬‡ï¸
MessageSourceAware.setMessageSource (only applicable when running in an application context)
          â¬‡ï¸
ApplicationContextAware.setApplicationContext (only applicable when running in an application context)
          â¬‡ï¸
ServletContextAware.setServletContext (only applicable when running in a web application context)
          â¬‡ï¸
postProcessBeforeInitialization methods of BeanPostProcessors
          â¬‡ï¸
InitializingBean.afterPropertiesSet
          â¬‡ï¸
a custom init-method definition
          â¬‡ï¸
postProcessAfterInitialization methods of BeanPostProcessors
</code></pre><p><code>BeanFactory</code> <strong>é”€æ¯</strong>æ—¶å€™çš„ç”Ÿå‘½å‘¨æœŸï¼š</p>
<pre><code>postProcessBeforeDestruction methods of DestructionAwareBeanPostProcessors
          â¬‡ï¸
DisposableBean.destroy
          â¬‡ï¸
a custom destroy-method definition
</code></pre><h3 id="invokeawaremethods">invokeAwareMethods</h3>
<p>Bean åˆå§‹åŒ–æ•´ä¸ªç”Ÿå‘½å‘¨æœŸçš„æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#75715e">// AbstractAutowireCapableBeanFactory.java
</span><span style="color:#75715e"></span><span style="color:#66d9ef">protected</span> Object <span style="color:#a6e22e">initializeBean</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> String beanName<span style="color:#f92672">,</span> <span style="color:#66d9ef">final</span> Object bean<span style="color:#f92672">,</span> <span style="color:#a6e22e">@Nullable</span> RootBeanDefinition mbd<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// ç¬¬ä¸€éƒ¨åˆ†
</span><span style="color:#75715e"></span>    invokeAwareMethods<span style="color:#f92672">(</span>beanName<span style="color:#f92672">,</span> bean<span style="color:#f92672">);</span>

    <span style="color:#75715e">// ç¬¬äºŒéƒ¨åˆ†
</span><span style="color:#75715e"></span>    Object wrappedBean <span style="color:#f92672">=</span> bean<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mbd <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span>mbd<span style="color:#f92672">.</span><span style="color:#a6e22e">isSynthetic</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        wrappedBean <span style="color:#f92672">=</span> applyBeanPostProcessorsBeforeInitialization<span style="color:#f92672">(</span>wrappedBean<span style="color:#f92672">,</span> beanName<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">// ç¬¬ä¸‰éƒ¨åˆ†
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
        invokeInitMethods<span style="color:#f92672">(</span>beanName<span style="color:#f92672">,</span> wrappedBean<span style="color:#f92672">,</span> mbd<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">// ç¬¬å››éƒ¨åˆ†
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mbd <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span>mbd<span style="color:#f92672">.</span><span style="color:#a6e22e">isSynthetic</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        wrappedBean <span style="color:#f92672">=</span> applyBeanPostProcessorsAfterInitialization<span style="color:#f92672">(</span>wrappedBean<span style="color:#f92672">,</span> beanName<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>ç¬¬ä¸€éƒ¨åˆ†ï¼ŒBean åˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸçš„<strong>å‰ä¸‰ä¸ªæ–¹æ³•</strong>ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#75715e">// AbstractAutowireCapableBeanFactory.java
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">invokeAwareMethods</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> String beanName<span style="color:#f92672">,</span> <span style="color:#66d9ef">final</span> Object bean<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>bean <span style="color:#66d9ef">instanceof</span> Aware<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>bean <span style="color:#66d9ef">instanceof</span> BeanNameAware<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#f92672">((</span>BeanNameAware<span style="color:#f92672">)</span> bean<span style="color:#f92672">).</span><span style="color:#a6e22e">setBeanName</span><span style="color:#f92672">(</span>beanName<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>bean <span style="color:#66d9ef">instanceof</span> BeanClassLoaderAware<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            ClassLoader bcl <span style="color:#f92672">=</span> getBeanClassLoader<span style="color:#f92672">();</span>
            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>bcl <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                <span style="color:#f92672">((</span>BeanClassLoaderAware<span style="color:#f92672">)</span> bean<span style="color:#f92672">).</span><span style="color:#a6e22e">setBeanClassLoader</span><span style="color:#f92672">(</span>bcl<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>bean <span style="color:#66d9ef">instanceof</span> BeanFactoryAware<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#f92672">((</span>BeanFactoryAware<span style="color:#f92672">)</span> bean<span style="color:#f92672">).</span><span style="color:#a6e22e">setBeanFactory</span><span style="color:#f92672">(</span>AbstractAutowireCapableBeanFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">this</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="beanpostprocessorsbeforeinitialization">BeanPostProcessorsBeforeInitialization</h3>
<p>ç¬¬äºŒéƒ¨åˆ†ï¼Œå¼€å§‹è°ƒç”¨ Bean çš„<strong>åå¤„ç†å™¨</strong>ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#75715e">// AbstractAutowireCapableBeanFactory.java
</span><span style="color:#75715e"></span><span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">applyBeanPostProcessorsBeforeInitialization</span><span style="color:#f92672">(</span>Object existingBean<span style="color:#f92672">,</span> String beanName<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">throws</span> BeansException <span style="color:#f92672">{</span>

    Object result <span style="color:#f92672">=</span> existingBean<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>BeanPostProcessor processor <span style="color:#f92672">:</span> getBeanPostProcessors<span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        Object current <span style="color:#f92672">=</span> processor<span style="color:#f92672">.</span><span style="color:#a6e22e">postProcessBeforeInitialization</span><span style="color:#f92672">(</span>result<span style="color:#f92672">,</span> beanName<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>current <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> result<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        result <span style="color:#f92672">=</span> current<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">return</span> result<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>è€Œå…¶ä¸­ä¹‹ä¸€å°±æœ‰ <code>ApplicationContextAwareProcessor</code>ï¼Œè¿™é‡Œé¢è°ƒç”¨äº† Bean åˆå§‹åŒ–ç”Ÿå‘½å‘¨æœŸçš„ä¸­é—´ 6 ä¸ªæ–¹æ³•ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#a6e22e">@Override</span>
<span style="color:#a6e22e">@Nullable</span>
<span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">postProcessBeforeInitialization</span><span style="color:#f92672">(</span><span style="color:#66d9ef">final</span> Object bean<span style="color:#f92672">,</span> String beanName<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> BeansException <span style="color:#f92672">{</span>
    <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>    invokeAwareInterfaces<span style="color:#f92672">(</span>bean<span style="color:#f92672">);</span>
    <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">return</span> bean<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">invokeAwareInterfaces</span><span style="color:#f92672">(</span>Object bean<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>bean <span style="color:#66d9ef">instanceof</span> Aware<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>bean <span style="color:#66d9ef">instanceof</span> EnvironmentAware<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#f92672">((</span>EnvironmentAware<span style="color:#f92672">)</span> bean<span style="color:#f92672">).</span><span style="color:#a6e22e">setEnvironment</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">applicationContext</span><span style="color:#f92672">.</span><span style="color:#a6e22e">getEnvironment</span><span style="color:#f92672">());</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>bean <span style="color:#66d9ef">instanceof</span> EmbeddedValueResolverAware<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#f92672">((</span>EmbeddedValueResolverAware<span style="color:#f92672">)</span> bean<span style="color:#f92672">).</span><span style="color:#a6e22e">setEmbeddedValueResolver</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">embeddedValueResolver</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>bean <span style="color:#66d9ef">instanceof</span> ResourceLoaderAware<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#f92672">((</span>ResourceLoaderAware<span style="color:#f92672">)</span> bean<span style="color:#f92672">).</span><span style="color:#a6e22e">setResourceLoader</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">applicationContext</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>bean <span style="color:#66d9ef">instanceof</span> ApplicationEventPublisherAware<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#f92672">((</span>ApplicationEventPublisherAware<span style="color:#f92672">)</span> bean<span style="color:#f92672">).</span><span style="color:#a6e22e">setApplicationEventPublisher</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">applicationContext</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>bean <span style="color:#66d9ef">instanceof</span> MessageSourceAware<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#f92672">((</span>MessageSourceAware<span style="color:#f92672">)</span> bean<span style="color:#f92672">).</span><span style="color:#a6e22e">setMessageSource</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">applicationContext</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>bean <span style="color:#66d9ef">instanceof</span> ApplicationContextAware<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#f92672">((</span>ApplicationContextAware<span style="color:#f92672">)</span> bean<span style="color:#f92672">).</span><span style="color:#a6e22e">setApplicationContext</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">applicationContext</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="invokeinitmethods">invokeInitMethods</h3>
<p>ç¬¬ä¸‰éƒ¨åˆ†è°ƒç”¨åˆå§‹åŒ–å‡½æ•°ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#66d9ef">protected</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">invokeInitMethods</span><span style="color:#f92672">(</span>String beanName<span style="color:#f92672">,</span> <span style="color:#66d9ef">final</span> Object bean<span style="color:#f92672">,</span> <span style="color:#a6e22e">@Nullable</span> RootBeanDefinition mbd<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">throws</span> Throwable <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">boolean</span> isInitializingBean <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>bean <span style="color:#66d9ef">instanceof</span> InitializingBean<span style="color:#f92672">);</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>isInitializingBean <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">(</span>mbd <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">||</span> <span style="color:#f92672">!</span>mbd<span style="color:#f92672">.</span><span style="color:#a6e22e">isExternallyManagedInitMethod</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;afterPropertiesSet&#34;</span><span style="color:#f92672">)))</span> <span style="color:#f92672">{</span>
        <span style="color:#f92672">((</span>InitializingBean<span style="color:#f92672">)</span> bean<span style="color:#f92672">).</span><span style="color:#a6e22e">afterPropertiesSet</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>mbd <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span> <span style="color:#f92672">&amp;&amp;</span> bean<span style="color:#f92672">.</span><span style="color:#a6e22e">getClass</span><span style="color:#f92672">()</span> <span style="color:#f92672">!=</span> NullBean<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        String initMethodName <span style="color:#f92672">=</span> mbd<span style="color:#f92672">.</span><span style="color:#a6e22e">getInitMethodName</span><span style="color:#f92672">();</span>
        invokeCustomInitMethod<span style="color:#f92672">(</span>beanName<span style="color:#f92672">,</span> bean<span style="color:#f92672">,</span> mbd<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="beanpostprocessorsafterinitialization">BeanPostProcessorsAfterInitialization</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">applyBeanPostProcessorsAfterInitialization</span><span style="color:#f92672">(</span>Object existingBean<span style="color:#f92672">,</span> String beanName<span style="color:#f92672">)</span>
        <span style="color:#66d9ef">throws</span> BeansException <span style="color:#f92672">{</span>

    Object result <span style="color:#f92672">=</span> existingBean<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>BeanPostProcessor processor <span style="color:#f92672">:</span> getBeanPostProcessors<span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        Object current <span style="color:#f92672">=</span> processor<span style="color:#f92672">.</span><span style="color:#a6e22e">postProcessAfterInitialization</span><span style="color:#f92672">(</span>result<span style="color:#f92672">,</span> beanName<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>current <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> result<span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
        result <span style="color:#f92672">=</span> current<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    <span style="color:#66d9ef">return</span> result<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="destroy">destroy</h3>
<p>Bean çš„é”€æ¯çš„å‘¨æœŸä¸»è¦åœ¨å¦‚ä¸‹å‡½æ•°ä¸­ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#75715e">// DisposableBeanAdapter.java
</span><span style="color:#75715e"></span><span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">destroy</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// ç¬¬ä¸€éƒ¨åˆ†
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>DestructionAwareBeanPostProcessor processor <span style="color:#f92672">:</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">beanPostProcessors</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        processor<span style="color:#f92672">.</span><span style="color:#a6e22e">postProcessBeforeDestruction</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">bean</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">beanName</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">// ç¬¬äºŒéƒ¨åˆ†
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">invokeDisposableBean</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#f92672">((</span>DisposableBean<span style="color:#f92672">)</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">bean</span><span style="color:#f92672">).</span><span style="color:#a6e22e">destroy</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">// ç¬¬ä¸‰éƒ¨åˆ†
</span><span style="color:#75715e"></span>    invokeCustomDestroyMethod<span style="color:#f92672">(</span>methodToCall<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="æ³¨å†Œ-bean-åˆ°-ioc-å®¹å™¨">æ³¨å†Œ Bean åˆ° IoC å®¹å™¨</h2>
<h2 id="beanfactory">BeanFactory</h2>
<p><code>BeanFactory</code> çš„å®ç°ç±»ï¼Œå­˜å‚¨äº† Bean çš„å®šä¹‰ï¼Œæ ¹æ® <code>BeanFactory</code> é…ç½®çš„ä¸åŒï¼Œå¯ä»¥è¿”å›<strong>å•ä¾‹ Bean</strong> å’Œ <strong>Prototype Bean</strong>ã€‚å®ƒä¸º IOC å®¹å™¨çš„å®ç°æä¾›äº†æ¨¡æ¿ã€æ¡†æ¶ã€é›å½¢ã€è§„èŒƒï¼Œ<code>BeanFactory</code> æ˜¯ IOC å®¹å™¨çš„æ ¸å¿ƒæ¥å£ï¼Œå®ƒçš„èŒè´£åŒ…æ‹¬ï¼šå®ä¾‹åŒ–ã€å®šä½ã€é…ç½®åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡åŠå»ºç«‹è¿™äº›å¯¹è±¡é—´çš„ä¾èµ–ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">BeanFactory</span> <span style="color:#f92672">{</span>

    Object <span style="color:#a6e22e">getBean</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> BeansException<span style="color:#f92672">;</span>

<span style="color:#f92672">}</span>
</code></pre></div><p><code>BeanFactory</code> çš„å®ç°ï¼Œéœ€è¦å°½å¯èƒ½åœ°å»æ”¯æŒ <strong>Bean çš„ç”Ÿå‘½å‘¨æœŸ</strong>ã€‚</p>
<h2 id="factorybean">FactoryBean</h2>
<p><code>FactoryBean</code> ä»¥ <code>Bean</code> ç»“å°¾ï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ª Beanã€‚æŸä¸ª Bean å¦‚æœå®ç°äº†è¿™ä¸ªæ¥å£ï¼Œé‚£ä¹ˆæ ¹æ®è¯¥ Bean çš„ ID ä» <code>BeanFactory</code> ä¸­è·å–çš„å®é™…ä¸Šæ˜¯ <code>FactoryBean</code> çš„ <code>getObject()</code> è¿”å›çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯ <code>FactoryBean</code> æœ¬èº«ï¼Œå¦‚æœè¦è·å– <code>FactoryBean</code> å¯¹è±¡ï¼Œè¯·åœ¨ <code>id</code> å‰é¢åŠ ä¸€ä¸ª <code>&amp;</code> ç¬¦å·æ¥è·å–ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">FactoryBean</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Nullable</span>
	T <span style="color:#a6e22e">getObject</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> Exception<span style="color:#f92672">;</span>

<span style="color:#f92672">}</span>
</code></pre></div><h3 id="mybatis-ç”¨æ³•ç¤ºä¾‹">Mybatis ç”¨æ³•ç¤ºä¾‹</h3>
<p>Mybatis çš„ <code>Mapper</code> æ˜¯ä» <code>SqlSession</code> ä¸­å»è·å–çš„ï¼Œå› æ­¤å®ƒå®ç°äº† <code>FactoryBean</code>ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MapperFactoryBean</span><span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">extends</span> SqlSessionDaoSupport <span style="color:#66d9ef">implements</span> FactoryBean<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> Class<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> mapperInterface<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">MapperFactoryBean</span><span style="color:#f92672">(</span>Class<span style="color:#f92672">&lt;</span>T<span style="color:#f92672">&gt;</span> mapperInterface<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">mapperInterface</span> <span style="color:#f92672">=</span> mapperInterface<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> T <span style="color:#a6e22e">getObject</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> getSqlSession<span style="color:#f92672">().</span><span style="color:#a6e22e">getMapper</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">mapperInterface</span><span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

<span style="color:#f92672">}</span>
</code></pre></div><p>å¯¹äº <code>SqlSessionFactoryBean</code> ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SqlSessionFactoryBean</span>
    <span style="color:#66d9ef">implements</span> FactoryBean<span style="color:#f92672">&lt;</span>SqlSessionFactory<span style="color:#f92672">&gt;,</span> InitializingBean<span style="color:#f92672">,</span> ApplicationListener<span style="color:#f92672">&lt;</span>ApplicationEvent<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> SqlSessionFactory <span style="color:#a6e22e">getObject</span><span style="color:#f92672">()</span> <span style="color:#66d9ef">throws</span> Exception <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">sqlSessionFactory</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            afterPropertiesSet<span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>

        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">sqlSessionFactory</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<ul>
<li><a href="https://www.jianshu.com/p/9ea61d204559">å›¾æ–‡å¹¶èŒ‚ï¼Œæ­ç§˜ Spring çš„ Bean çš„åŠ è½½è¿‡ç¨‹</a></li>
</ul>

<ins class="adsbygoogle"
style="display:block"
data-ad-client="ca-pub-8950855178079071"
data-ad-slot="6142361626"
data-ad-format="auto"
data-full-width-responsive="true"></ins>
</article>
 

      <footer class="book-footer">
        
  <div class="flex justify-between">





</div>

 
        
  
  <div class="book-comments">  </div>
  
 
      </footer>
      
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#bean-åŠ è½½è¿‡ç¨‹">Bean åŠ è½½è¿‡ç¨‹</a>
      <ul>
        <li><a href="#è½¬åŒ–-beanname">è½¬åŒ– BeanName</a></li>
        <li><a href="#åˆå¹¶-rootbeandefinition">åˆå¹¶ RootBeanDefinition</a></li>
        <li><a href="#å¤„ç†å¾ªç¯ä¾èµ–">å¤„ç†å¾ªç¯ä¾èµ–</a></li>
        <li><a href="#åˆ›å»ºå®ä¾‹">åˆ›å»ºå®ä¾‹</a></li>
        <li><a href="#æ³¨å…¥å±æ€§">æ³¨å…¥å±æ€§</a></li>
        <li><a href="#åˆå§‹åŒ–">åˆå§‹åŒ–</a></li>
        <li><a href="#ç±»å‹è½¬æ¢">ç±»å‹è½¬æ¢</a></li>
      </ul>
    </li>
    <li><a href="#bean-ç”Ÿå‘½å‘¨æœŸ-åˆå§‹åŒ–">Bean ç”Ÿå‘½å‘¨æœŸ (åˆå§‹åŒ–)</a>
      <ul>
        <li><a href="#invokeawaremethods">invokeAwareMethods</a></li>
        <li><a href="#beanpostprocessorsbeforeinitialization">BeanPostProcessorsBeforeInitialization</a></li>
        <li><a href="#invokeinitmethods">invokeInitMethods</a></li>
        <li><a href="#beanpostprocessorsafterinitialization">BeanPostProcessorsAfterInitialization</a></li>
        <li><a href="#destroy">destroy</a></li>
      </ul>
    </li>
    <li><a href="#æ³¨å†Œ-bean-åˆ°-ioc-å®¹å™¨">æ³¨å†Œ Bean åˆ° IoC å®¹å™¨</a></li>
    <li><a href="#beanfactory">BeanFactory</a></li>
    <li><a href="#factorybean">FactoryBean</a>
      <ul>
        <li><a href="#mybatis-ç”¨æ³•ç¤ºä¾‹">Mybatis ç”¨æ³•ç¤ºä¾‹</a></li>
      </ul>
    </li>
    <li><a href="#å‚è€ƒ">å‚è€ƒ</a></li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  <script type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1279346965'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1279346965%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</body>



</html>












