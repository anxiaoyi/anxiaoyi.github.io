<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Kubernetes Patterns"><meta property="og:title" content="Kubernetes Patterns" />
<meta property="og:description" content="Kubernetes Patterns ç®€ä»‹ åˆ›å»ºå¥½çš„äº‘åŸç”Ÿåº”ç”¨æ‰€éœ€è¦çš„æŠ€èƒ½ï¼š
 Domain-Driven Designï¼šä»ä¸ºäº†ä½¿æ¶æ„æ›´åŠ è´´åˆ‡ç°å®ä¸–ç•Œçš„ä¸šåŠ¡è§†è§’æ¥å»è¿›è¡Œè½¯ä»¶è®¾è®¡ã€‚ å¾®æœåŠ¡æ¶æ„ï¼šæä¾›äº†è®¾è®¡åˆ†å¸ƒå¼åº”ç”¨çš„ä¸€ç³»åˆ—å‡†åˆ™ç”šè‡³æ ‡å‡†ã€‚ å®¹å™¨ï¼šæ‰“åŒ…å’Œè¿è¡Œåˆ†å¸ƒå¼åº”ç”¨çš„æ ‡å‡†ã€‚  ç¨‹åºå‘˜åœ¨ Kubernetes ä¸­å¯ç”¨çš„èµ„æºï¼š
å¯é¢„æµ‹çš„éœ€æ±‚ ä½ åº”è¯¥æ€æ ·å£°æ˜ä½ åº”ç”¨ç¨‹åºéœ€è¦å“ªäº› runtime ä¾èµ–ã€èµ„æºéœ€æ±‚ï¼Ÿ
ç£ç›˜ å®¹å™¨æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸´æ—¶çš„ï¼Œå®¹å™¨å…³é—­çš„æ—¶å€™å°±æ¶ˆå¤±äº†ï¼›Kubernetes æä¾›äº† Pod çº§åˆ«çš„å­˜å‚¨ï¼švolumeã€‚å¦‚æœåº”ç”¨éœ€è¦æ¯” Pod çº§åˆ«æ›´é•¿ç”Ÿå‘½å‘¨æœŸçš„å­˜å‚¨æœºåˆ¶ï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨ volumnes æ¥ä¸»åŠ¨å£°æ˜ï¼š
apiVersion: v1 kind: Pod metadata: name: random-generator spec: containers: - image: k8spatterns/random-generator:1.0 name: random-generator volumeMounts: - mountPath: &#34;/logs&#34; name: log-volume volumes: - name: log-volume persistentVolumeClaim: claimName: random-generator-log å‚æ•°é…ç½® apiVersion: v1 kind: Pod metadata: name: random-generator spec: containers: - image: k8spatterns/random-generator:1.0 name: random-generator env: - name: PATTERN valueFrom: configMapKeyRef: name: random-generator-config key: pattern èµ„æºé™åˆ¶ apiVersion: v1 kind: Pod metadata: name: random-generator spec: containers: - image: k8spatterns/random-generator:1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kunzhao.org/docs/tutorial/technique/k8s-patterns/" />

<title>Kubernetes Patterns | èµµå¤çš„ä¸ªäººç½‘ç«™</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/book.min.7ebac727e739c3b4aee6328926e3b77ac1ddd5e9035221b7ec206fda1a413a4d.css" integrity="sha256-frrHJ&#43;c5w7Su5jKJJuO3esHd1ekDUiG37CBv2hpBOk0=">


<script defer src="/en.search.min.3ca8b225182094327479e1b309cdc92719f0c2e3706bb9c15531561c1d4d9eda.js" integrity="sha256-PKiyJRgglDJ0eeGzCc3JJxnwwuNwa7nBVTFWHB1Nnto="></script>
<script>
var _hmt = _hmt || [];
(function() {
  if (location.hostname === "localhost" || 
    location.hostname === "127.0.0.1") {
    return;
  }

  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d04ff9e23cec6cb39ebbee1b4883e269";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<script data-ad-client="ca-pub-8950855178079071" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><span>èµµå¤çš„ä¸ªäººç½‘ç«™</span>
  </a>
</h2>








  

  
  





 
  
    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/" >
      ğŸ’¡ æ•™ç¨‹
  </a>


    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/front-end-optimization-guide/" >
      å‰ç«¯ä¼˜åŒ–æŒ‡å—
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/algorithm/" >
      ç®—æ³•
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/raft/" >
      raft
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/unix-command/" >
      UNIX å¸¸ç”¨å‘½ä»¤å¤§å…¨
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/unix-optimize/" >
      UNIX æ€§èƒ½ä¼˜åŒ–
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/vue3/" >
      Vue.js æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/git/" >
      Git æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/network/" >
      ç½‘ç»œåè®®
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/awk/" >
      AWK æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/devops/" >
      DevOps
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/sentinel/" >
      é˜¿é‡Œå·´å·´ Sentinel
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/zipkin/" >
      Zipkin æºç åˆ†æ
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/eureka/" >
      Netflix Eureka æºç åˆ†æ
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/distributed-storage/" >
      åˆ†å¸ƒå¼å­˜å‚¨
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/maven/" >
      Maven æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/java/" >
      Java æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/spring/" >
      Spring æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/distributed/" >
      åˆ†å¸ƒå¼ç³»ç»Ÿä¸æ¶æ„è®¾è®¡
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/softskill/" >
      ç®´è¨€ç®´å¥
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/database/" >
      æ•°æ®åº“
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/redis/" >
      Redis
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/bigdata/" >
      å¤§æ•°æ®åœºæ™¯
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/technique/" >
      æŠ€æœ¯
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/docs/tutorial/technique/k8s/" >
      Kubernetes
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/technique/k8s-patterns/"  class="active">
      Kubernetes Patterns
  </a>

</li>
      
    
  </ul>
  



  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/programmer-interview/" >
      ğŸ‘ ç¨‹åºå‘˜é¢è¯•é¢˜
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/rocketmq/" >
      RocketMQ æºç åˆ†æ
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/books/" >
      ä¹¦ç±
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/javascript/" >
      JavaScript ä¸“æ 
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/it-zone/" >
      IT åœˆ
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/hire/" >
      æ‹›è˜
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/cloud-plus-bbs/" >
      äº‘&#43;ç¤¾åŒºæŠ€æœ¯æ²™é¾™
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tools/" >
      å®ç”¨å·¥å…·
  </a>


    

    






  </li>


      
    
  </ul>
  



  












<ul>
  
  <li>
    <a href="/posts/" >
        åšå®¢
      </a>
  </li>
  
</ul>



</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Kubernetes Patterns</strong>

  <label for="toc-control">
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#ç®€ä»‹">ç®€ä»‹</a></li>
    <li><a href="#å¯é¢„æµ‹çš„éœ€æ±‚">å¯é¢„æµ‹çš„éœ€æ±‚</a>
      <ul>
        <li><a href="#ç£ç›˜">ç£ç›˜</a></li>
        <li><a href="#å‚æ•°é…ç½®">å‚æ•°é…ç½®</a></li>
        <li><a href="#èµ„æºé™åˆ¶">èµ„æºé™åˆ¶</a></li>
        <li><a href="#pod-ä¼˜å…ˆçº§">Pod ä¼˜å…ˆçº§</a></li>
      </ul>
    </li>
    <li><a href="#å£°æ˜å¼éƒ¨ç½²">å£°æ˜å¼éƒ¨ç½²</a>
      <ul>
        <li><a href="#æ»šåŠ¨æ›´æ–°">æ»šåŠ¨æ›´æ–°</a></li>
        <li><a href="#fixed-éƒ¨ç½²">Fixed éƒ¨ç½²</a></li>
        <li><a href="#è“ç»¿å‘å¸ƒ">è“ç»¿å‘å¸ƒ</a></li>
        <li><a href="#é‡‘ä¸é›€å‘å¸ƒ">é‡‘ä¸é›€å‘å¸ƒ</a></li>
        <li><a href="#å¯¹æ¯”">å¯¹æ¯”</a></li>
      </ul>
    </li>
    <li><a href="#å¥åº·æ¢æµ‹">å¥åº·æ¢æµ‹</a>
      <ul>
        <li><a href="#liveness-æ¢æµ‹">Liveness æ¢æµ‹</a></li>
        <li><a href="#readiness-æ¢æµ‹">Readiness æ¢æµ‹</a></li>
      </ul>
    </li>
    <li><a href="#ç”Ÿå‘½å‘¨æœŸç®¡ç†">ç”Ÿå‘½å‘¨æœŸç®¡ç†</a></li>
    <li><a href="#automated-placement">Automated Placement</a>
      <ul>
        <li><a href="#è°ƒåº¦è¿‡ç¨‹">è°ƒåº¦è¿‡ç¨‹</a></li>
      </ul>
    </li>
    <li><a href="#æ‰¹é‡ä½œä¸š">æ‰¹é‡ä½œä¸š</a>
      <ul>
        <li><a href="#kubernetes-job">Kubernetes Job</a></li>
      </ul>
    </li>
    <li><a href="#å‘¨æœŸä½œä¸š">å‘¨æœŸä½œä¸š</a>
      <ul>
        <li><a href="#cronjob">CronJob</a></li>
      </ul>
    </li>
    <li><a href="#daemon-æœåŠ¡">Daemon æœåŠ¡</a></li>
    <li><a href="#å•ä¾‹æœåŠ¡">å•ä¾‹æœåŠ¡</a>
      <ul>
        <li><a href="#out-of-application-é”">Out-of-Application é”</a></li>
        <li><a href="#in-application-é”">In-Application é”</a></li>
      </ul>
    </li>
    <li><a href="#æœ‰çŠ¶æ€çš„æœåŠ¡">æœ‰çŠ¶æ€çš„æœåŠ¡</a>
      <ul>
        <li><a href="#statefulset">StatefulSet</a></li>
      </ul>
    </li>
    <li><a href="#æœåŠ¡å‘ç°">æœåŠ¡å‘ç°</a></li>
    <li><a href="#self-awareness">Self Awareness</a></li>
    <li><a href="#init-å®¹å™¨">Init å®¹å™¨</a></li>
    <li><a href="#sidecar">Sidecar</a></li>
    <li><a href="#adapter-æ¨¡å¼">Adapter æ¨¡å¼</a></li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
<article class="markdown">
  
<ins class="adsbygoogle"
style="display:block"
data-ad-client="ca-pub-8950855178079071"
data-ad-slot="6142361626"
data-ad-format="auto"
data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script><h1 id="kubernetes-patterns">Kubernetes Patterns</h1>
<h2 id="ç®€ä»‹">ç®€ä»‹</h2>
<p>åˆ›å»ºå¥½çš„äº‘åŸç”Ÿåº”ç”¨æ‰€éœ€è¦çš„æŠ€èƒ½ï¼š</p>
<ul>
<li><strong>Domain-Driven Design</strong>ï¼šä»ä¸ºäº†ä½¿æ¶æ„æ›´åŠ è´´åˆ‡ç°å®ä¸–ç•Œçš„ä¸šåŠ¡è§†è§’æ¥å»è¿›è¡Œè½¯ä»¶è®¾è®¡ã€‚</li>
<li><strong>å¾®æœåŠ¡æ¶æ„</strong>ï¼šæä¾›äº†è®¾è®¡åˆ†å¸ƒå¼åº”ç”¨çš„ä¸€ç³»åˆ—å‡†åˆ™ç”šè‡³æ ‡å‡†ã€‚</li>
<li><strong>å®¹å™¨</strong>ï¼šæ‰“åŒ…å’Œè¿è¡Œåˆ†å¸ƒå¼åº”ç”¨çš„æ ‡å‡†ã€‚</li>
</ul>
<p><img src="/images/docs/tutorial/technique/k8s-patterns/Snipaste_2021-08-21_23-06-38.png" alt=""></p>
<p>ç¨‹åºå‘˜åœ¨ Kubernetes ä¸­å¯ç”¨çš„èµ„æºï¼š</p>
<p><img src="/images/docs/tutorial/technique/k8s-patterns/Snipaste_2021-08-21_23-15-06.png" alt=""></p>
<h2 id="å¯é¢„æµ‹çš„éœ€æ±‚">å¯é¢„æµ‹çš„éœ€æ±‚</h2>
<p>ä½ åº”è¯¥æ€æ ·å£°æ˜ä½ åº”ç”¨ç¨‹åºéœ€è¦å“ªäº› runtime ä¾èµ–ã€èµ„æºéœ€æ±‚ï¼Ÿ</p>
<h3 id="ç£ç›˜">ç£ç›˜</h3>
<p>å®¹å™¨æ–‡ä»¶ç³»ç»Ÿæ˜¯<strong>ä¸´æ—¶çš„</strong>ï¼Œå®¹å™¨å…³é—­çš„æ—¶å€™å°±æ¶ˆå¤±äº†ï¼›Kubernetes æä¾›äº† <strong>Pod çº§åˆ«</strong>çš„å­˜å‚¨ï¼š<code>volume</code>ã€‚å¦‚æœåº”ç”¨éœ€è¦æ¯” Pod çº§åˆ«æ›´é•¿ç”Ÿå‘½å‘¨æœŸçš„å­˜å‚¨æœºåˆ¶ï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨ <code>volumnes</code> æ¥ä¸»åŠ¨å£°æ˜ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
<span style="color:#f92672">metadata</span>:
 <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
<span style="color:#f92672">spec</span>:
 <span style="color:#f92672">containers</span>:
 - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">k8spatterns/random-generator:1.0</span>
   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
   <span style="color:#f92672">volumeMounts</span>:
   - <span style="color:#f92672">mountPath</span>: <span style="color:#e6db74">&#34;/logs&#34;</span>
     <span style="color:#f92672">name</span>: <span style="color:#ae81ff">log-volume</span>
 <span style="color:#f92672">volumes</span>:
 - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">log-volume</span>
   <span style="color:#f92672">persistentVolumeClaim</span>:
     <span style="color:#f92672">claimName</span>: <span style="color:#ae81ff">random-generator-log</span>
</code></pre></div><h3 id="å‚æ•°é…ç½®">å‚æ•°é…ç½®</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
<span style="color:#f92672">metadata</span>:
 <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
<span style="color:#f92672">spec</span>:
 <span style="color:#f92672">containers</span>:
 - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">k8spatterns/random-generator:1.0</span>
   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
   <span style="color:#f92672">env</span>:
   - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">PATTERN</span>
     <span style="color:#f92672">valueFrom</span>:
     <span style="color:#f92672">configMapKeyRef</span>:
       <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator-config</span>
       <span style="color:#f92672">key</span>: <span style="color:#ae81ff">pattern</span>
</code></pre></div><h3 id="èµ„æºé™åˆ¶">èµ„æºé™åˆ¶</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
<span style="color:#f92672">metadata</span>:
 <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
<span style="color:#f92672">spec</span>:
 <span style="color:#f92672">containers</span>:
 - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">k8spatterns/random-generator:1.0</span>
 <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
 <span style="color:#f92672">resources</span>:
   <span style="color:#f92672">requests</span>:
     <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">100m</span>
     <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">100Mi</span>
 <span style="color:#f92672">limits</span>:
   <span style="color:#f92672">cpu</span>: <span style="color:#ae81ff">200m</span>
   <span style="color:#f92672">memory</span>: <span style="color:#ae81ff">200Mi</span>
</code></pre></div><p><code>requests</code> å£°æ˜çš„æ˜¯åˆå§‹çš„èµ„æºé™åˆ¶ï¼Œè€Œ <code>limits</code> æ˜¯æˆ‘ä»¬èƒ½ä½¿ç”¨çš„æœ€å¤§çš„èµ„æºé™åˆ¶ã€‚</p>
<h3 id="pod-ä¼˜å…ˆçº§">Pod ä¼˜å…ˆçº§</h3>
<p>èµ„æºé¥¥è’çš„æ—¶å€™åº”è¯¥å…ˆæ€æ­»å“ªä¸ª Podï¼Ÿåº”è¯¥ä¿ç•™å“ªä¸ª Podï¼Ÿ</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">scheduling.k8s.io/v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">PriorityClass</span>
<span style="color:#f92672">metadata</span>:
 <span style="color:#f92672">name</span>: <span style="color:#ae81ff">high-priority</span>
<span style="color:#f92672">value</span>: <span style="color:#ae81ff">1000</span>
<span style="color:#f92672">globalDefault</span>: <span style="color:#66d9ef">false</span>
<span style="color:#f92672">description</span>: <span style="color:#ae81ff">This is a very high priority Pod class</span>
---------
<span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
<span style="color:#f92672">metadata</span>:
 <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
 <span style="color:#f92672">labels</span>:
   <span style="color:#f92672">env</span>: <span style="color:#ae81ff">random-generator</span>
<span style="color:#f92672">spec</span>:
 <span style="color:#f92672">containers</span>:
 - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">k8spatterns/random-generator:1.0</span>
   <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
 <span style="color:#f92672">priorityClassName</span>: <span style="color:#ae81ff">high-priority</span>
</code></pre></div><h2 id="å£°æ˜å¼éƒ¨ç½²">å£°æ˜å¼éƒ¨ç½²</h2>
<p>æœåŠ¡ä¸Šçº¿è¿‡ç¨‹ï¼šå¹³æ»‘çš„åœæ­¢æ—§çš„ Podï¼Œå¯åŠ¨æ–°çš„ Podï¼Œç­‰å¾…ï¼ŒéªŒè¯ï¼Œæˆ–è€…å›æ»š â€¦ è¿™äº›äº‹æƒ…è¦é äººå»åšå—ï¼Ÿ</p>
<h3 id="æ»šåŠ¨æ›´æ–°">æ»šåŠ¨æ›´æ–°</h3>
<p>è¿™ç§æœºåˆ¶ç¡®ä¿æœåŠ¡é›¶åœæœºï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span>
<span style="color:#f92672">metadata</span>:
 <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
<span style="color:#f92672">spec</span>:
 <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>
 <span style="color:#f92672">strategy</span>:
 <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate</span>
 <span style="color:#f92672">rollingUpdate</span>:
  <span style="color:#f92672">maxSurge</span>: <span style="color:#ae81ff">1</span>
  <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">1</span>
 <span style="color:#f92672">selector</span>:
   <span style="color:#f92672">matchLabels</span>:
    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">random-generator</span>
 <span style="color:#f92672">template</span>:
   <span style="color:#f92672">metadata</span>:
      <span style="color:#f92672">labels</span>:
        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">random-generator</span>
   <span style="color:#f92672">spec</span>:
      <span style="color:#f92672">containers</span>:
      - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">k8spatterns/random-generator:1.0</span>
        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
        <span style="color:#f92672">readinessProbe</span>:
          <span style="color:#f92672">exec</span>:
            <span style="color:#f92672">command</span>: [ <span style="color:#e6db74">&#34;stat&#34;</span>, <span style="color:#e6db74">&#34;/random-generator-ready&#34;</span> ]
</code></pre></div><ul>
<li><code>maxSurge</code> è¡¨ç¤ºæœ€å¤šé¢å¤–å¤šè¿è¡Œå‡ ä¸ª Podï¼Œä¹Ÿå°±æ˜¯æ­¤æ¬¡æœ€å¤šè¿è¡Œ 4 ä¸ª Pod</li>
<li><code>maxUnavailable</code> è¡¨ç¤ºæœ€å¤šé¢å¤–ä¸å¯ç”¨å‡ ä¸ª Podï¼Œä¹Ÿå°±æ˜¯æ­¤æ¬¡è‡³å°‘ 2 ä¸ª Pod å¤„äºå¯ä»¥è¿è¡ŒçŠ¶æ€</li>
</ul>
<p><img src="/images/docs/tutorial/technique/k8s-patterns/Snipaste_2021-08-21_23-51-50.png" alt=""></p>
<h3 id="fixed-éƒ¨ç½²">Fixed éƒ¨ç½²</h3>
<p>æ»šåŠ¨æ›´æ–°çš„å¼Šç«¯ï¼šä¸¤ä¸ªä¸åŒç‰ˆæœ¬çš„æœåŠ¡åŒæ—¶è¿è¡Œï¼Œæœ‰äº›æƒ…å†µä¸‹å¯èƒ½ä¸å¤ªåˆé€‚ã€‚ä½¿ç”¨ <code>Recreate</code> ç­–ç•¥å³å¯ã€‚</p>
<p><img src="/images/docs/tutorial/technique/k8s-patterns/Snipaste_2021-08-21_23-55-47.png" alt=""></p>
<h3 id="è“ç»¿å‘å¸ƒ">è“ç»¿å‘å¸ƒ</h3>
<p>å…ˆæŠŠç»¿è‰²çš„éƒ½å¯åŠ¨èµ·æ¥ï¼Œç„¶åä¸€æŠŠåˆ‡æ¢æµé‡ï¼š</p>
<p><img src="/images/docs/tutorial/technique/k8s-patterns/Snipaste_2021-08-21_23-59-46.png" alt=""></p>
<h3 id="é‡‘ä¸é›€å‘å¸ƒ">é‡‘ä¸é›€å‘å¸ƒ</h3>
<p>æ›¿æ¢ä¸€å°éƒ¨åˆ†çš„å®ä¾‹ä¸ºæ–°çš„ç‰ˆæœ¬ï¼š</p>
<p><img src="/images/docs/tutorial/technique/k8s-patterns/Snipaste_2021-08-22_00-00-43.png" alt=""></p>
<h3 id="å¯¹æ¯”">å¯¹æ¯”</h3>
<p><img src="/images/docs/tutorial/technique/k8s-patterns/Snipaste_2021-08-22_00-02-32.png" alt=""></p>
<h2 id="å¥åº·æ¢æµ‹">å¥åº·æ¢æµ‹</h2>
<p>å¦‚ä½•çŸ¥é“ä¸€ä¸ªæœåŠ¡æ˜¯å¦èƒ½å¤Ÿæ¥å—è¯·æ±‚ï¼Ÿ</p>
<h3 id="liveness-æ¢æµ‹">Liveness æ¢æµ‹</h3>
<p>æ€ä¹ˆçŸ¥é“ç¨‹åºæ­»é”äº†ï¼Ÿ</p>
<p>Kubelet ä»£ç†å®šæ—¶è¯¢é—®å®¹å™¨æ˜¯å¦ä¾ç„¶å¥åº·ã€‚</p>
<ul>
<li>HTTP GET æ–¹æ³•å‘é€åˆ° IP åœ°å€ï¼ŒæœŸæœ›å¾—åˆ°ä¸€ä¸ªä½äº 200-399 ä¹‹é—´çš„ HTTP å“åº”ç </li>
<li>TCP Socket æ£€æµ‹æ˜¯å¦å¯ä»¥æ­£å¸¸åˆ›å»º TCP è¿æ¥</li>
<li><code>Exec</code> æ¢æµ‹æ˜¯å¦å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶ä¸”è¿”å›ç æ˜¯ <code>0</code></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-with-liveness-check</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">containers</span>:
  - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">k8spatterns/random-generator:1.0</span>
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
  <span style="color:#f92672">env</span>:
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">DELAY_STARTUP</span>
    <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;20&#34;</span>
  <span style="color:#f92672">ports</span>:
  - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">8080</span>
  <span style="color:#f92672">protocol</span>: <span style="color:#ae81ff">TCP</span>
  <span style="color:#f92672">livenessProbe</span>:
    <span style="color:#f92672">httpGet</span>:
      <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/actuator/health</span>
      <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8080</span>
    <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">30</span>
</code></pre></div><h3 id="readiness-æ¢æµ‹">Readiness æ¢æµ‹</h3>
<p>å®¹å™¨æ­£åœ¨å¯åŠ¨ã€å®¹å™¨è¿‡è½½ã€å®¹å™¨å“åº”å»¶è¿Ÿæ¯”è¾ƒå¤§ï¼Œä½ æ‰“ç®—è®©å®ƒç¼“ä¸€ä¸‹è¿‡ä¸€ä¼šå„¿å†æ¥å—è¯·æ±‚ã€‚readiness æ¢æµ‹å¦‚æœå¤±è´¥ï¼Œé‚£ä¹ˆè¿™ä¸ªå®¹å™¨å°†ä¼šè¢«ç§»é™¤æ‰ï¼Œä¸ä¼šå†æ¥å—ä»»ä½•è¯·æ±‚ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pod-with-readiness-check</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">containers</span>:
  - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">k8spatterns/random-generator:1.0</span>
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
  <span style="color:#f92672">readinessProbe</span>:
    <span style="color:#f92672">exec</span>:
      <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;stat&#34;</span>, <span style="color:#e6db74">&#34;/var/run/random-generator-ready&#34;</span>]
</code></pre></div><h2 id="ç”Ÿå‘½å‘¨æœŸç®¡ç†">ç”Ÿå‘½å‘¨æœŸç®¡ç†</h2>
<p>æˆä¸ºäº‘åŸç”Ÿä¸–ç•Œçš„å…¬æ°‘ï¼Œå°±è¦å¬ä»è¿™ä¸ªå¹³å°å‘å¸ƒçš„å„ç§äº‹ä»¶ã€å…³æ³¨å¹³å°çš„å„ç§ç”Ÿå‘½å‘¨æœŸã€‚</p>
<p><img src="/images/docs/tutorial/technique/k8s-patterns/Snipaste_2021-08-22_20-22-46.png" alt=""></p>
<ul>
<li><code>SIGTERM</code> ä¿¡å·ï¼šKubernetes è¦å…³é—­å®¹å™¨äº†ã€‚æ”¶åˆ°è¿™ä¸ªä¿¡å·ï¼Œåº”ç”¨ç¨‹åºåº”è¯¥åº”è¯¥è¦å°½å¿«çš„ shut down è‡ªå·±ã€‚</li>
<li><code>SIGKILL</code> ä¿¡å·ï¼š<code>SIGTERM</code> ä¹‹åå®¹å™¨è¿›ç¨‹æ²¡æœ‰ shut downï¼Œé‚£ä¹ˆ <code>SIGKILL</code> ä¿¡å·å°†ä¼šåœ¨ç­‰å¾… 30 ç§’ (<code>.spec.terminationGracePeriodSeconds</code>) ä¹‹åå‘å‡ºæ¥ä»¥ä¾¿å¼ºåˆ¶å…³é—­ã€‚</li>
<li><code>postStart</code> hookï¼šå®¹å™¨åˆ›å»ºä¹‹åå°†ä¼šæ‰§è¡Œï¼Œ<code>postStart</code> æ‰§è¡ŒæœŸé—´ï¼ŒPod å¤„äº <code>Pending</code> çŠ¶æ€ã€‚</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">post-start-hook</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">containers</span>:
  - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">k8spatterns/random-generator:1.0</span>
    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
    <span style="color:#f92672">lifecycle</span>:
      <span style="color:#f92672">postStart</span>:
        <span style="color:#f92672">exec</span>:
          <span style="color:#f92672">command</span>:
          - <span style="color:#ae81ff">sh</span>
          - -<span style="color:#ae81ff">c</span>
          - <span style="color:#ae81ff">sleep 30 &amp;&amp; echo &#34;Wake up!&#34; &gt; /tmp/postStart_done</span>
</code></pre></div><ul>
<li><code>preStop</code> hookï¼šå®¹å™¨ terminated ä¹‹å‰å°†ä¼šæ‰§è¡Œã€‚</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pre-stop-hook</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">containers</span>:
  - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">k8spatterns/random-generator:1.0</span>
    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
    <span style="color:#f92672">lifecycle</span>:
      <span style="color:#f92672">preStop</span>:
        <span style="color:#f92672">httpGet</span>:
          <span style="color:#f92672">port</span>: <span style="color:#ae81ff">8080</span>
          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/shutdown</span>
</code></pre></div><h2 id="automated-placement">Automated Placement</h2>
<p>è¿™ç§åŠŸèƒ½æ˜¯ Kubernetes çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå®ƒèƒ½å¤Ÿè‡ªåŠ¨å°† Pod æ”¾ç½®åˆ°æ­£ç¡®çš„èŠ‚ç‚¹ä¸Šï¼Œä»¥ä¾¿æ»¡è¶³å®¹å™¨èµ„æºä»¥åŠè°ƒåº¦ç­–ç•¥çš„éœ€è¦ã€‚è°ƒåº¦å™¨åšçš„äº‹æƒ…ç®€è€Œè¨€ä¹‹ï¼šä¸ºæ¯ä¸€ä¸ªæ–°åˆ›å»ºçš„ Pod é€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>
<p>è°ƒåº¦ç­–ç•¥ç¤ºä¾‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-JSON" data-lang="JSON">{
 <span style="color:#f92672">&#34;kind&#34;</span> : <span style="color:#e6db74">&#34;Policy&#34;</span>,
 <span style="color:#f92672">&#34;apiVersion&#34;</span> : <span style="color:#e6db74">&#34;v1&#34;</span>,
 <span style="color:#f92672">&#34;predicates&#34;</span> : [
  {<span style="color:#f92672">&#34;name&#34;</span> : <span style="color:#e6db74">&#34;PodFitsHostPorts&#34;</span>},
  {<span style="color:#f92672">&#34;name&#34;</span> : <span style="color:#e6db74">&#34;PodFitsResources&#34;</span>},
  {<span style="color:#f92672">&#34;name&#34;</span> : <span style="color:#e6db74">&#34;NoDiskConflict&#34;</span>},
  {<span style="color:#f92672">&#34;name&#34;</span> : <span style="color:#e6db74">&#34;NoVolumeZoneConflict&#34;</span>},
  {<span style="color:#f92672">&#34;name&#34;</span> : <span style="color:#e6db74">&#34;MatchNodeSelector&#34;</span>},
  {<span style="color:#f92672">&#34;name&#34;</span> : <span style="color:#e6db74">&#34;HostName&#34;</span>}
 ],
 <span style="color:#f92672">&#34;priorities&#34;</span> : [
  {<span style="color:#f92672">&#34;name&#34;</span> : <span style="color:#e6db74">&#34;LeastRequestedPriority&#34;</span>, <span style="color:#f92672">&#34;weight&#34;</span> : <span style="color:#ae81ff">2</span>},
  {<span style="color:#f92672">&#34;name&#34;</span> : <span style="color:#e6db74">&#34;BalancedResourceAllocation&#34;</span>, <span style="color:#f92672">&#34;weight&#34;</span> : <span style="color:#ae81ff">1</span>},
  {<span style="color:#f92672">&#34;name&#34;</span> : <span style="color:#e6db74">&#34;ServiceSpreadingPriority&#34;</span>, <span style="color:#f92672">&#34;weight&#34;</span> : <span style="color:#ae81ff">2</span>},
  {<span style="color:#f92672">&#34;name&#34;</span> : <span style="color:#e6db74">&#34;EqualPriority&#34;</span>, <span style="color:#f92672">&#34;weight&#34;</span> : <span style="color:#ae81ff">1</span>}
 ]
}
</code></pre></div><h3 id="è°ƒåº¦è¿‡ç¨‹">è°ƒåº¦è¿‡ç¨‹</h3>
<p><img src="/images/docs/tutorial/technique/k8s-patterns/Snipaste_2021-08-22_20-50-06.png" alt=""></p>
<p>æŸäº›æƒ…å†µä¸‹ï¼Œé€‰æ‹©åˆé€‚ node å¯èƒ½éœ€è¦ä¸€äº›çº¦æŸæ¡ä»¶ï¼Œæ¯”å¦‚å¿…é¡»é€‰æ‹©å…·å¤‡ SSD ç£ç›˜ç±»å‹çš„ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">containers</span>:
  - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">k8spatterns/random-generator:1.0</span>
    <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
  <span style="color:#f92672">nodeSelector</span>:
    <span style="color:#f92672">disktype</span>: <span style="color:#ae81ff">ssd</span>
</code></pre></div><h2 id="æ‰¹é‡ä½œä¸š">æ‰¹é‡ä½œä¸š</h2>
<p>ç”¨æ¥å¯é åœ°è¿è¡Œ short-lived Podsï¼Œè¿è¡Œå®Œä¹‹åç„¶åå…³é—­å®¹å™¨ã€‚</p>
<p>åˆ›å»º Pod æœ‰ä¸‰ç§æ–¹å¼ï¼š</p>
<ul>
<li>Bare Podï¼šæ‰‹å·¥åˆ›å»º Pod ä»¥ä¾¿è¿è¡Œå®¹å™¨</li>
<li>ReplicaSetï¼šç¡®ä¿ Pod è¿è¡Œçš„å¹³ç¨³æŒç»­</li>
<li>DaemonSetï¼šåœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œå•ç‹¬ Pod çš„ Controllerï¼Œä¸€èˆ¬ç”¨äºï¼šç›‘æ§ã€æ—¥å¿—èšåˆã€å­˜å‚¨å®¹å™¨ç­‰</li>
</ul>
<p>ä¸Šè¿° Pod éƒ½å±äºé•¿æœŸè¿è¡Œçš„è¿›ç¨‹ã€‚</p>
<h3 id="kubernetes-job">Kubernetes Job</h3>
<p>è¿™ç§ Job åˆ›å»ºæ•°ä¸ª Podï¼Œç„¶åç¡®ä¿å®ƒä»¬è¿è¡ŒæˆåŠŸã€‚å¦‚æœè¿è¡Œç»“æŸï¼Œé‚£ä¹ˆ Pod ä¹Ÿä¼šå…³é—­ã€‚Job è¿è¡Œç»“æŸï¼Œä¸ä¼šè¢«åˆ é™¤ä»¥ä¾¿ç”¨ä»¥è¿½è¸ªçš„ç›®çš„ï¼ŒPod ç»“æŸä¹Ÿä¸ä¼šè¢«åˆ é™¤ä»¥ä¾¿æ£€æŸ¥å®¹å™¨æ—¥å¿—ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">batch/v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Job</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#f92672">completions</span>: <span style="color:#ae81ff">5</span>
  <span style="color:#f92672">parallelism</span>: <span style="color:#ae81ff">2</span>
  <span style="color:#f92672">template</span>:
    <span style="color:#f92672">metadata</span>:
      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
    <span style="color:#f92672">spec</span>:
      <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">OnFailure</span>
      <span style="color:#f92672">containers</span>:
      - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">k8spatterns/random-generator:1.0</span>
        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
        <span style="color:#f92672">command</span>: [ <span style="color:#e6db74">&#34;java&#34;</span>, <span style="color:#e6db74">&#34;-cp&#34;</span>, <span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#e6db74">&#34;RandomRunner&#34;</span>, <span style="color:#e6db74">&#34;/numbers.txt&#34;</span>, <span style="color:#e6db74">&#34;10000&#34;</span> ]
</code></pre></div><p>ä¸Šè¿°å®šä¹‰äº†ä¸€ä¸ª Jobï¼Œè¿è¡Œ 5 ä¸ª Podï¼Œè¿™ 5 ä¸ª Pod å¿…é¡»éƒ½æˆåŠŸï¼Œæœ€å¤šå¹¶è¡Œä¸¤ä¸ª Podã€‚<code>.spec.template.spec.restartPolicy</code> åœ¨ ReplicaSet ä¸­çš„é»˜è®¤å€¼æ˜¯ <code>Always</code>ï¼Œå®ƒè¿˜æœ‰å…¶å®ƒä¸¤ä¸ªå€¼ï¼š<code>OnFailure</code> å’Œ <code>Never</code>ã€‚</p>
<p><img src="/images/docs/tutorial/technique/k8s-patterns/Snipaste_2021-08-22_21-25-28.png" alt=""></p>
<p>æ ¹æ®ä¸¤ä¸ªå‚æ•°çš„ä¸åŒï¼Œæœ‰å¦‚ä¸‹å‡ ç§ç±»å‹çš„ä½œä¸šï¼š</p>
<ul>
<li>å• Pod ä½œä¸šï¼š<code>.completions</code> å’Œ <code>.parallelism</code> éƒ½ä¸è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯éƒ½æ˜¯é»˜è®¤å€¼ 1.</li>
<li>å›ºå®šå®Œæˆæ•°çš„ä½œä¸šï¼š<code>.completions</code> æ˜¯å¤§äº 1 çš„å€¼ã€‚ä¹Ÿå°±æ˜¯åªæœ‰æ»¡è¶³ <code>.completions</code> ä¸ª Pod éƒ½æˆåŠŸï¼Œæ‰ä¼šäººä¸ºæ˜¯æˆåŠŸçš„ã€‚</li>
<li>ä»»åŠ¡é˜Ÿåˆ—çš„ä½œä¸šï¼š<code>.completions</code> å’Œ <code>.parallelism</code> éƒ½å¤§äº 1.</li>
</ul>
<h2 id="å‘¨æœŸä½œä¸š">å‘¨æœŸä½œä¸š</h2>
<ul>
<li>Cronã€Quartzã€Spring Batchã€<code>ScheduledThreadPoolExecutor</code> é«˜å¯ç”¨ä¸æ˜¯å¾ˆå®¹æ˜“</li>
</ul>
<h3 id="cronjob">CronJob</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yml" data-lang="yml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">batch/v1beta1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">CronJob</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
<span style="color:#f92672">spec</span>:
  <span style="color:#75715e"># Every three minutes</span>
  <span style="color:#f92672">schedule</span>: <span style="color:#e6db74">&#34;*/3 * * * *&#34;</span>
  <span style="color:#f92672">jobTemplate</span>:
    <span style="color:#f92672">spec</span>:
      <span style="color:#f92672">template</span>:
        <span style="color:#f92672">spec</span>:
        <span style="color:#f92672">containers</span>:
        - <span style="color:#f92672">image</span>: <span style="color:#ae81ff">k8spatterns/random-generator:1.0</span>
          <span style="color:#f92672">name</span>: <span style="color:#ae81ff">random-generator</span>
          <span style="color:#f92672">command</span>: [ <span style="color:#e6db74">&#34;java&#34;</span>, <span style="color:#e6db74">&#34;-cp&#34;</span>, <span style="color:#e6db74">&#34;/&#34;</span>, <span style="color:#e6db74">&#34;RandomRunner&#34;</span>, <span style="color:#e6db74">&#34;/numbers.txt&#34;</span>, <span style="color:#e6db74">&#34;10000&#34;</span> ]
        <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">OnFailure</span>
</code></pre></div><h2 id="daemon-æœåŠ¡">Daemon æœåŠ¡</h2>
<p>daemon é€šå¸¸æŒ‡ä¸€ä¸ªé•¿æœŸè¿è¡Œã€è‡ªæˆ‘æ¢å¤çš„ä¸€ä¸ªåå°ç¨‹åºã€‚åœ¨ Unix ä¸­ï¼Œdaemons çš„æœåŠ¡é€šå¸¸ä»¥ <code>d</code> ç»“å°¾ï¼š<code>httpd</code>ã€<code>named</code>ã€<code>sshd</code>ã€‚</p>
<h2 id="å•ä¾‹æœåŠ¡">å•ä¾‹æœåŠ¡</h2>
<p>ä»»ä½•æ—¶å€™åªæœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºåœ¨è¿è¡Œï¼Œå½“ç„¶è‚¯å®šæ˜¯é«˜å¯ç”¨çš„ã€‚</p>
<p>å½“æˆ‘ä»¬éœ€è¦ active-passive (æˆ–è€…ä¹Ÿå¯ä»¥å«åš master-slave) æ‹“æ‰‘ç»“æ„çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦ç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹æ˜¯æ¿€æ´»çš„çŠ¶æ€ï¼Œå…¶å®ƒçš„éƒ½æ˜¯ passive çŠ¶æ€ã€‚</p>
<h3 id="out-of-application-é”">Out-of-Application é”</h3>
<p><img src="/images/docs/tutorial/technique/k8s-patterns/Snipaste_2021-08-22_21-50-11.png" alt=""></p>
<p>Kubernetes å¯åŠ¨ä¸€ä¸ªå…·æœ‰ä¸€ä¸ªå‰¯æœ¬çš„ Podï¼Œå½“ç„¶æˆ‘ä»¬è¿˜éœ€è¦ä¸º Pod é…å¤‡ä¸€ä¸ª controller ä¾‹å¦‚ ReplicaSet æ¥è®©å…¶å˜ä¸ºé«˜å¯ç”¨çš„å•ä¾‹ã€‚æ³¨æ„ ReplicaSet åœ¨å‰¯æœ¬çš„ä¸ªæ•°å±‚çº§ï¼Œæ‰§è¡Œçš„è¯­ä¹‰æ˜¯ &ldquo;at least&rdquo; è€Œé &ldquo;at most&rdquo;ã€‚èƒ½å¤Ÿæä¾›ä¸¥æ ¼å•ä¾‹ä¿è¯çš„æ˜¯ StatefulSetï¼Œå…¶æ›´å€¾å‘äºä¸€è‡´æ€§ã€‚</p>
<h3 id="in-application-é”">In-Application é”</h3>
<p>è¿™ç§å®ç°éœ€è¦å¤–éƒ¨é”ï¼Œä¾‹å¦‚ ZooKeeperã€Consulã€Redisã€Etcd ç­‰å®ç°çš„é”ã€‚åœ¨ Kubernetes ä¸­ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯ä½¿ç”¨è‡ªå¸¦çš„ API æ¥é€šè¿‡ Etcd æ¥å®ç°é”çš„èƒ½åŠ›ï¼ŒEtcd å†…éƒ¨é€šè¿‡ Raft åè®®æ¥ç»´æŠ¤å‰¯æœ¬ä¸€è‡´æ€§ã€‚</p>
<p><img src="/images/docs/tutorial/technique/k8s-patterns/Snipaste_2021-08-22_21-58-14.png" alt=""></p>
<h2 id="æœ‰çŠ¶æ€çš„æœåŠ¡">æœ‰çŠ¶æ€çš„æœåŠ¡</h2>
<h3 id="statefulset">StatefulSet</h3>
<p>åœ¨ Kubernetes ä¸­è¿è¡Œçš„æœ‰çŠ¶æ€çš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºï¼š</p>
<p><img src="/images/docs/tutorial/technique/k8s-patterns/Snipaste_2021-08-22_22-50-41.png" alt=""></p>
<h2 id="æœåŠ¡å‘ç°">æœåŠ¡å‘ç°</h2>
<p>åœ¨ Kubernetes åˆ°æ¥ä¹‹å‰ï¼Œä¸€èˆ¬æœåŠ¡å‘ç°éƒ½æ˜¯é‡‡ç”¨å¦‚ä¸‹ Client-side æœåŠ¡å‘ç°çš„æ–¹å¼ï¼š</p>
<p><img src="/images/docs/tutorial/technique/k8s-patterns/Snipaste_2021-09-01_20-54-53.png" alt=""></p>
<p>å¦‚ä¸‹å±•ç¤ºäº† Kubernetes æ˜¯å¦‚ä½•è¿›è¡ŒæœåŠ¡æ³¨å†Œä¸å‘ç°çš„ (Server-side æœåŠ¡å‘ç°)ï¼š</p>
<p><img src="/images/docs/tutorial/technique/k8s-patterns/Snipaste_2021-09-01_20-58-41.png" alt=""></p>
<h2 id="self-awareness">Self Awareness</h2>
<p>è¯¢é—® Kubernetes çš„ä¸€äº›å…ƒä¿¡æ¯ï¼š</p>
<p><img src="/images/docs/tutorial/technique/k8s-patterns/Snipaste_2021-09-01_21-07-21.png" alt=""></p>
<h2 id="init-å®¹å™¨">Init å®¹å™¨</h2>
<p>å°±æ˜¯æ‰§è¡Œä¸€äº›<strong>åˆå§‹åŒ–é€»è¾‘</strong>ï¼Œè¿™äº›é€»è¾‘æ˜¯è¿è¡Œä½ åº”ç”¨ç¨‹åºçš„å‰ç½®æ¡ä»¶ï¼Œæ˜¯<strong>å¼ºä¾èµ–</strong>ï¼š</p>
<p><img src="/images/docs/tutorial/technique/k8s-patterns/Snipaste_2021-09-01_21-12-17.png" alt=""></p>
<blockquote>
<p>Init å®¹å™¨éœ€è¦æ˜¯<strong>å¹‚ç­‰</strong>çš„ã€‚</p>
</blockquote>
<h2 id="sidecar">Sidecar</h2>
<p>Sidecar æ— éœ€æ”¹å˜å³å¯<strong>å¢å¼º</strong>å•å®¹å™¨çš„åŠŸèƒ½ã€‚ä¸€ä¸ªç†æƒ³çš„å®¹å™¨åŠŸèƒ½åº”è¯¥åƒ Linux çš„ä¸€ä¸ªè¿›ç¨‹ä¸€æ ·ï¼Œå®ƒè§£å†³å¹¶ä¸”åªè§£å†³ä¸€ä»¶äº‹ï¼Œå°†ä»–è§£å†³å¥½ã€‚Sidecar æ¨¡å¼æä¾›äº†è¾¾åˆ°å¯é‡ç”¨/æ‰©å±•å®¹å™¨åŠŸèƒ½/å®¹å™¨é—´åä½œçš„æ–¹å¼ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€ç§ Sidecar ç¤ºä¾‹ï¼š</p>
<p><img src="/images/docs/tutorial/technique/k8s-patterns/Snipaste_2021-09-01_21-35-19.png" alt=""></p>
<p>Sidecar å…¶å®ä¹Ÿç±»ä¼¼äº<strong>ç»„åˆ</strong>æ¨¡å¼ã€‚</p>
<h2 id="adapter-æ¨¡å¼">Adapter æ¨¡å¼</h2>
<p><img src="/images/docs/tutorial/technique/k8s-patterns/Snipaste_2021-09-01_21-42-07.png" alt=""></p>

<ins class="adsbygoogle"
style="display:block"
data-ad-client="ca-pub-8950855178079071"
data-ad-slot="6142361626"
data-ad-format="auto"
data-full-width-responsive="true"></ins>
</article>
 

      <footer class="book-footer">
        
  <div class="flex justify-between">





</div>

 
        
  
  <div class="book-comments">  </div>
  
 
      </footer>
      
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#ç®€ä»‹">ç®€ä»‹</a></li>
    <li><a href="#å¯é¢„æµ‹çš„éœ€æ±‚">å¯é¢„æµ‹çš„éœ€æ±‚</a>
      <ul>
        <li><a href="#ç£ç›˜">ç£ç›˜</a></li>
        <li><a href="#å‚æ•°é…ç½®">å‚æ•°é…ç½®</a></li>
        <li><a href="#èµ„æºé™åˆ¶">èµ„æºé™åˆ¶</a></li>
        <li><a href="#pod-ä¼˜å…ˆçº§">Pod ä¼˜å…ˆçº§</a></li>
      </ul>
    </li>
    <li><a href="#å£°æ˜å¼éƒ¨ç½²">å£°æ˜å¼éƒ¨ç½²</a>
      <ul>
        <li><a href="#æ»šåŠ¨æ›´æ–°">æ»šåŠ¨æ›´æ–°</a></li>
        <li><a href="#fixed-éƒ¨ç½²">Fixed éƒ¨ç½²</a></li>
        <li><a href="#è“ç»¿å‘å¸ƒ">è“ç»¿å‘å¸ƒ</a></li>
        <li><a href="#é‡‘ä¸é›€å‘å¸ƒ">é‡‘ä¸é›€å‘å¸ƒ</a></li>
        <li><a href="#å¯¹æ¯”">å¯¹æ¯”</a></li>
      </ul>
    </li>
    <li><a href="#å¥åº·æ¢æµ‹">å¥åº·æ¢æµ‹</a>
      <ul>
        <li><a href="#liveness-æ¢æµ‹">Liveness æ¢æµ‹</a></li>
        <li><a href="#readiness-æ¢æµ‹">Readiness æ¢æµ‹</a></li>
      </ul>
    </li>
    <li><a href="#ç”Ÿå‘½å‘¨æœŸç®¡ç†">ç”Ÿå‘½å‘¨æœŸç®¡ç†</a></li>
    <li><a href="#automated-placement">Automated Placement</a>
      <ul>
        <li><a href="#è°ƒåº¦è¿‡ç¨‹">è°ƒåº¦è¿‡ç¨‹</a></li>
      </ul>
    </li>
    <li><a href="#æ‰¹é‡ä½œä¸š">æ‰¹é‡ä½œä¸š</a>
      <ul>
        <li><a href="#kubernetes-job">Kubernetes Job</a></li>
      </ul>
    </li>
    <li><a href="#å‘¨æœŸä½œä¸š">å‘¨æœŸä½œä¸š</a>
      <ul>
        <li><a href="#cronjob">CronJob</a></li>
      </ul>
    </li>
    <li><a href="#daemon-æœåŠ¡">Daemon æœåŠ¡</a></li>
    <li><a href="#å•ä¾‹æœåŠ¡">å•ä¾‹æœåŠ¡</a>
      <ul>
        <li><a href="#out-of-application-é”">Out-of-Application é”</a></li>
        <li><a href="#in-application-é”">In-Application é”</a></li>
      </ul>
    </li>
    <li><a href="#æœ‰çŠ¶æ€çš„æœåŠ¡">æœ‰çŠ¶æ€çš„æœåŠ¡</a>
      <ul>
        <li><a href="#statefulset">StatefulSet</a></li>
      </ul>
    </li>
    <li><a href="#æœåŠ¡å‘ç°">æœåŠ¡å‘ç°</a></li>
    <li><a href="#self-awareness">Self Awareness</a></li>
    <li><a href="#init-å®¹å™¨">Init å®¹å™¨</a></li>
    <li><a href="#sidecar">Sidecar</a></li>
    <li><a href="#adapter-æ¨¡å¼">Adapter æ¨¡å¼</a></li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</body>



</html>












