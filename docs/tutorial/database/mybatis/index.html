<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="MyBatis"><meta property="og:title" content="MyBatis" />
<meta property="og:description" content="MyBatis é˜²æ­¢ SQL æ³¨å…¥ $ vs # # å°†ä¼ å…¥çš„æ•°æ®éƒ½å½“æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¼šå¯¹è‡ªåŠ¨ä¼ å…¥çš„æ•°æ®åŠ ä¸€ä¸ªåŒå¼•å· (åº•å±‚åŸºäº PreparedStatement)ã€‚å¦‚ï¼šwhere username=#{username}ï¼Œå¦‚æœä¼ å…¥çš„å€¼æ˜¯ 111,é‚£ä¹ˆè§£ææˆ sql æ—¶çš„å€¼ä¸º where username=&quot;111&quot;, å¦‚æœä¼ å…¥çš„å€¼æ˜¯idï¼Œåˆ™è§£ææˆçš„ sql ä¸º where username=&quot;id&quot;ï¼š
&lt;select id=&#34;selectByNameAndPassword&#34; parameterType=&#34;java.util.Map&#34; resultMap=&#34;BaseResultMap&#34;&gt; select id, username, password, role from user where username = #{username,jdbcType=VARCHAR} and password = #{password,jdbcType=VARCHAR} &lt;/select&gt; $ å°†ä¼ å…¥çš„æ•°æ®ç›´æ¥æ˜¾ç¤ºç”Ÿæˆåœ¨ sql ä¸­ï¼š
&lt;select id=&#34;selectByNameAndPassword&#34; parameterType=&#34;java.util.Map&#34; resultMap=&#34;BaseResultMap&#34;&gt; select id, username, password, role from user where username = ${username,jdbcType=VARCHAR} and password = ${password,jdbcType=VARCHAR} &lt;/select&gt; # æ–¹å¼èƒ½å¤Ÿå¾ˆå¤§ç¨‹åº¦é˜²æ­¢sqlæ³¨å…¥ï¼Œ$ æ–¹å¼æ— æ³•é˜²æ­¢Sqlæ³¨å…¥ã€‚$ æ–¹å¼ä¸€èˆ¬ç”¨äºä¼ å…¥æ•°æ®åº“å¯¹è±¡ï¼Œä¾‹å¦‚ä¼ å…¥è¡¨åã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://kunzhao.org/docs/tutorial/database/mybatis/" />

<title>MyBatis | èµµå¤çš„ä¸ªäººç½‘ç«™</title>
<link rel="icon" href="/favicon.png" type="image/x-icon">


<link rel="stylesheet" href="/book.min.2c8703ef3571e9e1469d79306fda1ed51333153e6ba74aff763a8bc7a9fdaea2.css" integrity="sha256-LIcD7zVx6eFGnXkwb9oe1RMzFT5rp0r/djqLx6n9rqI=">


<script defer src="/en.search.min.1e7619796b61414a9016ae3ce0c51191e796bfabae1a014100792c00d2d6c838.js" integrity="sha256-HnYZeWthQUqQFq484MURkeeWv6uuGgFBAHksANLWyDg="></script>
<script>
var _hmt = _hmt || [];
(function() {
  if (location.hostname === "localhost" || 
    location.hostname === "127.0.0.1") {
    return;
  }

  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?d04ff9e23cec6cb39ebbee1b4883e269";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<script data-ad-client="ca-pub-8950855178079071" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  
</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><span>èµµå¤çš„ä¸ªäººç½‘ç«™</span>
  </a>
</h2>








  

  
  





 
  
    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/" >
      ğŸ’¡ æ•™ç¨‹
  </a>


    

    




  
  <ul>
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/front-end-optimization-guide/" >
      å‰ç«¯ä¼˜åŒ–æŒ‡å—
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/algorithm/" >
      ç®—æ³•
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/unix-command/" >
      UNIX å¸¸ç”¨å‘½ä»¤å¤§å…¨
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/unix-optimize/" >
      UNIX æ€§èƒ½ä¼˜åŒ–
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/vue3/" >
      Vue.js æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/git/" >
      Git æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/network/" >
      ç½‘ç»œåè®®
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/awk/" >
      AWK æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/devops/" >
      DevOps
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/sentinel/" >
      é˜¿é‡Œå·´å·´ Sentinel
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/zipkin/" >
      Zipkin æºç åˆ†æ
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/eureka/" >
      Netflix Eureka æºç åˆ†æ
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/distributed-storage/" >
      åˆ†å¸ƒå¼å­˜å‚¨
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/maven/" >
      Maven æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/java/" >
      Java æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/spring/" >
      Spring æ•™ç¨‹
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/distributed/" >
      åˆ†å¸ƒå¼ç³»ç»Ÿä¸æ¶æ„è®¾è®¡
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/database/" >
      æ•°æ®åº“
  </a>


    

    




  
  <ul>
    
      
        <li>

  <a href="/docs/tutorial/database/mysql-query/" >
      MySQL æŸ¥è¯¢
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/database/transaction-internal/" >
      MySQL äº‹åŠ¡å®ç°åŸç†
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/database/mysql-crash-safe/" >
      MySQL Crash Safe
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/database/mysql-index/" >
      MySQL ç´¢å¼•
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/database/auto-increment-id/" >
      MySQL è‡ªå¢é”®
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/database/mysql-high-availablity/" >
      MySQL é«˜å¯ç”¨
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/database/mysql-ops/" >
      MySQL ä¼˜åŒ–ä¸è¿ç»´
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/database/mybatis/"  class="active">
      MyBatis
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/database/oracle/" >
      Oracle
  </a>

</li>
      
    
      
        <li>

  <a href="/docs/tutorial/database/sharding-sphere/" >
      ShardingSphere 3.X
  </a>

</li>
      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tutorial/redis/" >
      Redis
  </a>


    

    






  </li>


      
    
  </ul>
  



  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/programmer-interview/" >
      ğŸ‘ ç¨‹åºå‘˜é¢è¯•é¢˜
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/rocketmq/" >
      RocketMQ æºç åˆ†æ
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/books/" >
      ä¹¦ç±
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/javascript/" >
      JavaScript ä¸“æ 
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/it-zone/" >
      IT åœˆ
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/hire/" >
      æ‹›è˜
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/cloud-plus-bbs/" >
      äº‘&#43;ç¤¾åŒºæŠ€æœ¯æ²™é¾™
  </a>


    

    






  </li>


      
    
      
        

  <li >
    
      

  <a href="/docs/tools/" >
      å®ç”¨å·¥å…·
  </a>


    

    






  </li>


      
    
  </ul>
  



  












<ul>
  
  <li>
    <a href="/posts/" >
        åšå®¢
      </a>
  </li>
  
</ul>



</nav>




  <script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>MyBatis</strong>

  <label for="toc-control">
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#é˜²æ­¢-sql-æ³¨å…¥">é˜²æ­¢ SQL æ³¨å…¥</a>
      <ul>
        <li><a href="#-vs-"><code>$</code> vs <code>#</code></a></li>
        <li><a href="#preparedstatement">PreparedStatement</a></li>
      </ul>
    </li>
    <li><a href="#ç¼“å­˜">ç¼“å­˜</a>
      <ul>
        <li><a href="#ä¸€çº§ç¼“å­˜">ä¸€çº§ç¼“å­˜</a></li>
        <li><a href="#äºŒçº§ç¼“å­˜">äºŒçº§ç¼“å­˜</a></li>
      </ul>
    </li>
    <li><a href="#åˆ†é¡µ">åˆ†é¡µ</a>
      <ul>
        <li><a href="#ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</a></li>
        <li><a href="#åˆ†é¡µåŸç†">åˆ†é¡µåŸç†</a></li>
      </ul>
    </li>
    <li><a href="#å‚è€ƒ">å‚è€ƒ</a></li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
<article class="markdown">
  
<ins class="adsbygoogle"
style="display:block"
data-ad-client="ca-pub-8950855178079071"
data-ad-slot="6142361626"
data-ad-format="auto"
data-full-width-responsive="true"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script><h1 id="mybatis">MyBatis</h1>
<h2 id="é˜²æ­¢-sql-æ³¨å…¥">é˜²æ­¢ SQL æ³¨å…¥</h2>
<h3 id="-vs-"><code>$</code> vs <code>#</code></h3>
<p><code>#</code> å°†ä¼ å…¥çš„æ•°æ®éƒ½å½“æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¼šå¯¹è‡ªåŠ¨ä¼ å…¥çš„æ•°æ®åŠ ä¸€ä¸ªåŒå¼•å· (åº•å±‚åŸºäº <code>PreparedStatement</code>)ã€‚å¦‚ï¼š<code>where username=#{username}</code>ï¼Œå¦‚æœä¼ å…¥çš„å€¼æ˜¯ <code>111</code>,é‚£ä¹ˆè§£ææˆ sql æ—¶çš„å€¼ä¸º <code>where username=&quot;111&quot;</code>, å¦‚æœä¼ å…¥çš„å€¼æ˜¯idï¼Œåˆ™è§£ææˆçš„ sql ä¸º <code>where username=&quot;id&quot;</code>ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-XML" data-lang="XML"><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;selectByNameAndPassword&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;java.util.Map&#34;</span> <span style="color:#a6e22e">resultMap=</span><span style="color:#e6db74">&#34;BaseResultMap&#34;</span><span style="color:#f92672">&gt;</span>
    select id, username, password, role
    from user
    where username = #{username,jdbcType=VARCHAR}
    and password = #{password,jdbcType=VARCHAR}
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><p><code>$</code> å°†ä¼ å…¥çš„æ•°æ®ç›´æ¥æ˜¾ç¤ºç”Ÿæˆåœ¨ sql ä¸­ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-XML" data-lang="XML"><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;selectByNameAndPassword&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;java.util.Map&#34;</span> <span style="color:#a6e22e">resultMap=</span><span style="color:#e6db74">&#34;BaseResultMap&#34;</span><span style="color:#f92672">&gt;</span>
    select id, username, password, role
    from user
    where username = ${username,jdbcType=VARCHAR}
    and password = ${password,jdbcType=VARCHAR}
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><p><code>#</code> æ–¹å¼èƒ½å¤Ÿå¾ˆå¤§ç¨‹åº¦é˜²æ­¢sqlæ³¨å…¥ï¼Œ<code>$</code> æ–¹å¼æ— æ³•é˜²æ­¢Sqlæ³¨å…¥ã€‚<code>$</code> æ–¹å¼ä¸€èˆ¬ç”¨äºä¼ å…¥æ•°æ®åº“å¯¹è±¡ï¼Œä¾‹å¦‚ä¼ å…¥è¡¨åã€‚</p>
<h3 id="preparedstatement">PreparedStatement</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java">String param <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#39;test&#39; or 1=1&#34;</span><span style="color:#f92672">;</span>
String sql <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select file from file where name = ?&#34;</span><span style="color:#f92672">;</span>
</code></pre></div><p>å¯¹äºä¸Šè¿° SQL è¯­å¥å’Œå‚æ•°ï¼Œå¦‚æœä½¿ç”¨æ‹¼æ¥æ–¹å¼ï¼Œå°±ä¼šæ„æˆ SQL æ³¨å…¥ï¼Œè€Œå¦‚æœä½¿ç”¨ <code>PreparedStatement</code> æ‰§è¡Œçš„ SQL è¯­å¥å°±ä¼šå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-SQL" data-lang="SQL"><span style="color:#66d9ef">select</span> file <span style="color:#66d9ef">from</span> file <span style="color:#66d9ef">where</span> name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;\&#39;</span>test<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#e6db74">&#39; or 1=1&#39;</span>
</code></pre></div><p>SQL æŠŠæ•´ä¸ªå‚æ•°ç”¨å¼•å·åŒ…èµ·æ¥ï¼Œå¹¶æŠŠå‚æ•°ä¸­çš„å¼•å·ä½œä¸ºè½¬ä¹‰å­—ç¬¦ï¼Œä»è€Œé¿å…äº†å‚æ•°ä¹Ÿä½œä¸ºæ¡ä»¶çš„ä¸€éƒ¨åˆ†ã€‚ä¸‹é¢æ¥çœ‹ <code>com.mysql.jdbc.PreparedStatement</code> çš„ <code>setString</code> æ–¹æ³•ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setString</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> parameterIndex<span style="color:#f92672">,</span> String x<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> SQLException <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">synchronized</span> <span style="color:#f92672">(</span>checkClosed<span style="color:#f92672">().</span><span style="color:#a6e22e">getConnectionMutex</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
            <span style="color:#75715e">// if the passed string is null, then set this column to null
</span><span style="color:#75715e"></span>            <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>x <span style="color:#f92672">==</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                setNull<span style="color:#f92672">(</span>parameterIndex<span style="color:#f92672">,</span> Types<span style="color:#f92672">.</span><span style="color:#a6e22e">CHAR</span><span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                checkClosed<span style="color:#f92672">();</span>

                <span style="color:#66d9ef">int</span> stringLength <span style="color:#f92672">=</span> x<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">();</span>

                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">connection</span><span style="color:#f92672">.</span><span style="color:#a6e22e">isNoBackslashEscapesSet</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
                    <span style="color:#75715e">// Scan for any nasty chars                    // åˆ¤æ–­æ˜¯å¦éœ€è¦è½¬ä¹‰å¤„ç†ï¼ˆæ¯”å¦‚åŒ…å«å¼•å·ï¼Œæ¢è¡Œç­‰å­—ç¬¦ï¼‰
</span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">boolean</span> needsHexEscape <span style="color:#f92672">=</span> isEscapeNeededForString<span style="color:#f92672">(</span>x<span style="color:#f92672">,</span> stringLength<span style="color:#f92672">);</span>                     <span style="color:#75715e">// å¦‚æœä¸éœ€è¦è½¬ä¹‰ï¼Œåˆ™åœ¨ä¸¤è¾¹åŠ ä¸Šå•å¼•å·
</span><span style="color:#75715e"></span>                    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span>needsHexEscape<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                        <span style="color:#66d9ef">byte</span><span style="color:#f92672">[]</span> parameterAsBytes <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>

                        StringBuilder quotedString <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StringBuilder<span style="color:#f92672">(</span>x<span style="color:#f92672">.</span><span style="color:#a6e22e">length</span><span style="color:#f92672">()</span> <span style="color:#f92672">+</span> 2<span style="color:#f92672">);</span>
                        quotedString<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;\&#39;&#39;</span><span style="color:#f92672">);</span>
                        quotedString<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>x<span style="color:#f92672">);</span>
                        quotedString<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#39;\&#39;&#39;</span><span style="color:#f92672">);</span>

                        <span style="color:#f92672">...</span>
                    <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
                        <span style="color:#f92672">...</span>
                <span style="color:#f92672">}</span>

                String parameterAsString <span style="color:#f92672">=</span> x<span style="color:#f92672">;</span>
                <span style="color:#66d9ef">boolean</span> needsQuoted <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">;</span>
                <span style="color:#75715e">// å¦‚æœéœ€è¦è½¬ä¹‰ï¼Œåˆ™åšè½¬ä¹‰å¤„ç†
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">isLoadDataQuery</span> <span style="color:#f92672">||</span> isEscapeNeededForString<span style="color:#f92672">(</span>x<span style="color:#f92672">,</span> stringLength<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
                <span style="color:#f92672">...</span>
</code></pre></div><h2 id="ç¼“å­˜">ç¼“å­˜</h2>
<p>MyBatis æœ‰ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼Œå¹¶ä¸”é¢„ç•™äº†é›†æˆç¬¬ä¸‰æ–¹ç¼“å­˜çš„æ¥å£ã€‚</p>
<h3 id="ä¸€çº§ç¼“å­˜">ä¸€çº§ç¼“å­˜</h3>
<p>ä¸€çº§ç¼“å­˜ä¹Ÿå«æœ¬åœ°ç¼“å­˜ï¼ŒMyBatis çš„ä¸€çº§ç¼“å­˜æ˜¯åœ¨ä¼šè¯ï¼ˆSqlSessionï¼‰å±‚é¢è¿›è¡Œç¼“å­˜çš„ã€‚MyBatis çš„<strong>ä¸€çº§ç¼“å­˜æ˜¯é»˜è®¤å¼€å¯</strong>çš„ï¼Œä¸éœ€è¦ä»»ä½•çš„é…ç½®ã€‚</p>
<p>åœ¨å¯¹æ•°æ®åº“çš„ä¸€æ¬¡ä¼šè¯ä¸­ï¼Œæˆ‘ä»¬æœ‰å¯èƒ½ä¼šåå¤åœ°æ‰§è¡Œå®Œå…¨ç›¸åŒçš„æŸ¥è¯¢è¯­å¥ï¼Œå¦‚æœä¸é‡‡å–ä¸€äº›æªæ–½çš„è¯ï¼Œæ¯ä¸€æ¬¡æŸ¥è¯¢éƒ½ä¼šæŸ¥è¯¢ä¸€æ¬¡æ•°æ®åº“,è€Œæˆ‘ä»¬åœ¨æçŸ­çš„æ—¶é—´å†…åšäº†å®Œå…¨ç›¸åŒçš„æŸ¥è¯¢ï¼Œé‚£ä¹ˆå®ƒä»¬çš„ç»“æœææœ‰å¯èƒ½å®Œå…¨ç›¸åŒï¼Œç”±äºæŸ¥è¯¢ä¸€æ¬¡æ•°æ®åº“çš„ä»£ä»·å¾ˆå¤§ï¼Œè¿™æœ‰å¯èƒ½é€ æˆå¾ˆå¤§çš„èµ„æºæµªè´¹ã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œå‡å°‘èµ„æºçš„æµªè´¹ï¼ŒMyBatis ä¼šåœ¨è¡¨ç¤ºä¼šè¯çš„ <code>SqlSession</code> å¯¹è±¡ä¸­å»ºç«‹ä¸€ä¸ªç®€å•çš„ç¼“å­˜ï¼Œå°†æ¯æ¬¡æŸ¥è¯¢åˆ°çš„ç»“æœç»“æœç¼“å­˜èµ·æ¥ï¼Œå½“ä¸‹æ¬¡æŸ¥è¯¢çš„æ—¶å€™ï¼Œå¦‚æœåˆ¤æ–­å…ˆå‰æœ‰ä¸ªå®Œå…¨ä¸€æ ·çš„æŸ¥è¯¢ï¼Œä¼šç›´æ¥ä»ç¼“å­˜ä¸­ç›´æ¥å°†ç»“æœå–å‡ºï¼Œè¿”å›ç»™ç”¨æˆ·ï¼Œä¸éœ€è¦å†è¿›è¡Œä¸€æ¬¡æ•°æ®åº“æŸ¥è¯¢äº†ã€‚</p>
<p><img src="/images/docs/tutorial/database/mybatis/1383365-20190628172851422-987384747.png" alt=""></p>
<blockquote>
<p>ä¸€çº§ç¼“å­˜çš„ç”Ÿå‘½å‘¨æœŸæœ‰å¤šé•¿ï¼Ÿ</p>
</blockquote>
<ul>
<li>MyBatisåœ¨å¼€å¯ä¸€ä¸ªæ•°æ®åº“ä¼šè¯æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„SqlSessionå¯¹è±¡ï¼ŒSqlSessionå¯¹è±¡ä¸­ä¼šæœ‰ä¸€ä¸ªæ–°çš„Executorå¯¹è±¡ï¼ŒExecutorå¯¹è±¡ä¸­æŒæœ‰ä¸€ä¸ªæ–°çš„ <code>PerpetualCache</code> å¯¹è±¡ï¼›å½“ä¼šè¯ç»“æŸæ—¶ï¼Œ<code>SqlSession</code> å¯¹è±¡åŠå…¶å†…éƒ¨çš„Executorå¯¹è±¡è¿˜æœ‰ <code>PerpetualCache</code> å¯¹è±¡ä¹Ÿä¸€å¹¶é‡Šæ”¾æ‰ã€‚</li>
<li>å¦‚æœ <code>SqlSession</code> è°ƒç”¨äº† <code>close()</code> æ–¹æ³•ï¼Œä¼šé‡Šæ”¾æ‰ä¸€çº§ç¼“å­˜ <code>PerpetualCache</code> å¯¹è±¡ï¼Œä¸€çº§ç¼“å­˜å°†ä¸å¯ç”¨ï¼›</li>
<li>å¦‚æœ <code>SqlSession</code> è°ƒç”¨äº† <code>clearCache()</code>ï¼Œä¼šæ¸…ç©º <code>PerpetualCache</code> å¯¹è±¡ä¸­çš„æ•°æ®ï¼Œä½†æ˜¯è¯¥å¯¹è±¡ä»å¯ä½¿ç”¨ï¼›</li>
<li><code>SqlSession</code> ä¸­æ‰§è¡Œäº†ä»»ä½•ä¸€ä¸ª update æ“ä½œ(<code>update()</code>ã€<code>delete()</code>ã€<code>insert()</code>) ï¼Œéƒ½ä¼šæ¸…ç©º <code>PerpetualCache</code> å¯¹è±¡çš„æ•°æ®ï¼Œä½†æ˜¯è¯¥å¯¹è±¡å¯ä»¥ç»§ç»­ä½¿ç”¨ï¼›</li>
</ul>
<h3 id="äºŒçº§ç¼“å­˜">äºŒçº§ç¼“å­˜</h3>
<p>äºŒçº§ç¼“å­˜æ˜¯ç”¨æ¥è§£å†³ä¸€çº§ç¼“å­˜ä¸èƒ½è·¨ä¼šè¯å…±äº«çš„é—®é¢˜çš„ï¼ŒèŒƒå›´æ˜¯ namespace çº§åˆ«çš„ï¼Œå¯ä»¥è¢«å¤šä¸ª<code>SqlSession</code> å…±äº«ï¼ˆåªè¦æ˜¯åŒä¸€ä¸ªæ¥å£é‡Œé¢çš„ç›¸åŒæ–¹æ³•ï¼Œéƒ½å¯ä»¥å…±äº«ï¼‰ï¼Œç”Ÿå‘½å‘¨æœŸå’Œåº”ç”¨åŒæ­¥ã€‚å¦‚æœä½ çš„MyBatisä½¿ç”¨äº†äºŒçº§ç¼“å­˜ï¼Œå¹¶ä¸”ä½ çš„<code>Mapper</code>å’Œselectè¯­å¥ä¹Ÿé…ç½®ä½¿ç”¨äº†äºŒçº§ç¼“å­˜ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡ŒselectæŸ¥è¯¢çš„æ—¶å€™ï¼ŒMyBatisä¼šå…ˆä»äºŒçº§ç¼“å­˜ä¸­å–è¾“å…¥ï¼Œå…¶æ¬¡æ‰æ˜¯ä¸€çº§ç¼“å­˜ï¼Œå³MyBatisæŸ¥è¯¢æ•°æ®çš„é¡ºåºæ˜¯ï¼šäºŒçº§ç¼“å­˜ -&gt; ä¸€çº§ç¼“å­˜ -&gt; æ•°æ®åº“ã€‚</p>
<p><img src="/images/docs/tutorial/database/mybatis/1383365-20190628180149776-546074458.png" alt=""></p>
<blockquote>
<p>å¼€å¯äºŒçº§ç¼“å­˜çš„æ–¹æ³•</p>
</blockquote>
<ul>
<li>ç¬¬ä¸€æ­¥ï¼šé…ç½® <code>mybatis.configuration.cache-enabled=true</code>ã€‚</li>
<li>ç¬¬äºŒæ­¥ï¼šåœ¨ <code>Mapper.xml</code> ä¸­é…ç½® <code>&lt;cache/&gt;</code> æ ‡ç­¾ï¼š</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-XML" data-lang="XML"><span style="color:#f92672">&lt;cache</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;org.apache.ibatis.cache.impl.PerpetualCache&#34;</span>
    <span style="color:#a6e22e">size=</span><span style="color:#e6db74">&#34;1024&#34;</span>
    <span style="color:#a6e22e">eviction=</span><span style="color:#e6db74">&#34;LRU&#34;</span>
    <span style="color:#a6e22e">flushInterval=</span><span style="color:#e6db74">&#34;120000&#34;</span>
    <span style="color:#a6e22e">readOnly=</span><span style="color:#e6db74">&#34;false&#34;</span><span style="color:#f92672">/&gt;</span>
</code></pre></div><blockquote>
<p>æŸä¸ªæ–¹æ³•ä¸éœ€è¦äºŒçº§ç¼“å­˜</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-XML" data-lang="XML"><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;selectBlog&#34;</span> <span style="color:#a6e22e">resultMap=</span><span style="color:#e6db74">&#34;BaseResultMap&#34;</span> <span style="color:#a6e22e">useCache=</span><span style="color:#e6db74">&#34;false&#34;</span><span style="color:#f92672">&gt;</span>
</code></pre></div><h2 id="åˆ†é¡µ">åˆ†é¡µ</h2>
<p><a href="https://baomidou.com/">MyBatis-Plus</a>ï¼ˆç®€ç§° MPï¼‰æ˜¯ä¸€ä¸ª MyBatis çš„<strong>å¢å¼ºå·¥å…·</strong>ï¼Œåœ¨ MyBatis çš„åŸºç¡€ä¸Šåªåšå¢å¼ºä¸åšæ”¹å˜ï¼Œä¸ºç®€åŒ–å¼€å‘ã€æé«˜æ•ˆç‡è€Œç”Ÿã€‚</p>
<p>è¿™ä¸ªåº“æä¾›äº†ä¸€ä¸ªåˆ†é¡µæ’ä»¶ï¼Œä¸‹é¢ç®€å•çœ‹ä¸‹æ­¤åˆ†é¡µæ’ä»¶çš„ç”¨æ³•å’ŒåŸç†ã€‚</p>
<h3 id="ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#75715e">//Spring bootæ–¹å¼
</span><span style="color:#75715e"></span><span style="color:#a6e22e">@Configuration</span>
<span style="color:#a6e22e">@MapperScan</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;com.baomidou.cloud.service.*.mapper*&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MybatisPlusConfig</span> <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Bean</span>
    <span style="color:#66d9ef">public</span> MybatisPlusInterceptor <span style="color:#a6e22e">mybatisPlusInterceptor</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        MybatisPlusInterceptor interceptor <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> MybatisPlusInterceptor<span style="color:#f92672">();</span>
        interceptor<span style="color:#f92672">.</span><span style="color:#a6e22e">addInnerInterceptor</span><span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> PaginationInnerInterceptor<span style="color:#f92672">(</span>DbType<span style="color:#f92672">.</span><span style="color:#a6e22e">H2</span><span style="color:#f92672">));</span>
        <span style="color:#66d9ef">return</span> interceptor<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
    
<span style="color:#f92672">}</span>
</code></pre></div><p>ç„¶åæŸ¥çœ‹ <code>Mapper.java</code> å¦‚ä½•ä½¿ç”¨åˆ†é¡µï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">UserMapper</span> <span style="color:#f92672">{</span><span style="color:#75715e">//å¯ä»¥ç»§æ‰¿æˆ–è€…ä¸ç»§æ‰¿BaseMapper
</span><span style="color:#75715e"></span>    IPage<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">selectPageVo</span><span style="color:#f92672">(</span>Page<span style="color:#f92672">&lt;?&gt;</span> page<span style="color:#f92672">,</span> Integer state<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><code>UserMapper.xml</code> çš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-XML" data-lang="XML"><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;selectPageVo&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;com.baomidou.cloud.entity.UserVo&#34;</span><span style="color:#f92672">&gt;</span>
    SELECT id,name FROM user WHERE state=#{state}
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><p>ç„¶åå½“è°ƒç”¨ <code>selectPageVo</code> çš„æ—¶å€™ï¼ŒMybatis-Plus è‡ªåŠ¨æ›¿ä½ åˆ†é¡µã€‚</p>
<h3 id="åˆ†é¡µåŸç†">åˆ†é¡µåŸç†</h3>
<blockquote>
<p>åŸºäº MyBatis-Plus 3.0 ç‰ˆæœ¬çš„æºç è¿›è¡Œçš„åˆ†æã€‚</p>
</blockquote>
<p>å¤„ç†åˆ†é¡µçš„ä¸»è¦é€»è¾‘åœ¨ <code>PaginationInterceptor</code> è¿™ä¸ªç±»çš„ <code>intercept</code> æ–¹æ³•é‡Œé¢ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#a6e22e">@Override</span>
<span style="color:#66d9ef">public</span> Object <span style="color:#a6e22e">intercept</span><span style="color:#f92672">(</span>Invocation invocation<span style="color:#f92672">)</span> <span style="color:#66d9ef">throws</span> Throwable <span style="color:#f92672">{</span>
    <span style="color:#75715e">// SQL è§£æ
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">sqlParser</span><span style="color:#f92672">(</span>metaObject<span style="color:#f92672">);</span>

    <span style="color:#75715e">// å…ˆåˆ¤æ–­æ˜¯ä¸æ˜¯SELECTæ“ä½œ
</span><span style="color:#75715e"></span>    MappedStatement mappedStatement <span style="color:#f92672">=</span> <span style="color:#f92672">(</span>MappedStatement<span style="color:#f92672">)</span> metaObject<span style="color:#f92672">.</span><span style="color:#a6e22e">getValue</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;delegate.mappedStatement&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>SqlCommandType<span style="color:#f92672">.</span><span style="color:#a6e22e">SELECT</span> <span style="color:#f92672">!=</span> mappedStatement<span style="color:#f92672">.</span><span style="color:#a6e22e">getSqlCommandType</span><span style="color:#f92672">()</span>
        <span style="color:#f92672">||</span> StatementType<span style="color:#f92672">.</span><span style="color:#a6e22e">CALLABLE</span> <span style="color:#f92672">==</span> mappedStatement<span style="color:#f92672">.</span><span style="color:#a6e22e">getStatementType</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        <span style="color:#75715e">// å¦‚æœä¸æ˜¯ SELECT é‚£ä¹ˆç›´æ¥è¿”å›
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">return</span> invocation<span style="color:#f92672">.</span><span style="color:#a6e22e">proceed</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">// åˆ¤æ–­å‚æ•°é‡Œæ˜¯å¦æœ‰pageå¯¹è±¡
</span><span style="color:#75715e"></span>    IPage<span style="color:#f92672">&lt;?&gt;</span> page <span style="color:#f92672">=</span> ParameterUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">findPage</span><span style="color:#f92672">(</span>paramObj<span style="color:#f92672">).</span><span style="color:#a6e22e">orElse</span><span style="color:#f92672">(</span><span style="color:#66d9ef">null</span><span style="color:#f92672">);</span>

    <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>page<span style="color:#f92672">.</span><span style="color:#a6e22e">isSearchCount</span><span style="color:#f92672">()</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>page<span style="color:#f92672">.</span><span style="color:#a6e22e">isHitCount</span><span style="color:#f92672">())</span> <span style="color:#f92672">{</span>
        SqlInfo sqlInfo <span style="color:#f92672">=</span> SqlParserUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getOptimizeCountSql</span><span style="color:#f92672">(</span>page<span style="color:#f92672">.</span><span style="color:#a6e22e">optimizeCountSql</span><span style="color:#f92672">(),</span> countSqlParser<span style="color:#f92672">,</span> originalSql<span style="color:#f92672">,</span> metaObject<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">queryTotal</span><span style="color:#f92672">(</span>sqlInfo<span style="color:#f92672">.</span><span style="color:#a6e22e">getSql</span><span style="color:#f92672">(),</span> mappedStatement<span style="color:#f92672">,</span> boundSql<span style="color:#f92672">,</span> page<span style="color:#f92672">,</span> connection<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(!</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">continueLimit</span><span style="color:#f92672">(</span>page<span style="color:#f92672">))</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">null</span><span style="color:#f92672">;</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    IDialect dialect <span style="color:#f92672">=</span> Optional<span style="color:#f92672">.</span><span style="color:#a6e22e">ofNullable</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">dialect</span><span style="color:#f92672">).</span><span style="color:#a6e22e">orElseGet</span><span style="color:#f92672">(()</span> <span style="color:#f92672">-&gt;</span> DialectFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">getDialect</span><span style="color:#f92672">(</span>dbType<span style="color:#f92672">));</span>
    String buildSql <span style="color:#f92672">=</span> concatOrderBy<span style="color:#f92672">(</span>originalSql<span style="color:#f92672">,</span> page<span style="color:#f92672">);</span>
    DialectModel model <span style="color:#f92672">=</span> dialect<span style="color:#f92672">.</span><span style="color:#a6e22e">buildPaginationSql</span><span style="color:#f92672">(</span>buildSql<span style="color:#f92672">,</span> page<span style="color:#f92672">.</span><span style="color:#a6e22e">offset</span><span style="color:#f92672">(),</span> page<span style="color:#f92672">.</span><span style="color:#a6e22e">getSize</span><span style="color:#f92672">());</span>

    metaObject<span style="color:#f92672">.</span><span style="color:#a6e22e">setValue</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;delegate.boundSql.sql&#34;</span><span style="color:#f92672">,</span> model<span style="color:#f92672">.</span><span style="color:#a6e22e">getDialectSql</span><span style="color:#f92672">());</span>
    metaObject<span style="color:#f92672">.</span><span style="color:#a6e22e">setValue</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;delegate.boundSql.parameterMappings&#34;</span><span style="color:#f92672">,</span> mappings<span style="color:#f92672">);</span>

    <span style="color:#66d9ef">return</span> invocation<span style="color:#f92672">.</span><span style="color:#a6e22e">proceed</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>ä¸Šè¿°ä¸»è¦é€»è¾‘å°±æ˜¯å…ˆè¿›è¡Œ SQL è§£æï¼Œå¦‚æœæ˜¯ SELECT æ“ä½œçš„è¯ï¼Œé‚£ä¹ˆç”¨ <code>queryTotal</code> æ–¹æ³•æŸ¥è¯¢æ€» countï¼ŒæœŸå†…éƒ¨çš„å¤§è‡´çš„æ‰§è¡Œçš„ SQL è¯­å¥çš„å†™æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"> <span style="color:#75715e">/**
</span><span style="color:#75715e">  * è·å– COUNT åŸç”Ÿ SQL åŒ…è£…
</span><span style="color:#75715e">  *
</span><span style="color:#75715e">  * @param originalSql ignore
</span><span style="color:#75715e">  * @return ignore
</span><span style="color:#75715e">  */</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> String <span style="color:#a6e22e">getOriginalCountSql</span><span style="color:#f92672">(</span>String originalSql<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> String<span style="color:#f92672">.</span><span style="color:#a6e22e">format</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;SELECT COUNT(*) FROM (%s) TOTAL&#34;</span><span style="color:#f92672">,</span> originalSql<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>è·å–åˆ° <code>count</code> ä¿¡æ¯åï¼Œä¼šæ”¾åˆ° <code>page</code> å¯¹è±¡çš„ <code>total</code> å­—æ®µä¸Šã€‚éšåæ ¹æ®æ•°æ®åº“çš„ä¸åŒï¼Œåœ¨ SQL è¯­å¥åé¢æ‹¼æ¥æˆä¸åŒçš„åˆ†é¡µ SQL è¯­å¥ã€‚</p>
<p>Oracle12c æ•°æ®åº“æ‹¼å‡‘åˆ†é¡µçš„ SQL è¯­å¥å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Oracle12cDialect</span> <span style="color:#66d9ef">implements</span> IDialect <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> DialectModel <span style="color:#a6e22e">buildPaginationSql</span><span style="color:#f92672">(</span>String originalSql<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> offset<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> limit<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        String sql <span style="color:#f92672">=</span> originalSql <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; OFFSET &#34;</span> <span style="color:#f92672">+</span> FIRST_MARK <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; ROWS FETCH NEXT &#34;</span> <span style="color:#f92672">+</span> SECOND_MARK <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; ROWS ONLY&#34;</span><span style="color:#f92672">;</span>
        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> DialectModel<span style="color:#f92672">(</span>sql<span style="color:#f92672">,</span> offset<span style="color:#f92672">,</span> limit<span style="color:#f92672">).</span><span style="color:#a6e22e">setConsumerChain</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>MySQL æ•°æ®åº“æ‹¼å‡‘åˆ†é¡µçš„ SQL è¯­å¥å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-Java" data-lang="Java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MySqlDialect</span> <span style="color:#66d9ef">implements</span> IDialect <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> DialectModel <span style="color:#a6e22e">buildPaginationSql</span><span style="color:#f92672">(</span>String originalSql<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> offset<span style="color:#f92672">,</span> <span style="color:#66d9ef">long</span> limit<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        StringBuilder sql <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> StringBuilder<span style="color:#f92672">(</span>originalSql<span style="color:#f92672">).</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34; LIMIT &#34;</span><span style="color:#f92672">).</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>FIRST_MARK<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>offset <span style="color:#f92672">!=</span> 0L<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            sql<span style="color:#f92672">.</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>StringPool<span style="color:#f92672">.</span><span style="color:#a6e22e">COMMA</span><span style="color:#f92672">).</span><span style="color:#a6e22e">append</span><span style="color:#f92672">(</span>SECOND_MARK<span style="color:#f92672">);</span>
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> DialectModel<span style="color:#f92672">(</span>sql<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span> offset<span style="color:#f92672">,</span> limit<span style="color:#f92672">).</span><span style="color:#a6e22e">setConsumerChain</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span> <span style="color:#66d9ef">else</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> DialectModel<span style="color:#f92672">(</span>sql<span style="color:#f92672">.</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span> limit<span style="color:#f92672">).</span><span style="color:#a6e22e">setConsumer</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>æ‹¼æ¥å¥½åˆ†é¡µ SQL è¯­å¥ä»¥åï¼Œå°†å…¶æ”¾åˆ° <code>metaObject</code> ä¸Šï¼Œä»¥ä¾›ä¸‹æ¸¸è¿›è¡Œæ¶ˆè´¹ã€‚</p>
<h2 id="å‚è€ƒ">å‚è€ƒ</h2>
<ul>
<li><a href="https://www.cnblogs.com/wuzhenzhao/p/11103043.html">mybatisç¼“å­˜æœºåˆ¶</a></li>
</ul>

<ins class="adsbygoogle"
style="display:block"
data-ad-client="ca-pub-8950855178079071"
data-ad-slot="6142361626"
data-ad-format="auto"
data-full-width-responsive="true"></ins>
</article>
 

      <footer class="book-footer">
        
  <div class="flex justify-between">





</div>

 
        
  
  <div class="book-comments">  </div>
  
 
      </footer>
      
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#é˜²æ­¢-sql-æ³¨å…¥">é˜²æ­¢ SQL æ³¨å…¥</a>
      <ul>
        <li><a href="#-vs-"><code>$</code> vs <code>#</code></a></li>
        <li><a href="#preparedstatement">PreparedStatement</a></li>
      </ul>
    </li>
    <li><a href="#ç¼“å­˜">ç¼“å­˜</a>
      <ul>
        <li><a href="#ä¸€çº§ç¼“å­˜">ä¸€çº§ç¼“å­˜</a></li>
        <li><a href="#äºŒçº§ç¼“å­˜">äºŒçº§ç¼“å­˜</a></li>
      </ul>
    </li>
    <li><a href="#åˆ†é¡µ">åˆ†é¡µ</a>
      <ul>
        <li><a href="#ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</a></li>
        <li><a href="#åˆ†é¡µåŸç†">åˆ†é¡µåŸç†</a></li>
      </ul>
    </li>
    <li><a href="#å‚è€ƒ">å‚è€ƒ</a></li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

  <script type="text/javascript">document.write(unescape("%3Cspan id='cnzz_stat_icon_1279346965'%3E%3C/span%3E%3Cscript src='https://v1.cnzz.com/z_stat.php%3Fid%3D1279346965%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
</body>



</html>












