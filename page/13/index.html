<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>代码人生</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="赵坤的个人网站">
<meta property="og:type" content="website">
<meta property="og:title" content="代码人生">
<meta property="og:url" content="http://blog.kunzhao.org/page/13/index.html">
<meta property="og:site_name" content="代码人生">
<meta property="og:description" content="赵坤的个人网站">
<meta property="og:locale" content="zh-cn">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="代码人生">
<meta name="twitter:description" content="赵坤的个人网站">
  
    <link rel="alternate" href="/atom.xml" title="代码人生" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    
  
  <link rel="stylesheet" href="/blog/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    
    <div id="header-inner" class="inner">
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.kunzhao.org"></form>
      </div>
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/blog/">首页</a>
        
          <a class="main-nav-link" href="/blog/archives">归档</a>
        
          <a class="main-nav-link" href="/blog/about">关于</a>
        
      </nav>
      
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/blog/" id="logo">代码人生</a>
      </h1>
      
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-git" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2017/07/10/git/" class="article-date">
  <time datetime="2017-07-10T07:19:24.000Z" itemprop="datePublished">2017-07-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/开发者手册/">开发者手册</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2017/07/10/git/">Git</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h2 id="Git"><a href="#Git" class="headerlink" title="Git"></a>Git</h2><h3 id="1-如何搭建-Git-服务器"><a href="#1-如何搭建-Git-服务器" class="headerlink" title="(1) 如何搭建 Git 服务器"></a>(1) 如何搭建 Git 服务器</h3><p>请参考<a href="https://git-scm.com/book/en/v2/Git-on-the-Server-Setting-Up-the-Server" target="_blank" rel="external">4.4 Git on the Server - Setting Up the Server</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mkdir project.git</div><div class="line"><span class="built_in">cd</span> project.git</div><div class="line">git init --bare</div></pre></td></tr></table></figure>
<h3 id="2-如何生成-SSH-Key"><a href="#2-如何生成-SSH-Key" class="headerlink" title="(2) 如何生成 SSH Key"></a>(2) 如何生成 SSH Key</h3><p>请参考<a href="https://help.github.com/articles/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent/" target="_blank" rel="external">Generating a new SSH key</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh-keygen -t rsa -b 4096 -C <span class="string">"igozhaokun@163.com"</span></div></pre></td></tr></table></figure>
<p>然后拷贝 <code>~/.ssh/id_rsa.pub</code> 中的内容到 Git 服务器电脑的 <code>~/.ssh/authorized_keys</code> 文件中去</p>
<h3 id="3-Git-Diff"><a href="#3-Git-Diff" class="headerlink" title="(3) Git Diff"></a>(3) Git Diff</h3><p><img src="git-diff.png" alt=""></p>
<h3 id="4-Git-Data-Transport-Commands"><a href="#4-Git-Data-Transport-Commands" class="headerlink" title="(4) Git Data Transport Commands"></a>(4) Git Data Transport Commands</h3><p><img src="git-operations.png" alt=""></p>
<h3 id="5-Git-Reset"><a href="#5-Git-Reset" class="headerlink" title="(5) Git Reset"></a>(5) Git Reset</h3><p><img src="RPeKg.png" alt=""></p>
<h3 id="6-Git-Tagging"><a href="#6-Git-Tagging" class="headerlink" title="(6) Git Tagging"></a>(6) Git Tagging</h3><p><img src="git-tutorial-12-638.jpg" alt=""></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ git tag -a v1.4 -m <span class="string">"my version 1.4"</span></div><div class="line">$ git tag</div><div class="line">$ git show v1.4</div><div class="line">$ git push origin --tags</div><div class="line">$ git checkout -b [branchname] [tagname]</div></pre></td></tr></table></figure>
<h3 id="7-Git-Ignore"><a href="#7-Git-Ignore" class="headerlink" title="(7) Git Ignore"></a>(7) Git Ignore</h3><p><img src="git-gitflow-18-638.jpg" alt=""></p>
<p>Visit <a href="https://www.gitignore.io/" target="_blank" rel="external">gitignore.io</a></p>
<h3 id="8-恢复误删除的文件"><a href="#8-恢复误删除的文件" class="headerlink" title="(8) 恢复误删除的文件"></a>(8) 恢复误删除的文件</h3><p>误删除，但是<strong>未提交</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git reset HEAD file.txt</div><div class="line">git checkout file.txt</div></pre></td></tr></table></figure>
<h3 id="9-添加一个-new-remote"><a href="#9-添加一个-new-remote" class="headerlink" title="(9) 添加一个 new remote"></a>(9) 添加一个 <code>new remote</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">git remote add origin https://github.com/user/repo.git</div><div class="line"><span class="comment"># Set a new remote</span></div><div class="line"></div><div class="line">git remote -v</div><div class="line"><span class="comment"># Verify new remote</span></div><div class="line">origin  https://github.com/user/repo.git (fetch)</div><div class="line">origin  https://github.com/user/repo.git (push)</div></pre></td></tr></table></figure>
<h3 id="10-git-rm"><a href="#10-git-rm" class="headerlink" title="(10) git rm"></a>(10) <code>git rm</code></h3><p><strong>不想跟踪</strong>某个文件或者文件夹了:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git rm -r --cached .idea/</div></pre></td></tr></table></figure>
<h3 id="11-删除分支"><a href="#11-删除分支" class="headerlink" title="(11) 删除分支"></a>(11) 删除分支</h3><p><strong>删除远程分支</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git push origin --delete &lt;your_branch&gt;</div></pre></td></tr></table></figure>
<p><strong>删除本地分支</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git branch -D &lt;branch_name&gt;</div></pre></td></tr></table></figure>
<h3 id="12-HEAD-detached-from"><a href="#12-HEAD-detached-from" class="headerlink" title="(12) HEAD detached from"></a>(12) HEAD detached from</h3><p>当前修改的东西不在任何一个分支上，但是也已经 <code>commit</code> 了，想要将修改部分的东西合并并切换到正确的分支上的方法：</p>
<ul>
<li>创建一个临时分支</li>
<li>切换到正确分支，<code>merge</code> 临时分支</li>
<li>删除临时分支</li>
</ul>
<p>参考: <a href="https://www.git-tower.com/learn/git/faq/detached-head-when-checkout-commit" target="_blank" rel="external">What’s a “detached HEAD” in Git?</a></p>
<h3 id="13-如何安装-Git"><a href="#13-如何安装-Git" class="headerlink" title="(13) 如何安装 Git"></a>(13) 如何安装 <code>Git</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt install git</div></pre></td></tr></table></figure>
<h3 id="14-显示某个文件被编辑的历史记录"><a href="#14-显示某个文件被编辑的历史记录" class="headerlink" title="(14) 显示某个文件被编辑的历史记录"></a>(14) 显示某个文件被编辑的历史记录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">log</span> -- [filename]</div></pre></td></tr></table></figure>
<h3 id="15-冲突"><a href="#15-冲突" class="headerlink" title="(15) 冲突"></a>(15) 冲突</h3><p><img src="2017_10_04_22_38_33.png" alt=""></p>
<h3 id="16-切换到某个-commit-然后再返回"><a href="#16-切换到某个-commit-然后再返回" class="headerlink" title="(16) 切换到某个 commit 然后再返回"></a>(16) 切换到某个 <code>commit</code> 然后再返回</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">git checkout 3c4f7121bdf2f1ab9294dd525f7eb316360c2577</div><div class="line">git checkout -</div><div class="line"><span class="comment"># 或者</span></div><div class="line">git checkout master</div></pre></td></tr></table></figure>
<h3 id="17-推送本地新分支到远程服务器"><a href="#17-推送本地新分支到远程服务器" class="headerlink" title="(17) 推送本地新分支到远程服务器"></a>(17) 推送本地新分支到远程服务器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git checkout -b &lt;branch&gt;</div><div class="line">git push -u origin &lt;branch&gt;</div></pre></td></tr></table></figure>
<h3 id="18-git-pull-的命令"><a href="#18-git-pull-的命令" class="headerlink" title="(18) git pull 的命令"></a>(18) <code>git pull</code> 的命令</h3><p>Incorporates changes from a remote repository into the current branch. In its <strong>default mode (默认情况)</strong>, <code>git pull</code> is shorthand for <code>git fetch</code> followed by <code>git merge FETCH_HEAD</code>.</p>
<p><code>git pull</code> will fetch new commits from <strong>all tracked branches (所有跟踪的版本)</strong> from the <strong>default remote(origin) (默认远程 <code>origin</code>)</strong></p>
<hr>
<p>To see <strong>which remote servers (哪个远程服务器)</strong> you have configured, you can run the <code>git remote</code> command. It lists the <strong>shortnames</strong> of each remote handle you’ve specified. If you’ve cloned your repository, you should at least see <code>origin</code> – that is the default name Git gives to the server you cloned from.</p>
<p>You can also specify <code>-v</code>, which <strong>shows you the URLs (显示 URL)</strong> that Git has stored for the shortname to be used when reading and writing to that remote.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ git remote -v</div><div class="line">origin	https://github.com/schacon/ticgit (fetch)</div><div class="line">origin	https://github.com/schacon/ticgit (push)</div></pre></td></tr></table></figure>
<hr>
<p><code>git pull</code> 默认不能用:</p>
<p><img src="2018_01_08_13_50_57.png" alt="git_pull"></p>
<p><code>git pull origin</code> 的默认行为:</p>
<p><img src="2018_01_08_13_52_53.png" alt="git_pull_origin"></p>
<p>执行如下命令后:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git branch -u origin/master</div></pre></td></tr></table></figure>
<p>会发现 <code>config</code> 文件发生了一点变化:</p>
<p><img src="2018_01_08_14_04_38.png" alt="git_config"></p>
<p>我们创建另外一个分支 <code>R1</code> 之后，并再次调用 <code>-u origin/R1</code> 发现:</p>
<p><img src="2018_01_08_14_11_36.png" alt="git_config_R1"></p>
<p>即 <code>git pull</code> 默认<strong>合并远程的哪一个分支</strong>，是需要配置的。<strong>并不是</strong>默认 <code>master</code> 就从 <code>master</code> 分支，<code>R1</code> 就从 <code>R1</code> 分支。</p>
<h3 id="19-帮助文档"><a href="#19-帮助文档" class="headerlink" title="(19) 帮助文档"></a>(19) 帮助文档</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">help</span> [COMMAND]</div></pre></td></tr></table></figure>
<p>显示所有支持查看帮助文档的命令 <code>[COMMAND]</code>: </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">help</span> -a</div></pre></td></tr></table></figure>
<h3 id="20-git-查看版本"><a href="#20-git-查看版本" class="headerlink" title="(20) git 查看版本"></a>(20) <code>git</code> 查看版本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git version</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.kunzhao.org/2017/07/10/git/" data-id="cjc5qrt1k003a5cemvlikz7ix" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>
 


  
    <article id="post-Maven" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2017/07/08/Maven/" class="article-date">
  <time datetime="2017-07-08T03:06:37.000Z" itemprop="datePublished">2017-07-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/开发者手册/">开发者手册</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2017/07/08/Maven/">Maven</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h2 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h2><h3 id="1-基本语法"><a href="#1-基本语法" class="headerlink" title="(1) 基本语法"></a>(1) 基本语法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mvn &lt;phase&gt;</div><div class="line">mvn [plugin-name]:[goal-name]</div></pre></td></tr></table></figure>
<h3 id="2-创建工程"><a href="#2-创建工程" class="headerlink" title="(2) 创建工程"></a>(2) 创建工程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn archetype:generate -DgroupId=com.mycompany.app -DartifactId=my-app -DarchetypeArtifactId=maven-archetype-quickstart -DinteractiveMode=false</div></pre></td></tr></table></figure>
<h3 id="3-如何使用-Java-8-编译"><a href="#3-如何使用-Java-8-编译" class="headerlink" title="(3) 如何使用 Java 8 编译:"></a>(3) 如何使用 Java 8 编译:</h3><p>使用插件<a href="https://maven.apache.org/plugins/maven-compiler-plugin/" target="_blank" rel="external">Apache Maven Compiler Plugin</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">        </div><div class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">extensions</span>&gt;</span>true<span class="tag">&lt;/<span class="name">extensions</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></div><div class="line">          <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">        </div><div class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="4-如何在编译项目的时候使-Javassist-生成代码"><a href="#4-如何在编译项目的时候使-Javassist-生成代码" class="headerlink" title="(4) 如何在编译项目的时候使 Javassist 生成代码:"></a>(4) 如何在编译项目的时候使 Javassist 生成代码:</h3><p>使用插件<a href="http://www.mojohaus.org/" target="_blank" rel="external">MojoHaus</a>，执行<strong>命令 <code>mvn compile</code></strong>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line"></div><div class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- Generate proxies --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.mojo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>exec-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.6.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">executions</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">execution</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- phase&gt;generate-test-sources&lt;/phase --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">goal</span>&gt;</span>java<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></div><div class="line">          <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.zk.JavassistProxyFactory<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">      </div><div class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure>
<p>其中 <code>com.zk.JavassistProxyFactory</code> 必须有 <code>main</code> 方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JavassistProxyFactory</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String... args)</span> </span>&#123;</div><div class="line">        <span class="comment">// ...</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="5-如何将源代码打包成一个-Jar-文件"><a href="#5-如何将源代码打包成一个-Jar-文件" class="headerlink" title="(5) 如何将源代码打包成一个 Jar 文件:"></a>(5) 如何将源代码打包成一个 Jar 文件:</h3><p>使用插件<a href="https://maven.apache.org/plugins/maven-source-plugin/" target="_blank" rel="external">Apache Maven Source Plugin</a>，执行<strong>命令 <code>mvn source:jar</code></strong>，默认生成的文件位于 <code>target</code> 目录下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">        </div><div class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-source-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">attach</span>&gt;</span>true<span class="tag">&lt;/<span class="name">attach</span>&gt;</span></div><div class="line">          <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">executions</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">execution</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">id</span>&gt;</span>attach-sources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">goals</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></div><div class="line">              <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></div><div class="line">          <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">        </div><div class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="6-如何生成-Javadoc-文档"><a href="#6-如何生成-Javadoc-文档" class="headerlink" title="(6) 如何生成 Javadoc 文档:"></a>(6) 如何生成 Javadoc 文档:</h3><p>使用插件<a href="https://maven.apache.org/plugins/maven-javadoc-plugin/" target="_blank" rel="external">Apache Maven Javadoc Plugin</a>，执行<strong>命令 <code>mvn javadoc:javadoc</code></strong>，默认生成的文件位于 <code>target/site/</code> 目录下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-javadoc-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.10.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">show</span>&gt;</span>public<span class="tag">&lt;/<span class="name">show</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">excludePackageNames</span>&gt;</span>com.zaxxer.hikari.hibernate:com.zaxxer.hikari.metrics.*:com.zaxxer.hikari.pool:com.zaxxer.hikari.util<span class="tag">&lt;/<span class="name">excludePackageNames</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">attach</span>&gt;</span>true<span class="tag">&lt;/<span class="name">attach</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">maxmemory</span>&gt;</span>1024m<span class="tag">&lt;/<span class="name">maxmemory</span>&gt;</span></div><div class="line">          <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">executions</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">execution</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">id</span>&gt;</span>bundle-sources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></div><div class="line">              <span class="tag">&lt;<span class="name">goals</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></div><div class="line">              <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></div><div class="line">          <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">        </div><div class="line">      <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="7-如何将项目打包成一个-Jar-文件-无任何依赖"><a href="#7-如何将项目打包成一个-Jar-文件-无任何依赖" class="headerlink" title="(7) 如何将项目打包成一个 Jar 文件 (无任何依赖):"></a>(7) 如何将项目打包成一个 Jar 文件 (无任何依赖):</h3><p>使用插件<a href="https://maven.apache.org/plugins/maven-jar-plugin/" target="_blank" rel="external">Apache Maven JAR Plugin</a>，执行<strong>命令 <code>mvn jar:jar</code></strong>，默认生成的文件位于 <code>target</code> 目录下:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-jar-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">archive</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">addDefaultImplementationEntries</span>&gt;</span>true<span class="tag">&lt;/<span class="name">addDefaultImplementationEntries</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">manifestEntries</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Implementation-Build</span>&gt;</span>$&#123;buildNumber&#125;<span class="tag">&lt;/<span class="name">Implementation-Build</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">manifestEntries</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="8-如何添加本地-Jar-包"><a href="#8-如何添加本地-Jar-包" class="headerlink" title="(8) 如何添加本地 Jar 包:"></a>(8) 如何添加本地 Jar 包:</h3><p>参考自 <a href="https://github.com/alibaba/druid/blob/master/pom.xml" target="_blank" rel="external">Alibaba-Druid-pom.xml</a></p>
<p>首先指明 Jar 所在位置:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">repository</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>local-file<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>file://$&#123;basedir&#125;/lib/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">layout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></div></pre></td></tr></table></figure>
<p>然后将 Jar 文件放到 <code>lib</code> 文件夹内，其中目录结构如下 (与 <code>~/.m2/repository/</code> 一样):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">com/taobao/tbdatasource</div><div class="line">└── tbdatasource</div><div class="line">    └── 2.0.2</div><div class="line">        ├── tbdatasource-2.0.2.jar</div><div class="line">        ├── tbdatasource-2.0.2.jar.sha1</div><div class="line">        ├── tbdatasource-2.0.2.pom</div><div class="line">        ├── tbdatasource-2.0.2.pom.sha1</div><div class="line">        ├── tbdatasource-2.0.2-sources.jar</div><div class="line">        └── tbdatasource-2.0.2-sources.jar.sha1</div></pre></td></tr></table></figure>
<p>其他的没有什么特殊的地方</p>
<h3 id="9-如何配置代理与镜像"><a href="#9-如何配置代理与镜像" class="headerlink" title="(9) 如何配置代理与镜像:"></a>(9) 如何配置代理与镜像:</h3><p>拷贝 <strong><code>/usr/share/maven/conf/settings.xml</code></strong> 到 <code>~/.m2/settings.xml</code>，然后编辑 <code>~/.m2/settings.xml</code> 添加如下内容:</p>
<p>镜像:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">mirrors</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>alimaven<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>aliyun maven<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mirrors</span>&gt;</span></div></pre></td></tr></table></figure>
<p>代理:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">proxies</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">proxy</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>bupt<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">active</span>&gt;</span>true<span class="tag">&lt;/<span class="name">active</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">protocol</span>&gt;</span>http<span class="tag">&lt;/<span class="name">protocol</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">host</span>&gt;</span>proxy1.asec.buptnsrc.com<span class="tag">&lt;/<span class="name">host</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">port</span>&gt;</span>8001<span class="tag">&lt;/<span class="name">port</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">nonProxyHosts</span>&gt;</span>local.net|some.host.com<span class="tag">&lt;/<span class="name">nonProxyHosts</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">proxy</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">proxies</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="10-如何跳过测试"><a href="#10-如何跳过测试" class="headerlink" title="(10) 如何跳过测试:"></a>(10) 如何跳过测试:</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>$&#123;skipTests&#125;<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></div></pre></td></tr></table></figure>
<p><code>skipTests</code> 有两种声明方式，一种是</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div></pre></td></tr></table></figure>
<p>另外一种是:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn install -DskipTests=<span class="literal">true</span></div></pre></td></tr></table></figure>
<p>According to the <a href="http://maven.apache.org/plugins/maven-surefire-plugin/test-mojo.html#skip" target="_blank" rel="external">documentation</a> on the Maven Surefire Plugin, <code>-Dmaven.test.skip</code> should skip both <strong>compilation and execution</strong> of the tests. By contrast, <code>-DskipTests</code> just skips the <strong>test execution</strong>: the tests are still compiled.</p>
<h3 id="11-如何进行测试"><a href="#11-如何进行测试" class="headerlink" title="(11) 如何进行测试"></a>(11) 如何<a href="https://maven.apache.org/surefire/maven-surefire-plugin/examples/single-test.html" target="_blank" rel="external">进行测试</a></h3><p>执行类 <code>HomeControllerTest</code> 中的所有测试:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn -Dtest=HomeControllerTest <span class="built_in">test</span></div></pre></td></tr></table></figure>
<p>执行多个类中的测试:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn -Dtest=TestSquare,TestCi*le <span class="built_in">test</span></div></pre></td></tr></table></figure>
<hr>
<p>执行类 <code>HomeControllerTest</code> 中的 <code>testHome</code> 方法:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn -Dtest=HomeControllerTest<span class="comment">#testHome test</span></div></pre></td></tr></table></figure>
<h3 id="12-如何将项目打包成一个大的-Jar-包-所有依赖都在里面"><a href="#12-如何将项目打包成一个大的-Jar-包-所有依赖都在里面" class="headerlink" title="(12) 如何将项目打包成一个大的 Jar 包 (所有依赖都在里面):"></a>(12) 如何将项目打包成一个大的 <code>Jar</code> 包 (所有依赖都在里面):</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-assembly-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">executions</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">goals</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>single<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">archive</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">manifest</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span></div><div class="line">              com.zk.Application</div><div class="line">            <span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></div><div class="line">          <span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">archive</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">descriptorRefs</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">descriptorRef</span>&gt;</span>jar-with-dependencies<span class="tag">&lt;/<span class="name">descriptorRef</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">descriptorRefs</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div></pre></td></tr></table></figure>
<p>执行命令 <strong><code>mvn assembly:assembly</code></strong>，请无视这样的错误，依然可以运行这个 <code>jar</code> 文件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[ERROR] Failed to execute goal org.apache.maven.plugins:maven-assembly-plugin:2.2-beta-5:assembly (default-cli) on project excelparser: Error reading assemblies: No assembly descriptors found. -&gt; [Help 1]</div></pre></td></tr></table></figure>
<p>或者执行命令 <strong><code>mvn package</code></strong>，就不会出现那样的错误。</p>
<p>另外需要注意的一点是:</p>
<p><img src="2017_09_15_22_23_32.png" alt=""></p>
<h3 id="13-Maven-生命周期"><a href="#13-Maven-生命周期" class="headerlink" title="(13) Maven 生命周期"></a>(13) Maven 生命周期</h3><p><img src="continuous-deliverywithmaven-23-728.jpg" alt=""></p>
<h3 id="14-Maven-激活某个-Profile"><a href="#14-Maven-激活某个-Profile" class="headerlink" title="(14) Maven 激活某个 Profile"></a>(14) Maven 激活某个 Profile</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn clean compile install -Ponline</div></pre></td></tr></table></figure>
<p><code>&lt;profile&gt;</code> 节点的优先级位于 <code>&lt;project&gt;</code> 节点之下，与 <code>build</code> 并排:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">profile</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>local<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">activation</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">profile</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>online<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">activation</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>false<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="15-安装-Maven"><a href="#15-安装-Maven" class="headerlink" title="(15) 安装 Maven"></a>(15) 安装 Maven</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt intall maven</div></pre></td></tr></table></figure>
<h3 id="16-Maven-运行的时候查看到更多的信息"><a href="#16-Maven-运行的时候查看到更多的信息" class="headerlink" title="(16) Maven 运行的时候查看到更多的信息"></a>(16) <code>Maven</code> 运行的时候查看到更多的信息</h3><p>使用 <strong><code>-e -X</code></strong> 能够查看更多的输出调试信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn -Prelease-all -DskipTests clean install -U -e -X</div></pre></td></tr></table></figure>
<h3 id="17-解决冲突"><a href="#17-解决冲突" class="headerlink" title="(17) 解决冲突"></a>(17) 解决冲突</h3><p><img src="2017_10_02_20_28_37.png" alt=""></p>
<p>首先运行命令 <code>mvn dependency:tree</code> 查看一下依赖树，我们可以找到哪两个依赖出现了冲突:</p>
<p><img src="2017_10_02_20_30_25.png" alt=""><br><img src="2017_10_02_20_31_30.png" alt=""></p>
<p>由此，我们知道在这两个冲突依赖中国，排除掉一个依赖就可以了:</p>
<p><img src="2017_10_02_20_34_08.png" alt=""></p>
<p>或者</p>
<p><img src="2017_10_02_20_45_53.png" alt=""></p>
<p>另外一点需要注意的是，在填写 <code>groupId</code> 和 <code>artifactId</code> 的时候，要注意<strong>排除的是 <code>+-</code> 的那一行</strong>的信息，而不是 <code>\-</code> 这一行的信息:</p>
<p><img src="2017_10_02_20_46_30.png" alt=""></p>
<h3 id="18-编码问题"><a href="#18-编码问题" class="headerlink" title="(18) 编码问题"></a>(18) 编码问题</h3><p><img src="2017_10_02_21_08_11.png" alt=""></p>
<p>添加上如下这行:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="19-本地依赖"><a href="#19-本地依赖" class="headerlink" title="(19) 本地依赖"></a>(19) 本地依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.xvolks<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>org.xvolks.jnative<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;project.basedir&#125;/lib/JNative.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="20-子模块依赖父模块"><a href="#20-子模块依赖父模块" class="headerlink" title="(20) 子模块依赖父模块"></a>(20) 子模块依赖父模块</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.parent.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="21-多模块结构"><a href="#21-多模块结构" class="headerlink" title="(21) 多模块结构"></a>(21) 多模块结构</h3><p>有多个模块的话，父模块就不要放任何代码了，否则 <code>mvn package</code> 等操作运行不过去，应该将父类代码放到子类中去。</p>
<p><img src="2017_10_14_15_53_28.png" alt=""></p>
<h3 id="22-打成-war-包"><a href="#22-打成-war-包" class="headerlink" title="(22) 打成 war 包"></a>(22) 打成 <code>war</code> 包</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-war-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">failOnMissingWebXml</span>&gt;</span>false<span class="tag">&lt;/<span class="name">failOnMissingWebXml</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="23-Software-release-life-cycle"><a href="#23-Software-release-life-cycle" class="headerlink" title="(23) Software release life cycle"></a>(23) Software release life cycle</h3><p><img src="Software_dev2.svg.png" alt=""></p>
<h3 id="24-指定不同的-pom-xml-文件"><a href="#24-指定不同的-pom-xml-文件" class="headerlink" title="(24) 指定不同的 pom.xml 文件"></a>(24) 指定不同的 <code>pom.xml</code> 文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mvn -f pom-xxx.xml</div></pre></td></tr></table></figure>
<h3 id="23-指定编译类"><a href="#23-指定编译类" class="headerlink" title="(23) 指定编译类"></a>(23) 指定编译类</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>**/api/test/omi/*.java<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="24-Apache-Maven-Assembly-Plugin"><a href="#24-Apache-Maven-Assembly-Plugin" class="headerlink" title="(24) Apache Maven Assembly Plugin"></a>(24) Apache Maven Assembly Plugin</h3><ul>
<li><p><strong>目的</strong>:将项目的文件、依赖、模块、网站文档、其它文件等东西打成一个分发包。当前支持打成一个 <code>jar</code>, <code>zip</code>, <code>tar</code>, <code>war</code>, <code>dir</code> 等其它格式。</p>
</li>
<li><p>选择/编写一个 <code>assembly</code> 描述文件</p>
</li>
<li>在 <code>pom.xml</code> 配置 <code>Assembly</code> 插件</li>
<li>在项目中运行: <code>mvn assembly:single</code></li>
</ul>
<p><img src="2017_11_14_22_57_18.png" alt=""></p>
<hr>
<p><strong>过滤文件</strong>:</p>
<p><strong>根目录下面</strong>有三个文件:</p>
<ul>
<li>过滤: <code>README.txt</code></li>
<li>拷贝: <code>LICENSE.txt</code></li>
<li>过滤: <code>NOTICE.txt</code></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">assembly</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/ASSEMBLY/2.0.0"</span></span></div><div class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></div><div class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/ASSEMBLY/2.0.0 http://maven.apache.org/xsd/assembly-2.0.0.xsd"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>distribution<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">formats</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">format</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">format</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">formats</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">files</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">file</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">source</span>&gt;</span>README.txt<span class="tag">&lt;/<span class="name">source</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>/<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">filtered</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtered</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">file</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">file</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">source</span>&gt;</span>LICENSE.txt<span class="tag">&lt;/<span class="name">source</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>/<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">file</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">file</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">source</span>&gt;</span>NOTICE.txt<span class="tag">&lt;/<span class="name">source</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>/<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">filtered</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtered</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">file</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">files</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">assembly</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="25-如何跳过某个插件-一些情况下执行、一些情况下又不需要执行"><a href="#25-如何跳过某个插件-一些情况下执行、一些情况下又不需要执行" class="headerlink" title="(25) 如何跳过某个插件 (一些情况下执行、一些情况下又不需要执行)"></a>(25) 如何跳过某个插件 (一些情况下执行、一些情况下又不需要执行)</h3><p><code>Maven</code> 的答案就是针对不同的环境生成不同的构件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 查看当前激活的 profile</span></div><div class="line">mvn <span class="built_in">help</span>:active-profiles</div><div class="line"><span class="comment"># 列出当前所有 profile</span></div><div class="line">mvn <span class="built_in">help</span>:all-profiles</div></pre></td></tr></table></figure>
<h3 id="26-忽略资源目录下的某些文件"><a href="#26-忽略资源目录下的某些文件" class="headerlink" title="(26) 忽略资源目录下的某些文件"></a>(26) <a href="https://maven.apache.org/plugins/maven-resources-plugin/examples/include-exclude.html" target="_blank" rel="external">忽略资源目录下的某些文件</a></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">resource</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">exclude</span>&gt;</span>log4j.properties<span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div></pre></td></tr></table></figure>
<p>这样会导致两个地方都没有：</p>
<ul>
<li>最终 <code>build</code> 出来的 <code>jar</code> 不包含 <code>log4j.properties</code></li>
<li>直接从 <code>IDEA</code> 中运行，在 <code>target</code> 临时目录下面，也没有 <code>log4j.properties</code></li>
</ul>
<h3 id="27-install-U"><a href="#27-install-U" class="headerlink" title="(27) install -U"></a>(27) <code>install -U</code></h3><p>Maven is checking for update of SNAPSHOT artifacts base on an interval. By default it is checked <strong>每天</strong>. Which means, if in the morning you got an update in SNAPSHOT, and another version is available in the afternoon in the remote repository, you will not be able to get it until tomorrow.</p>
<p><code>-U</code> options <strong>强制</strong> checking for SNAPSHOT <strong>更新</strong> even the update interval is not reached.</p>
<h3 id="28-某些依赖设置可选"><a href="#28-某些依赖设置可选" class="headerlink" title="(28) 某些依赖设置可选"></a>(28) 某些依赖设置可选</h3><p>以下是 <code>MyBatis</code> 的 <code>Log</code> 依赖项，<code>Maven</code> 的默认 <code>scope</code> 就是 <code>compile</code>:</p>
<p><img src="2018_01_04_17_07_37.png" alt="optional_dependency"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.kunzhao.org/2017/07/08/Maven/" data-id="cjc5qrsvc000h5cemq1t0rro8" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>
 


  
    <article id="post-javaweb" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2017/07/07/javaweb/" class="article-date">
  <time datetime="2017-07-07T14:41:38.000Z" itemprop="datePublished">2017-07-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/开发者手册/">开发者手册</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2017/07/07/javaweb/">javaweb</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h2 id="Java-Web"><a href="#Java-Web" class="headerlink" title="Java Web"></a>Java Web</h2><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="https://docs.gradle.org/3.3/userguide/web_project_tutorial.html" target="_blank" rel="external">Chapter 48. Web Application Quickstart</a></li>
<li><a href="https://plugins.gradle.org/plugin/org.akhikhl.gretty" target="_blank" rel="external">org.akhikhl.gretty</a></li>
<li><a href="https://softwareengineering.stackexchange.com/questions/222732/java-web-application-folder-structure" target="_blank" rel="external">Java web application folder structure</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.kunzhao.org/2017/07/07/javaweb/" data-id="cjc5qrt2700455cemq7fzwge7" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>
 


  
    <article id="post-hikaricp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2017/07/07/hikaricp/" class="article-date">
  <time datetime="2017-07-07T14:12:56.000Z" itemprop="datePublished">2017-07-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/开发者手册/">开发者手册</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2017/07/07/hikaricp/">HikariCP 性能分析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h2 id="HikariCP-性能分析"><a href="#HikariCP-性能分析" class="headerlink" title="HikariCP 性能分析"></a>HikariCP 性能分析</h2><h3 id="用-wait-还是用-yield"><a href="#用-wait-还是用-yield" class="headerlink" title="用 wait() 还是用 yield()"></a>用 <code>wait()</code> 还是用 <code>yield()</code></h3><p>下面代码摘自 <a href="https://github.com/brettwooldridge/HikariCP/blob/61be9b923d8608605eb97264129d4f0467a0a2cc/src/main/java/com/zaxxer/hikari/util/ConcurrentBag.java#L206,L219" target="_blank" rel="external">HikariCP</a> 在添加一个 <code>BagEntry</code> 时候的实现:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">final</span> T bagEntry)</span> </span>&#123;</div><div class="line">    sharedList.add(bagEntry);</div><div class="line">    <span class="comment">// spin until a thread takes it or none are waiting</span></div><div class="line">    <span class="keyword">while</span> (waiters.get() &gt; <span class="number">0</span> &amp;&amp; !handoffQueue.offer(bagEntry)) &#123;</div><div class="line">        yield();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个地方，我<strong>不明白为什么使用 <code>yield</code></strong>，于是上网搜索得到三个网友的答案:</p>
<p><code>yield()</code> is a <code>Thread</code> method , <code>wait()</code> is at the origins <code>Object</code> method inheritid in thread as for all classes.</p>
<hr>
<p><code>wait</code> is for waiting on <strong>一个条件</strong>. This might not jump into the eye when looking at the method as it is entirely up to you to define what kind of condition it is. But <strong>the API</strong> tries to <strong>强制</strong> you to use it correctly by requiring that you own the monitor of the object on which you are waiting, which is necessary for a correct condition check in a multi-threaded environment.</p>
<p>So a <strong>正确使用</strong> of wait looks like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">synchronized</span>(object) &#123;</div><div class="line">  <span class="keyword">while</span>( ! <span class="comment">/* your defined condition */</span>)</div><div class="line">    object.wait();</div><div class="line">  <span class="comment">/* execute other critical actions if needed */</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>And it must be paired with another thread executing code like:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">synchronized</span>(object) &#123;</div><div class="line">  <span class="comment">/* make your defined condition true */</span>)</div><div class="line">  object.notify();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>In contrast <code>Thread.yield()</code> is just a <strong>hint</strong> that your thread might <strong>释放 CPU</strong> at this point of time. It’s not specified whether it actually does anything and, regardless of whether the CPU has been released or not, it has no impact on the semantics in respect to the memory model. In other words, it does not create any relationship to other threads which would be required for accessing shared variables correctly.</p>
<p>For example the following loop accessing <code>sharedVariable</code> (which is not declared volatile) might run forever without ever noticing updates made by other threads:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span>(sharedVariable != expectedValue) Thread.yield();</div></pre></td></tr></table></figure>
<p>While <code>Thread.yield</code> might help other threads to run (they will run anyway on most systems), it does not enforce re-reading the value of sharedVariable from the shared memory. Thus, without other constructs enforcing memory visibility, e.g. decaring <code>sharedVariable</code> as volatile, this loop is broken.</p>
<hr>
<p>Not even close, because <code>yield()</code> does not wait for anything.</p>
<p>Every thread can be in one of a number of different states: Running means that the thread is actually running on a CPU, Runnable means that nothing is preventing the thread from running except, maybe the availability of a CPU for it to run on. All of the other states can be lumped into a category called blocked. A blocked thread is a thread that is waiting for something to happen before it can become runnable.</p>
<p>The operating system preempts 抢占 running threads on a regular basis: Every so often (between 10 times per second and 100 times per second on most operating systems) the OS tags each running thread and says, “your turn is up, go to the back of the run queue’ (i.e., change state from running to runnable). Then it lets whatever thread is at the head of the run queue use that CPU (i.e., become running again).</p>
<p>When your program calls <code>Thread.yield()</code>, it’s saying to the operating system, <strong>“I still have work to do, but it might not be as important as the work that some other thread is doing. Please send me to the back of the run queue right now.”</strong> If there is an available CPU for the thread to run on though, then it effectively will just keep running (i.e., the <code>yield()</code> call will immediately return).</p>
<p>When your program calls <code>foobar.wait()</code> on the other hand, it’s saying to the operating system, <strong>“Block me until some other thread calls <code>foobar.notify()</code></strong>.</p>
<p>Yielding was first implemented on non-preemptive operating systems and, in non-preemptive threading libraries. On a computer with <strong>只有一个 CPU</strong>, the only way that more than one thread ever got to run was when the threads <strong>明确地</strong> yielded to one another.</p>
<p>Yielding also was useful for <strong>忙等待</strong>. That’s where a thread waits for something to happen by sitting in a tight loop, testing the same condition over and over again. If the condition depended on some other thread to do some work, the waiting thread would <code>yield()</code> each time around the loop in order to let the other thread do its work.</p>
<p>Now that we have preemption and multiprocessor systems and libraries that provide us with higher-level synchronization objects, there is basically no reason why an application programs would need to call <code>yield()</code> anymore.</p>
<h3 id="为什么使用-SynchronousQueue"><a href="#为什么使用-SynchronousQueue" class="headerlink" title="为什么使用 SynchronousQueue"></a>为什么使用 <code>SynchronousQueue</code></h3><p>以下代码摘自 <a href="https://github.com/brettwooldridge/HikariCP/blob/61be9b923d8608605eb97264129d4f0467a0a2cc/src/main/java/com/zaxxer/hikari/util/ConcurrentBag.java#L77" target="_blank" rel="external">HikariCP</a> 在实现 <code>ConcurrentBag</code> 借与还的时候都用到的重要同步队列的代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> SynchronousQueue&lt;T&gt; handoffQueue;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConcurrentBag</span><span class="params">(<span class="keyword">final</span> IBagStateListener listener)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.handoffQueue = <span class="keyword">new</span> SynchronousQueue&lt;&gt;(<span class="keyword">true</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>相应的这个 <code>handoffQueue</code> 在如下几种情况下都使用了:</p>
<ul>
<li><strong>借</strong>:</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">final</span> T bagEntry = handoffQueue.poll(timeout, NANOSECONDS);</div></pre></td></tr></table></figure>
<ul>
<li><strong>还</strong>:</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (bagEntry.getState() != STATE_NOT_IN_USE || handoffQueue.offer(bagEntry)) &#123;</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><strong>添加</strong>:</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span> (waiters.get() &gt; <span class="number">0</span> &amp;&amp; !handoffQueue.offer(bagEntry)) &#123;</div><div class="line">    yield();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<p>以下内容摘自 <a href="https://item.jd.com/11740734.html" target="_blank" rel="external">《Java 并发编程的艺术》</a>:</p>
<p><code>SynchronousQueue</code> 是一个不存储元素的阻塞队列。每一个 <code>put</code> 操作必须等待一个 <code>take</code> 操作，否则不能继续添加元素。它支持公平访问队列。默认情况下线程采用非公平性策略访问队列。使用以下构造方法可以创建公平性访问的 <code>SynchronousQueue</code>，如果设置为 <code>true</code>，则<strong>等待的线程会采用先进先出的顺序访问队列</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">SynchronousQueue</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>(<span class="keyword">false</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">SynchronousQueue</span><span class="params">(<span class="keyword">boolean</span> fair)</span> </span>&#123;</div><div class="line">    transferer = fair ? <span class="keyword">new</span> TransferQueue&lt;E&gt;() : <span class="keyword">new</span> TransferStack&lt;E&gt;();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>SynchronousQueue</code> 可以看成是<strong>一个传球手，负责把生产者线程处理的数据<font color="red">直接</font>传递给消费者线程</strong>。队列本身并不存储任何元素，非常适合传递性场景。<code>SynchronousQueue</code> 的吞吐量高于 <code>LinkedBlockingQueue</code> 和 <code>ArrayBlockingQueue</code>。</p>
<hr>
<p>在 <a href="https://item.jd.com/11800589.html" target="_blank" rel="external">《实战 Java 高并发程序设计》</a> 中也有对其介绍，以下是部分摘抄:</p>
<p>对于 <code>SynchronousQueue</code> 来说，它将 <code>put()</code> 和 <code>take()</code> 两个功能截然不同的操作抽象为一个共通的方法 <code>Transferer.transfer()</code>，从字面意思上看，这就是数据传递的意思:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">abstract</span> E <span class="title">transfer</span><span class="params">(E e, <span class="keyword">boolean</span> timed, <span class="keyword">long</span> nanos)</span></span>;</div></pre></td></tr></table></figure>
<p>当 <code>e</code> 参数为<strong>非空</strong>时，表示当前操作传递给一个消费者，如果为空，则表示当前操作需要请求一个数据。如果返回值非空，则表示数据已经接受或者正常提供，如果为空，则表示失败（超时或者中断）。</p>
<hr>
<p>API 介绍与实现:</p>
<ul>
<li><code>offer()</code>:</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Inserts the specified element into this queue, waiting if necessary</span></div><div class="line"><span class="comment"> * up to the specified wait time for another thread to receive it.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">offer</span><span class="params">(E e, <span class="keyword">long</span> timeout, TimeUnit unit)</span></span></div><div class="line"><span class="function">    <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">    <span class="keyword">if</span> (e == <span class="keyword">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</div><div class="line">    <span class="keyword">if</span> (transferer.transfer(e, <span class="keyword">true</span>, unit.toNanos(timeout)) != <span class="keyword">null</span>)</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    <span class="keyword">if</span> (!Thread.interrupted())</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><code>poll()</code>:</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"><span class="comment"> * Retrieves and removes the head of this queue, waiting</span></div><div class="line"><span class="comment"> * if necessary up to the specified wait time, for another thread</span></div><div class="line"><span class="comment"> * to insert it.</span></div><div class="line"><span class="comment"> */</span></div><div class="line"><span class="function"><span class="keyword">public</span> E <span class="title">poll</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">    E e = transferer.transfer(<span class="keyword">null</span>, <span class="keyword">true</span>, unit.toNanos(timeout));</div><div class="line">    <span class="keyword">if</span> (e != <span class="keyword">null</span> || !Thread.interrupted())</div><div class="line">        <span class="keyword">return</span> e;</div><div class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="CompletableFuture"><a href="#CompletableFuture" class="headerlink" title="CompletableFuture"></a><code>CompletableFuture</code></h3><p><code>CompletableFuture</code> 是 Java 8 新增的一个<strong>超大型工具类</strong>，它实现了 <code>Future</code> 接口，而更重要的是，它也实现了 <code>CompletionStage</code> 接口，拥有多达 40 种方法！</p>
<p>严重怀疑<a href="https://github.com/brettwooldridge/HikariCP/blob/47b827d11e26e961bcce457cbbfd28c3356c1ee8/src/main/java/com/zaxxer/hikari/pool/HikariPool.java#L311" target="_blank" rel="external">这个地方</a>其实用错了:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addBagItem</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> waiting)</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">boolean</span> shouldAdd = waiting - addConnectionQueue.size() &gt;= <span class="number">0</span>; <span class="comment">// Yes, &gt;= is intentional.</span></div><div class="line">    <span class="keyword">if</span> (shouldAdd) &#123;</div><div class="line">        addConnectionExecutor.submit(POOL_ENTRY_CREATOR);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    CompletableFuture.completedFuture(Boolean.TRUE);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="无锁修改状态"><a href="#无锁修改状态" class="headerlink" title="无锁修改状态"></a>无锁修改状态</h3><p>不用这种方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</div><div class="line">    state = newState;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>而采用无锁方式:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PoolEntry</span> <span class="keyword">implements</span> <span class="title">IConcurrentBagEntry</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span></div><div class="line">        AtomicIntegerFieldUpdater&lt;PoolEntry&gt; stateUpdater;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">int</span> state = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> &#123;</div><div class="line">        stateUpdater = AtomicIntegerFieldUpdater</div><div class="line">            .newUpdater(PoolEntry.class, <span class="string">"state"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getState</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> stateUpdater.get(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">compareAndSet</span><span class="params">(<span class="keyword">int</span> expect, <span class="keyword">int</span> update)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> stateUpdater.compareAndSet(<span class="keyword">this</span>, expect, update);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setState</span><span class="params">(<span class="keyword">int</span> update)</span> </span>&#123;</div><div class="line">        stateUpdater.set(<span class="keyword">this</span>, update);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<ul>
<li><code>Updater</code> 使用<strong>反射</strong>得到这个变量。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> tclass.getDeclaredField(fieldName);</div></pre></td></tr></table></figure>
<ul>
<li>为了确保变量被正确的读取，它<strong>必须是 <code>volatile</code> 类型</strong>的。</li>
</ul>
<hr>
<p><code>AtomicIntegerFieldUpdater</code> 能够<strong>原子更新</strong>整型字段。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><a href="http://www.cnblogs.com/zou90512/p/5559357.html" target="_blank" rel="external">面试总结 - 数据库连接池</a></li>
<li><a href="http://freeman1.iteye.com/blog/2268874" target="_blank" rel="external">数据库连接池性能比对</a></li>
<li><a href="https://www.oschina.net/p/hikaricp" target="_blank" rel="external">HikariCP 详细介绍</a></li>
<li><a href="https://github.com/brettwooldridge/HikariCP" target="_blank" rel="external">Github - HikariCP</a></li>
<li><a href="https://github.com/brettwooldridge/HikariCP/wiki/Down-the-Rabbit-Hole" target="_blank" rel="external">Github - WIKI - Down the Rabbit Hole</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.kunzhao.org/2017/07/07/hikaricp/" data-id="cjc5qrt1q003k5cem9bdr0cyc" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>
 


  
    <article id="post-MySQL-High-Availability" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/blog/2017/07/07/MySQL-High-Availability/" class="article-date">
  <time datetime="2017-07-07T08:40:49.000Z" itemprop="datePublished">2017-07-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/blog/categories/开发者手册/">开发者手册</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/blog/2017/07/07/MySQL-High-Availability/">MySQL_High_Availability</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <!-- Table of Contents -->
        
        <h2 id="MySQL-High-Availability"><a href="#MySQL-High-Availability" class="headerlink" title="MySQL_High_Availability"></a>MySQL_High_Availability</h2><p><code>my.cnf</code> 位置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/etc/mysql/mysql.conf.d/mysqld.cnf</div></pre></td></tr></table></figure>
<p>配置 Master:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[mysqld]</div><div class="line">#</div><div class="line"># * Basic Settings</div><div class="line">#</div><div class="line">user        = mysql</div><div class="line">pid-file    = /var/run/mysqld/mysqld.pid</div><div class="line">socket      = /var/run/mysqld/mysqld.sock</div><div class="line">port        = 3306</div><div class="line">basedir     = /usr</div><div class="line">datadir     = /var/lib/mysql</div><div class="line">tmpdir      = /tmp</div><div class="line"></div><div class="line"># 添加如下三行</div><div class="line"># 二进制日志产生的所有文件的基本名</div><div class="line">log-bin     = master-bin</div><div class="line"># 二进制索引文件的文件名</div><div class="line">log-bin-index = master-bin.index</div><div class="line"># 每个服务器都有一个唯一的服务器 ID</div><div class="line">server-id   = 1</div></pre></td></tr></table></figure>
<p>重启 Master 使配置生效:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo service mysql restart</div></pre></td></tr></table></figure>
<p>Slave 启动一个标准的客户端连到 Master，并请求 Master 将所有的改动转储给它。Slave 连接时要求 Master 上有一个特殊复制权限的用户:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mysql&gt; CREATE USER repl_user;</div><div class="line">mysql&gt; GRANT REPLICATION SLAVE ON *.* TO repl_user IDENTIFIED BY 'xyzzy';</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://blog.kunzhao.org/2017/07/07/MySQL-High-Availability/" data-id="cjc5qrsv8000f5cemd3hyc34p" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>
 


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/blog/page/12/">&laquo; Prev</a><a class="page-number" href="/blog/">1</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/11/">11</a><a class="page-number" href="/blog/page/12/">12</a><span class="page-number current">13</span><a class="page-number" href="/blog/page/14/">14</a><a class="page-number" href="/blog/page/15/">15</a><span class="space">&hellip;</span><a class="page-number" href="/blog/page/23/">23</a><a class="extend next" rel="next" href="/blog/page/14/">Next&raquo;</a>
  </nav>
</section>
           
    <aside id="sidebar">
  
    

  
    
  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title recent-posts">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/blog/2018/01/06/where-the-time-actually-gone/">时间都去哪儿了</a>
          </li>
        
          <li>
            <a href="/blog/2018/01/05/dev-reflection/">开发反思</a>
          </li>
        
          <li>
            <a href="/blog/2018/01/05/my-microblog/">我的微博</a>
          </li>
        
          <li>
            <a href="/blog/2018/01/04/gcc-basic/">gcc-basic</a>
          </li>
        
          <li>
            <a href="/blog/2018/01/04/java-internal/">Java Internal</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    

  
    
  
</aside>

      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-left">
      &copy; 2014 - 2018 赵坤&nbsp;|&nbsp;
      Theme by <a href="https://github.com/giscafer/hexo-theme-cafe/" target="_blank">Cafe</a>
    </div>
     <div id="footer-right">
      Contact&nbsp;|&nbsp;igozhaokun@163.com
    </div>
  </div>
</footer>
 <script src="/blog/jquery/jquery.min.js"></script>
    </div>
    <nav id="mobile-nav">
  
    <a href="/blog/" class="mobile-nav-link">首页</a>
  
    <a href="/blog/archives" class="mobile-nav-link">归档</a>
  
    <a href="/blog/about" class="mobile-nav-link">关于</a>
  
</nav>
    <img class="back-to-top-btn" src="/blog/images/fly-to-top.png"/>
<script>
// Elevator script included on the page, already.
window.onload = function() {
  var elevator = new Elevator({
    selector:'.back-to-top-btn',
    element: document.querySelector('.back-to-top-btn'),
    duration: 1000 // milliseconds
  });
}
</script>

      

  

  







<!-- author:forvoid begin -->
<!-- author:forvoid begin -->

<!-- author:forvoid end -->

<!-- author:forvoid end -->


  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      })
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      })
    </script>
    <script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js"></script>
  


 <script src="/blog/js/is.js"></script>


  <link rel="stylesheet" href="/blog/fancybox/jquery.fancybox.css">
  <script src="/blog/fancybox/jquery.fancybox.pack.js"></script>


<script src="/blog/js/script.js"></script>
<script src="/blog/js/elevator.js"></script>
  </div>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>